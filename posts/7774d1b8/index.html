
  <script type="text/javascript">
    (function () {
      var dayStr = '2020/04/04';
      if (/^\d{1,2}\/\d{1,2}$/.test(dayStr)) {
        dayStr = new Date().getFullYear() + '/' + dayStr;
      }
      if (!/^\d{4}\/\d{1,2}\/\d{1,2}$/.test(dayStr)) {
        return ;
      }
      var day = new Date(dayStr);
      var now = new Date();
      var isMemorialDay = now.getFullYear() === day.getFullYear() && now.getMonth() === day.getMonth() && now.getDate() === day.getDate();
      if (isMemorialDay) {
        if (document.all) {
          window.style = 'html {     -webkit-filter: grayscale(100%); /* webkit */     -moz-filter: grayscale(100%); /* firefox */     -ms-filter: grayscale(100%); /* ie9 */     -o-filter: grayscale(100%); /* opera */     filter: grayscale(100%);     filter:progid:DXImageTransform.Microsoft.BasicImage(grayscale=1); filter:gray; /* ie9- */   }';
          document.createStyleSheet('javascript:style');
        } else {
          var style = document.createElement('style');
          style.type = 'text/css';
          style.innerHTML = 'html {     -webkit-filter: grayscale(100%); /* webkit */     -moz-filter: grayscale(100%); /* firefox */     -ms-filter: grayscale(100%); /* ie9 */     -o-filter: grayscale(100%); /* opera */     filter: grayscale(100%);     filter:progid:DXImageTransform.Microsoft.BasicImage(grayscale=1); filter:gray; /* ie9- */   }';
          document.getElementsByTagName('HEAD').item(0).appendChild(style);
        }
      }
    })();
  </script>
  <!DOCTYPE html><html lang="en" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="http://image.beenli.cn/img/20200429/F7MQvrUt2Q4K.png?imageslim"><link rel="icon" type="image/png" href="http://image.beenli.cn/img/20200429/F7MQvrUt2Q4K.png?imageslim"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="description" content="A senior in JLU majoring in EE/CS. I am interested in Domain-specific accelerator based on RISC-V."><meta name="author" content="Wan Li"><meta name="keywords" content="digital IC, ASIC, Linux, Vim, python, 电子狗, 程序猿"><title>gem5简介和dvfs应用初探 - WanLi&#39;s blog</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/9.18.1/styles/github-gist.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_ijqayz9ro8k.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1791347_g19vm5ywni.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"www.beenli.cn",root:"/",version:"1.8.7",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},copy_btn:!0,image_zoom:{enable:!0},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:1},lazyload:{enable:!0,onlypost:!1},web_analytics:{enable:!0,baidu:"e003c704a60a6fe8b1437118b71fea30",google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null},tajs:null}}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="WanLi's blog" type="application/atom+xml">
</head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>WanLi's blog</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> Home</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> Archives</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> Categories</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> Tags</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> About</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:" rel="external nofollow noreferrer">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(http://image.beenli.cn/img/20200426/ytR82GE0j1B5.jpg?imageslim) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="gem5简介和dvfs应用初探"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-08-25 04:48" pubdate>Wednesday, August 25th 2021, 4:48 am</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 5.1k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 60 分钟</span></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">gem5简介和dvfs应用初探</h1><p class="note note-info">本文最后更新于：Saturday, April 9th 2022, 10:53 pm</p><div class="markdown-body"><h1 id="1-性能仿真器1"><a href="#1-性能仿真器1" class="headerlink" title="1 性能仿真器1"></a>1 性能仿真器<a href="#refer-anchor-1"><sup>1</sup></a></h1><p>上世纪80年代早期，高性能计算机的设计很大程度上是<code>数据驱动</code>的。例如对指令使用情况的分析发现在真实的机器上，不是每种指令都是以相同的频率被执行。设计人员利用这一观察来优化这些机器的具体实现。但是，这种直接的测量属于<code>后设计</code>操作步骤，并不总能在设计阶段帮助优化。作为替代方案，架构师们使用<code>分析模型</code>来预测性能，它们在初始阶段剔除一部分设计空间是成功的，但是在评估更复杂的<code>设计权衡</code>时不是那么奏效。</p><p>随着工艺节点的进步，片上能塞进更多的晶体管，计算机系统可以变得十分复杂。早在2004年，由于风冷芯片最大功耗和无法有效地开发更多指令集并行这两大孪生瓶颈，Intel取消自己的高性能单核处理器项目转向多核心开发。面对多核心，更深的存储层次，异构计算等日益复杂的计算系统，设计师们开始诉诸<code>仿真模型</code>在项目初期预测机器性能。</p><p>这些仿真模型大多使用高层次编程语言来编写，例如C或者C++。它们不仅要保证很高的评估保真度，而且在仿真速度上要比RTL高几个数量级。常见的性能仿真器有：<code>Rsim</code>, <code>Simics</code>, <code>SimpleScalar</code>和 <code>Asim</code></p><div class="table-container"><table><thead><tr><th style="text-align:center">仿真器</th><th style="text-align:center">特点</th></tr></thead><tbody><tr><td style="text-align:center"><a href="http://rsim.cs.illinois.edu/rsim/dist.html" rel="external nofollow noreferrer">Rsim</a></td><td style="text-align:center">仿真使用共享内存的ILP处理器的多核系统</td></tr><tr><td style="text-align:center"><a href="https://en.wikipedia.org/wiki/Simics" rel="external nofollow noreferrer">Simics</a></td><td style="text-align:center">全系统模拟器，用于以高性能速度运行目标硬件的未更改二进制文件</td></tr><tr><td style="text-align:center"><a href="http://www.simplescalar.com/" rel="external nofollow noreferrer">SimpleScalar</a></td><td style="text-align:center">计算机系统建模的基础设施（仿真框架)</td></tr><tr><td style="text-align:center"><a href="https://www.researchgate.net/publication/2955583_Asim_A_performance_model_framework" rel="external nofollow noreferrer">Asim</a></td><td style="text-align:center">一个性能模型框架，Asim 将 SimpleScalar 的重用理念扩展到模拟器本身内的细粒度模块化组件</td></tr></tbody></table></div><h1 id="2-gem5简介2"><a href="#2-gem5简介2" class="headerlink" title="2 gem5简介2"></a>2 gem5简介<a href="#refer-anchor-2"><sup>2</sup></a></h1><h2 id="2-1-gem5是什么"><a href="#2-1-gem5是什么" class="headerlink" title="2.1 gem5是什么"></a>2.1 gem5是什么</h2><blockquote><p>The gem5 <code>simulator</code> is a <code>modular platform</code> for computer-system architecture research, encompassing <code>system-level</code> architecture as well as <code>processor microarchitecture</code><a href="#refer-anchor-3"><sup>3</sup></a></p><ul><li>gem5是一个<code>开源</code>的计算机系统性能仿真器，既可以全系统仿真也可以进行处理器的微架构仿真。</li><li>gem5融合了<a href="https://www.computer.org/csdl/magazine/mi/2006/04/m4052/13rRUxYIMRJ" rel="external nofollow noreferrer">M5</a>和<a href="https://dl.acm.org/doi/10.1145/1105734.1105747" rel="external nofollow noreferrer">GEMS</a>仿真器两者最好的部分。M5提供高度可配置的仿真框架，多个ISAs还有多种CPU模型。GEMS通过详细且扩展性好的内存系统补充M5这些特点。</li><li>gem5是一个精英管理的社区工具。其良好的可扩展性，模块化仿真对象和简洁明确的接口使得研究者们可以专注于特定部分代码而无需理解全部代码。</li></ul></blockquote><h2 id="2-2-为什么使用gem54"><a href="#2-2-为什么使用gem54" class="headerlink" title="2.2 为什么使用gem54"></a>2.2 为什么使用gem5<a href="#refer-anchor-4"><sup>4</sup></a></h2><ul><li><code>运行真实的负载</code>(比如运行像Linux，Android等复杂的负载)</li><li><code>提供系统级别的视野</code>(比如设备之间的交互，操作系统交互)</li><li><code>挂载定制的模型</code>(gem5提供了封装有通用外设接口的基类，开箱即用的常见硬件模型)</li><li><code>早期快速原型验证</code>(通过参数化的模型使能快速设计空间探索)</li><li><code>gem5在工业和学术界有大量的用户群体</code>(自从2011年合并以来，gem5 已被 2900 多篇出版物引用)</li></ul><h2 id="2-3-gem5设计特色"><a href="#2-3-gem5设计特色" class="headerlink" title="2.3 gem5设计特色"></a>2.3 gem5设计特色</h2><blockquote><p>设计gem5时使用了很多卓越软件工程实践的方法：<code>无处不在的面向对象</code>, <code>集成Python</code>, <code>领域特定语言(DSL)</code>和<code>标准的接口</code></p></blockquote><ul><li><p><code>可扩展性</code>是gem5模拟器一个重要的目标，也是它成功的关键因素。而这种特性很大一部分是通过底层C++代码面向对象设计实现的。也正是由于gem5扩展性好，可以满足不同仿真任务的需求。例如，当一个想法从高层次的概念到具体的设计实现孵化过程中，架构师需要一个能在不同抽象层级上仿真的工具，兼具仿真速度和正确性。一个细粒度的门控实验可能需要详细的CPU模型，而对多核的建模不是必须的；与此同时一个高度可伸缩互连模型可能需要多个CPU,但是这些CPU没必要建模太多细节。此外，随着时间的推移，通过长期使用一个仿真配套设施，架构师能够以更少的开销更快地完成更多的工作。</p></li><li><p><code>Python集成</code>使得gem5的配置变得更加灵活，同时对用户的接口也更加友好。python主要完成仿真对象配置，初始化，构建系统的拓扑结构和仿真流的控制。</p></li><li><p><code>DSL</code>的使用使得gem5在<code>ISA</code>和<code>Cache Coherence</code>建模上更加简洁和高效。</p></li><li><p>gem5定义了一个重要的<code>port interface</code>，<code>Ports</code>用来连接gem5中两个内存对象。内存对象通过一个叫<code>Packet</code>的内存请求对象来传递消息。</p></li></ul><h2 id="2-4-gem5常见的模型"><a href="#2-4-gem5常见的模型" class="headerlink" title="2.4 gem5常见的模型"></a>2.4 gem5常见的模型</h2><ol><li><p><code>CPU 模型</code></p><p><img src="https://image.beenli.cn/CPU%20model.png?imageslim" srcset="/img/loading.gif" alt="cpu model"></p><ul><li>从左到右建模得越来越详细，实现的功能也更多，但是仿真速度越来越慢。</li></ul></li><li><p><code>系统模式</code></p></li></ol><div class="table-container"><table><thead><tr><th>Full system mode(<code>FS</code>)</th><th>建模完整的计算系统，包括OS和外设。还需要建模中断，异常，特权指令，故障处理</th></tr></thead><tbody><tr><td>System-call Emulation mode(<code>SE</code>)</td><td>只用建模用户可见的ISA，加上常见的系统调用(通常通过调用主机的OS)</td></tr></tbody></table></div><ol><li><p><code>内存 模型</code></p><p><img src="https://image.beenli.cn/Memory%20system.png?imageslim" srcset="/img/loading.gif" alt="memory system"></p><ul><li>gem5提供两种内存模型：<code>Classic</code> 和 <code>Ruby</code></li><li>在上图的例子中不需要使用Ruby选项运行gem5。但是如果研究缓存一致性协议，则可能需要使用Ruby模型，因为它提供了扩展性好的内存系统(SLICC用于缓存协议的领域专用语言），详细的统计数据和部件仿真模型。</li></ul></li></ol><h1 id="3-gem5开发介绍"><a href="#3-gem5开发介绍" class="headerlink" title="3 gem5开发介绍"></a>3 gem5开发介绍</h1><blockquote><p>几乎所有的gem5仿真对象使用C++编写，外面用Python包裹。gem5使用<a href="https://pybind11.readthedocs.io/en/stable/index.html" rel="external nofollow noreferrer">pybind11</a>工具完成C++对象和Python对象之间的绑定，而整个项目的编译则由<a href="https://scons.org/" rel="external nofollow noreferrer">Scons</a>构建工具完成。</p></blockquote><h2 id="3-1-gem5编译"><a href="#3-1-gem5编译" class="headerlink" title="3.1 gem5编译"></a>3.1 gem5编译</h2><ul><li><p>下载gem5源代码(写此文时最新稳定版本为v21.0.1.0)</p><p><code>git clone https://gem5.googlesource.com/public/gem5</code></p></li><li><p>编译gem5</p><ul><li><p><a href="https://www.gem5.org/documentation/learning_gem5/part1/building/" rel="external nofollow noreferrer">首先根据官方介绍下载依赖</a>(主要有python3和scons)</p></li><li><p>进行编译(可以选择<code>gem5/build_opts</code>下任意一个ISA和缓存一致性协议进行编译)</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 `<span class="hljs-built_in">which</span> scons` build/ARM/gem5.opt -j $(nproc)<br></code></pre></td></tr></tbody></table></figure></li><li><p>上面使用的ARM ISA进行编译，并编译了所有的CPU model，也可以修改<code>gem5/build_opts/ARM</code>，只编译一部分CPU模型。</p></li><li><p>gem5有五种二进制类型: <code>debug</code>, <code>opt</code>, <code>fast</code>, <code>prof</code> 和<code>perf</code>。具体差别见<a href="https://www.gem5.org/documentation/learning_gem5/part1/building/" rel="external nofollow noreferrer">官网介绍</a>。通常使用opt类型。</p></li></ul></li></ul><h2 id="3-2-创建gem5仿真对象"><a href="#3-2-创建gem5仿真对象" class="headerlink" title="3.2 创建gem5仿真对象"></a>3.2 创建gem5仿真对象</h2><blockquote><p>gem5 中的所有主要仿真组件都是继承<code>SimObjects</code>， 并都具有配置、初始化、统计和序列化(检查点)的常见行为。每个仿真对象由两个类代表，一个在C++中，一个在Python中。</p><p>所有的仿真对象需要放在<code>gem5/src</code>目录下面，每次修改后需要重新编译，才能在仿真脚本中引用得到。</p></blockquote><ol><li><p><code>Python file</code><br><img src="https://image.beenli.cn/python%20file.png?imageslim" srcset="/img/loading.gif" alt="Python file"></p><ul><li>创建一个与C++对象同名的类，并继承SimObject</li><li>指明C++头文件位置(相对gem5/src目录的位置)</li><li>声明该对象可配置的参数，并可以赋予初值。(第一次参数为初值，第二参数为说明)</li></ul></li><li><p><code>C++文件</code>(一个头文件声明，一个文件进行函数实现)</p><p><img src="https://image.beenli.cn/c++%20head%20file.png?imageslim" srcset="/img/loading.gif" alt="c++ head file"></p><p><img src="https://image.beenli.cn/c++%20file.png?imageslim" srcset="/img/loading.gif" alt="C++文件"></p><ul><li>C++对象继承SimObject,同时使用<code>member initializer lists(成员初始化列表)</code>给类成员在构造函数中赋初值</li><li>gem5有一种机制，根据python对象名自动创建一个<code>xxxParams</code>类，并且该类包含了python文件中给的初始值。</li></ul></li><li><p>SConscript文件(类似cmake中的CMakeLists.txt)</p><p><img src="https://image.beenli.cn/scons%20file.png?imageslim" srcset="/img/loading.gif" alt="scons file"></p><ul><li>SConscript相当于python脚本，可以写任何符合python语法的程序。</li><li>Import，DebugFlag，SimObject, Source都是Scons提供的方法，便于用户使用。</li></ul></li></ol><h2 id="3-3-仿真配置脚本"><a href="#3-3-仿真配置脚本" class="headerlink" title="3.3 仿真配置脚本"></a>3.3 仿真配置脚本</h2><blockquote><p>gem5 源代码提供了很多实用程序和通用的配置脚本文件，都放在gem5/config/目录下。</p></blockquote><ul><li><p>首先引入仿真对象</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> m5<br><span class="hljs-keyword">from</span> m5.objects <span class="hljs-keyword">import</span> *<br></code></pre></td></tr></tbody></table></figure></li><li><p>创建一个<code>root</code>对象，系统中所有对象都是它的子对象(注：通常所有对象挂载在root.system层次下面，本次实验为了简单，没有使用system对象)</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">root = Root(full_system = <span class="hljs-literal">False</span>)<br></code></pre></td></tr></tbody></table></figure></li><li><p>实例化一个HelloObject对象，并挂载在root下面（gem5中内存对象至少有一个slave或master端口，当python中用=操作符进行连接时，底层调用端口连接函数）</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">root.hello_test = HelloObject(time_to_wait=<span class="hljs-string">'2ns'</span>, number_of_fires=<span class="hljs-number">10</span>)<br><span class="hljs-comment"># 可以通过配置脚本覆盖参数的默认值</span><br></code></pre></td></tr></tbody></table></figure></li><li><p>系统搭建完毕后就可以仿真</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">m5.instantiate()<br>print(<span class="hljs-string">"Beginning simulation!"</span>)<br>exit_event = m5.simulate()<br>print(<span class="hljs-string">'Exiting @ tick %i because %s'</span> % (m5.curTick(), exit_event.getCause()))<br></code></pre></td></tr></tbody></table></figure><h2 id="3-4-开始仿真"><a href="#3-4-开始仿真" class="headerlink" title="3.4 开始仿真"></a>3.4 开始仿真</h2></li></ul><blockquote><p>仿真命令类似如下：</p><p><code>build/ARM/gem5.opt --debug-flags=HelloExample configs/learning_gem5/part2/hello_goodbye.py</code></p></blockquote><p><img src="https://image.beenli.cn/helloExample.png?imageslim" srcset="/img/loading.gif" alt="仿真结果"></p><blockquote><hr><p>完整的实验步骤请参考<a href="https://www.gem5.org/documentation/learning_gem5/part2/helloobject/" rel="external nofollow noreferrer">官网教程</a></p></blockquote><h1 id="4-DVFS背景"><a href="#4-DVFS背景" class="headerlink" title="4 DVFS背景"></a>4 DVFS背景</h1><blockquote><p>DVFS全称为动态电压频率缩放，是一种重要的电源管理方法。本部分内容主要来自2013年的一篇论文<a href="#refer-anchor-3"><sup>3</sup></a></p></blockquote><p>想要在gem5中模型DVFS需要做哪些东西呢？</p><p><img src="https://image.beenli.cn/dvfs%E6%9E%B6%E6%9E%84.png?imageslim" srcset="/img/loading.gif" alt="DVFS在gem5系统中的架构"></p><ul><li>硬件支持<ul><li>CPU等硬件支持多频率电压工作</li><li>需要设计一个DVFS controller与软件交互</li></ul></li><li>软件支持<ul><li>通常Linux上已经存在DVFS governor可以复用(高层次模块)</li><li>我们只需要设计底层驱动，特定于硬件</li></ul></li><li>功耗评估模型<ul><li>实时统计系统功耗，输入给温控系统</li><li>比较DVFS策略的能耗效率</li></ul></li></ul><h2 id="4-1-DVFS-controller"><a href="#4-1-DVFS-controller" class="headerlink" title="4.1 DVFS controller"></a>4.1 DVFS controller</h2><p><img src="https://image.beenli.cn/dvfs_controller.png?imageslim" srcset="/img/loading.gif" alt="dvfs controller"></p><ul><li>外部提供三个寄存器：<code>domain_id</code>(每个时钟域下可以有多个仿真对象),<code>Freq level</code>(从012开始编号,编号越小频率越高),<code>Ack</code>(只读寄存器，读完清零，当当前转换完成时硬件置1)</li><li>内部记录各个时钟域的相关信息，并响应请求进行时钟电压的变换。</li><li>还需要抽象一个<code>DVFS Handler</code>仿真对象(不是IO设备),方便用户将时钟域配置进去。</li></ul><h2 id="4-2-Linux-cpufreq-driver"><a href="#4-2-Linux-cpufreq-driver" class="headerlink" title="4.2 Linux cpufreq driver"></a>4.2 Linux cpufreq driver</h2><p><img src="https://image.beenli.cn/cpufreq%E9%A9%B1%E5%8A%A8.png?imageslim" srcset="/img/loading.gif" alt="cpufreq 驱动"></p><ul><li>Linux内核一般有DVFS管理驱动程序。<code>performance</code>: 始终以最大频率运行;<code>powersave</code>: 始终以最低频率运行;<code>userspace</code>:用户自行调整频率，通过向<code>scaling_stepeed</code>文件写入频率值。<code>ondemand</code>:系统根据负载需要自行调整频率。</li><li>下层驱动需要与dvfs controller交互，同时给上层管理程序提供服务。这部分特定于硬件实现，但是只要符合上层驱动的接口规范，就可以不用修改地复用上层模块。</li><li>当需要模拟不同的电压-频率点时，只需要修改设备树文件，底层驱动从设备树文件初始化硬件，而不需重新编译下层驱动。</li></ul><h2 id="4-3-power-model"><a href="#4-3-power-model" class="headerlink" title="4.3 power model"></a>4.3 power model</h2><p><img src="https://image.beenli.cn/power%20model.png?imageslim" srcset="/img/loading.gif" alt="能耗模型"></p><blockquote><p>gem5是个模块化的系统，通过累加每个模块的能耗得出整体的能耗。每个模块分为5种电源状态，每个状态又分别由动态功耗和静态功耗组成。模块处于何种状态由系统决定，模块每种状态下计算功耗的公式人为给定。</p></blockquote><h1 id="5-DVFS实验"><a href="#5-DVFS实验" class="headerlink" title="5 DVFS实验"></a>5 DVFS实验</h1><blockquote><p>本次实验主要参考官方教程中的<a href="https://www.gem5.org/documentation/learning_gem5/part2/arm_power_modelling/" rel="external nofollow noreferrer">ARM power Modelling</a>和<a href="https://www.gem5.org/documentation/learning_gem5/part2/arm_dvfs_support/" rel="external nofollow noreferrer">ARM DVFS Support</a></p></blockquote><ul><li><p>目前最新版本(v21.0.1.0)的gem5已经内置了DVFS controller，并且提供了DVFS_Handler仿真对象</p><p><img src="https://image.beenli.cn/dvfs%E9%85%8D%E7%BD%AE%E8%84%9A%E6%9C%AC.png?imageslim" srcset="/img/loading.gif" alt="dvfs配置脚本"></p><p><img src="https://image.beenli.cn/dvfs%E7%B3%BB%E7%BB%9F%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6.png?imageslim" srcset="/img/loading.gif" alt="系统参数文件"></p><blockquote><ul><li><p>在系统仿真配置文件中使能DVFS_Handler，并将需要模拟的时钟域注册进去。</p></li><li><p>当前系统参数文件见：<code>gem5/m5out/config.ini</code> 或者config.json文件</p></li></ul></blockquote></li><li><p>gem5官方提供的修改过后的Linux版本内置了DVFS底层驱动</p><ul><li>当gem5以全系统模式仿真时，通过设置不同DVFS governor，即不同的策略，来实现动态的电压频率缩放。</li><li>本次实验使用的<a href="https://github.com/gem5/linux-arm-gem5/commits/gem5/v4.4" rel="external nofollow noreferrer">v4.4内核</a>，底层驱动为<code>arm-gem5-mc</code></li></ul><p><img src="https://image.beenli.cn/arm-gem5-mc.png?imageslim" srcset="/img/loading.gif" alt="底层驱动"></p></li></ul><h2 id="5-1-功耗估计模型"><a href="#5-1-功耗估计模型" class="headerlink" title="5.1 功耗估计模型"></a>5.1 功耗估计模型</h2><blockquote><p>下面代码见gem5/configs/example/arm/fs_power.py文件</p></blockquote><p><img src="https://image.beenli.cn/%E5%8A%9F%E8%80%97%E4%BC%B0%E8%AE%A1%E6%A8%A1%E5%9E%8B.png?imageslim" srcset="/img/loading.gif" alt="功耗估计模型"></p><blockquote><p>gem5提供的<code>MathExprPowerModel</code>类，用于用公式表达一种电源状态下模块的动静态功耗。gem5提供的<code>PowerModel</code>类用于封装模块4种状态下的功耗模型。</p><p>每个模块一般都会有各种统计信息可以用于功耗公式中，例如CPU模块的统计参数见:<code>gem5/src/cpu/base.cc</code>中的 <code>ADD_STAT(numCycles, UNIT_CYCLE, "Number of cpu cycles simulated")</code>等。Cache模块的统计参数见:<code>gem5/src/mem/cache/base.cc</code>中的<code>ADD_STAT(overallMisses, UNIT_COUNT, "number of overall misses")</code>等。</p><p>如果遇到<code>fatal: Failed to evaluate power expressions: [...]</code>，多半是因为当前模块没有该统计参数或者名称输入错误。解决办法：用vscode打开gem5/src文件夹，然后搜索ADD_STAT(xxx)，查看当前参数在哪个类中定义；或者查找相近的统计参数名称进行比对。</p></blockquote><p><img src="https://image.beenli.cn/%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%80%97%E6%A8%A1%E5%9E%8B%E5%88%B0%E6%A8%A1%E5%9D%97%E4%B8%AD.png?imageslim" srcset="/img/loading.gif" alt="注册功耗模型到模块中"></p><blockquote><p>将之前定义的<code>CPUPowerModel</code>类注册到系统中所有CPU中，这样全系统仿真时才会有CPU的功耗统计结果。</p><p>最后，可以设置每间隔多长时间，dump一次统计数据(👇使用间隔为0.01s仿真时间，默认为1s)</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">m5.stats.periodicStatDump(m5.ticks.fromSeconds(<span class="hljs-number">0.1E-1</span>))<br></code></pre></td></tr></tbody></table></figure><h2 id="5-2-设置时钟-电压域"><a href="#5-2-设置时钟-电压域" class="headerlink" title="5.2 设置时钟-电压域"></a>5.2 设置时钟-电压域</h2></blockquote><ul><li>电压域包含在时钟域里面</li><li>电压域如果是单值——时钟域可以是单值也可以是多值</li><li>电压域如果是多值——时钟域必须是多值，且项数与电压域匹配(使用降序)</li></ul><ol><li>首先在gem5/configs/example/arm/devices.py中的<code>CpuCluster</code>类中self.clk_domain中，加入<code>domain_id=system.numCpuClusters()</code>，因为domain_id必须唯一。(当系统实例化bigCluster时domai_id=0，接着实例化littleCluster时domain_id=1)</li></ol><p><img src="https://image.beenli.cn/%E6%97%B6%E9%92%9F%E5%9F%9Fdevices.png?imageslim" srcset="/img/loading.gif" alt="设置域id"></p><ol><li><p>接在在gem5/configs/example/arm/fs_bigLITTLE.py，加入对大小核时钟和电压的命令行参数输入。</p><p><img src="https://image.beenli.cn/%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E7%94%B5%E5%8E%8B%E5%92%8C%E6%97%B6%E9%92%9F.png?imageslim" srcset="/img/loading.gif" alt="参数配置电压和时钟"></p></li><li><p>将电压和频率配置进<code>CpuCluster</code>中</p><p><img src="https://image.beenli.cn/fs_bigLITTLE.png?imageslim" srcset="/img/loading.gif" alt="注册电压和频率"></p></li></ol><h2 id="5-3-全系统仿真"><a href="#5-3-全系统仿真" class="headerlink" title="5.3 全系统仿真"></a>5.3 全系统仿真</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt; <span class="hljs-built_in">cd</span> your/gem5/main/directory<br>&gt; build/ARM/gem5.opt \<br>--debug-flags=dvfs_handler,EnergyCtrl \<br>--debug-file=dvfs_debug.log  \<br>configs/example/arm/fs_power.py  \<br>--kernel=../full_system_for_gem5/binaries/vmlinux_4.4 \<br>--cache  \<br>--dvfs \<br>--big-cpu-clock 3GHz 2GHz 1GHz 900MHz \<br>--big-cpu-voltage 1.0V 0.9V 0.8V 0.5V \<br>--little-cpu-clock 2GHz 1GHz 800MHz 500MHz \<br>--little-cpu-voltage 1.0V 0.8V 0.6V 0.5Vs<br></code></pre></td></tr></tbody></table></figure><ul><li>设置debug-flags为<code>dvfs_handler</code>和<code>EnergyCtrl</code></li><li>设置debug-file为dvfs_debug.log，此文件将记录系统初始化DVFS，频率切换过程等</li><li>—kernel指定内核，本次实验使用的是v4.4。</li><li>可以使用—disk设置镜像文件位置，脚本默认镜像为aarch64-ubuntu-trusty-headless.img，可以通过<a href="http://dist.gem5.org/dist/current/arm/disks/aarch64-ubuntu-trusty-headless.img.bz2" rel="external nofollow noreferrer">网址</a>下载。</li><li>需要设置<code>M5_PATH</code>环境变量，该目录包含两个文件夹，分别为binary和disk，把编译好的内核vmlinux复制到binary文件夹下，下载好的镜像复制到disk文件夹下。</li></ul><hr><ol><li><p>另开一个终端，输入命令<code>telnet localhost 3456</code>，等待两到三小时后(因为默认大核使用的O3 CPU，小核使用的Minor CPU，所以启动Linux很慢)，进入Linux命令行，输入root即可。</p><p><img src="https://image.beenli.cn/%E8%BF%9B%E5%85%A5Linux%E5%91%BD%E4%BB%A4%E8%A1%8C.png?imageslim" srcset="/img/loading.gif" alt="进入Linux命令行"></p></li><li><p>进入cpufreq目录(dvfs内核接口)</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt; <span class="hljs-built_in">cd</span> /sys/devices/system/cpu/cpu0/cpufreq<br>&gt; ls<br></code></pre></td></tr></tbody></table></figure><blockquote><p>该目录下有很多与dvfs有关的信息文件，比如<code>scaling_driver</code>即底层驱动名称，scaling_governor为高层驱动名称。cpuinfo_tarnsition_latency为频率调整时间，cpuinfo_cur_freq为当前CPU频率等。</p></blockquote><p><img src="https://image.beenli.cn/cpufreq%20directory.png?imageslim" srcset="/img/loading.gif" alt="cpufreq 目录"></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt; cat scaling_available_frequencies<br></code></pre></td></tr></tbody></table></figure><p><img src="https://image.beenli.cn/scaling_frequency.png?imageslim" srcset="/img/loading.gif" alt="可以调整的频率"></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt; <span class="hljs-built_in">echo</span> <span class="hljs-string">"userspace"</span> &gt; scaling_governor<br>&gt; cat cpuinfo_cur_freq<br>&gt; <span class="hljs-built_in">echo</span> <span class="hljs-string">"3003003"</span> &gt; scaling_setspeed<br>&gt; cat cpuinfo_cur_freq<br></code></pre></td></tr></tbody></table></figure><p><img src="https://image.beenli.cn/%E6%89%8B%E5%8A%A8%E8%B0%83%E9%A2%91%E7%8E%87.png?imageslim" srcset="/img/loading.gif" alt="手动调频"></p></li></ol><h2 id="5-4-Benchmark比较"><a href="#5-4-Benchmark比较" class="headerlink" title="5.4 Benchmark比较"></a>5.4 Benchmark比较</h2><blockquote><p>通过跑stamp-roi-o2/genome/genome_roi_lock来比较<code>performance</code>和<code>Ondemand</code>不同调度策略的效率。</p></blockquote><ol><li><p>在5.3节中我们已经进入仿真系统的Linux命令行，由于Linux默认调度程序为<code>perfermance</code>，所以先保存一个检查点。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&gt; m5 checkpoint <br></code></pre></td></tr></tbody></table></figure><p>保存的检查点文件夹在gem5/m5out下，一般以cpt.xxx命名的目录下(xxx为从仿真开始到执行checkpoint这段时间的时钟tick数)</p></li><li><p>然后，调整scaling_governor为ondemand后，再保存一个检查点。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt; <span class="hljs-built_in">echo</span> <span class="hljs-string">"ondemand"</span> &gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor<br>&gt; m5 checkpoint<br></code></pre></td></tr></tbody></table></figure></li><li><p>从<code>perfermance</code>恢复，然后开始执行程序</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt; build/ARM/gem5.opt \<br>--debug-flags=dvfs_handler,EnergyCtrl \<br>--debug-file=dvfs_debug.log  \<br>configs/example/arm/fs_power.py  \<br>--kernel=../full_system_for_gem5/binaries/vmlinux_4.4 \<br>--cache  \<br>--dvfs \<br>--big-cpu-clock 3GHz 2GHz 1GHz 900MHz \<br>--big-cpu-voltage 1.0V 0.9V 0.8V 0.5V \<br>--little-cpu-clock 2GHz 1GHz 800MHz 500MHz \<br>--little-cpu-voltage 1.0V 0.8V 0.6V 0.5Vs<br>--retore-from m5out/performance<br><br>&gt; ./genome_roi_lock -g256 -s16 -n16384 -t1<br></code></pre></td></tr></tbody></table></figure><p><img src="https://image.beenli.cn/perfermance_time.png?imageslim" srcset="/img/loading.gif" alt="performance运行时间"></p><p>再开一个窗口，查看gem5统计的数据(<code>gem5/m5out/stats.txt</code>)</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt; cat -n stats.txt | grep -E <span class="hljs-string">'system.bigCluster.clk_domain.clock|simSeconds|system.bigCluster.cpus.power_model.dy*|system.bigCluster.cpus.power_model.st*'</span><br></code></pre></td></tr></tbody></table></figure><p><img src="2021-08-25-gem5简介和dvfs应用初探\performance_statistic.png" srcset="/img/loading.gif" alt="performance 统计数据"></p></li><li><p>从<code>ondemand</code>中恢复,然后开始执行程序</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt; build/ARM/gem5.opt \<br>--debug-flags=dvfs_handler,EnergyCtrl \<br>--debug-file=dvfs_debug.log  \<br>configs/example/arm/fs_power.py  \<br>--kernel=../full_system_for_gem5/binaries/vmlinux_4.4 \<br>--cache  \<br>--dvfs \<br>--big-cpu-clock 3GHz 2GHz 1GHz 900MHz \<br>--big-cpu-voltage 1.0V 0.9V 0.8V 0.5V \<br>--little-cpu-clock 2GHz 1GHz 800MHz 500MHz \<br>--little-cpu-voltage 1.0V 0.8V 0.6V 0.5Vs<br>--retore-from m5out/ondemand<br><br>&gt; ./genome_roi_lock -g256 -s16 -n16384 -t1<br></code></pre></td></tr></tbody></table></figure><p><img src="https://image.beenli.cn/ondemand_time_2.png?imageslim" srcset="/img/loading.gif" alt="ondemand 运行时间"></p><p><img src="https://image.beenli.cn/on_demand_statistic_2.png?imageslim" srcset="/img/loading.gif" alt="Ondemand统计数据"></p><ul><li><p>从statistic可以看出，在跑程序之前CPU工作在最低频率下，即图中的clock=1111(900MHz)；当进入程序时，governor将CPU频率从1111变化到333(即3GHz)，以最高频率工作。当工作完成后，CPU继续以3GHz进行程序的收尾部分，然后在某一瞬间，变化到1GHz(1000)，如果后续没有负载则在这个过渡态待一会儿，又将CPU调度到900MHz工作。</p><p><img src="2021-08-25-gem5简介和dvfs应用初探\Ondemand全过程.png" srcset="/img/loading.gif" alt="Ondemand时序图"></p></li></ul></li><li><p>结果比较</p><p>| <code>dvfs调度策略</code> | 时间(s) | 动态功耗(w) | 静态功耗(w) |<br>| :——————: | :———: | :————-: | :————-: |<br>| performance | 0.004403 | 1.65 | 93.84 |<br>| ondemad | 0.007800 | 0.05 | 5.3 |</p><ul><li>由于Ondemand将cpu调整到3GHz，有延迟并且需要转换时间，而Performance策略CPU一直在3GHz运行，因此Ondemand运行的时间更长。</li><li>由于本次实验只是想通过DVFS达到控制频率点的目的，对于CPU还有其它模块的动静态功耗公式只是用单一指标简单示意(比如动态功耗定义成与电压成正比，静态功耗定义成与温度成正比)，没有进行详尽的建模和修正，所以计算得到的结果只能比较相对值，绝对值没有意义。</li><li>在Performance的调度策略下，CPU一直处于最高频率下工作，温度会较低频率更高。因此静态功耗会更高。又因为越高的频率所需的电压越高，其动态功率也会越大，与最后得到的实验结果相一致。</li></ul></li></ol><h2 id="5-5-遗留问题"><a href="#5-5-遗留问题" class="headerlink" title="5.5 遗留问题"></a>5.5 遗留问题</h2><ol><li><p>为什么只有CPU0(即大核)能够应用DVFS，而CPU1(小核)不能动态调整频率。</p><p><img src="https://image.beenli.cn/dvfs_log.png?imageslim" srcset="/img/loading.gif" alt="dvfs_debug log"></p><blockquote><p>通过查看<code>dvfs_debug.log</code>文件，可以看到系统成功初始化两个domain域，大核域id为0；小核域id为1。并且初始化的电压-频率点与命令行手动输入的相吻合。由此判断DVFS的底层驱动是正确的。但是<code>/sys/devices/system/cpu/</code>文件夹下只有<code>cpu0</code>提供上层模块用户接口的<code>cpufreq</code>文件夹，而<code>cpu0</code>却没有，猜测可能的原因是目前官方提供的内核的dvfs高层驱动只支持挂载一个域。</p></blockquote></li><li><p>为什么在performance下运行benchmark只输出一组数据，而在Ondemand下输出四组数据。</p><blockquote><p>通过反复实验观察，gem5会默认每隔1s的仿真时间dump一次数据。可以通过m5.stats.periodicStatDump覆盖默认的dump周期(见5-1)。其次gem5内部实现了一种机制，只要一个域的频率发生了变化就dump一次数据(目前还没有找到办法禁掉该特性)。再者运行benchmark时，在程序ROI结尾也会自动dump一次数据。</p></blockquote></li></ol><h1 id="6-总结"><a href="#6-总结" class="headerlink" title="6 总结"></a>6 总结</h1><ul><li>gem5是一个高度模块化，参数化的性能仿真器。</li><li>gem5一直在更新迭代，对原有模型进行补充并不断有新的模型和特定应用扩展加入gem5主线</li><li>通过阅读相关文献，了解到用户在gem5中可以定制化建模硬件，并和其它现有的模型连接成系统，在这个虚拟的系统中运行未经修改或者修改后的操作系统或应用程序。</li><li>通过DVFS实验，学习到了gem5的全系统模式仿真，命令行参数配置，复杂系统的python配置文件编写等。</li></ul><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p></p><div id="refer-anchor-1"></div><p></p><ul><li>[1] Mukherjee, S. et al. “Performance Simulation Tools.” <em>Computer</em> 35 (2002): 38-39.<div id="refer-anchor-2"></div></li><li>[2] Binkert N, Beckmann B, Black G, et al. The gem5 simulator [J]. SIGARCH Comput Archit News, 2011, 39(2): 1–7.<div id="refer-anchor-3"></div></li><li>[3] gem5官方介绍和相关教程<a href="https://www.gem5.org/" rel="external nofollow noreferrer">https://www.gem5.org/</a><div id="refer-anchor-4"></div></li><li>[4] Presented by Andreas Sandberg Nikos Nikoleris, <a href="https://www.youtube.com/watch?v=81lm0hp0t-M&amp;list=PLr8iflX7VSArgv4cnqFq0qv6YtLfe4Kra" rel="external nofollow noreferrer">Arm at the Arm Research Summit 2017</a><div id="refer-anchor-5"></div></li><li>[5] V. Spiliopoulos, A. Bagdia, A. Hansson, P. Aldworth, and S. Kaxiras, ‘Introducing DVFS-Management in a Full-System Simulator’, in Proc. 21st International Symposium on Modeling, Analysis and Simulation of Computer and Telecommunication Systems, 2013.</li></ul></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/CS/">CS</a> <a class="hover-with-bg" href="/categories/CS/Computer-Organization-Design/">Computer Organization & Design</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/Architecture/">Architecture</a> <a class="hover-with-bg" href="/tags/gem5/">gem5</a></div></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" rel="nofollow noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p><div class="post-prevnext"><article class="post-prev col-6"></article><article class="post-next col-6"></article></div></div><article class="comments" id="comments"><div id="vcomments"></div><script type="text/javascript">Fluid.utils.waitElementVisible("vcomments",(function(){Fluid.utils.createScript("https://cdn.staticfile.org/valine/1.4.4/Valine.min.js",(function(){new Valine({el:"#vcomments",app_id:"wL8cVEADdoKpEaDDPPnBR9sm-gzGzoHsz",app_key:"2oJflENqEmJ8ccfv0XLxRL8O",placeholder:"说点什么",path:window.location.pathname,avatar:"monsterid",meta:["nick","mail","link"],pageSize:"10",lang:"zh-CN",highlight:!1,recordIP:!1,serverURLs:""})}))}))</script><noscript>Please enable JavaScript to view the <a href="https://valine.js.org" rel="nofollow noopener">comments powered by Valine.</a></noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p><div class="toc-body" id="toc-body"></div></div></div></div></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">keyword</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">鄂ICP备20001266号</a></span></div></footer><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/lazyload.js"></script><script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>!function(t,i){(0,Fluid.plugins.typing)(i.getElementById("subtitle").title)}(window,document)</script><script src="/js/local-search.js"></script><script>document.querySelector("#local-search-input").onclick=function(){searchFunc("/local-search.xml","local-search-input","local-search-result"),this.onclick=null}</script><script defer>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e003c704a60a6fe8b1437118b71fea30";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script src="/js/boot.js"></script></body></html>