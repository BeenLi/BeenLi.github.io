<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>WanLi&#39;s blog</title>
  <icon>https://www.gravatar.com/avatar/a560576344d33015bbc0603eeb844702</icon>
  <subtitle>Stay hungry,Stay foolish...</subtitle>
  <link href="https://www.beenli.cn/atom.xml" rel="self"/>
  
  <link href="https://www.beenli.cn/"/>
  <updated>2020-12-27T00:42:59.941Z</updated>
  <id>https://www.beenli.cn/</id>
  
  <author>
    <name>Wan Li</name>
    <email>wanli.99@qq.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç¥å§å§ç”Ÿæ—¥å¿«ä¹</title>
    <link href="https://www.beenli.cn/posts/73cde49/"/>
    <id>https://www.beenli.cn/posts/73cde49/</id>
    <published>2020-12-26T14:46:48.000Z</published>
    <updated>2020-12-27T00:42:59.941Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰ï¼Œè¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹ï¼Œè¯·å†è¯•è¯•ã€‚ã€æç¤ºã€:è·Ÿæˆ‘å§ç›¸å…³çš„" data-whm="æŠ±æ­‰ï¼Œè¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«çº æ­£ï¼Œä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹ã€‚">  <script id="hbeData" type="hbeData" data-hmacdigest="ee0db8ca0c71989bbdd733006ea2f82db6993bd2a59cadcfd14c47f463f3a0ef">765cd4b020f39b1839cce7d1faeca93862b5fd8f199261ab17dfee835d3ea6de68ebd08acfd52d6d650d0ce89df87b8125abb47a1ce5e1d8878a8ec381a443b8ff517a714a93f635cbcf4a87a852c7d37e4ebfc37d168eca59a87814d99775cab2039c85ce7813f373f8b3e79e6fc9bb388b90eba81aacd6988c27d00ce64f5faaa97db4e09d874ca8a441c2a8ffbb70a2d72522a473333bdab01b44ea8d60e773c68da4f5e9948cbf4826186d7f8c0ea50197be6188cde45925e82de8d62ba916c7501ce469d9e4a59f94db05daf797d5b1eda53f0294d17dc95c2ae692845bf5c1965e643687910461040bdbda310f423c8e82dec4d46fedabb872862b2175a8d206b2eb028cba0672d3b052f072da4347e0aa1c2fcb5c79fcb60da3b561888f375eff33d33b7dcca9e34f5814dd3db94f86a833cc69782e83a0df065665eaa028463211f34d171c82d9712c155a804ad3da54c6d5a58b7f115420cb0d4ef9ae29986b7a40cc40bffca7d48977bfc7d8c44c8c11550680437d002222db18f7ddab2d43278ebbc58710af403601618941acdb37362c205b7145de0d27752f9889ef723277058a8f88f64cc3b5bd63452607d7548cc0fdf2392f490595334ccddc38f90b20b00d069120a38fa1420db7a6b1ad3e0c9d58b238f7c55bd7d95fd41b08d99215060721c8b7331da05a0da1a153d15771d1aad0e36c612146da6b6a96b5033167f49243eea54fa65860ee7b5c53f0d77b7bf077c8ce643987e814290a33235f3312ed3ac9f3066062a5fec2c68ef85402f71420bd471716b1e72eb61b445212b91dea8ca4c1e7e54b77413d5b962198c558e4a26f3b8036d9eaa894e949bc280f43f995e421b46c350b5d33dca277441eb3628720c0b4b46ed740b2cfa14351caa01d032b17c33d2893464c90eb015217de223edf348b25285236f9bd7f645c5ad2cf63c89724f5da18307bd31aed40811e19f7adb63f478568cc7d65b0524c960b3a4c1c61fc08169f6a7f8612333717bf990a5d92ba7e91c1a87b1a762dd4e86302109e8d4446700c9ec7ac02a2c1edee9185e25a84a0217e3182a545799cdb05e1e916718215fec01d2c253d063745fa59090a311c36d1f3fe23844fb036d12f0441f873753d5295e51f19f065cc37dbc4ca7254ecf9d6efe8671e7a22eac7d4b7c5ef4b34114f78069a29ef5f9613362f85a2316e80f3329fa76d7635a2619ae5f960f90e07f6e71742d574f1199bd38db595a54c3f2d00af3e4aea8253191e61462dbd05c1313918a58b3a48d38bde15ffb70aab93ca72e3054195bdd621317f032436f5cfff307be865d205f3f50a925ef3c31c153d369953f8d3e51963c77183c19285058baac299b2ee001369857d226a3d0ca4fd984f20cfda4acdb8ca310c52d24fd172768d34aa5c346b40b7aacd9eafa273a1b306e313ac0dc3c82ba7bc201959b0f1727cdcebdc918580558950cbf0cc3dc01828368017937c3d32ce9a2b58291b63ed29069ee42dc79f9703a257b3d11cd542db89b177c5a1adade019b5d25196a7efc0e60d44d742ce21d46cabe050fd847a4c55a411b81a46786f39829de12350431c1a2dd06c434c3cd9b2dc3ba7233965ad2016e304f9fad1df72c9d610669d37c7b98a7c5087eea5f26afd0a4d8e805122a6b1c2324e17c9257e825a8e01aa0c9cf598d8dc0fce2e91382fa2154d0b33be57a87b5571f6439da3db20057377ae3f59e92d4f8137082a38ac0f17850670ef0a188a68805decb0e91bb8f22b8a87905ad542a7a4627614d64bea192a9918875e76fe5e188f8eda051fd8a081652af9403c3eba2c1a7d515598f658f40ff53486aebc4b18e55d8b491474805f7ed269b7de18b921f4cd1e73baa76d6b0110c551d4d0c47d7e11319fa2c5d5802b0ce8cd4ca689f1d725396858c81139580e8e561c9502ebefcdfec78b6203de9fc647d32213118f719eefb3159f9e96e940bebfcec2bb26d227d95065b46bf5ffbd087bf6b504315a2363d7680a83756e320b8fb43663f5fbabe1e93c4bc82efe5f1271d258f3f88ae294a5c87c87456ac3e059dc17f42f8e0ca9b3b25f97abdf2873ed4cca57e5e9057efe3ffa4199b1762eb21e8c223ad0f70d0ec7da010ea6d32bd00911115d784c7dd515dcfa7626c7c426234015b89680400351f4c34f1e26e9d95cf5c25526f69cc95c623d3b669e444e086781f569c7ff5cada57aeb36463d498bf072209355e41e60e56039730405b7a8dd2d046a01e76c0f489be3c5336349e8e598e98d6f62cdab6ac7c693d539ccf82ec863f4ce1acae9f35c61621967fc3b809e0a47380829a7cc58aaba4233f98dbedf54fa0c98aa697dde8bbf00da8750bc0c7c9b039272ea43a486e2b814a2b33e09a6c896bbdb83beaa0914b458f8747715ecaa535b81d2cd6e1c53775d2f803b0c03743044fec75ca356e79b6b6ad4a0e756285756ec1dabd385c93ca55485cffe3b20ddcdd54c755a5ef73ecf6ab855a28d23928a8017b81920573e7102ce1923382b7cc77f2f3c36e1704260342d6410545d321ac3853a715488a4c6217faea11e086b5ad8e2b0c506762f9e2d3bc93de0b65f005d3498b4a457f2a2ed2a3a027e25b45735b2a8e7d4b1ebd136c56c30dca0ebbf1269a49986b44df3c458f7e820d28671afe5bcb66ce4abcb520346a765ccd0ccb0430afa4ea3b9fa4b503165c5a3d0dca40cd1c5141d871a0e39f8055241a16c32f91d57aa6eac5c3d3d0b2dab9a1bbee132db70b83078984b2c55a0a6db41486dd12c151c345f12bc4d958e3a1c04cc401969693c8929a4fcdbdc4c420d8882cb70de54eaf0870c9c2cc7bac3e3a7b491ff1d5aa91a23939939336dbc8fe4493c287cb243afce5ee1d97cc5623f8cfa848b0f96c0b210be22e431a7e01c6992520f2483b3ce8387435a915783bed2aaa447e5652b1026298f783e73bc3be910c6930c72aef3c594f205f3702db1af564e59b1b4a6e97512d91de5365aa9001d6821c0820ec8ae8dbd654e980234935071d438916bf00f0a517969871d71b3f4bbfac0b6888295a6ff8a0e0aedc3915d529736171541b951e1bba55c095d45ffe17ea0d565cc4db4f90184d780862129ade4fd08c5b492eb9ec1d81d213d3f8c800758afa9b29ef49c163a3d1317ce0c72f432ebdd73f74e347c7aee08b2d13b155a0040f81f60e67fdbfc2c2169926d98cb0378c53fc3fb6ded8d8281589cc9d7a30ea896263b7b2f8293812801470717e4529012ae57a33d1525f99bd1c7438e6f4e3c2f65cb2081e8117320accbfe154cbcec75cecde6fe63f9990c4ebf7f7b1ee4e36d8cf11164277e8523109b48aaa47b4bdbe26f76530cecb3fb92c8007b2a78a4a4d4d5b5570da14a564e8e083fcb308fc8370ac617f4a1acecb81c97226acc19882d2f1598511b95ccda42bb9c50d0669acbf6bc231cff6d506c75431a3d4859d6fc777bbd3f074ef7f7290353aa606df4fa1839a9354cb395d27cde1663afccdc999e167343d6eda27afbd1e06643047716d1b45ce46e5ba861191b466b430dfa6ede6c5741687b7c3881aeb4e1a8d0eda2799a6a94844acb8575eb68b49ae61619cd7d62a980d6a35f33db8b64dcc7651586a06777c9952b1511403a5eca0f783aa10fdbb3bd75601950a345ac2ce3f1e1ac773e69e2bf38a50d31ffd0009e1b4cec58c0dfce521197d1a87af0a711b742a547b7e3ae092c34e86957837ad90dfd4a980fe13f54106e6ec1232c1467bbdc6fd8318400fb6dd0d70e4c2c681db155fad849d688c50b4a05780d3ee7e8fd06e312022b73a33f9e0e53a16f74d65c22a952660ddf9a90b246f7434a9864877341137dcad36a7b0f72728035ba6a18539b36a923d49d63a93dc6d72da4afa1f35830e87f573bfe770d9b6c8c2540b0c15ba60ca2c17442d1b73dc1c89383909b7d55b34480c994447d36054899623da2ff37964cd03cba835d8a3063d5129cde1c7edb7cc174973b27cd14b879373aadcaa2972ccc6c97de95b4bec4b498b283b75abc51bc01704fb114e93a6ca0c5504d68cb6c79e4a756df3f98ed4680a8a0d87c0d21378aa0d76fee204a20cbb50b36f9bff3f746b2f8351b34074f71c6e2fab8d14a8c030bb4be7852f8a70d3361ef54cb0195a3b7093d9764c052ebef731531a8653ab33508b8f47c1b93ba25a9ba834400b7b3a7e01bb09c894dc3e1306559c0931b3031cd9387b305b87b73bdded14a4d3acf85172f4e27be095bfef6c22c8dfa9168c3a3686a454af82d80418e7a1c61f4ddfbf0dce593826534bea3fb796fbd7d65389d87b51385561676adb42681a190a85e26081970b244ba5ac94413650550cc9234408b7cb5f0c82633a1de3e0bddffb5da6ee1fcd4e9bae1754a3b116bde0491bf81ed9367b9439b70df3f60cfccc43730fbaed68976ee815c60680ffd82596704120c092c738db9ebf492d60595c3af50028349846d70ba958ecd441722249b94d376a387a7c4579174d3e92f01f6cacc4e2837186a67e18222da9094922dc580d8f5bb46a7ddb9282a4a221b533816ddc98964f684d31517c7826553257a0072ae395136dcfdc4d419ec84ce015fdf8ee0ab77476fcef35b490d0eea104c1ab7e35160eed34be2ecac2ebdc4c6896e4ce301bcf9c320d10d451a8df471e356d7c5626d03b9f767730d9a6e59e2137d953648a2378071a89f6840b1c6f0699161688bbcc728f423e4976f0c3ee64dfea42a9693d01390c8e6c0a39dfcd2563fbb765648cac3d3805d1ac903b9721127d328cf51117f56e7cda5dca128dc7f8c3a2e07cb9232978214e7364b0ba9129773e7ca4bcbc63f2160a24c2c75e83933d37499fd2fffd79eb9194a367d6da4ad1b756bba153ef509bd433b1bc179d8872fcc56be52de08bfa450d442dc896a44219f198ad8362aa174c745a35aa71f928e2baf70e305998c0900334b3fb3845f128a6bf1255cade542c739e8fb7f424f6cd533223aa3d122eee6d44699b6e4ce2eeb04b39223bcef1f715522bf9609eb907824c04fb9d964fa779dafd81e86950f348f44f599292328679db744ad054732cf69507f362f916b97057a14fe2b4d05ee8c3370ec2d5808208c8a8f8539a894283d96545f8ea4cc3543a57eb2fc907fd30eac8fd028d9d89a522de7275d9267026a4c88b0a33e683fbde67de6d0fca075c9ef73117d6b7e1d08039e8a37ba460312b0f27ec61dab235f16acebaea9a9eb962685b99d531844a0ec5d6552361779f3104c3383f3fdbd8c5fd71cf625a6fb105783b3ff2d2baacd7e99ddd583aa35678612bf58208b5d2f26aa8fa9f73ac00968f60330d0ae07f54fbcb949c153516ed9f7a758f3b6092d8a4ad973b6771452218deed6d80358ba93f9065f3f925d0cb31630208b40487984639a3b497c204f1e347eeb482cf8de738c1ab32441fb3eb730e6e6dd7b35f932d976bd017ffc27fb02c9ef9ac0c5bd2649f32446b9f346b13f154c08b2140ea9d9d23b5942e0b975db4f545aeb12b494ba64bd76fc346c12bc4f11087238735b7a80585a44cfed14b805858e334809afd64cfca43258ea7ebe6b103162afc22f9c5cf05d722a54d85ad7318abdd9474731cff3149fd57b6b134b896dc1083786513f793c9fe3412ab6911e32c1a35660a17486ffd99f6e8c8be672557478dd82ac7d2e7693c13bd864fc319bef864219d7ea7b4241639a3577811dcafeebea32c305060a123e980e68a390f00bba3222887736de9f16d7bd73fa020548c1d00dff647f3b8db2620a60bab9386a2a3596e50eaaf7588be4b73887e1e31947e07378724709083cad20a7cc4a9ee544b129b5dafa471bd16a0e061aa3a7a80465a8579bbbd029e3c537032055af9741c006e7eb23c421b39f6986436b8239c1cf5d549a281eb92b56d42db45d58d92a5828d6cbd023d77fd5a17d4fe2c711e6505c6c73f0c90c105a2ceddde3c1e87302bb826d07ca64f83b0cfadaf7f49bec2236fd3acdfacb4c766a68cf80d2a9f42ea36ec961dd222ae55e927944928ad71d15173ff429cec883efce29e5fc05f4795238aa540bad6653d26552e675a596888dba342470731599e4092b40653b65394e8df9a9ace867c0afec03ead75e183b9d4cd0b9398e57b970732a092368d1e45139850fd61f14edcd734ad58517144bf2db8226695b93d0d9a7714623ab2f373b7d55f82b3301c4ef021ebb03d922a0076a3a1fdf4734eb22bea57c451ef8c61d6248308b05255cbab17cec31e0dfc092fb5cd276706bb258e0091a97a89f10aacae5463bc595f259f564798caf95a33d7d8baf35dfeec80c34adb206a1a4fcc182ad45464ddc4a31561d8905992cac18e3fc2efbe13b6a1be29e9e7e03de3cb31b3e1c88a9476bfd09a66f9b3beb2ba4096118f9c4e105058dbede5a5a0118daaf09198632a3ba437816088691e1a4c1dff88f9668fbcd8bddb244dee6a0675ef8d27cb71e6efc78db5eacded83b02f2511be100334f9dbfd1d754f179874df52572f84d058e202225fd11b65f2aec7388b687197a82899858d5294af79f2cfea2ab5e39d767eeed2263af87439eb12deebff1691089417722f8d5ecf8f70ee152c99c220e597a34a30849e13c6a6103849bd578ce8dd257f3f504ae60a91303e6a9f11ce20c6b2fbbe1558915791c69eee13250229521b8576cf98c3abda98e8b8b825deca8b928398383339ba7b65eb2160ab9ad6b2dad7df308f405a516348efab32caaf6b65f5a33a6f682bcc359d2566e57fa56f47778896bd92f3ef2078402a443f368111bbf8cb0f7be9e0c8f0d84e7bfce3f55e5a66c062e6438fdc89d2319e4148e3c9682f0fea4b54f780be68670102c07c1dad13a1915f0086eb08c5b624888449d11927fbdcfe209d381c42604c3253258e5a2b025beb28474cbd682fa88c15e2a96a1113c3383678a200862e6c280418e95cbddfe460d30dda893659d9efbbd7f347da15421a8981353364802f214829b1afd97b36075eeb0d48bac6e520d48814a777f1d5c3ab0e76c3cdd2a6200c991a0a00c0991a1c61173f61fb4d1a86c021fa1cc17b5f6261cb5b5e0b6e63a5631845820a6b841f55a177b167bcea0bb2818b8c75a78a272927229b065b8ff51e8c65d9a92b48f57a3737ec5012faba6eb65f73c79e84bb1dd2e57189ca9556677cfe48f3c8b306392674b15b0dfaee29e746b807a8b0c9a85f9e6a6cb33fa944adfa0cb6cc04104e0c167a95e0094c945b3976eb7e6880df664</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">æ‚¨å¥½ï¼Œè¿™é‡Œéœ€è¦å¯†ç ã€‚</span>      </label>    </div>  </div></div><script src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">è¿™é‡Œæœ‰ä¸œè¥¿è¢«åŠ å¯†äº†ï¼Œéœ€è¦è¾“å…¥å¯†ç æŸ¥çœ‹å“¦ã€‚</summary>
    
    
    
    <category term="Life" scheme="https://www.beenli.cn/categories/Life/"/>
    
    
  </entry>
  
  <entry>
    <title>YOLOv3 in PyTorch</title>
    <link href="https://www.beenli.cn/posts/9e0400c7/"/>
    <id>https://www.beenli.cn/posts/9e0400c7/</id>
    <published>2020-12-25T00:34:19.000Z</published>
    <updated>2020-12-25T04:17:43.670Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h1><blockquote><p><code>YOLO</code>, aka â€œYou Only Look Onceâ€â€”&gt; åå­—æ˜¯ä¸æ˜¯å¾ˆé…·</p><p>YOLOæ˜¯<code>object detection</code>é¢†åŸŸéå¸¸å‡ºåçš„ç®—æ³•ï¼Œå®ƒä»¥é€Ÿåº¦å¿«åŒæ—¶å…¼é¡¾æ€§èƒ½è‘—ç§°ã€‚</p></blockquote><h2 id="1-Net-Architecture"><a href="#1-Net-Architecture" class="headerlink" title="1 Net Architecture"></a>1 Net Architecture</h2><p><img src="https://image.beenli.cn/img/20201225/3crM6aHe8hd1.png?imageslim" alt="Figure1 YOLOv3 Network Architecture"></p><p><img src="https://image.beenli.cn/img/20201225/OyauoNS5dlmi.png?imageslim" alt="Figure2 Yolo_v3_Structure"></p><ul><li><code>concatenateå±‚</code>åœ¨Yoloé‡Œé¢å«åš<code>route</code>å±‚</li><li><code>res_unitå±‚</code>åœ¨Yoloé‡Œé¢å«åš<code>shortcut</code>å±‚</li><li><code>detectionå±‚</code>åœ¨Yoloé‡Œé¢å«åš<code>yolo</code>å±‚</li></ul><h2 id="2-Details"><a href="#2-Details" class="headerlink" title="2 Details"></a>2 Details</h2><p><img src="https://image.beenli.cn/img/20201225/Fewd3cB5ftsc.png?imageslim" alt="Figure3 Yolov3 anchor box"></p><ol><li><p>è¾“å…¥å±‚:<code>416*416*3</code></p></li><li><p>å°†è¾“å…¥åˆ’åˆ†ä¸º$S * S$ grid, æ¯ä¸ªæ ¼å­æœ‰ä¸‰ä¸ªé¢„å…ˆè®¾å®šå¥½é•¿($p_w$)å’Œå®½($p_h$)çš„anchor boxï¼›å¦‚æœç‰©ä½“çš„ä¸­å¿ƒè½åœ¨å“ªä¸ªgrid, é‚£ä¸ªgridå°±è´Ÿè´£æ¢æµ‹è¯¥ç‰©ä½“ã€‚</p><p><img src="https://image.beenli.cn/img/20201225/msBsRFJ838Rv.png?imageslim" alt="coordinate transform"></p></li><li><p>æ¯ä¸ªanchor boxæœ‰85ä¸ªæ•°æ®[$t_x, t_y, t_w, t_h, objectscore, c1, c2â€¦]$ï¼Œåˆ†åˆ«ä»£è¡¨ï¼š</p><ul><li>é¢„æµ‹æ¡†ä¸­å¿ƒç‚¹åæ ‡ï¼šç½‘ç»œå®é™…è¾“å‡ºçš„æ˜¯$t_x å’Œ t_y$, ä¸ºäº†è®©è¯¥cellé¢„æµ‹çš„ç‰©ä½“ä¸­å¿ƒä¸€å®šè½åœ¨è¯¥cellä¸Šï¼ŒåŠ äº†ä¸ªsigmoidå‡½æ•°ã€‚</li><li>é¢„æµ‹æ¡†é•¿å’Œå®½: é˜²æ­¢æ¢¯åº¦ä¸‹é™ä¸ç¨³å®šï¼Œæ‰€ä»¥è¿›è¡Œäº†å¯¹æ•°ç©ºé—´å˜æ¢ï¼Œç½‘ç»œç»™å‡º$t_x, t_h$, çœŸå®çš„é•¿å’Œå®½ç”±ğŸ‘†å…¬å¼è®¡ç®—ã€‚</li><li>æ˜¯å¦æœ‰ç‰©ä½“çš„æ¦‚ç‡: å¦‚æœæ²¡æœ‰ç‰©ä½“ï¼Œåç»­ç±»åˆ«çš„ç½®ä¿¡åˆ†æ•°å°†æ²¡æœ‰ä½œç”¨</li><li>ä¸€å…±é¢„æµ‹80ä¸ªç±»åˆ«ï¼Œæ¯ä¸ªç±»åˆ«çš„ç½®ä¿¡åˆ†æ•°ã€‚</li></ul></li></ol><p><img src="https://image.beenli.cn/img/20201225/OEr4juQiwsBl.jpg?imageslim" alt="scale output"></p><ol><li><p>æœ‰ä¸‰ç§scaleçš„è¾“å‡ºå±‚ï¼Œåˆ†åˆ«ä¸ºï¼š<code>13 * 13 * 85ï¼›26 * 26 * 85ï¼›52 * 52 * 85</code>ï¼›</p><p>æ¯ä¸ªcellæœ‰ä¸‰ä¸ªanchor box;æ‰€ä»¥æ¯ä¸ªè¾“å…¥ä¸€å…±æœ‰$(13\times13+26\times26+52\times52)\times3=10647$ä¸ªé¢„æµ‹æ¡†</p></li><li><p>è¿™ä¹ˆå¤šè¾“å‡ºæ¡†è‚¯å®šç»å¤§éƒ¨åˆ†æ˜¯é‡å¤é¢„æµ‹æˆ–è€…ä¸æ­£ç¡®çš„é¢„æµ‹ï¼Œéœ€è¦å‰”é™¤ä¸å¥½çš„æ¡†</p><ul><li>è®¾ç½®<code>object score</code>é˜ˆå€¼ï¼Œæ¯”å¦‚ä½äº0.6çš„å»é™¤</li><li>è®¾ç½®<code>IOU</code>é˜ˆå€¼ï¼Œè¿›è¡Œ<code>Non-maximum Suppression</code></li></ul></li></ol><h1 id="Implementation-in-PyTorch"><a href="#Implementation-in-PyTorch" class="headerlink" title="Implementation in PyTorch"></a>Implementation in PyTorch</h1><p><img src="https://image.beenli.cn/img/20201225/hGvI8gvYywrx.png?imageslim" alt="mark"></p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ol><li><a href="https://blog.paperspace.com/how-to-implement-a-yolo-object-detector-in-pytorch/">how-to-implement-a-yolo-object-detector-in-pytorch</a></li><li><a href="https://arxiv.org/pdf/1506.02640.pdf">YOLO V1: You Only Look Once: Unified, Real-Time Object Detection</a></li><li><a href="https://arxiv.org/pdf/1612.08242.pdf">YOLO V2: YOLO9000: Better, Faster, Stronger</a></li><li><a href="https://pjreddie.com/media/files/papers/YOLOv3.pdf">YOLO V3: An Incremental Improvement</a></li><li><a href="https://www.youtube.com/watch?v=DNEm4fJ-rto">IOU</a></li><li><a href="https://arxiv.org/pdf/1311.2524.pdf">Bounding Box Regression (Appendix C)</a></li><li><a href="https://www.youtube.com/watch?v=A46HZGR5fMw">Non maximum suppresion</a></li><li><a href="http://pytorch.org/tutorials/beginner/deep_learning_60min_blitz.html">PyTorch Official Tutorial</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Intro&quot;&gt;&lt;a href=&quot;#Intro&quot; class=&quot;headerlink&quot; title=&quot;Intro&quot;&gt;&lt;/a&gt;Intro&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;YOLO&lt;/code&gt;, aka â€œYou Only Look Onceâ€â€”&amp;</summary>
      
    
    
    
    <category term="CS" scheme="https://www.beenli.cn/categories/CS/"/>
    
    <category term="Programming" scheme="https://www.beenli.cn/categories/CS/Programming/"/>
    
    <category term="ML" scheme="https://www.beenli.cn/categories/CS/Programming/ML/"/>
    
    
    <category term="python" scheme="https://www.beenli.cn/tags/python/"/>
    
    <category term="PyTorch" scheme="https://www.beenli.cn/tags/PyTorch/"/>
    
  </entry>
  
  <entry>
    <title>Python x CV</title>
    <link href="https://www.beenli.cn/posts/f67fb0fb/"/>
    <id>https://www.beenli.cn/posts/f67fb0fb/</id>
    <published>2020-12-24T08:27:02.000Z</published>
    <updated>2020-12-24T13:06:22.472Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><blockquote><p><code>python opencv</code> åŒ…çš„å®˜æ–¹ç½‘å€: <a href="https://pypi.org/project/opencv-python/">https://pypi.org/project/opencv-python/</a></p><p><code>opencv</code>å®˜ç½‘ç½‘å€ : <a href="https://docs.opencv.org/master/">https://docs.opencv.org/master/</a></p></blockquote><ul><li><p>ç›´æ¥é€šè¿‡pipå®‰è£…(æœ‰å›¾å½¢ç•Œé¢çš„PC)</p><ul><li>é€‰æ‹©1ï¼šåŒ…å«ä¸»è¦çš„æ¨¡å—: <code>pip install opencv-python</code></li><li>é€‰æ‹©2: å…¨éƒ¨å®‰è£…(æœ‰äº›é¢å¤–çš„æ¨¡å—) : <code>pip install opencv-contrib-python</code></li></ul></li><li><p>æ²¡æœ‰å›¾å½¢ç•Œé¢çš„æœåŠ¡å™¨ä¸Š(ä¸ğŸ‘†å¯¹åº”)</p><ul><li><code>pip install opencv-python-headless</code></li><li><code>pip install opencv-contrib-python-headless</code></li></ul></li><li><p>å°è¯•ç”¨<code>conda install open-cv</code>,ä½†æ˜¯æ‰¾ä¸åˆ°åŒ…</p></li></ul><h2 id="Common-Usage"><a href="#Common-Usage" class="headerlink" title="Common Usage"></a>Common Usage</h2><blockquote><p>å¯¼å…¥çš„åŒ…ä¸º<code>cv2</code></p></blockquote><h3 id="1-è¯»å–å›¾åƒ"><a href="#1-è¯»å–å›¾åƒ" class="headerlink" title="1. è¯»å–å›¾åƒ"></a>1. è¯»å–å›¾åƒ</h3>   <figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> cv2<br>cv2.imread(<span class="hljs-string">"dog.png"</span>)<br></code></pre></td></tr></tbody></table></figure><blockquote><p>è¿”å›å€¼: åƒç´ çŸ©é˜µ<code>[height, width, channel]</code></p><p>ç±»å‹: <code>numpy.ndarray</code>ï¼›</p><p>æ•°æ®ç±»å‹: <code>unit8</code>; </p><p>é€šé“: <code>BGR</code>, ä¸æ˜¯RGB; å¯ä»¥é€šè¿‡<code>src[:,:,::]</code>è½¬æ¢</p></blockquote><p>   æ³¨æ„ï¼šæ¯ä¸ªåƒç´ çš„æ•°æ®ç±»å‹ä¸€å®šè¦<code>uint8</code>ï¼›å¦åˆ™ä¼šå‡ºç°</p><blockquote><p><font color="red">error:</font>  (-215:Assertion failed) src_depth != CV_16F &amp;&amp; src_depth != CV_32S in function â€˜convertToShowâ€™</p></blockquote><p>   è§£å†³åŠæ³•: np.uint8(image)</p><h3 id="2-æ˜¾ç¤ºå›¾åƒ"><a href="#2-æ˜¾ç¤ºå›¾åƒ" class="headerlink" title="2. æ˜¾ç¤ºå›¾åƒ"></a>2. æ˜¾ç¤ºå›¾åƒ</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">cv2.imshow(<span class="hljs-string">"winname"</span>, image)<br></code></pre></td></tr></tbody></table></figure><h3 id="3-ç¼©æ”¾å›¾åƒ"><a href="#3-ç¼©æ”¾å›¾åƒ" class="headerlink" title="3. ç¼©æ”¾å›¾åƒ"></a>3. ç¼©æ”¾å›¾åƒ</h3>   <figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">cv2.resize(src, dsize[, dst[, fx[, fy[, interpolation]]]]) --&gt; dst<br></code></pre></td></tr></tbody></table></figure><p>   å‚æ•°è¯´æ˜:</p><ul><li>src: è¯»å…¥çš„å›¾åƒ, [height, width, channel]</li><li>dsize: å˜æ¢åçš„å®½å’Œé«˜(width, height) â€”&gt; (int, int)</li><li>dst: ä¸srcç›¸å¯¹åº”, å³å˜æ¢å®Œçš„å„ç‚¹åƒç´ çŸ©é˜µ</li><li>fx: xæ–¹å‘(å³widthæ–¹å‘) ç¼©æ”¾å€æ•°</li><li>fy: yæ–¹å‘(å³heightæ–¹å‘)ç¼©æ”¾å€æ•°</li><li>interpolation: æ’å€¼æ–¹æ³•</li><li><font color="red">notes:</font> è½¬æ¢åçš„å°ºå¯¸è¦ä¹ˆç”±<code>dsize</code>è¦ä¹ˆç”±<code>fx,fy</code>æ¥å†³å®š</li></ul><div class="table-container"><table><thead><tr><th style="text-align:center">æ’å€¼æ–¹æ³•</th><th style="text-align:center">è§£é‡Šå¦‚ä¸‹</th></tr></thead><tbody><tr><td style="text-align:center">INTER_NEAREST</td><td style="text-align:center">æœ€è¿‘é‚»æ’å€¼(0)</td></tr><tr><td style="text-align:center">INTER_LINEAR</td><td style="text-align:center">åŒçº¿æ€§æ’å€¼ï¼ˆé»˜è®¤è®¾ç½®ï¼‰(1)</td></tr><tr><td style="text-align:center">INTER_AREA</td><td style="text-align:center">ä½¿ç”¨åƒç´ åŒºåŸŸå…³ç³»è¿›è¡Œé‡é‡‡æ ·ï¼ˆæœ€é€‚åˆshrink)</td></tr><tr><td style="text-align:center">INTER_CUBIC</td><td style="text-align:center">4x4åƒç´ é‚»åŸŸçš„åŒä¸‰æ¬¡æ’å€¼ (2)</td></tr><tr><td style="text-align:center">INTER_LANCZOS4</td><td style="text-align:center">8x8åƒç´ é‚»åŸŸçš„Lanczosæ’å€¼(3)</td></tr></tbody></table></div><center>ğŸ‘†æ ‡å·0,1,2,3ä»£è¡¨ä¸Šé‡‡æ ·æ–¹æ³•è¶Šæ¥è¶Šå¤æ‚, å›¾åƒè¿‡åº¦è¶Šå¹³æ»‘,è´¨é‡è¶Šå¥½,ä½†æ˜¯é€Ÿåº¦è¶Šæ…¢</center><ul><li><p>å¦‚æœä½ å·²ç»åˆ›å»ºäº†dst(è½¬æ¢åçš„å°ºå¯¸ç”±dstæ¥å†³å®š)</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">resize(src, dst.size(), dst)<br></code></pre></td></tr></tbody></table></figure></li><li><p>ä¿®æ”¹å›¾ç‰‡å°ºå¯¸</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">letterbox_image</span>(<span class="hljs-params">img, inp_dim</span>):</span><br>    <span class="hljs-string">"""resize image with unchanged aspect ratio using padding</span><br><span class="hljs-string">    img: input image</span><br><span class="hljs-string">    inp_dim: </span><br><span class="hljs-string">    """</span><br>    img_w, img_h = img.shape[<span class="hljs-number">1</span>], img.shape[<span class="hljs-number">0</span>] <span class="hljs-comment"># img:[height, width, channel]</span><br>    w, h = inp_dim<br>    scale = <span class="hljs-built_in">min</span>(w / img_w, h / img_h)   <span class="hljs-comment"># keep aspect ratio</span><br>    new_w = <span class="hljs-built_in">int</span>(img_w * scale)   <span class="hljs-comment"># multiply the same number</span><br>    new_h = <span class="hljs-built_in">int</span>(img_h * scale)<br>    <span class="hljs-comment"># è¡¨ç¤ºå¤§å°æ—¶ç”¨çš„æ˜¯(width,height) --&gt; è¿”å›çš„æ˜¯[height, width, channel]</span><br>    resized_image = cv2.resize(img, (new_w, new_h), interpolation=cv2.INTER_CUBIC) <span class="hljs-comment"># cubic</span><br>    cv2.imshow(<span class="hljs-string">"unchanged aspect ratio"</span>, resized_image)<br>    canvas = np.full((h, w, <span class="hljs-number">3</span>), <span class="hljs-number">128</span>)          <span class="hljs-comment"># create a numpy array having shape of [width, height, c]</span><br><br>    <span class="hljs-comment"># padding with (128,128,128) gray</span><br>    canvas[(h - new_h) // <span class="hljs-number">2</span>: (h - new_h) // <span class="hljs-number">2</span> + new_h, (w - new_w) // <span class="hljs-number">2</span>:(w - new_w) // <span class="hljs-number">2</span> + new_w, :] = resized_image<br><br>    <span class="hljs-keyword">return</span> canvas<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<br>    filename = <span class="hljs-string">"dog-cycle-car.png"</span><br>    dog = cv2.imread(filename)<br>    cv2.imshow(<span class="hljs-string">"original_dog"</span>, dog)<br>    shrink_dog = cv2.resize(dog, <span class="hljs-literal">None</span>, fx=<span class="hljs-number">0.5</span>, fy=<span class="hljs-number">1</span>, interpolation=cv2.INTER_CUBIC)<br>    dog_keep_ratio_padding = np.uint8(letterbox_image(dog, (dog.shape[<span class="hljs-number">0</span>] // <span class="hljs-number">2</span>, dog.shape[<span class="hljs-number">0</span>] // <span class="hljs-number">2</span>))) <span class="hljs-comment"># height/2</span><br>    cv2.imshow(<span class="hljs-string">"dog_keep_ratio_padding"</span>, dog_keep_ratio_padding)<br>    cv2.imshow(<span class="hljs-string">"shrink_dog"</span>, shrink_dog)<br>    cv2.waitKey(<span class="hljs-number">0</span>)<br>    cv2.destroyAllWindows()<br></code></pre></td></tr></tbody></table></figure><blockquote><ul><li>ä¸€å®šè¦ä½¿ç”¨<code>cv2.waitKey(0)</code>ï¼Œå¦åˆ™æ˜¾ç¤ºä¸äº†å›¾ç‰‡:ï¼ˆæ­£æ•°ä¸ºç­‰å¾…çš„æ—¶é—´,å•ä½æ¯«ç§’)</li><li>ä½¿ç”¨cv2.destroyWindows(â€œwinnameâ€),å¯ä»¥ä¸»åŠ¨å…³é—­çª—å£(å›¾ç‰‡)</li></ul></blockquote><p><img src="https://image.beenli.cn/img/20201224/JfARdC8VMOQt.png?imageslim" alt="mark"></p></li></ul><h3 id="4-åœ¨å›¾åƒä¸Šç”»çŸ©å½¢"><a href="#4-åœ¨å›¾åƒä¸Šç”»çŸ©å½¢" class="headerlink" title="4. åœ¨å›¾åƒä¸Šç”»çŸ©å½¢)"></a>4. <a href="https://docs.opencv.org/2.4/modules/core/doc/drawing_functions.html#void%20line(Mat&amp;%20img,%20Point%20pt1,%20Point%20pt2,%20const%20Scalar&amp;%20color,%20int%20thickness,%20int%20lineType,%20int%20shift">åœ¨å›¾åƒä¸Šç”»çŸ©å½¢</a>)</h3>   <figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">cv2.rectangle(img, pt1, pt2, color[, thickness[, lineType[, shift]]]) -&gt; img<br></code></pre></td></tr></tbody></table></figure><blockquote><p>The function cv::rectangle draws a rectangle outline or a filled rectangle whose two opposite corners</p><p>are pt1 and pt2</p></blockquote><p>   <code>pt1</code>,<code>pt2</code>: ä¸¤ä¸ªå¯¹è§’çš„åæ ‡</p><p>   <code>color</code>: tuple(R,G,B)</p><p>   <code>thickness</code>: int å¦‚æœä¸ºè´Ÿæ•°,æ¯”å¦‚-1,é‚£ä¹ˆä¼šå¡«å……æ•´ä¸ªçŸ©å½¢</p><p>   <code>lineType</code>: 8(é»˜è®¤)ï¼š8è¿æ¥ï¼›4ï¼š4è¿æ¥çº¿ï¼›CV_AA:é”¯é½¿çº¿</p><p>   æ³¨:å¯¹äºæ•´æ•°åæ ‡çš„éåé”¯é½¿çº¿ï¼Œä½¿ç”¨8è¿æ¥æˆ–4è¿æ¥çš„Bresenhamç®—æ³•ã€‚ç²—çº¿ä»¥åœ†è§’ç»“å°¾ç»˜åˆ¶ã€‚åé”¯é½¿çº¿æ˜¯ç”¨é«˜æ–¯æ»¤æ³¢ç»˜åˆ¶çš„</p><p>   <code>shift</code>: ç‚¹åæ ‡ä¸­çš„å°æ•°ä½æ•°</p><h3 id="5-åœ¨å›¾åƒä¸Šå†™å­—"><a href="#5-åœ¨å›¾åƒä¸Šå†™å­—" class="headerlink" title="5.åœ¨å›¾åƒä¸Šå†™å­—"></a>5.åœ¨å›¾åƒä¸Šå†™å­—</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">cv2.putText(img, text, org, fontFace, fontScale, color[, thickness[, lineType[, bottomLeftOrigin]]])<br></code></pre></td></tr></tbody></table></figure><blockquote><p>å¯¹äºä¸èƒ½æ¸²æŸ“çš„symbolï¼Œä½¿ç”¨ï¼Ÿæ ‡è®°</p></blockquote><p><code>text</code>: String to be drawn</p><p><code>org</code>: Tuple(x,y) Bottom-left corner of the text string in the image(æ–‡æœ¬çš„å·¦ä¸‹è§’åæ ‡)</p><p><code>fontFace</code>: å­—ä½“</p><p><code>fontScale</code>: å­—ä½“å¤§å°</p><p><code>color</code>, <code>thickness</code>, <code>lineType</code>: åŒğŸ‘†</p><p><code>bottomLeftOrigin</code>: å½“å…¶ä¸ºçœŸæ—¶ï¼Œå›¾åƒåŸç‚¹åœ¨å·¦ä¸‹è§’ï¼Œå¦åˆ™åœ¨å·¦ä¸Šè§’(opencvé»˜è®¤ä¸ºå·¦ä¸Š)ã€å¦‚æœä¸ºTrueï¼Œå­—ç¿»è½¬$180^o$ã€‘</p><figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs awk">enum HersheyFonts {<br>    FONT_HERSHEY_SIMPLEX        = <span class="hljs-number">0</span>, <span class="hljs-regexp">//</span>!&lt; normal size sans-serif font<br>    FONT_HERSHEY_PLAIN          = <span class="hljs-number">1</span>, <span class="hljs-regexp">//</span>!&lt; small size sans-serif font<br>    FONT_HERSHEY_DUPLEX         = <span class="hljs-number">2</span>, <span class="hljs-regexp">//</span>!&lt; normal size sans-serif font (more complex than FONT_HERSHEY_SIMPLEX)<br>    FONT_HERSHEY_COMPLEX        = <span class="hljs-number">3</span>, <span class="hljs-regexp">//</span>!&lt; normal size serif font<br>    FONT_HERSHEY_TRIPLEX        = <span class="hljs-number">4</span>, <span class="hljs-regexp">//</span>!&lt; normal size serif font (more complex than FONT_HERSHEY_COMPLEX)<br>    FONT_HERSHEY_COMPLEX_SMALL  = <span class="hljs-number">5</span>, <span class="hljs-regexp">//</span>!&lt; smaller version of FONT_HERSHEY_COMPLEX<br>    FONT_HERSHEY_SCRIPT_SIMPLEX = <span class="hljs-number">6</span>, <span class="hljs-regexp">//</span>!&lt; hand-writing style font<br>    FONT_HERSHEY_SCRIPT_COMPLEX = <span class="hljs-number">7</span>, <span class="hljs-regexp">//</span>!&lt; more complex variant of FONT_HERSHEY_SCRIPT_SIMPLEX<br>    FONT_ITALIC                 = <span class="hljs-number">16</span> <span class="hljs-regexp">//</span>!&lt; flag <span class="hljs-keyword">for</span> italic font<br>};<br></code></pre></td></tr></tbody></table></figure><center>å­—ä½“ğŸ‘†</center><h3 id="6-ç¤ºä¾‹"><a href="#6-ç¤ºä¾‹" class="headerlink" title="6 ç¤ºä¾‹"></a>6 ç¤ºä¾‹</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> cv2<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<br>    filename = <span class="hljs-string">"imgs\\dog.jpg"</span><br>    dog = cv2.imread(filename)<br>    cv2.imshow(<span class="hljs-string">"original_dog"</span>, dog)<br>    c1 = (<span class="hljs-number">164</span>, <span class="hljs-number">108</span>)<br>    c2 = (<span class="hljs-number">560</span>, <span class="hljs-number">447</span>)<br>    color = (<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) <span class="hljs-comment"># red</span><br>    cv2.rectangle(dog, c1, c2, color, <span class="hljs-number">2</span>, lineType=cv2.LINE_AA)<br>    cv2.imshow(<span class="hljs-string">"rectangle"</span>, dog)<br>    label = <span class="hljs-string">"bicycle"</span><br>    <span class="hljs-comment"># (text,fontFace,fontScale,thickness)</span><br>    t_size = cv2.getTextSize(label, cv2.FONT_HERSHEY_SIMPLEX, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>] <span class="hljs-comment"># </span><br>    c2 = c1[<span class="hljs-number">0</span>] + t_size[<span class="hljs-number">0</span>] + <span class="hljs-number">3</span>, c1[<span class="hljs-number">1</span>] - t_size[<span class="hljs-number">1</span>] - <span class="hljs-number">4</span> <span class="hljs-comment"># c2 at the right-top of original rectangle's top-left corner</span><br>    <span class="hljs-comment"># (width:x, height:y)</span><br>    cv2.rectangle(dog, c1, c2, color, -<span class="hljs-number">1</span>, lineType=cv2.LINE_AA) <span class="hljs-comment"># -1 fill the rectangle</span><br>    cv2.putText(dog, label, (c1[<span class="hljs-number">0</span>], c1[<span class="hljs-number">1</span>]-<span class="hljs-number">6</span>), cv2.FONT_HERSHEY_SIMPLEX, <span class="hljs-number">1</span>, [<span class="hljs-number">225</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>], <span class="hljs-number">1</span>)<br>    cv2.imshow(<span class="hljs-string">"rectangle+text"</span>, dog)<br>    cv2.waitKey(<span class="hljs-number">0</span>)<br>    cv2.destroyAllWindows()<br><br></code></pre></td></tr></tbody></table></figure><p><img src="https://image.beenli.cn/img/20201224/ml4IQnTHooSV.png?imageslim" alt="mark"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Installation&quot;&gt;&lt;a href=&quot;#Installation&quot; class=&quot;headerlink&quot; title=&quot;Installation&quot;&gt;&lt;/a&gt;Installation&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;python open</summary>
      
    
    
    
    <category term="CS" scheme="https://www.beenli.cn/categories/CS/"/>
    
    <category term="Programming" scheme="https://www.beenli.cn/categories/CS/Programming/"/>
    
    <category term="ML" scheme="https://www.beenli.cn/categories/CS/Programming/ML/"/>
    
    
    <category term="CV" scheme="https://www.beenli.cn/tags/CV/"/>
    
    <category term="python" scheme="https://www.beenli.cn/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>manage project dependencies with SBT</title>
    <link href="https://www.beenli.cn/posts/f1ee3abb/"/>
    <id>https://www.beenli.cn/posts/f1ee3abb/</id>
    <published>2020-12-03T12:29:14.000Z</published>
    <updated>2020-12-03T14:20:46.829Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Dependency"><a href="#Dependency" class="headerlink" title="Dependency"></a>Dependency</h2><blockquote><p>ä¾èµ–åˆ†ä¸ºï¼šæ‰˜ç®¡ä¾èµ–ã€Œmanagedã€å’Œéæ‰˜ç®¡ä¾èµ–ã€Œunmanagedã€</p></blockquote><h2 id="Unmanaged"><a href="#Unmanaged" class="headerlink" title="Unmanaged"></a>Unmanaged</h2><p>éæ‰˜ç®¡ä¾èµ–ï¼šæ¯”å¦‚<code>JARåŒ…</code></p><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><ul><li>æŠŠéœ€è¦çš„JARåŒ…æ‹·è´åˆ°é¡¹ç›®æ ¹ç›®å½•çš„<code>lib</code>æ–‡ä»¶å¤¹ ä¸‹ã€‚</li><li>å¦‚æœè¯¥JARåŒ…è¿˜ä¾èµ–å…¶å®ƒJARåŒ…ï¼Œä½ ä¹Ÿè¦ä¸‹è½½å…¶å®ƒJARå¹¶æŠŠå…¶åŒæ ·æ‹·è´åˆ°libç›®å½•ä¸­</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>è¦è‡ªå·±è§£å†³åŒ…ä¾èµ–å…³ç³»ï¼Œä¸€æ—¦é¡¹ç›®å˜å¤§äº†ï¼Œé æ‰‹å·¥ç»´æŠ¤åŸºæœ¬ä¸å¯èƒ½</li></ul><h2 id="Managed-key"><a href="#Managed-key" class="headerlink" title="Managed(key)"></a>Managed(key)</h2><p>æ‰˜ç®¡ä¾èµ–ï¼šé€šè¿‡ç»™å®šé¡¹ç›®ä¸€äº›å±æ€§ï¼Œç”±æ„å»ºå·¥å…·(å¦‚sbt)è‡ªåŠ¨å»é»˜è®¤ä»“åº“ä¸‹è½½ã€‚</p><h3 id="Single-lib"><a href="#Single-lib" class="headerlink" title="Single lib"></a>Single lib</h3><p><code>åŸºæœ¬è¯­æ³•:</code> å†™åœ¨é¡¹ç›®çš„ã€Œbuild.sbtã€æ–‡ä»¶ä¸­</p><figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Scala">libraryDependencies += groupID % artifactID % revision % configuration<br></code></pre></td></tr></tbody></table></figure><p><code>æœ€å°å®Œæ•´çš„æ–‡ä»¶:</code></p><figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs scala">name := <span class="hljs-string">"BasicProjectWithScalaTest"</span>  <span class="hljs-comment">// é¡¹ç›®åç§°</span><br><br>version := <span class="hljs-string">"1.0"</span>                     <span class="hljs-comment">// é¡¹ç›®ç‰ˆæœ¬</span><br><br>scalaVersion := <span class="hljs-string">"2.10.0"</span>             <span class="hljs-comment">// é¡¹ç›®Scalaç‰ˆæœ¬</span><br><br>libraryDependencies += <span class="hljs-string">"org.scalatest"</span> %% <span class="hljs-string">"scalatest"</span> % <span class="hljs-string">"1.9.1"</span> % <span class="hljs-string">"test"</span><br></code></pre></td></tr></tbody></table></figure><ul><li>ğŸ‘†æ–¹æ³•è¯´æ˜ï¼š</li></ul><div class="table-container"><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td>+=</td><td>é”®å€¼å¯¹;ç”¨+=è¡¨ç¤ºç»™é”®(libraryDependencies)é™„åŠ å€¼</td></tr><tr><td>%</td><td>ç”¨äºä»ä½ æä¾›çš„å­—ç¬¦ä¸²ä¸­æ„å»º<code>Ivy module ID</code></td></tr><tr><td>%%</td><td>å½“å…¶åœ¨<code>groupID</code>åä½¿ç”¨æ—¶,è‡ªåŠ¨æŠŠä½ é¡¹ç›®Scalaç‰ˆæœ¬å·æ·»åŠ åˆ°å·¥ä»¶åå­—æœ«å°¾</td></tr></tbody></table></div><p>exampleï¼šğŸ‘‡ä¸¤ä¸ªç­‰æ•ˆ</p><figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scala">libraryDependencies += <span class="hljs-string">"org.scalatest"</span> % <span class="hljs-string">"scalatest_2.10"</span> % <span class="hljs-string">"1.9.1"</span> % <span class="hljs-string">"test"</span><br>libraryDependencies += <span class="hljs-string">"org.scalatest"</span> %% <span class="hljs-string">"scalatest"</span> % <span class="hljs-string">"1.9.1"</span> % <span class="hljs-string">"test"</span><br></code></pre></td></tr></tbody></table></figure><p><code>libraryDependencies</code>å¯ä»¥åœ¨<a href="https://mvnrepository.com/">sbté»˜è®¤è¿œç¨‹ä»“åº“</a>ä¸­æ‰¾åˆ°</p><p><img src="https://image.beenli.cn/img/20201203/lG49276bcmsi.png?imageslim" alt="mark"></p><p><code>notes:</code></p><ul><li>å‡è®¾ä½ æ·»åŠ ä¸€ä¸ªä¾èµ–ï¼Œä½†æ˜¯è¿™ä¸ªå·¥ä»¶ä¾èµ–å…¶å®ƒçš„å·¥ä»¶ï¼Œé‚£ä¹ˆsbtä¼šè‡ªåŠ¨å¸®ä½ ä¸‹è½½ä¾èµ–ï¼Œè¿™æ˜¯éæ‰˜ç®¡æ— æ³•æ¯”æ‹Ÿçš„</li><li>å·¥ä»¶çš„ç‰ˆæœ¬å¾ˆæ€»è¦;ä¸€å®šè¦ä¸è‡ªå·±é¡¹ç›®ä¸­Scalaç‰ˆæœ¬å…¼å®¹</li><li>SBTä½¿ç”¨<code>Apache Ivy</code>ä½œä¸ºè‡ªå·±çš„ä¾èµ–ç®¡ç†å™¨ï¼Œè€ŒIvyä¹Ÿè¢«<code>Ant</code>å’Œ<code>Maven</code>ä½¿ç”¨ï¼Œå› æ­¤èƒ½åœ¨Scalaé¡¹ç›®ä¸­å¾ˆå®¹æ˜“ä½¿ç”¨å¤šå¹´æ¥åˆ›å»ºçš„ä¸°å¯ŒJavaåº“ã€‚</li><li>SBTä½¿ç”¨<a href="https://mvnrepository.com/">standard Maven repository</a>ä½œä¸ºé»˜è®¤ä»“åº“(ç´¢å¼•çš„å·¥ä»¶æ•°æˆªè‡³2020/12/03å·²ç»æ˜¯18.4M); å¦‚æœä½ éœ€è¦çš„åº“æ²¡æœ‰å‘å¸ƒåˆ°æ”¹æ ‡å‡†åº“ä¸­ï¼Œä½ å¿…é¡»å‘Šè¯‰SBTå»å“ªé‡Œå¯»æ‰¾ï¼Œè¿™ä¸ªè¿‡ç¨‹é€šè¿‡æ·»åŠ ä¸€ä¸ª<code>resolver</code>è§£å†³</li></ul><h3 id="Multiple-lib"><a href="#Multiple-lib" class="headerlink" title="Multiple lib"></a>Multiple lib</h3><ul><li><p>ä½¿ç”¨<code>Seq</code>æ–¹æ³•ï¼ˆæ³¨æ„æ˜¯<code>++=</code>ï¼‰</p><figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scala">libraryDependencies ++= <span class="hljs-type">Seq</span>(<br>    <span class="hljs-string">"net.sourceforge.htmlcleaner"</span> % <span class="hljs-string">"htmlcleaner"</span> % <span class="hljs-string">"2.4"</span>,<br>    <span class="hljs-string">"org.scalatest"</span> % <span class="hljs-string">"scalatest_2.10"</span> % <span class="hljs-string">"1.9.1"</span> % <span class="hljs-string">"test"</span>,<br>    <span class="hljs-string">"org.foobar"</span> %% <span class="hljs-string">"foobar"</span> % <span class="hljs-string">"1.8"</span><br>)<br></code></pre></td></tr></tbody></table></figure><h3 id="Multiple-project"><a href="#Multiple-project" class="headerlink" title="Multiple project"></a>Multiple project</h3></li><li><p>ä½¿ç”¨<code>lazy</code>ï¼šæ„å»ºå¤šä¸ªé¡¹ç›®</p><p><img src="https://image.beenli.cn/img/20201203/o9IVGTWnnADF.png?imageslim" alt="mark"></p></li><li><p>ä½¿ç”¨<code>projects</code>ï¼šæŸ¥çœ‹é¡¹ç›®ç»“æ„</p></li></ul><p><img src="https://image.beenli.cn/img/20201203/4I3Oo4actGgg.png?imageslim" alt="mark"></p><ul><li><p>ä½¿ç”¨<code>.dependsOn</code>:ä¸»é¡¹ç›®ä¾èµ–å¯ä»¥ç§»åˆ°å­é¡¹ç›®ä¸­ï¼Œç„¶åæ˜¾ç¤ºæŒ‡æ˜</p><figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Scala">.dependsOn(helloCore)    <span class="hljs-comment">// è¡¨ç¤ºä¾èµ–å­é¡¹ç›®</span><br></code></pre></td></tr></tbody></table></figure></li><li><p>ä½¿ç”¨<code>dist</code>ï¼šç”Ÿæˆé€šç”¨jaråŒ…</p><ul><li><p>åœ¨~/project/plugins.sbtæ·»åŠ æ’ä»¶     ã€~ä»£è¡¨é¡¹ç›®æ ¹ç›®å½•ã€</p><figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala">addSbtPlugin(<span class="hljs-string">"com.typesafe.sbt"</span> % <span class="hljs-string">"sbt-native-packager"</span> % <span class="hljs-string">"1.3.4"</span>)  <span class="hljs-comment">// æ·»åŠ sbt-native-packageræ’ä»¶,ç”¨äºæ‰“åŒ…universal package</span><br></code></pre></td></tr></tbody></table></figure></li><li><p>åœ¨build.sbtä¸­æ·»åŠ <code>JavaAppPackaging</code></p><figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala">.enablePlugins(<span class="hljs-type">JavaAppPackaging</span>) <span class="hljs-comment">// ç”¨äºæ‰“åŒ…dist? </span><br></code></pre></td></tr></tbody></table></figure><p><img src="https://image.beenli.cn/img/20201203/rookW5HWO63t.png?imageslim" alt="mark"></p></li></ul></li><li><p>ä½¿ç”¨<code>publishlocal</code>: æŠŠåŒ…å‘å¸ƒåˆ°æœ¬åœ°</p><ul><li><p>é»˜è®¤æ˜¯åœ¨~\.ivy2\local\æ–‡ä»¶å¤¹ä¸‹</p></li><li><p>ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°<code>groupID % artifactID % revision % configuration</code>æ¥ç»„ç»‡</p><p><img src="https://image.beenli.cn/img/20201203/nY14vTt0xhSh.png?imageslim" alt="mark"></p></li></ul><figure class="highlight haml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs haml">-<span class="ruby">com.example        /<span class="hljs-regexp">/ groupID</span></span><br><span class="ruby">- hello_2.<span class="hljs-number">12</span>    /<span class="hljs-regexp">/ artifactID</span></span><br><span class="ruby">- <span class="hljs-number">1.0</span>.<span class="hljs-number">0</span>     /<span class="hljs-regexp">/ revision</span></span><br><span class="ruby">            - docs</span><br><span class="ruby">            - ivys</span><br><span class="ruby">            - jars</span><br><span class="ruby">            - proms</span><br><span class="ruby">            - scrs</span><br><span class="ruby">    - hello-core_2.<span class="hljs-number">12</span> /<span class="hljs-regexp">/ å­é¡¹ç›®ç”Ÿæˆçš„å·¥ä»¶</span></span><br><span class="ruby">    - <span class="hljs-number">1.0</span>.<span class="hljs-number">0</span></span><br><span class="ruby">        - docs</span><br><span class="ruby">            - ivys</span><br><span class="ruby">            - jars</span><br><span class="ruby">            - proms</span><br><span class="ruby">            - scrs</span><br><span class="ruby">    - <span class="hljs-number">0.1</span>.<span class="hljs-number">0</span>-SNAPSHOT(è¿™æ˜¯è‡ªå‰å‘å¸ƒçš„)</span><br><span class="ruby">        - docs</span><br><span class="ruby">            - ivys</span><br><span class="ruby">            - jars</span><br><span class="ruby">            - proms</span><br><span class="ruby">            - scrs</span><br></code></pre></td></tr></tbody></table></figure></li><li>ä½¿ç”¨<code>Docker/publishLocal</code>:ç”Ÿæˆé•œåƒ</li></ul><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p>[1] <a href="https://www.scala-sbt.org/1.x/docs/sbt-by-example.html">sbt-by-example</a></p><p>[2] <a href="https://alvinalexander.com/scala/sbt-how-to-manage-project-dependencies-in-scala/">sbt-how-to-manage-project-dependencies-in-scala</a></p><p>[3] <a href="https://mvnrepository.com/artifact/edu.berkeley.cs/chisel3-core_2.12/3.4.0">mvnrepo-chisel3-core</a></p><p>[4] <a href="https://yintianyu.github.io/2019/01/21/post-sbt-dependencies/">Sbt ä¾èµ–é…ç½®</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Dependency&quot;&gt;&lt;a href=&quot;#Dependency&quot; class=&quot;headerlink&quot; title=&quot;Dependency&quot;&gt;&lt;/a&gt;Dependency&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;ä¾èµ–åˆ†ä¸ºï¼šæ‰˜ç®¡ä¾èµ–ã€Œmanagedã€å’Œéæ‰˜ç®¡ä¾èµ–ã€Œ</summary>
      
    
    
    
    <category term="CS" scheme="https://www.beenli.cn/categories/CS/"/>
    
    <category term="Programming" scheme="https://www.beenli.cn/categories/CS/Programming/"/>
    
    <category term="env_problems" scheme="https://www.beenli.cn/categories/CS/Programming/env-problems/"/>
    
    
    <category term="Scala" scheme="https://www.beenli.cn/tags/Scala/"/>
    
  </entry>
  
  <entry>
    <title>The most used Scala Build Tools(SBT)</title>
    <link href="https://www.beenli.cn/posts/67dea116/"/>
    <id>https://www.beenli.cn/posts/67dea116/</id>
    <published>2020-12-03T01:19:39.000Z</published>
    <updated>2020-12-03T03:50:29.538Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ‰å¾ˆå¤šæ„å»ºå·¥å…·ï¼Œæ¯”å¦‚ Ant, Maven, Gradleç­‰ç­‰ï¼Œä½†æ˜¯ <a href="http://www.scala-sbt.org/">sbt</a>æ˜¯ä¸“é—¨ä¸ºScalaè®¾è®¡çš„ã€‚å®ƒå‰äº›æ—¥å­è¿˜è¢«Scalaåˆ›å§‹äºº<a href="https://twitter.com/odersky">Martin Odersky</a>è”åˆåˆ›åŠçš„<a href="https://www.lightbend.com/">Lightbend</a>å…¬å¸æ”¯æŒã€‚</p></blockquote><h2 id="What-is-sbt"><a href="#What-is-sbt" class="headerlink" title="What is sbt"></a>What is sbt</h2><blockquote><p>sbt æ˜¯ä¸€ä¸ªäº¤äº’å¼æ„å»ºå·¥å…·:ä½ å¯ä»¥åœ¨Scala projectä¸­å®šä¹‰ä½ çš„taskï¼Œç„¶åä»äº¤äº’å¼sbt shell å¹¶è¡Œçš„è¿è¡Œå®ƒä»¬ã€‚</p></blockquote><h2 id="Why-sbt"><a href="#Why-sbt" class="headerlink" title="Why sbt"></a>Why sbt</h2><ul><li>ä¸“ä¸ºScalaå’ŒJavaè®¾è®¡ï¼šå®ƒèƒ½ä½¿ç”¨å¤šä¸ªScalaç‰ˆæœ¬äº¤å‰ç¼–è¯‘ä½ çš„é¡¹ç›®ã€‚</li><li>ç±»å‹å®‰å…¨å’Œå¹¶è¡Œçš„<code>build.sbt</code>ï¼šä¸€ä¸ªåŸºäºScalaçš„DSL(domain specific language)ï¼Œç”¨äºè¡¨ç¤º<code>å¹¶è¡Œä»»åŠ¡å¤„ç†å›¾è°±</code>ã€‚ä»»ä½•æ‰“å­—é”™è¯¯éƒ½ä¼šå¼•å‘ç¼–è¯‘é”™è¯¯ã€‚</li><li>å¿«é€Ÿè¿­ä»£ï¼šä½¿ç”¨Zinc å¢é‡ç¼–è¯‘å™¨å’Œæ–‡ä»¶ç›‘è§†å™¨ï¼Œä½¿å¾—<code>ç¼–è¾‘-ç¼–è¯‘-æµ‹è¯•</code>å¾ªç¯è¾¾åˆ°å¿«é€Ÿå¹¶ä¸”é€’å¢</li><li>å¯æ‰©å±•æ€§ï¼šæˆ‘ä»¬åªç”¨åœ¨<code>build.sbt</code>ä¸­å†™å…¥ç›¸åº”ä»£ç ï¼Œå°±å¯ä»¥å¢åŠ å¯¹æ–°çš„ä»»åŠ¡æˆ–å¹³å°(æ¯”å¦‚Scala.js)çš„æ”¯æŒã€‚</li><li>Join <a href="https://www.scala-sbt.org/1.x/docs/Community-Plugins.html">100+ community-maintained plugins</a> to share and reuse sbt tasks</li></ul><h2 id="Install-sbt-1-4-4"><a href="#Install-sbt-1-4-4" class="headerlink" title="Install sbt(1.4.4)"></a>Install sbt(1.4.4)</h2><ul><li><p>for windows</p><ul><li><a href="https://github.com/sbt/sbt/releases/download/v1.4.4/sbt-1.4.4.msi">windows installer</a></li><li><a href="https://github.com/sbt/sbt/releases/download/v1.4.4/sbt-1.4.4.zip">universal package</a></li><li>ä½¿ç”¨<a href="https://chocolatey.org/">Chocolatey</a>ã€ŒWindows å¹³å°åŒ…ç®¡ç†å™¨ã€ï¼š&gt; choco install sbt</li></ul></li><li><p><a href="https://www.scala-sbt.org/1.x/docs/Installing-sbt-on-Linux.html">for linux</a></p><ul><li><p>æ¨èæŠŠsbtè½¯ä»¶åŒ…å‘å¸ƒçš„aptä»“åº“åŠ å…¥åˆ°æºåˆ—è¡¨</p><p><img src="https://image.beenli.cn/img/20201203/bWG3g3NThAzf.png?imageslim" alt="mark"></p></li></ul></li></ul><h2 id="The-sbt-directory-structure"><a href="#The-sbt-directory-structure" class="headerlink" title="The sbt directory structure"></a>The sbt directory structure</h2><ul><li><p>æ‰‹åŠ¨åˆ›å»ºé¡¹ç›®ç›®å½•</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">mkdir HelloWorld<br><span class="hljs-built_in">cd</span> HelloWorld<br>mkdir -p src/{main,<span class="hljs-built_in">test</span>}/{java,resources,scala}<br>mkdir project target<br></code></pre></td></tr></tbody></table></figure></li></ul><p><img src="https://image.beenli.cn/img/20201203/JzI5IeQHXDQw.png?imageslim" alt="mark"></p><center>é¡¹ç›®ä¸»ç›®å½•ä¸‹çš„åŸºæœ¬æ–‡ä»¶ç»“æ„å›¾</center><ul><li><p>â€‹    ä½¿ç”¨sbtå‘½ä»¤è¡Œå·¥å…·</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sbt new scala/hello-world.g8    // ä»Githubä»“åº“ä¸Šæ‹‰ä¸‹æ¥é¡¹ç›®æ¨¡æ¿<br></code></pre></td></tr></tbody></table></figure><p><img src="https://image.beenli.cn/img/20201203/a5Q3j5v83kgy.png?imageslim" alt="mark"></p></li></ul><p><img src="https://image.beenli.cn/img/20201203/u63YK3DEd2WU.png?imageslim" alt="mark"></p><center>ç›®å½•ç»“æ„å’ŒğŸ‘†å¤§åŒå°å¼‚</center><figure class="highlight mipsasm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">- hello-world<br>    - project (<span class="hljs-keyword">sbt </span>uses this to <span class="hljs-keyword">install </span><span class="hljs-keyword">and </span>manage plugins <span class="hljs-keyword">and </span>dependencies)<br>        - <span class="hljs-keyword">build.properties</span><br><span class="hljs-keyword"> </span>   - src<br>        - main<br>            - <span class="hljs-keyword">scala </span>(All of your <span class="hljs-keyword">scala </span>code goes here)<br>                - Main.<span class="hljs-keyword">scala </span>(Entry point of program) &lt;-- this is all we need for now<br>    - <span class="hljs-keyword">build.sbt </span>(<span class="hljs-keyword">sbt's </span><span class="hljs-keyword">build </span>definition file)<br></code></pre></td></tr></tbody></table></figure><h2 id="Running-the-project"><a href="#Running-the-project" class="headerlink" title="Running the project"></a>Running the project</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sbt run<br></code></pre></td></tr></tbody></table></figure><p><img src="https://image.beenli.cn/img/20201203/Uz6oUqxI95y7.png?imageslim" alt="mark"></p><h2 id="Project-management"><a href="#Project-management" class="headerlink" title="Project management"></a>Project management</h2><blockquote><p><code>build.sbt</code>æ–‡ä»¶éå¸¸é‡è¦ï¼Œä½ é¡¹ç›®çš„Scalaç‰ˆæœ¬ï¼Œä¾èµ–é¡¹å…¨åœ¨é‡Œé¢æœ‰è¯´æ˜ã€‚</p><p>æ·»åŠ ä¾èµ–åï¼Œä½ æ‰å¯ä»¥åœ¨ä½ çš„ç¨‹åºé‡Œé¢æ­£å¸¸importï¼›</p><p>å‘å¸ƒçš„åŒ…å¯ä»¥åœ¨<a href="https://index.scala-lang.org/">è¿™é‡Œ</a>æŸ¥çœ‹</p></blockquote><p><img src="https://image.beenli.cn/img/20201203/h1WcOX3aQUIa.png?imageslim" alt="mark"></p><p>æ›´å¤šå†…å®¹è¯·è§ä¸‹ä¸€ç¯‡æ–‡ç« ï¼šã€build.sbt è¯¦è§£ã€‘<span class="github-emoji" style="display:inline;vertical-align:middle"><span>ğŸ˜¸</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f638.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></p><hr><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p>[1] <a href="https://docs.scala-lang.org/overviews/scala-book/scala-build-tool-sbt.html">Scala book</a></p><p>[2] <a href="https://docs.scala-lang.org/getting-started/sbt-track/getting-started-with-scala-and-sbt-on-the-command-line.html">GETTING STARTED WITH SCALA</a></p><p>[3] <a href="https://www.scala-sbt.org/1.x/docs/Hello.html">sbt reference</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æœ‰å¾ˆå¤šæ„å»ºå·¥å…·ï¼Œæ¯”å¦‚ Ant, Maven, Gradleç­‰ç­‰ï¼Œä½†æ˜¯ &lt;a href=&quot;http://www.scala-sbt.org/&quot;&gt;sbt&lt;/a&gt;æ˜¯ä¸“é—¨ä¸ºScalaè®¾è®¡çš„ã€‚å®ƒå‰äº›æ—¥å­è¿˜è¢«Scalaåˆ›å§‹äºº&lt;a href=&quot;https://t</summary>
      
    
    
    
    <category term="CS" scheme="https://www.beenli.cn/categories/CS/"/>
    
    <category term="Programming" scheme="https://www.beenli.cn/categories/CS/Programming/"/>
    
    <category term="env_problems" scheme="https://www.beenli.cn/categories/CS/Programming/env-problems/"/>
    
    
    <category term="Scala" scheme="https://www.beenli.cn/tags/Scala/"/>
    
  </entry>
  
  <entry>
    <title>batch file(1) -- for statement</title>
    <link href="https://www.beenli.cn/posts/c8d1a621/"/>
    <id>https://www.beenli.cn/posts/c8d1a621/</id>
    <published>2020-12-02T13:09:50.000Z</published>
    <updated>2020-12-03T00:46:22.889Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-official-explanation"><a href="#1-official-explanation" class="headerlink" title="1 official explanation"></a>1 official explanation</h1><blockquote><p>type <code>for /?</code> in your cmd.exe prompt</p></blockquote><p><img src="https://image.beenli.cn/img/20201202/w4qud1SIjXWb.png?imageslim" alt="mark"></p><h1 id="2-common-usage1"><a href="#2-common-usage1" class="headerlink" title="2 common usage1"></a>2 common usage<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup></h1><blockquote><p>è·Ÿpythoné‡Œé¢è¿­ä»£å™¨å‘ã€Œiteratorã€å¾ˆåƒï¼Œå¯¹ä¸€ä¸ªé›†åˆçš„æ•°æ®åšç›¸åŒçš„æ“ä½œã€‚</p><font color="red">note:</font><ul><li>å¦‚æœæ˜¯åœ¨å‘½ä»¤è¡Œ,é‚£ä¹ˆä½¿ç”¨<code>%G</code>;åœ¨è„šæœ¬æ–‡ä»¶ä¸­ä½¿ç”¨<code>%%G</code></li><li>å¦‚æœè¿­ä»£å™¨æ¯æ¬¡äº§ç”Ÿä¸€ä¸ªå€¼,é‚£æ­£å¥½èµ‹å€¼ä¸º%%G</li><li>å¦‚æœè¿­ä»£å™¨æ¯æ¬¡äº§ç”Ÿå¤šä¸ªå€¼,é‚£ä¹ˆç³»ç»Ÿéšå¼å®šä¹‰å‡ ä¸ªå˜é‡æ¥ä¿å­˜å€¼ï¼Œé»˜è®¤æ˜¯æŒ‰å­—æ¯é¡ºåº:<code>%%H</code> <code>%%I</code> <code>%%J</code>â€¦</li><li>å¦‚æœè¿­ä»£å™¨äº§ç”Ÿæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨æ‰©å±•ç¬¦æ¥æå–æ–‡ä»¶åç§°/è·¯å¾„/æ—¥æœŸ/å¤§å°ç­‰</li></ul></blockquote><h2 id="1-for"><a href="#1-for" class="headerlink" title="1 for"></a>1 for</h2><blockquote><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic">FOR %%parameter IN (set) DO command <br></code></pre></td></tr></tbody></table></figure><ul><li>æŠŠä¸€ç³»åˆ—æ–‡ä»¶æ‹·è´åˆ°å¤‡ä»½</li></ul></blockquote>  <figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic">FOR %%G IN ("C:\demo files\file1.txt" "C:\demo files\File2.txt") DO copy %%G d:\backups\<br></code></pre></td></tr></tbody></table></figure><h2 id="2-for-R"><a href="#2-for-R" class="headerlink" title="2 for /R"></a>2 for /R</h2><blockquote><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic">FOR /R [[drive:]path] %%parameter IN (set) DO command<br></code></pre></td></tr></tbody></table></figure><ul><li><p>å¦‚æœçœç•¥[[drive:]path] é‚£ä¹ˆç”¨å½“å‰çš„ä»£æ›¿</p></li><li><p>setå¿…é¡»ä½¿ç”¨é€šé…ç¬¦<code>?</code>å’Œ<code>.</code></p></li><li><p>å¦‚æœ(set)ä¸º(.), é‚£ä¹ˆä¾¿åˆ©æ¯ä¸ªæ–‡ä»¶å¤¹ï¼Œä¸éå†æ–‡ä»¶<sup><a href="#fn_test" id="reffn_test">test</a></sup></p></li></ul></blockquote><ol><li><p>åˆ—å‡ºä»C:\temp\å¼€å§‹çš„æ¯ä¸ªå­æ–‡ä»¶å¤¹ä¸­çš„æ¯ä¸ª.bakæ–‡ä»¶</p><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic">For /R C:\temp\ %%G IN (*.bak) do Echo "%%G"<br></code></pre></td></tr></tbody></table></figure></li><li><p>å°†â€™demoâ€™æ–‡ä»¶å¤¹å’Œæ‰€æœ‰å­æ–‡ä»¶å¤¹ä¸­çš„.LOGæ–‡ä»¶é‡å‘½åä¸º.TXT:</p><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic">For /R C:\demo\ %%G in (*.LOG) do Echo REN "%%G" "%%~nG.TXT"<br></code></pre></td></tr></tbody></table></figure></li><li><p>ä¾æ¬¡å°†ç›®å½•æ›´æ”¹ä¸ºå½“å‰æ–‡ä»¶å¤¹ä¸‹çš„æ¯ä¸ªå­æ–‡ä»¶å¤¹(åŒ…å«è‡ªå·±æ‰€åœ¨æ–‡ä»¶å¤¹)<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup></p><figure class="highlight dos"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-keyword">FOR</span> /R  <span class="hljs-variable">%%G</span> <span class="hljs-keyword">in</span> (.) <span class="hljs-keyword">DO</span> (<br> <span class="hljs-built_in">Pushd</span> <span class="hljs-variable">%%G</span><br> <span class="hljs-built_in">Echo</span> now <span class="hljs-keyword">in</span> <span class="hljs-variable">%%G</span><br> <span class="hljs-built_in">Popd</span> )<br><span class="hljs-built_in">Echo</span> "back home"<br></code></pre></td></tr></tbody></table></figure></li></ol><p>   <img src="https://image.beenli.cn/img/20201202/dJ8iLSFzbna0.png?imageslim" alt="mark"></p><h2 id="3-for-D"><a href="#3-for-D" class="headerlink" title="3 for /D"></a>3 for /D</h2><blockquote><figure class="highlight jboss-cli"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">FOR <span class="hljs-string">/D</span> [<span class="hljs-string">/r</span>] %%parameter IN <span class="hljs-params">(folder_set)</span> DO <span class="hljs-keyword">command</span><br></code></pre></td></tr></tbody></table></figure><p>åœ¨å‡ ä¸ªç›®å½•/æ–‡ä»¶å¤¹ä¸Šæœ‰æ¡ä»¶åœ°æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ã€‚</p><p>/r  é€’å½’çš„è¿›å…¥å­æ–‡ä»¶å¤¹</p></blockquote><ul><li><p>åˆ—å‡ºåç§°ä»¥â€œUsersâ€å¼€å¤´çš„æ–‡ä»¶å¤¹C:\Work\ä¸‹é¢çš„æ¯ä¸ªå­æ–‡ä»¶å¤¹</p><figure class="highlight dos"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dos">@<span class="hljs-built_in">Echo</span> Off<br><span class="hljs-built_in">CD</span> \Work<br><span class="hljs-keyword">FOR</span> /D /r <span class="hljs-variable">%%G</span> <span class="hljs-keyword">in</span> ("User*") <span class="hljs-keyword">DO</span> <span class="hljs-built_in">Echo</span> We found <span class="hljs-variable">%%~</span>nxG<br></code></pre></td></tr></tbody></table></figure><h2 id="4-for-L"><a href="#4-for-L" class="headerlink" title="4 for /L"></a>4 for /L</h2></li></ul><blockquote><figure class="highlight livecodeserver"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">FOR /L %%parameter IN (<span class="hljs-built_in">start</span>,step,<span class="hljs-keyword">end</span>) DO <span class="hljs-keyword">command</span> <br></code></pre></td></tr></tbody></table></figure><p>æœ‰æ¡ä»¶åœ°å¯¹ä¸€ç»„æ•°å­—æ‰§è¡Œå‘½ä»¤ã€‚</p></blockquote><ul><li><p>ä»1æ•°åˆ°5</p><figure class="highlight dos"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-keyword">FOR</span> /L <span class="hljs-variable">%%G</span> <span class="hljs-keyword">IN</span> (<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">5</span>) <span class="hljs-keyword">DO</span> <span class="hljs-built_in">echo</span> <span class="hljs-variable">%%G</span><br></code></pre></td></tr></tbody></table></figure></li><li><p>éæ•°å€¼åˆ—è¡¨å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„forå‘½ä»¤</p><figure class="highlight dos"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-keyword">FOR</span> <span class="hljs-variable">%%G</span> <span class="hljs-keyword">IN</span> (Sun Mon Tue Wed Thur Fri Sat) <span class="hljs-keyword">DO</span> <span class="hljs-built_in">echo</span> <span class="hljs-variable">%%G</span><br></code></pre></td></tr></tbody></table></figure></li><li><p>ç»™æ–‡ä»¶åˆ›å»º1000ä¸ªå‰¯æœ¬</p><figure class="highlight dos"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-keyword">FOR</span> /l <span class="hljs-variable">%%G</span> <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1000</span>) <span class="hljs-keyword">DO</span> <span class="hljs-built_in">copy</span> SourceFile.txt NewFile<span class="hljs-variable">%%G</span>.txt<br></code></pre></td></tr></tbody></table></figure><h2 id="5-for-F"><a href="#5-for-F" class="headerlink" title="5 for /F"></a>5 for /F</h2></li></ul><blockquote><figure class="highlight cos"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cos"><span class="hljs-keyword">FOR</span> /F [<span class="hljs-string">"options"</span>] %<span class="hljs-built_in">%parameter</span> IN (filenameset) <span class="hljs-keyword">DO</span> command <br><br><span class="hljs-keyword">FOR</span> /F [<span class="hljs-string">"options"</span>] %<span class="hljs-built_in">%parameter</span> IN (<span class="hljs-string">"Text string to process"</span>) <span class="hljs-keyword">DO</span> command<br></code></pre></td></tr></tbody></table></figure><p>é’ˆå¯¹æ–‡ä»¶é‡Œé¢çš„å­—ç¬¦å¤„ç†</p><p><code>options:</code>(ä¼˜å…ˆçº§ï¼šusebackq &gt; skip &gt; delims &gt; eol &gt; tokens)</p><ol><li><p>delims=xxx(åˆ†éš”ç¬¦, é»˜è®¤ä¸ºç©ºæ ¼)</p></li><li><p>skip=n ï¼ˆæ–‡ä»¶å¼€å¤´è¦è·³è¿‡çš„ä¸€äº›è¡Œ,é»˜è®¤ä¸º0)</p></li><li><p>eol=;  (æ¯è¡Œå¼€å¤´æŒ‡ç¤ºæ³¨é‡Šçš„å­—ç¬¦ï¼Œé»˜è®¤ä¸ºåˆ†å·;)</p></li><li><p>tokens=n (æŒ‡å®šè¦ä»æ¯è¡Œè¯»å–å“ªäº›ç¼–å·çš„é¡¹,é»˜è®¤ä¸º1)</p></li><li><p>usebackq (ä½¿ç”¨äº¤æ›¿å¼•ç”¨çš„é£æ ¼)</p><p><img src="https://image.beenli.cn/img/20201203/IGenal079Kft.png?imageslim" alt="mark"></p></li></ol></blockquote><ol><li>å¦‚æœâ€delims=â€,é‚£ä¹ˆæŠŠä¸€è¡Œéƒ½è§†ä¸ºç¬¬ä¸€ä¸ªtoken</li><li>â€œeol=&amp;â€ ä¸€èˆ¬æŠŠeolè®¾ç½®ä¸ºä¸å®¹æ˜“ç¢°åˆ°çš„å­—ç¬¦ï¼Œé¿å…æŠŠæœ¬è¯¥è§£é‡Šçš„è¡Œæ³¨é‡Šæ‰</li><li>â€œskip=3â€ å»æ‰å‰é¢ä¸‰ä¸ªç©ºè¡Œ</li><li>tokensç”¨æ³•:<code>2,4,6</code>, <code>2-6</code>(2åˆ°6),<code>*</code>(æ‰€æœ‰), <code>3*</code>(ç¬¬4ä¸ªèµ·åé¢çš„)</li></ol><hr><ul><li><p>å¤åˆ¶æ–‡æœ¬æ–‡ä»¶ä¸­åˆ—å‡ºçš„æ–‡ä»¶åˆ°æ–°çš„ç›®çš„åœ°:</p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">å‡è®¾<span class="hljs-keyword">files</span>.txtæ¯è¡ŒåŒ…å«ä¸€ä¸ªæ–‡ä»¶å<br>FOR /<span class="hljs-keyword">f</span> <span class="hljs-string">"delims="</span> %%G in (<span class="hljs-keyword">files</span>.txt) DO <span class="hljs-keyword">copy</span> <span class="hljs-string">"\\source\folder\%%G"</span> <span class="hljs-string">"H:\destination\%%G"</span><br></code></pre></td></tr></tbody></table></figure></li><li><p>ä»åŒ…å«å­—ç¬¦å’Œé€—å·çš„æ–‡æœ¬æ–‡ä»¶ä¸­æå–æ•°æ®</p><p>æ–‡ä»¶å¦‚ä¸‹ï¼š</p><p>January,Snowy,02<br>February,Rainy,15<br>March,Sunny,25</p><figure class="highlight cos"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cos"><span class="hljs-keyword">FOR</span> /F <span class="hljs-string">"tokens=1,3 delims=,"</span> %<span class="hljs-built_in">%G</span> IN (weather.txt) <span class="hljs-keyword">DO</span> @echo %<span class="hljs-built_in">%G</span> %<span class="hljs-built_in">%H</span><br></code></pre></td></tr></tbody></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><p>January 02<br>February 15<br>March 25</p></li><li><p>è§£æä¸€æ®µå­—ç¬¦ä¸²</p><figure class="highlight cos"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cos"><span class="hljs-keyword">FOR</span> /F <span class="hljs-string">"tokens=4 delims=,"</span> %<span class="hljs-built_in">%G</span> IN (<span class="hljs-string">"deposit,$4500,123.4,12-AUG-09"</span>) <span class="hljs-keyword">DO</span> @echo Date paid %<span class="hljs-built_in">%G</span><br></code></pre></td></tr></tbody></table></figure><p>è¾“å‡ºï¼šDate paid 12-AUG-09</p></li></ul><h2 id="6-for-F"><a href="#6-for-F" class="headerlink" title="6 for /F"></a>6 for /F</h2><blockquote><figure class="highlight vhdl"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vhdl"><span class="hljs-keyword">FOR</span> /F [<span class="hljs-string">"options"</span>] %%<span class="hljs-keyword">parameter</span> <span class="hljs-keyword">IN</span> (<span class="hljs-symbol">'command</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">process</span>') DO command<br></code></pre></td></tr></tbody></table></figure><p>å‘½ä»¤è§£æï¼šå¯¹å‘½ä»¤çš„å¤„ç†åŒ…æ‹¬æ¯æ¬¡è¯»å–ä¸€è¡Œå‘½ä»¤çš„è¾“å‡ºï¼Œç„¶åå°†è¯¥è¡Œåˆ†è§£ä¸ºå•ä¸ªçš„æ•°æ®é¡¹æˆ–â€œtokensâ€ã€‚ç„¶åæ‰§è¡ŒDOå‘½ä»¤ï¼Œå¹¶å°†å‚æ•°è®¾ç½®ä¸ºæ‰¾åˆ°çš„tokensã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼šä½ æƒ³æ‰§è¡Œä¸€äº›å‘½ä»¤ï¼ŒæŠŠå‘½ä»¤æŒ‡ä»¤çš„ç»“æœæå–å‡ºæ¥å¹¶èµ‹äºˆå˜é‡ï¼Œç„¶åå¯¹è¯¥å˜é‡è¿›è¡Œä¸€ç³»åˆ—æ“ä½œ</p></blockquote><ul><li><p>åªæ‰“å°ç¯å¢ƒå˜é‡ï¼Œä¸æ‰“å°å…¶å€¼</p><figure class="highlight cos"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cos"><span class="hljs-keyword">FOR</span> /F <span class="hljs-string">"delims=="</span> <span class="hljs-built_in">%G</span> IN ('<span class="hljs-keyword">SET</span>') <span class="hljs-keyword">DO</span> @Echo <span class="hljs-built_in">%G</span><br></code></pre></td></tr></tbody></table></figure></li><li><p>æŠŠWindowsç‰ˆæœ¬è®¾ç½®ä¸ºç¯å¢ƒå˜é‡</p><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">FOR</span> /F <span class="hljs-string">"tokens=4*"</span> %%G <span class="hljs-keyword">IN</span> (<span class="hljs-string">'ver'</span>) <span class="hljs-keyword">DO</span> <span class="hljs-builtin-name">SET</span> <span class="hljs-attribute">_version</span>=%%G <br></code></pre></td></tr></tbody></table></figure><p>è¾“å‡ºç»“æœï¼š</p><p>SET _version=10.0.19042.630]</p><p>ï¼ˆå…¶ä¸­å‘½ä»¤envè¾“å‡º:Microsoft Windows [Version 10.0.19042.630])</p></li><li><p>åˆ—å‡ºä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡æœ¬æ–‡ä»¶ï¼ŒåŒ…æ‹¬å®Œæ•´è·¯å¾„</p><figure class="highlight cos"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cos"><span class="hljs-keyword">FOR</span> /F <span class="hljs-string">"tokens=*"</span> %<span class="hljs-built_in">%G</span> IN ('dir/b /<span class="hljs-keyword">s</span> ^<span class="hljs-string">"c:\program files\*.txt^"</span>') <span class="hljs-keyword">DO</span> echo %<span class="hljs-built_in">%G</span><br></code></pre></td></tr></tbody></table></figure></li></ul><h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none; padding-left: 0;"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">1.</span><span style="display: inline-block; vertical-align: top;"><a href="https://ss64.com/nt/for.html">For - Looping commands - Windows CMD</a></span><a href="#fnref:1" rev="footnote"> â†©</a></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">2.</span><span style="display: inline-block; vertical-align: top;"><a href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/pushd">windows-commands pushd</a></span><a href="#fnref:2" rev="footnote"> â†©</a></li></ol></div></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-official-explanation&quot;&gt;&lt;a href=&quot;#1-official-explanation&quot; class=&quot;headerlink&quot; title=&quot;1 official explanation&quot;&gt;&lt;/a&gt;1 official explanati</summary>
      
    
    
    
    <category term="CS" scheme="https://www.beenli.cn/categories/CS/"/>
    
    <category term="Programming" scheme="https://www.beenli.cn/categories/CS/Programming/"/>
    
    <category term="Scripts" scheme="https://www.beenli.cn/categories/CS/Programming/Scripts/"/>
    
    
    <category term="Batch" scheme="https://www.beenli.cn/tags/Batch/"/>
    
  </entry>
  
  <entry>
    <title>Install Scala</title>
    <link href="https://www.beenli.cn/posts/74349f7/"/>
    <id>https://www.beenli.cn/posts/74349f7/</id>
    <published>2020-12-02T07:39:04.000Z</published>
    <updated>2020-12-03T00:54:33.211Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-Install-what1"><a href="#1-Install-what1" class="headerlink" title="1 Install what1"></a>1 Install what<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup></h2><blockquote><p>å®‰è£…Installæ„å‘³ç€å®‰è£…å„ç§å‘½ä»¤è¡Œå·¥å…·ã€ŒScala compiler, coursier, sbtâ€¦ã€å’Œæ„å»ºå·¥å…·ã€Œbuild toolsã€</p></blockquote><h2 id="2-how-to-install"><a href="#2-how-to-install" class="headerlink" title="2 how to install"></a>2 how to install</h2><blockquote><p>æœ‰ä¸¤ç§åŠæ³•ï¼š</p><ol><li>Scala Installer toolï¼šè‡ªåŠ¨å®‰è£…æ‰€æœ‰ä¾èµ–</li><li>æ‰‹åŠ¨å®‰è£…</li></ol></blockquote><h3 id="â‘ -Scala-Installer"><a href="#â‘ -Scala-Installer" class="headerlink" title="â‘  Scala Installer"></a>â‘  Scala Installer</h3><p>Windows msiï¼š<a href="https://downloads.lightbend.com/scala/2.13.4/scala-2.13.4.msi">è·å–å®‰è£…åŒ…Scala-2.13.4</a>(è¿™ç§æ–¹æ³•æœ€ç®€ä¾¿, è·ŸWindowså…¶å®ƒè½¯ä»¶åŒ…å®‰è£…æ–¹å¼ä¸€æ ·)</p><hr><p>æˆ–è€…ä¸‹è½½<a href="https://github.com/coursier/coursier">coursier</a>(Scalaå·¥ä»¶ã€Œartifactã€è·å–å™¨)</p><p><img src="https://image.beenli.cn/img/20201202/S0bzdtb75Nf2.png?imageslim" alt="mark"></p><blockquote><p>ğŸ‘‡ä¸‰ç§æ–¹æ³•ä»»é€‰å…¶ä¸€</p></blockquote><ol><li><p>ä¸‹è½½æºä»£ç (è‡ªå·±ç¼–è¯‘,æ‰“åŒ…æˆjaråŒ…)</p></li><li><p>ä¸‹è½½è„šæœ¬+jaråŒ…</p></li><li><p>ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶</p></li></ol><blockquote><p>æ–¹æ³•äºŒè¯¦è§£:</p></blockquote><ul><li><p>ç¡®ä¿ä½ æœ‰Javaï¼ˆè¿è¡ŒJava â€”version)</p><p><img src="https://image.beenli.cn/img/20201202/tJcHxloH4grk.png?imageslim" alt="mark"></p></li><li><p>ç¡®ä¿ç¯å¢ƒå˜é‡è®¾ç½®æ­£ç¡®âœ”(set <code>JAVA_HOME</code>=<code>/path/to/java/installation</code>)</p><p><font color="red">notes: </font>æ¯”å¦‚ä½ java.exeåœ¨D:\app\jdk\bin\java.exe; é‚£å°±è®¾ç½®JAVA_HOME=D:\app\jdkå³å¯,ä¸è¦å†åŠ \</p><p><img src="https://image.beenli.cn/img/20201202/8TnE1UtiERJ9.png?imageslim" alt="coursier"></p><blockquote><p>è„šæœ¬è‡ªåŠ¨æ£€æµ‹ä½ ç”µè„‘ä¸Šçš„Javaç¯å¢ƒ, å¦‚æœæ²¡æœ‰è‡ªåŠ¨ä¸‹è½½</p><p>è‡ªåŠ¨ä¸‹è½½æ ‡å‡†Scalaåº”ç”¨ç¨‹åºåˆ°~\AppData\Local\Coursier\data\bin</p></blockquote></li></ul><div class="table-container"><table><thead><tr><th><a href="https://ammonite.io/">ammonite</a></th><th>improved Scala REPL(ç›¸å½“äºipython)</th></tr></thead><tbody><tr><td>cs</td><td>coursier</td></tr><tr><td>scala</td><td>Scala REPL</td></tr><tr><td>scalac</td><td>scala compiler</td></tr><tr><td>sbt</td><td>Scalaæ„å»ºå·¥å…·</td></tr></tbody></table></div><h3 id="â‘¡-manually"><a href="#â‘¡-manually" class="headerlink" title="â‘¡ manually"></a>â‘¡ manually</h3><ul><li>ä¸‹è½½<a href="https://www.oracle.com/java/technologies/javase-downloads.html">Oracle Java 8\11</a></li><li>ä¸‹è½½<a href="https://www.scala-sbt.org/download.html">sbt</a><ul><li>ğŸ‘†coursierå¯ä»¥çœ‹æˆå®ƒçš„æ’ä»¶ï¼Œç”¨äºè§£å†³åŒ…ä¾èµ–é—®é¢˜</li><li>ä¸ºè‡ªå·±é¡¹ç›®é€‰å®šç‰¹å®šScalaç‰ˆæœ¬ï¼Œç›¸åº”çš„åŒ…ç‰ˆæœ¬;sbtä¼šå¸®ä½ è‡ªåŠ¨è§£å†³</li></ul></li></ul><h2 id="3-check"><a href="#3-check" class="headerlink" title="3 check"></a>3 check</h2><ol><li><p>å¦‚æœä½ ç”¨çš„msiå®‰è£…åŒ…,é»˜è®¤å®‰è£…åœ¨<code>c/Program Files (x86)/scala/bin/</code>ä¸‹</p></li><li><p>å¦‚æœä½¿ç”¨csï¼Œé‚£ä¹ˆåœ¨~/AppData/Local/Coursier/data/bin ä¸‹</p><p><img src="https://image.beenli.cn/img/20201202/O5ls0QiHBrPn.png?imageslim" alt="mark"></p></li></ol><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none; padding-left: 0;"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">1.</span><span style="display: inline-block; vertical-align: top;"><a href="https://docs.scala-lang.org/getting-started.html">Getting started with scala</a></span><a href="#fnref:1" rev="footnote"> â†©</a></li></ol></div></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-Install-what1&quot;&gt;&lt;a href=&quot;#1-Install-what1&quot; class=&quot;headerlink&quot; title=&quot;1 Install what1&quot;&gt;&lt;/a&gt;1 Install what&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    <category term="CS" scheme="https://www.beenli.cn/categories/CS/"/>
    
    <category term="Programming" scheme="https://www.beenli.cn/categories/CS/Programming/"/>
    
    <category term="env_problems" scheme="https://www.beenli.cn/categories/CS/Programming/env-problems/"/>
    
    
    <category term="Scala" scheme="https://www.beenli.cn/tags/Scala/"/>
    
  </entry>
  
  <entry>
    <title>Generate constructs</title>
    <link href="https://www.beenli.cn/posts/7a9bb3ef/"/>
    <id>https://www.beenli.cn/posts/7a9bb3ef/</id>
    <published>2020-11-10T10:55:31.000Z</published>
    <updated>2020-11-10T12:28:34.126Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><blockquote><p>Generate constructs are used to either conditionally or multiply instantiate generate blocks into a model</p><p><code>ç”Ÿæˆç»“æ„</code>ç”¨äºè¦ä¹ˆæœ‰æ¡ä»¶åœ°æˆ–æˆå€åœ°å®ä¾‹åŒ–ç”Ÿæˆå—åˆ°ä¸€ä¸ªæ¨¡å‹ä¸­ã€‚</p></blockquote><p>æœ‰ä¸¤ç§ç”Ÿæˆç»“æ„ï¼š<code>loops</code>å’Œ<code>conditionals</code></p><p>loops: ç”¨äºå®ä¾‹ç”Ÿæˆå—å¤šæ¬¡</p><p>conditionals: åŒ…æ‹¬if-generateå’Œcase-generateç»“æ„;æœ€å¤šä»ä¸€ç³»åˆ—<code>generate blocks</code>ä¸­é€‰æ‹©ä¸€ä¸ª.</p><hr><blockquote><p><code>Generate schemes</code> are evaluated during elaboration of the model.</p><p>ç”Ÿæˆæ–¹æ³•ï¼šå†³å®šå“ªä¸ªç”Ÿæˆå—è¢«å®ä¾‹åŒ–æˆ–å¤šå°‘ç”Ÿæˆå—è¢«å®ä¾‹åŒ–çš„æ–¹æ³•ã€‚</p><p>Elaboration occurs after parsing the HDL and before simulation(ç”Ÿæˆå‘ç”Ÿåœ¨è§£æHDLä¹‹åä»¿çœŸä¹‹å‰);åŒ…æ‹¬å¦‚ä¸‹äº”ä¸ªè¿‡ç¨‹ï¼š</p><ul><li>expanding module instantiations</li><li>computing parameter values</li><li>resolving hierarchical names</li><li>establishing net connectivity</li><li>preparing the model for simulation</li></ul></blockquote><h2 id="Loop-generate-constructs"><a href="#Loop-generate-constructs" class="headerlink" title="Loop generate constructs"></a>Loop generate constructs</h2><blockquote><p><code>loopç”Ÿæˆç»“æ„</code>è¿è¡Œä½¿ç”¨ç±»ä¼¼for loop çš„è¯­æ³•æŠŠä¸€ä¸ªç”Ÿæˆå—å®ä¾‹å¤šæ¬¡ã€‚å¾ªç¯ç´¢å¼•å˜é‡åº”è¯¥åœ¨ä½¿ç”¨å‰ç”¨<code>genvar</code>å£°æ˜ï¼›genvaråªåœ¨elaborationæ—¶æœ‰ç”¨ï¼Œæ‰€ä»¥ä½ ä¸èƒ½åœ¨ç”Ÿæˆå—ä»»ä½•åœ°æ–¹å¼•ç”¨å®ƒã€‚</p></blockquote><ol><li><p>å‚æ•°åŒ–</p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">module</span>  gray2bin1 (bin, gray); <br>   <span class="hljs-keyword">parameter</span>  SIZE = <span class="hljs-number">8</span>;      <span class="hljs-comment">// this module is parameterizable </span><br>   <span class="hljs-keyword">output</span>  [SIZE-<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] bin; <br>   <span class="hljs-keyword">input</span>   [SIZE-<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] gray; <br>  <br>   <span class="hljs-keyword">genvar</span>  i; <br>   <span class="hljs-keyword">generate</span>  <br>     <span class="hljs-keyword">for</span>  (i=<span class="hljs-number">0</span>; i&lt;SIZE; i=i+<span class="hljs-number">1</span>)  <span class="hljs-keyword">begin</span> :<span class="hljs-keyword">bit</span><br>       <span class="hljs-keyword">assign</span>  bin[i] = ^gray[SIZE-<span class="hljs-number">1</span>:i]; <br>            <span class="hljs-comment">// i refers to the implicitly defined localparam whose</span><br>            <span class="hljs-comment">// value in each instance of the generate block is</span><br>            <span class="hljs-comment">// the value of the genvar when it was elaborated.</span><br>     <span class="hljs-keyword">end</span> <br>   <span class="hljs-keyword">endgenerate</span><br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></tbody></table></figure></li><li><p>ä½¿ç”¨äºŒç»´netæŠŠç”Ÿæˆçš„å®ä¾‹è¿æ¥èµ·æ¥</p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs Verilog"><span class="hljs-keyword">module</span>  addergen1 (co, sum, a, b, ci); <br>   <span class="hljs-keyword">parameter</span>  SIZE = <span class="hljs-number">4</span>; <br>   <span class="hljs-keyword">output</span>  [SIZE-<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] sum; <br>   <span class="hljs-keyword">output</span>             co; <br>   <span class="hljs-keyword">input</span>   [SIZE-<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] a, b; <br>   <span class="hljs-keyword">input</span>              ci; <br>   <span class="hljs-keyword">wire</span>    [SIZE  :<span class="hljs-number">0</span>] c; <br>   <span class="hljs-keyword">wire</span>    [SIZE-<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] t [<span class="hljs-number">1</span>:<span class="hljs-number">3</span>]; <br>   <span class="hljs-keyword">genvar</span>             i; <br>  <br>   <span class="hljs-keyword">assign</span>  c[<span class="hljs-number">0</span>] = ci; <br>  <br>  <span class="hljs-comment">// Hierarchical gate instance names are: </span><br>  <span class="hljs-comment">// xor gates: bit[0].g1 bit[1].g1 bit[2].g1 bit[3].g1</span><br>  <span class="hljs-comment">//            bit[0].g2 bit[1].g2 bit[2].g2 bit[3].g2</span><br>  <span class="hljs-comment">// and gates: bit[0].g3 bit[1].g3 bit[2].g3 bit[3].g3</span><br>  <span class="hljs-comment">//            bit[0].g4 bit[1].g4 bit[2].g4 bit[3].g4</span><br>  <span class="hljs-comment">// or  gates: bit[0].g5 bit[1].g5 bit[2].g5 bit[3].g5 </span><br>  <span class="hljs-comment">// Generated instances are connected with </span><br>  <span class="hljs-comment">// multidimensional nets t[1][3:0] t[2][3:0] t[3][3:0] </span><br>  <span class="hljs-comment">// (12 nets total) </span><br>   <br>     <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i&lt;SIZE; i=i+<span class="hljs-number">1</span>)  <span class="hljs-keyword">begin</span> :<span class="hljs-keyword">bit</span><br>       <span class="hljs-keyword">xor</span>  g1 ( t[<span class="hljs-number">1</span>][i],    a[i],    b[i]); <br>       <span class="hljs-keyword">xor</span>  g2 (  sum[i], t[<span class="hljs-number">1</span>][i],    c[i]); <br>       <span class="hljs-keyword">and</span>  g3 ( t[<span class="hljs-number">2</span>][i],    a[i],    b[i]); <br>       <span class="hljs-keyword">and</span>  g4 ( t[<span class="hljs-number">3</span>][i], t[<span class="hljs-number">1</span>][i],    c[i]); <br>       <span class="hljs-keyword">or</span>   g5 (  c[i+<span class="hljs-number">1</span>], t[<span class="hljs-number">2</span>][i], t[<span class="hljs-number">3</span>][i]); <br>     <span class="hljs-keyword">end</span>  <br>  <br>   <span class="hljs-keyword">assign</span>  co = c[SIZE]; <br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></tbody></table></figure></li><li><p>multilevel generate loop</p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">parameter</span>  SIZE = <span class="hljs-number">2</span>; <br><span class="hljs-keyword">genvar</span>  i, j, k, m; <br><span class="hljs-keyword">generate</span>  <br>   <span class="hljs-keyword">for</span>  (i=<span class="hljs-number">0</span>; i&lt;SIZE; i=i+<span class="hljs-number">1</span>)  <span class="hljs-keyword">begin</span> :B1     <span class="hljs-comment">// scope B1[i] </span><br>    M1 N1();                   <span class="hljs-comment">// instantiates B1[i].N1</span><br>     <span class="hljs-keyword">for</span>  (j=<span class="hljs-number">0</span>; j&lt;SIZE; j=j+<span class="hljs-number">1</span>)  <span class="hljs-keyword">begin</span> :B2   <span class="hljs-comment">// scope B1[i].B2[j]</span><br>      M2 N2();                 <span class="hljs-comment">// instantiates B1[i].B2[j].N2 </span><br>       <span class="hljs-keyword">for</span>  (k=<span class="hljs-number">0</span>; k&lt;SIZE; k=k+<span class="hljs-number">1</span>)  <span class="hljs-keyword">begin</span> :B3 <span class="hljs-comment">// scope B1[i].B2[j].B3[k] </span><br>        M3 N3();               <span class="hljs-comment">// instantiates B1[i].B2[j].B3[k].N3</span><br>       <span class="hljs-keyword">end</span>  <br>     <span class="hljs-keyword">end</span>  <br>     <span class="hljs-keyword">if</span>  (i&gt;<span class="hljs-number">0</span>)  <span class="hljs-keyword">begin</span> :B4                   <span class="hljs-comment">// scope B1[i].B4</span><br>       <span class="hljs-keyword">for</span>  (m=<span class="hljs-number">0</span>; m&lt;SIZE; m=m+<span class="hljs-number">1</span>)  <span class="hljs-keyword">begin</span> :B5 <span class="hljs-comment">// scope B1[i].B4.B5[m] </span><br>        M4 N4();               <span class="hljs-comment">// instantiates B1[i].B4.B5[m].N4 </span><br>       <span class="hljs-keyword">end</span>  <br>     <span class="hljs-keyword">end</span><br>   <span class="hljs-keyword">end</span>  <br><span class="hljs-keyword">endgenerate</span>  <br>  <span class="hljs-comment">// Some examples of hierarchical names for the module instances: </span><br>  <span class="hljs-comment">// B1[0].N1              B1[1].N1</span><br>  <span class="hljs-comment">// B1[0].B2[0].N2        B1[0].B2[1].N2</span><br>  <span class="hljs-comment">// B1[0].B2[0].B3[0].N3  B1[0].B2[0].B3[1].N3</span><br>  <span class="hljs-comment">// B1[0].B2[1].B3[0].N3</span><br>  <span class="hljs-comment">// B1[1].B4.B5[0].N4     B1[1].B4.B5[1].N4</span><br></code></pre></td></tr></tbody></table></figure><h2 id="Conditional-generate-constructs"><a href="#Conditional-generate-constructs" class="headerlink" title="Conditional generate constructs"></a>Conditional generate constructs</h2></li></ol><blockquote><p><code>æ¡ä»¶ç”Ÿæˆç»“æ„</code>åªèƒ½é€‰æ‹©ä¸€ä¸ªç”Ÿæˆå—</p></blockquote><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs Verilog"><span class="hljs-keyword">module</span>  test;<br><span class="hljs-keyword">parameter</span>  p = <span class="hljs-number">0</span>, q = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">wire</span>  a, b, c;<br><span class="hljs-comment">//---------------------------------------------------------</span><br><span class="hljs-comment">// Code to either generate a u1.g1 instance or no instance.</span><br><span class="hljs-comment">// The u1.g1 instance of one of the following gates:</span><br><span class="hljs-comment">// (and, or, xor, xnor) is generated if</span><br><span class="hljs-comment">// {p,q} == {1,0}, {1,2}, {2,0}, {2,1}, {2,2}, {2, default}</span><br><span class="hljs-comment">//---------------------------------------------------------</span><br><span class="hljs-keyword">if</span>  (p == <span class="hljs-number">1</span>)<br>   <span class="hljs-keyword">if</span>  (q == <span class="hljs-number">0</span>)<br>     <span class="hljs-keyword">begin</span>  : u1          <span class="hljs-comment">// If p==1 and q==0, then instantiate</span><br>       <span class="hljs-keyword">and</span>  g1(a, b, c); <span class="hljs-comment">// AND with hierarchical name test.u1.g1</span><br>     <span class="hljs-keyword">end</span><br>   <span class="hljs-keyword">else</span>   <span class="hljs-keyword">if</span>  (q == <span class="hljs-number">2</span>)<br>     <span class="hljs-keyword">begin</span>  : u1          <span class="hljs-comment">// If p==1 and q==2, then instantiate</span><br>       <span class="hljs-keyword">or</span>   g1(a, b, c); <span class="hljs-comment">// OR with hierarchical name test.u1.g1</span><br>     <span class="hljs-keyword">end</span><br>                   <span class="hljs-comment">// "else" added to end "if (q == 2)" statement</span><br>   <span class="hljs-keyword">else</span> ;                                   <span class="hljs-comment">// If p==1 and q!=0 or 2, then no instantiation</span><br><span class="hljs-keyword">else</span>   <span class="hljs-keyword">if</span>  (p == <span class="hljs-number">2</span>)<br>   <span class="hljs-keyword">case</span>  (q)<br>  <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>:<br>     <span class="hljs-keyword">begin</span>  : u1         <span class="hljs-comment">// If p==2 and q==0,1, or 2, then instantiate</span><br>            <span class="hljs-keyword">xor</span>  g1(a, b, c);<span class="hljs-comment">// XOR with hierarchical name test.u1.g1</span><br>          <span class="hljs-keyword">end</span><br>   <span class="hljs-keyword">default</span> :<br>     <span class="hljs-keyword">begin</span>  : u1          <span class="hljs-comment">// If p==2 and q!=0,1, or 2, then instantiate</span><br>       <span class="hljs-keyword">xnor</span>  g1(a, b, c);<span class="hljs-comment">// XNOR with hierarchical name test.u1.g1</span><br>     <span class="hljs-keyword">end</span><br>   <span class="hljs-keyword">endcase</span><br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></tbody></table></figure><h2 id="External-names-for-unnamed"><a href="#External-names-for-unnamed" class="headerlink" title="External names for unnamed"></a>External names for unnamed</h2><blockquote><p>å°½ç®¡ä¸€ä¸ªæ²¡æœ‰åå­—çš„ç”Ÿæˆå—æ²¡æœ‰å¯ä»¥è¢«ä½¿ç”¨çš„é˜¶çº§åå­—(hierarchical name)ï¼Œä½†æ˜¯å®ƒéœ€è¦ä¸€ä¸ªåå­—è®©å¤–éƒ¨æ¥å£å¯ä»¥è®¿é—®å®ƒã€‚å› æ­¤å‡ºäºè¯¥ç›®çš„å°†ä¼šç»™ä»–ä»¬åˆ†é…åå­—ã€‚</p><p>æ‰€æœ‰æ²¡åå­—çš„ç”Ÿæˆå—å°†è¢«ç»™äºˆ<code>genblk&lt;n&gt;</code>åå­—,å…¶ä¸­<n>æ˜¯è¢«åˆ†é…åˆ°å®ƒåŒ…æ‹¬çš„ç”Ÿæˆç»“æ„çš„æ¬¡æ•°ã€‚ï¼ˆä»1å¼€å§‹è®¡æ•°ï¼‰ï¼›å¦‚æœæœ‰å†²çª,åœ¨<n>å‰é¢åŠ 0ç›´åˆ°ä¸å†²çªä¸ºæ­¢</n></n></p></blockquote><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs Verilog"><span class="hljs-keyword">module</span>  top;<br>   <span class="hljs-keyword">parameter</span>  genblk2 = <span class="hljs-number">0</span>;<br>   <span class="hljs-keyword">genvar</span>  i;<br>  <span class="hljs-comment">// The following generate block is implicitly named genblk1</span><br>   <span class="hljs-keyword">if</span>  (genblk2)  <span class="hljs-keyword">reg</span>  a;  <span class="hljs-comment">// top.genblk1.a</span><br>   <span class="hljs-keyword">else</span>                    <span class="hljs-keyword">reg</span>  b;  <span class="hljs-comment">// top.genblk1.b</span><br>  <span class="hljs-comment">// The following generate block is implicitly named genblk02</span><br>  <span class="hljs-comment">// as genblk2 is already a declared identifier</span><br>   <span class="hljs-keyword">if</span>  (genblk2)  <span class="hljs-keyword">reg</span>  a;  <span class="hljs-comment">// top.genblk02.a</span><br>   <span class="hljs-keyword">else</span>                    <span class="hljs-keyword">reg</span>  b;  <span class="hljs-comment">// top.genblk02.b</span><br>  <span class="hljs-comment">// The following generate block would have been named genblk3 </span><br>  <span class="hljs-comment">// but is explicitly named g1</span><br>   <span class="hljs-keyword">for</span>  (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1</span>; i = i + <span class="hljs-number">1</span>)  <span class="hljs-keyword">begin</span>  : g1    <span class="hljs-comment">// block name</span><br>    <span class="hljs-comment">// The following generate block is implicitly named genblk1 </span><br>    <span class="hljs-comment">// as the first nested scope inside of g1</span><br>     <span class="hljs-keyword">if</span>  (<span class="hljs-number">1</span>)      <span class="hljs-keyword">reg</span>  a;  <span class="hljs-comment">// top.g1[0].genblk1.a</span><br>   <span class="hljs-keyword">end</span><br>  <span class="hljs-comment">// The following generate block is implicitly named genblk4 since </span><br>  <span class="hljs-comment">// it belongs to the fourth generate construct in scope "top". </span><br>  <span class="hljs-comment">// The previous generate block would have been </span><br>  <span class="hljs-comment">// named genblk3 if it had not been explicitly named g1</span><br>   <span class="hljs-keyword">for</span>  (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1</span>; i = i + <span class="hljs-number">1</span>)<br>    <span class="hljs-comment">// The following generate block is implicitly named genblk1 </span><br>    <span class="hljs-comment">// as the first nested generate block in genblk4</span><br>     <span class="hljs-keyword">if</span>  (<span class="hljs-number">1</span>)      <span class="hljs-keyword">reg</span>  a;  <span class="hljs-comment">// top.genblk4[0].genblk1.a</span><br>  <br>  <span class="hljs-comment">// The following generate block is implicitly named genblk5</span><br>   <span class="hljs-keyword">if</span>  (<span class="hljs-number">1</span>)        <span class="hljs-keyword">reg</span>  a;  <span class="hljs-comment">// top.genblk5.a</span><br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></tbody></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Preface&quot;&gt;&lt;a href=&quot;#Preface&quot; class=&quot;headerlink&quot; title=&quot;Preface&quot;&gt;&lt;/a&gt;Preface&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Generate constructs are used to eithe</summary>
      
    
    
    
    <category term="Digital IC" scheme="https://www.beenli.cn/categories/Digital-IC/"/>
    
    <category term="verilog" scheme="https://www.beenli.cn/categories/Digital-IC/verilog/"/>
    
    
    <category term="specification" scheme="https://www.beenli.cn/tags/specification/"/>
    
  </entry>
  
  <entry>
    <title>jupyterlab environment</title>
    <link href="https://www.beenli.cn/posts/e121429a/"/>
    <id>https://www.beenli.cn/posts/e121429a/</id>
    <published>2020-10-21T12:44:31.000Z</published>
    <updated>2020-10-21T14:10:01.843Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>The blog is derived from the transition of <a href="https://jupyterlab.readthedocs.io/en/stable/index.html">JupyterLab document</a></p></blockquote><h1 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h1><blockquote><p>JupyterLab is the next-generation web-based user interface for Project Jupyter.</p><p>JupyterLab enables you to work with documents and activities such as <a href="https://jupyterlab.readthedocs.io/en/stable/user/notebook.html#notebook">Jupyter notebooks</a>, text editors, terminals, and custom components in a flexible, integrated, and extensible manner.</p><p>jupyterlabæ˜¯ä¸‹ä¸€ä»£åŸºäºwebçš„Jupyteré¡¹ç›®ç”¨æˆ·ç•Œé¢ï¼›å®ƒèƒ½è®©ä½ ä»¥çµæ´»ã€é›†æˆå’Œå¯æ‰©å±•çš„æ–¹å¼ä¸æ–‡æ¡£å’Œæ´»åŠ¨ä¸€èµ·å·¥ä½œï¼Œæ¯”å¦‚notebookï¼Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œç»ˆç«¯è¿˜æœ‰è‡ªå®šä¹‰ç»„ä»¶ã€‚</p></blockquote><h1 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1><ol><li><p>prerequisite</p><p>å®‰è£…notebook</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">conda install -c conda-forge notebook<br></code></pre></td></tr></tbody></table></figure></li><li><p>å®‰è£…jupyterlab</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">conda install -c conda-forge jupyterlab<br></code></pre></td></tr></tbody></table></figure><h1 id="Start"><a href="#Start" class="headerlink" title="Start"></a>Start</h1></li><li><p>åœ¨conda promptä¸­æ•²å¦‚ä¸‹å‘½ä»¤</p><figure class="highlight ebnf"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">jupyter lab</span><br></code></pre></td></tr></tbody></table></figure></li><li><p>jupyter labä¼šè‡ªåŠ¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€</p> <figure class="highlight elixir"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">http(s)<span class="hljs-symbol">://&lt;server</span><span class="hljs-symbol">:port&gt;/&lt;lab-location&gt;/lab</span><br></code></pre></td></tr></tbody></table></figure><p> å› ä¸ºJupyterLabæ˜¯<code>jupyter notebook</code>ä¸€ä¸ªæœåŠ¡å™¨æ‰©å±•ï¼Œæ‰€ä»¥ä½ ä¹Ÿèƒ½å¤Ÿé€šè¿‡è°ƒç”¨<code>jupyter notebook</code>å¹¶è®¿é—®/lab URLæ¥ç™»å½•JupyterLabã€‚</p></li><li><p>å¦‚æœğŸ‘†æœ‰é—®é¢˜,å¤šåŠæ˜¯kernelæœ‰é—®é¢˜;</p><p> é¦–å…ˆå°è¯•å»ºç«‹ä¸€ä¸ªå¹²å‡€çš„jupyterç¯å¢ƒ</p> <figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda create -n jlab-test --override-channels --strict-channel-priority -c conda-forge -c anaconda jupyterlab// åˆ›å»ºä¸€ä¸ªæ–°çš„ç¯å¢ƒ<br>conda activate jlab-test// åˆ‡æ¢åˆ°è¯¥ç¯å¢ƒ<br>jupyter lab   // å¯åŠ¨jupyterlab<br></code></pre></td></tr></tbody></table></figure></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;The blog is derived from the transition of &lt;a href=&quot;https://jupyterlab.readthedocs.io/en/stable/index.html&quot;&gt;JupyterLab docum</summary>
      
    
    
    
    <category term="Software" scheme="https://www.beenli.cn/categories/Software/"/>
    
    <category term="jupyter" scheme="https://www.beenli.cn/categories/Software/jupyter/"/>
    
    
    <category term="python" scheme="https://www.beenli.cn/tags/python/"/>
    
    <category term="toolkits" scheme="https://www.beenli.cn/tags/toolkits/"/>
    
  </entry>
  
  <entry>
    <title>Conda environment</title>
    <link href="https://www.beenli.cn/posts/ac51cf39/"/>
    <id>https://www.beenli.cn/posts/ac51cf39/</id>
    <published>2020-10-21T05:20:57.000Z</published>
    <updated>2020-12-20T13:56:31.303Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>The blog is derived from the transilation of conda document: <a href="https://docs.conda.io/projects/conda/en/latest/">https://docs.conda.io/projects/conda/en/latest/</a></p></blockquote><h1 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h1><blockquote><p><em>Package, dependency and environment management for any languageâ€”-Python, R, Ruby, Lua, Scala, Java, JavaScript, C/ C++, FORTRAN</em> </p><p>å¯¹python, Rç­‰è¯­è¨€å…¶åŒ…ï¼Œä¾èµ–å’Œç¯å¢ƒçš„ç®¡ç†</p></blockquote><h2 id="1ã€åŸºæœ¬åŠŸèƒ½"><a href="#1ã€åŸºæœ¬åŠŸèƒ½" class="headerlink" title="1ã€åŸºæœ¬åŠŸèƒ½"></a>1ã€åŸºæœ¬åŠŸèƒ½</h2><ul><li>Condaæ˜¯ä¸€ä¸ªå¼€æºåŒ…ç®¡ç†ç³»ç»Ÿå’Œç¯å¢ƒç®¡ç†ç³»ç»Ÿ,å¯ä»¥è¿è¡Œåœ¨Windows, MacOS, Linuxä¸Š.</li><li>Condaèƒ½å¤Ÿå¿«é€Ÿå®‰è£…,è¿è¡Œ,å‡çº§åŒ…å’ŒåŒ…çš„ä¾èµ–.</li><li>Condaèƒ½è½»æ˜“åœ°åœ¨æœ¬åœ°åˆ›å»º,ä¿å­˜å’Œåˆ‡æ¢ç¯å¢ƒ.</li><li>condaèµ·åˆæ˜¯ä¸º<code>Python</code>ç¨‹åºåˆ›å»º,ä½†å®ƒèƒ½æ‰“åŒ…å’Œå‘å¸ƒ(package and distribute)å…¶å®ƒè¯­è¨€çš„è½¯ä»¶.</li></ul><h2 id="2ã€åº”ç”¨åœºæ™¯"><a href="#2ã€åº”ç”¨åœºæ™¯" class="headerlink" title="2ã€åº”ç”¨åœºæ™¯"></a>2ã€åº”ç”¨åœºæ™¯</h2><ol><li>Condaä½œä¸ºåŒ…ç®¡ç†å™¨ï¼Œå¸®åŠ©ä½ æ‰¾åˆ°å¹¶å®‰è£…ä½ éœ€è¦çš„åŒ…ã€‚å¦‚æœæ‚¨éœ€è¦ä¸€ä¸ªéœ€è¦ä¸åŒç‰ˆæœ¬Pythonçš„åŒ…ï¼Œä½ ä¸éœ€è¦åˆ‡æ¢åˆ°å¦ä¸€ä¸ªç¯å¢ƒç®¡ç†å™¨ï¼Œå› ä¸ºcondaä¹Ÿæ˜¯ä¸€ä¸ªç¯å¢ƒç®¡ç†å™¨(environment manager)ã€‚åªéœ€è¦ä¸€äº›å‘½ä»¤ï¼Œä½ å°±èƒ½å»ºç«‹ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„ç¯å¢ƒå»è¿è¡Œä¸åŒç‰ˆæœ¬çš„pythonï¼ŒåŒæ—¶åœ¨æ­£å¸¸ç¯å¢ƒä¸­ç»§ç»­è¿è¡Œæ‚¨é€šå¸¸ç‰ˆæœ¬çš„Python</li><li>åœ¨condaé»˜è®¤çš„é…ç½®ä¸­ï¼Œcondaèƒ½å¤Ÿåœ¨repo.anaconda.comå®‰è£…å’Œç®¡ç†è¶…è¿‡7500ä¸ªåŒ…;è¿™äº›åŒ…è¢«AnacondaÂ®æ„å»ºã€è¯„å®¡å’Œç»´æŠ¤.</li><li>Condaå¯ä»¥ä¸Travis CIå’ŒAppVeyorç­‰æŒç»­é›†æˆç³»ç»Ÿç›¸ç»“åˆï¼Œä¸ºä»£ç æä¾›é¢‘ç¹çš„è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚</li></ol><h2 id="3ã€è·å–Conda"><a href="#3ã€è·å–Conda" class="headerlink" title="3ã€è·å–Conda"></a>3ã€è·å–Conda</h2><ol><li>é€šè¿‡ä¸‹è½½<a href="https://docs.conda.io/projects/conda/en/latest/glossary.html#anaconda-glossary">Anaconda</a>Â®, <a href="https://docs.conda.io/projects/conda/en/latest/glossary.html#miniconda-glossary">Miniconda</a>, and <a href="https://docs.continuum.io/anaconda-repository/">Anaconda Repository</a></li><li>é€šè¿‡<a href="https://www.anaconda.com/enterprise/">Anaconda Enterprise</a>(æ”¶è´¹)</li><li>Conda is also available on <a href="https://anaconda.org/conda-forge/conda">conda-forge</a>, a community channel</li><li>You may also get conda on <a href="https://pypi.org/">PyPI</a>, but that approach may not be as up to date.</li></ol><h2 id="4ã€Anaconda"><a href="#4ã€Anaconda" class="headerlink" title="4ã€Anaconda"></a>4ã€Anaconda</h2><blockquote><p>anaconda is a graphical user interface that lets you use conda in a web-like interface without having to enter manual commands</p><p>anacondaæœ‰å›¾å½¢ç•Œé¢ï¼Œå¯¹ç”¨æˆ·æ›´åŠ å‹å¥½,ä½†å†…æ ¸è¿˜æ˜¯conda</p></blockquote><h1 id="Getting-stated"><a href="#Getting-stated" class="headerlink" title="Getting stated"></a>Getting stated</h1><h2 id="1ã€æ‰“å¼€å‘½ä»¤è¡Œ"><a href="#1ã€æ‰“å¼€å‘½ä»¤è¡Œ" class="headerlink" title="1ã€æ‰“å¼€å‘½ä»¤è¡Œ"></a>1ã€æ‰“å¼€å‘½ä»¤è¡Œ</h2><p>å¦‚æœæ˜¯Windows,æœ€å¥½ç”¨<code>anaconda prompt</code>,è²Œä¼¼cmdä¹Ÿå¯;Linuxå°±ç›´æ¥åœ¨terminalè¾“å‘½ä»¤å³å¯.</p><ol><li><p>å¦‚æœä¸æ˜¯æœ€æ–°çš„ï¼Œå»ºè®®æ›´æ–°åˆ°æœ€æ–°</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">conda --veriosn<br>4.9.0<br>conda updata conda<br></code></pre></td></tr></tbody></table></figure><p>å¦‚æœğŸ‘†ä¸èµ·ä½œç”¨ï¼šå‡ºç°äº†RemoveError ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">conda update --force-reinstall conda(é‡æ–°å®‰è£…)<br></code></pre></td></tr></tbody></table></figure><h2 id="2ã€åˆ›å»ºä¸€ä¸ªç¯å¢ƒ"><a href="#2ã€åˆ›å»ºä¸€ä¸ªç¯å¢ƒ" class="headerlink" title="2ã€åˆ›å»ºä¸€ä¸ªç¯å¢ƒ"></a>2ã€åˆ›å»ºä¸€ä¸ªç¯å¢ƒ</h2><blockquote><p>Condaå…è®¸æ‚¨åˆ›å»ºåŒ…å«æ–‡ä»¶ã€åŒ…åŠå…¶ä¸ä¸å…¶ä»–ç¯å¢ƒäº¤äº’çš„ä¾èµ–é¡¹çš„ç‹¬ç«‹ç¯å¢ƒã€‚</p><p>å½“ä½ å¼€å§‹ä½¿ç”¨condaï¼Œå°±å·²ç»æœ‰ä¸€ä¸ªé»˜è®¤çš„ç¯å¢ƒ<code>base</code>;ä½†æ˜¯,æ‚¨ä¸å¸Œæœ›å°†ç¨‹åºæ”¾åˆ°åŸºæœ¬ç¯å¢ƒä¸­ã€‚åˆ›å»ºå•ç‹¬çš„ç¯å¢ƒï¼Œä½¿æ‚¨çš„ç¨‹åºå½¼æ­¤éš”ç¦»ã€‚</p></blockquote><ul><li><p>åˆ›å»ºä¸€ä¸ªæ–°çš„ç¯å¢ƒ,å¹¶åœ¨å…¶ä¸­å®‰è£…ä¸€ä¸ªåŒ….</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">conda create --name snowflakes numpy<br></code></pre></td></tr></tbody></table></figure><p>condaéšåä¼šæ£€æŸ¥æ˜¯å¦æœ‰é¢å¤–çš„åŒ…(â€œdependenciesâ€)æ˜¯<code>numpy</code>æ‰€éœ€,å¹¶é—®ä½ æ˜¯å¦è¦ç»§ç»­:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Proceed ([y]/n)? y<br></code></pre></td></tr></tbody></table></figure><p>è¾“å…¥â€yâ€å¹¶æŒ‰Enterç»§ç»­.</p><p><img src="https://image.beenli.cn/img/20201021/LizlMfu7T998.png?imageslim" alt="mark"></p></li><li><p>åˆ‡æ¢åˆ°åˆšåˆšåˆ›å»ºçš„ç¯å¢ƒ</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">conda info --envs [-e]  // æŸ¥çœ‹å·²æœ‰çš„ç¯å¢ƒåˆ—è¡¨(å¸¦*è¡¨ç¤ºå½“å‰ç¯å¢ƒ)<br><span class="hljs-comment"># conda environments:</span><br><span class="hljs-comment">#</span><br>base                     D:\APP\miniconda<br>py38                     D:\APP\miniconda\envs\py38<br>snowflakes            *  D:\APP\miniconda\envs\snowflakes<br></code></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">conda activate snowflakes  // åˆ‡æ¢åˆ°ç¯å¢ƒsnowflakes<br></code></pre></td></tr></tbody></table></figure></li></ul></li></ol><ul><li><p>ä¿®æ”¹åˆšåˆšåˆ›å»ºçš„ç¯å¢ƒçš„åå­—</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">conda create -n new_name --<span class="hljs-built_in">clone</span> old_name<br>conda remove -n old_name --all<br></code></pre></td></tr></tbody></table></figure></li></ul><h2 id="3ã€ç®¡ç†åŒ…"><a href="#3ã€ç®¡ç†åŒ…" class="headerlink" title="3ã€ç®¡ç†åŒ…"></a>3ã€ç®¡ç†åŒ…</h2><blockquote><p>åœ¨è¿™éƒ¨åˆ†ï¼Œä½ å°†å­¦ä¼šæ£€æŸ¥ä½ å®‰è£…äº†å“ªäº›åŒ…, æ£€æŸ¥å“ªäº›åŒ…æ˜¯å¯ä»¥å¾—åˆ°çš„ï¼Œå¹¶æŸ¥æ‰¾ä¸€ä¸ªç‰¹å®šçš„åŒ…å¹¶å®‰è£…å®ƒã€‚</p></blockquote><ul><li><p>æ¿€æ´»ä¸€ä¸ªç¯å¢ƒ</p></li><li><p>æ£€æŸ¥ä½ æ²¡æœ‰å®‰è£…çš„â€beautifulsoup4â€æ˜¯å¦åœ¨Anaconda repositoryä¸­å­˜åœ¨.(ä½ å¿…é¡»è”ç½‘)</p><figure class="highlight apache"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">conda</span> search beautifulsoup<span class="hljs-number">4</span><br></code></pre></td></tr></tbody></table></figure><p>condaä¼šåˆ—å‡ºåŒ…å«é‚£ä¸ªåŒ…åçš„æ‰€æœ‰åŒ…,è¿™æ ·ä½ å°±çŸ¥é“å®ƒä»¬æ˜¯å¯ä»¥å¾—åˆ°çš„ã€‚</p></li><li><p>å®‰è£…æ­¤åŒ…åˆ°å½“å‰ç¯å¢ƒä¸­</p><figure class="highlight apache"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">conda</span> install beautifulsoup<span class="hljs-number">4</span>=<span class="hljs-number">4</span>.<span class="hljs-number">9</span>.<span class="hljs-number">1</span><br></code></pre></td></tr></tbody></table></figure></li><li><p>æ£€æŸ¥æ–°å®‰è£…çš„ç¨‹åºæ˜¯å¦åœ¨è¿™ä¸ªç¯å¢ƒä¸­:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">conda list<br></code></pre></td></tr></tbody></table></figure><p><img src="https://image.beenli.cn/img/20201021/4T9f3Ow0M7ug.png?imageslim" alt="mark"></p></li></ul><hr><blockquote><p>å…³äºä½¿ç”¨condaçš„æœ€é‡è¦ä¿¡æ¯çš„å•é¡µæ‘˜è¦ã€‚</p><p><a href="https://docs.conda.io/projects/conda/en/latest/_downloads/843d9e0198f2a193a3484886fa28163c/conda-cheatsheet.pdf">conda cheat sheet</a> PDF (1 MB) </p></blockquote><h1 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1><blockquote><p>æœ€å¿«çš„å®‰è£…æ–¹æ³•æ˜¯:å®‰è£…<a href="https://docs.conda.io/projects/conda/en/latest/glossary.html#miniconda-glossary">Miniconda</a>(400MB)</p><ul><li><p>å®ƒæ˜¯å…è´¹çš„condaæœ€å°å®‰è£…åŒ…</p></li><li><p>ä»…ä»…åŒ…å«<code>conda</code>ï¼Œ<code>Python</code>ï¼Œ<code>packages they depend on</code>ï¼Œè¿˜æœ‰ä¸€äº›éå¸¸æœ‰ç”¨çš„åŒ…(åŒ…æ‹¬pip, zlibç­‰ç­‰).</p></li><li><p>éœ€è¦ä½¿ç”¨<code>conda install</code>å‘½ä»¤ä»Anaconda repositoryå®‰è£…é¢å¤–çš„7500+åŒ…(anacondaç›´æ¥å®‰è£…å¥½)</p></li><li><p>Minicondaæ˜¯ä¸€ä¸ªPythonå‘è¡Œç‰ˆï¼Œå®ƒå¯ä»¥ä½¿å®‰è£…Pythonå˜å¾—åˆå¿«åˆå®¹æ˜“ï¼Œç”šè‡³å¯¹æ–°ç”¨æˆ·ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p><img src="https://image.beenli.cn/img/20201021/NLArkcWLrsJE.png?imageslim" alt="mark"></p></li></ul></blockquote><p><font color="red">noteï¼š</font>ä½ æ²¡æœ‰å¿…è¦ä¸ºäº†ä½¿ç”¨condaå»å¸è½½æ‰ä½ ç³»ç»Ÿä¸­åŸå…ˆçš„pythonå’Œç›¸åº”çš„åŒ….</p><p>æˆ‘ä»¬åªéœ€è¦æ­£å¸¸å®‰è£…miniconda,å¹¶è®©å®‰è£…ç¨‹åºå°†conda installation of Pythonæ·»åŠ åˆ°PATHç¯å¢ƒå˜é‡ä¸­.æ²¡æœ‰å¿…è¦è®¾ç½®<code>PYTHONPATH</code>ç¯å¢ƒå˜é‡ã€‚</p><blockquote><ul><li><p>for windos:</p><p>å®‰è£…åŒ…ä¸‹è½½åœ°å€:<a href="https://docs.conda.io/en/latest/miniconda.html#windows-installers">https://docs.conda.io/en/latest/miniconda.html#windows-installers</a></p></li><li><p>for linux</p><ul><li>ä½¿ç”¨è„šæœ¬</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh  // è·å–å®‰è£…è„šæœ¬<br><span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;sha-hash&gt; *filename"</span> | shasum -a 256 -c     // æ£€æµ‹æ–‡ä»¶å®Œæ•´æ€§<br><span class="hljs-built_in">echo</span> <span class="hljs-string">"879457af6a0bf5b34b48c12de31d4df0ee2f06a8e68768e5758c3293b2daf688 *Miniconda3-latest-Linux-x86_64.sh"</span> | sha256sum -c<br>Miniconda3-latest-Linux-x86_64.sh: OK              // å®Œæ•´æ€§æ­£å¸¸<br>bash Miniconda3-latest-Linux-x86_64.sh             // å®‰è£…è„šæœ¬<br></code></pre></td></tr></tbody></table></figure><ul><li><a href="https://docs.conda.io/projects/conda/en/latest/user-guide/install/rpm-debian.html">ä½¿ç”¨åŒ…ç®¡ç†å™¨(aptæˆ–è€…npm)</a></li></ul></li></ul></blockquote><h1 id="Managing-channels"><a href="#Managing-channels" class="headerlink" title="Managing channels"></a>Managing channels</h1><blockquote><p>Conda channels are the locations where packages are stored. They serve as the base for hosting and managing packages. Conda packages are downloaded from remote channels, which are URLs to directories containing conda packages. The conda command searches a default set of channels and packages are automatically downloaded and updated from <a href="https://repo.anaconda.com/pkgs/">https://repo.anaconda.com/pkgs/</a></p><p>Condaé€šé“æ˜¯å­˜æ”¾åŒ…çš„ä½ç½®ï¼›ä¸åŒçš„é€šé“å¯ä»¥æœ‰ç›¸åŒçš„åŒ…ï¼Œæ‰€ä»¥condaå¿…é¡»å¤„ç†è¿™äº›é€šé“å†²çªã€‚</p></blockquote><p>Condaåˆ—å‡ºä»æ‰€æœ‰é€šé“æ”¶é›†åˆ°çš„å…·æœ‰ç›¸åŒåç§°çš„åŒ…ï¼Œå¹¶æŒ‰ç…§å¦‚ä¸‹æ–¹å¼å¤„ç†å®ƒä»¬:</p><ul><li>æŒ‰é€šé“ä¼˜å…ˆçº§æ’åº</li><li>å†æŒ‰ç‰ˆæœ¬å·æ’åº;</li><li>å†æŒ‰æ„å»ºå·æ’åºï¼›</li><li>å®‰è£…æ’åºåˆ—è¡¨ä¸­æ»¡è¶³å®‰è£…è§„èŒƒçš„ç¬¬ä¸€ä¸ªåŒ…ã€‚</li><li>channelA::numpy-1.13_1 &gt; channelA::numpy-1.12.1_1 &gt; channelA::numpy-1.12.1_0 &gt; channelB::numpy-1.13_1(å¦‚æœæ‰“å¼€äº†ä¸¥æ ¼é€šé“æ’åºï¼Œé‚£ä¹ˆchannelBçš„åŒ…å°±ä¸ä¼šåœ¨æ­¤åˆ—è¡¨ä¸­)</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">conda config --prepend/add channels new_channel // ä¼˜å…ˆçº§æœ€é«˜<br>conda config --append channels new_channel      // ä¼˜å…ˆçº§æœ«å°¾<br>conda config --<span class="hljs-built_in">set</span> channel_priority <span class="hljs-literal">false</span>       // ä¼˜å…ˆçº§å…³é—­,é‚£ä¹ˆæ¯æ¬¡å®‰è£…æœ€æ–°ç‰ˆæœ¬<br>æˆ–è€…æŠŠ`channel_priority: <span class="hljs-literal">false</span>`æ·»åŠ åˆ°`.condarc`æ–‡ä»¶ä¸­<br></code></pre></td></tr></tbody></table></figure><p>æ·»åŠ æ¸…åçš„channel(å°†ä¸‹é¢ä»£ç å¤åˆ¶åˆ°.condarcæ–‡ä»¶ä¸­):</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">channels:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">defaults</span><br><span class="hljs-attr">show_channel_urls:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">channel_alias:</span> <span class="hljs-string">https://mirrors.tuna.tsinghua.edu.cn/anaconda</span>  <br><span class="hljs-attr">default_channels:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/pro</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2</span><br><span class="hljs-attr">custom_channels:</span><br>  <span class="hljs-attr">conda-forge:</span> <span class="hljs-string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br>  <span class="hljs-attr">msys2:</span> <span class="hljs-string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br>  <span class="hljs-attr">bioconda:</span> <span class="hljs-string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br>  <span class="hljs-attr">menpo:</span> <span class="hljs-string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br>  <span class="hljs-attr">pytorch:</span> <span class="hljs-string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br>  <span class="hljs-attr">simpleitk:</span> <span class="hljs-string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br></code></pre></td></tr></tbody></table></figure><ul><li><p>é»˜è®¤<code>channel_alias</code>ä¸º:<a href="https://repo.anaconda.com/pkgs/">https://repo.anaconda.com/pkgs/</a></p></li><li><p>é€šå¸¸,<code>default_channels</code>æŒ‡å‘repo.anaconda.comå­˜å‚¨åº“ä¸­çš„å‡ ä¸ªé€šé“ï¼Œä½†æ˜¯å¦‚æœå®šä¹‰äº†default_channelsï¼Œå®ƒå°†è®¾ç½®é»˜è®¤é€šé“çš„æ–°åˆ—è¡¨ã€‚è¿™å¯¹airgappedå’Œä¼ä¸šå®‰è£…éå¸¸æœ‰ç”¨ã€‚</p></li><li><p>ä¸ºäº†ç¡®ä¿æ‰€æœ‰çš„ç”¨æˆ·ä»å†…éƒ¨éƒ¨ç½²çš„ä»“åº“æ‹‰å–åŒ…ï¼Œç®¡ç†å‘˜å¯ä»¥è®¾ç½®ğŸ‘†ä¸¤ä¸ªå‚æ•°ã€‚</p></li><li><p><code>channel_alias</code>: åœ¨ä»¥åä½ æŒ‡å®šchannelä¸æ˜¯<code>url</code>æ—¶,ä¼šåŠ ä¸Šè¿™ä¸ªå‰ç¼€</p></li><li><p>å¦‚æœè¦ä¸‹è½½çš„åŒ…æ¸…åæºæ²¡æœ‰ï¼Œåœ¨anocondaçš„å­˜å‚¨åº“ä¸­ï¼Œå¯ä»¥åœ¨<code>custom_channel</code>åŠ ä¸Šç›¸åº”çš„é€šé“</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">  peterjc123: https:<span class="hljs-comment">//conda.anaconda.org</span><br>  <span class="hljs-comment">// ç®€å†™ä¸º</span><br>  conda install -c peterjc123 vc vs2017_runtime<br>  <span class="hljs-comment">// å¦åˆ™è¦å†™å…¨</span><br>  conda install --channel https:<span class="hljs-comment">//conda.anaconda.org/peterjc123 vc vs2017_runtime</span><br>  <span class="hljs-comment">// ä¹Ÿå¯ä»¥å†™æˆ</span><br>conda install -c defaults https:<span class="hljs-comment">//conda.anaconda.org/peterjc123 vc vs2017_runtime</span><br></code></pre></td></tr></tbody></table></figure><p><img src="https://image.beenli.cn/img/20201220/2MiTl9GzQdC4.jpg?imageslim" alt="mark"></p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;The blog is derived from the transilation of conda document: &lt;a href=&quot;https://docs.conda.io/projects/conda/en/latest/&quot;&gt;https</summary>
      
    
    
    
    <category term="Software" scheme="https://www.beenli.cn/categories/Software/"/>
    
    <category term="jupyter" scheme="https://www.beenli.cn/categories/Software/jupyter/"/>
    
    
    <category term="python" scheme="https://www.beenli.cn/tags/python/"/>
    
    <category term="toolkits" scheme="https://www.beenli.cn/tags/toolkits/"/>
    
  </entry>
  
  <entry>
    <title>AMBA AHB spec(2)--bus interface</title>
    <link href="https://www.beenli.cn/posts/d1f5324a/"/>
    <id>https://www.beenli.cn/posts/d1f5324a/</id>
    <published>2020-10-09T11:16:03.000Z</published>
    <updated>2020-10-09T11:28:44.625Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>The blog is derived from the translation of <code>ARM IHI 0011A</code> AHB specification   Copyright Â© 1999 ARM Limited</p><p>æ–‡æ¡£é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/19fG2h8Jw4k29AjWfRBliFw">https://pan.baidu.com/s/19fG2h8Jw4k29AjWfRBliFw</a> æå–ç ï¼šmmme </p></blockquote><h1 id="0-Convention"><a href="#0-Convention" class="headerlink" title="0 Convention"></a>0 Convention</h1><h2 id="0-1-timing-parameters"><a href="#0-1-timing-parameters" class="headerlink" title="0.1 timing parameters"></a>0.1 timing parameters</h2><blockquote><p>generic timing parameters that are required to analyze an AMBA design</p><p>â€¢ <strong>Tis</strong> - input setup time</p><p>â€¢ <strong>Tih</strong> - input hold time</p><p>â€¢ <strong>Tov</strong> - output valid time</p><p>â€¢ <strong>Toh</strong> - output hold time.</p></blockquote><h2 id="0-2-timing-diagrams"><a href="#0-2-timing-diagrams" class="headerlink" title="0.2 timing diagrams"></a>0.2 timing diagrams</h2><p><img src="https://image.beenli.cn/img/20201009/TFbsAcJR31hk.png?imageslim" alt="mark"></p><blockquote><font color="blue">Notesï¼š</font><ul><li>æ€»çº¿å’Œä¿¡å·ä¸­çš„é˜´å½±åŒºåŸŸæ˜¯æœªå®šä¹‰çš„ï¼Œæ‰€ä»¥å¯ä»¥å‡å®šä»–ä»¬åœ¨è¿™ä¸ªåŒºåŸŸçš„å€¼æ˜¯ä»»æ„çš„ã€‚å®ƒä»¬å®é™…çš„å€¼ä¸é‡è¦ï¼Œä¸å½±å“æ­£å¸¸çš„æ“ä½œã€‚</li><li>å•æ¯”ç‰¹ä¿¡å·æœ‰æ—¶åœ¨åŒä¸€æ—¶åˆ»è¢«æ˜¾ç¤ºä¸º<code>HIGH</code>å’Œ<code>LOW</code>ï¼Œå®ƒä»¬å’Œ<code>æ€»çº¿å˜åŒ–</code>(ğŸ‘†Bus change)ç›¸ä¼¼ã€‚å¦‚æœå•æ¯”ç‰¹ä¿¡å·åƒè¿™æ ·æ˜¾ç¤ºï¼Œæ„å‘³ç€å®ƒçš„å€¼ä¸å½±å“é™„å¸¦çš„æè¿°(accompanying description)</li></ul></blockquote><h1 id="1-Slave"><a href="#1-Slave" class="headerlink" title="1 Slave"></a>1 Slave</h1><blockquote><p>slaveå¯¹ç³»ç»Ÿå†…masterå‘èµ·çš„ä¼ è¾“åšå‡ºå“åº”ã€‚slaveä½¿ç”¨è§£ç å™¨ä¼ æ¥çš„<code>HSELx</code>ä¿¡å·æ¥å†³å®šåˆé€‚å¯¹ä¼ è¾“åšå‡ºå“åº”ã€‚æ‰€æœ‰å…¶å®ƒè¢«ä¼ è¾“éœ€è¦çš„ä¿¡å·ï¼Œä¾‹å¦‚åœ°å€å’Œæ§åˆ¶ä¿¡å·ï¼Œéƒ½æœ‰masteräº§ç”Ÿã€‚</p></blockquote><h2 id="17-1-Interface-diagram"><a href="#17-1-Interface-diagram" class="headerlink" title="17.1 Interface diagram"></a>17.1 Interface diagram</h2><p><img src="https://image.beenli.cn/img/20201008/qyvxmE48Sr2g.png?imageslim" alt="mark"></p><h2 id="17-2-Timing-diagrams"><a href="#17-2-Timing-diagrams" class="headerlink" title="17.2 Timing diagrams"></a>17.2 Timing diagrams</h2><h3 id="17-2-1-Reset"><a href="#17-2-1-Reset" class="headerlink" title="17.2.1 Reset"></a>17.2.1 Reset</h3><p><img src="https://image.beenli.cn/img/20201009/EA3CJd2Uw70d.png?imageslim" alt="mark"></p><ul><li><p><strong>Tihrst</strong>ï¼šresetè¾“å…¥ä¿¡å·ä¿æŒæ—¶é—´[åœ¨æ—¶é’Ÿè¾¹æ²¿åè¿˜å¾—ä¿æŒä¸€æ®µæ—¶é—´ä¿è¯è¢«é‡‡æ ·åˆ°] (ih=input hold time; rst=HRESETn)</p></li><li><p><strong>Tisrst</strong>ï¼šresetè¾“å…¥ä¿¡å·å»ºç«‹æ—¶é—´[åœ¨æ—¶é’Ÿè¾¹æ²¿ä¹‹å‰ç»´æŒvalidä¸€æ®µå¿…è¦çš„æ—¶é—´ï¼Œè®©ä¸»è§¦å‘å™¨èƒ½å¤Ÿé‡‡æ ·åˆ°âœ”çš„å€¼]</p></li></ul><h3 id="17-2-2-Normal-signals"><a href="#17-2-2-Normal-signals" class="headerlink" title="17.2.2 Normal signals"></a>17.2.2 Normal signals</h3><hr><p>  <img src="https://image.beenli.cn/img/20201009/U6kJ4KxjPY3w.png?imageslim" alt="mark"></p><ul><li><strong>Tovrdy</strong>ï¼šè¾“å‡ºä¿¡å·HREADYçš„æœ‰æ•ˆæ—¶é—´</li></ul><h3 id="17-2-3-Additional-signals"><a href="#17-2-3-Additional-signals" class="headerlink" title="17.2.3 Additional signals"></a>17.2.3 Additional signals</h3><p><img src="https://image.beenli.cn/img/20201009/sIpc22HODUqP.png?imageslim" alt="mark"></p><h1 id="2-Master"><a href="#2-Master" class="headerlink" title="2 Master"></a>2 Master</h1><blockquote><p>åœ¨AMBAç³»ç»Ÿä¸­ï¼Œmasteræœ‰æœ€å¤æ‚çš„æ€»çº¿æ¥å£ã€‚é€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªAMBAç³»ç»Ÿè®¾è®¡è€…ä¼šä½¿ç”¨é¢„å…ˆè®¾è®¡å¥½çš„master(å¯èƒ½æ˜¯å¤„ç†å™¨æ ¸ï¼Œåå¤„ç†å™¨ç­‰)ï¼Œå› æ­¤æ²¡å¿…è¦æ‹…å¿ƒmasteræ¥å£çš„ç»†èŠ‚ã€‚</p></blockquote><h2 id="2-1-Interface-diagram"><a href="#2-1-Interface-diagram" class="headerlink" title="2.1 Interface diagram"></a>2.1 Interface diagram</h2><p><img src="https://image.beenli.cn/img/20201009/HtNGaKLwi8H5.png?imageslim" alt="mark"></p><h1 id="3-Arbiter"><a href="#3-Arbiter" class="headerlink" title="3 Arbiter"></a>3 Arbiter</h1><blockquote><p>åœ¨AMBAç³»ç»Ÿä¸­ä»²è£å™¨çš„è§’è‰²ï¼šæ§åˆ¶å“ªä¸ªmasteræœ‰æƒè®¿é—®æ€»çº¿ã€‚æ¯ä¸ªmasteræœ‰ä¸€ä¸ªé€šå‘ä»²è£å™¨çš„<code>REQUESET/GRANT</code>æ¥å£ï¼Œä»²è£å™¨ä½¿ç”¨ä¸€ä¸ªä¼˜å…ˆçº§ç­–ç•¥å†³å®šå½“å‰è¯·æ±‚æ€»çº¿çš„æ‰€æœ‰masterä¸­å“ªä¸ªä¼˜å…ˆçº§æœ€é«˜ã€‚</p><p>æ¯ä¸ªmasterä¹Ÿä¼šäº§ç”Ÿä¸€ä¸ª<code>HLOCKx</code>ä¿¡å·ï¼Œç”¨æ¥å‘masteræŒ‡ç¤ºæˆ‘éœ€è¦å¯¹æ€»çº¿ç‹¬å è®¿é—®ã€‚(exclusive access to the bus)</p><p>ä¼˜å…ˆçº§åˆ«ç­–ç•¥çš„ç»†èŠ‚æ²¡æœ‰è§„å®šï¼Œè€Œæ˜¯æ¯ä¸ªåº”ç”¨è‡ªå·±å†³å®šã€‚å¯¹äºä»²è£å™¨ä½¿ç”¨å…¶å®ƒçš„ä¿¡å·(ä¾‹å¦‚AMBAæˆ–non-AMBA)å»å½±å“æ­£åœ¨ä½¿ç”¨çš„ä¼˜å…ˆçº§ç­–ç•¥æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p></blockquote><h2 id="3-1-Interface-diagram"><a href="#3-1-Interface-diagram" class="headerlink" title="3.1 Interface diagram"></a>3.1 Interface diagram</h2><p><img src="https://image.beenli.cn/img/20201009/Le7fV3wAczDf.png?imageslim" alt="mark"></p><h1 id="4-Decoder"><a href="#4-Decoder" class="headerlink" title="4 Decoder"></a>4 Decoder</h1><blockquote><p>AMBAç³»ç»Ÿä¸­çš„<code>decoder</code>ç”¨äºå®Œæˆä¸€ä¸ªä¸­å¿ƒåŒ–åœ°å€è¯‘ç çš„åŠŸèƒ½ï¼Œé€šè¿‡ä½¿å®ƒä»¬ç‹¬ç«‹äºç³»ç»Ÿå†…å­˜æ˜ å°„(system memory map)æ¥æé«˜å¤–è®¾å¯ç§»æ¤æ€§ã€‚</p></blockquote><p><img src="https://image.beenli.cn/img/20201009/XynQ4f67E9KN.png?imageslim" alt="mark"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;The blog is derived from the translation of &lt;code&gt;ARM IHI 0011A&lt;/code&gt; AHB specification   Copyright Â© 1999 ARM Limited&lt;/p&gt;
</summary>
      
    
    
    
    <category term="RISC-V" scheme="https://www.beenli.cn/categories/RISC-V/"/>
    
    <category term="spec" scheme="https://www.beenli.cn/categories/RISC-V/spec/"/>
    
    
    <category term="specification" scheme="https://www.beenli.cn/tags/specification/"/>
    
  </entry>
  
  <entry>
    <title>AMBA AHB spec(1)--bus scheme</title>
    <link href="https://www.beenli.cn/posts/d26415ba/"/>
    <id>https://www.beenli.cn/posts/d26415ba/</id>
    <published>2020-10-09T10:25:09.000Z</published>
    <updated>2020-10-09T11:28:41.027Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>The blog is derived from the translation of <code>ARM IHI 0011A</code> AHB specification   Copyright Â© 1999 ARM Limited</p><p>æ–‡æ¡£é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/19fG2h8Jw4k29AjWfRBliFw">https://pan.baidu.com/s/19fG2h8Jw4k29AjWfRBliFw</a> æå–ç ï¼šmmme </p></blockquote><h1 id="0-Overall-framwork"><a href="#0-Overall-framwork" class="headerlink" title="0 Overall framwork"></a>0 Overall framwork</h1><p><img src="https://image.beenli.cn/img/20201009/UXpaBaxtcInK.jpg?imageslim" alt="mark"></p><h1 id="1-Bus-interconnection"><a href="#1-Bus-interconnection" class="headerlink" title="1 Bus interconnection"></a>1 Bus interconnection</h1><blockquote><p>AHBæ€»çº¿åè®®è¢«è®¾è®¡æˆå¸¦æœ‰ä¸€ä¸ªä¸­å¿ƒé€‰æ‹©å™¨(central multiplexor)çš„äº’è¿æ–¹æ¡ˆã€‚</p><ul><li>ä¸»è®¾å¤‡é©±åŠ¨åœ°å€å’Œæ§åˆ¶ä¿¡å·ï¼Œä¿¡å·æŒ‡ç¤ºå®ƒä»¬æƒ³è¦æ‰§è¡Œçš„ä¼ è¾“ã€‚</li><li>å¹¶ä¸”ä»²è£å™¨å†³å®šå“ªä¸ªä¸»è®¾å¤‡èƒ½å¤ŸæŠŠä»–ä»¬çš„ä¿¡å·è·¯ç”±ç»™æ‰€æœ‰çš„ä»è®¾å¤‡ï¼›</li><li>è¿˜éœ€è¦ä¸€ä¸ªä¸­å¿ƒè¯‘ç å™¨æ§åˆ¶è¯»æ•°æ®(read data)å’Œå›åº”ä¿¡å·(response signal)å¤šé€‰å™¨ï¼Œå®ƒä»æ¶‰åŠè¿™æ¬¡ä¼ è¾“çš„ä»è®¾å¤‡ä¸­é€‰æ‹©åˆé€‚çš„ä¿¡å·ã€‚</li></ul><p><img src="https://image.beenli.cn/img/20201009/fekjU3fX5vOK.jpg?imageslim" alt="mark"></p></blockquote><h1 id="2-Overview-of-operation"><a href="#2-Overview-of-operation" class="headerlink" title="2 Overview of operation"></a>2 Overview of operation</h1><blockquote><p>åœ¨ä¸€æ¬¡ä¼ è¾“å¼€å§‹(commence)ä¹‹å‰ï¼Œmasterå¿…é¡»è¢«æˆäºˆè®¿é—®æ€»çº¿(granted access to the bus)ã€‚è¿™ä¸ªè¿‡ç¨‹ç”±masterå‘ä»²è£å™¨å‘èµ·ä¸€ä¸ªè¯·æ±‚ä¿¡å·å¼€å§‹(assert a request signal)ã€‚ç„¶åä»²è£å™¨æŒ‡ç¤ºä½•æ—¶å°†æˆäºˆmasteræ€»çº¿ä½¿ç”¨æƒã€‚</p><p>å¾—åˆ°æˆäºˆçš„masteré€šè¿‡é©±åŠ¨åœ°å€å’Œæ§åˆ¶ä¿¡å·å¼€å§‹ä¸€æ¬¡AHB transferã€‚è¿™äº›ä¿¡å·æä¾›äº†å…³äº<code>åœ°å€</code>ï¼Œ<code>æ–¹å‘</code>ï¼Œ<code>ä¼ è¾“å®½åº¦</code>å’Œ<code>è¿™æ¬¡ä¼ è¾“æ˜¯å¦æ˜¯burstçš„ä¸€éƒ¨åˆ†çš„æŒ‡ç¤ºä¿¡å·(indiction)</code>ã€‚ä¸¤ç§ä¸åŒå½¢å¼çš„burst transferéƒ½è¢«å…è®¸ï¼š</p><ul><li>é€’å¢çš„çªå‘(incrementing burst)ï¼Œå®ƒä¸åŒ…è£…åœ¨åœ°å€è¾¹ç•Œ</li><li>åŒ…è£…çš„çªå‘(wrapping burst)ï¼ŒåŒ…è£¹åœ¨ç‰¹æ®Šçš„åœ°å€è¾¹ç•Œ</li></ul><p>å†™æ•°æ®æ€»çº¿æŠŠæ•°æ®ä»masteræ¬è¿åˆ°slaveï¼›ä½†è¯»æ•°æ®æ€»çº¿æŠŠæ•°æ®ä»Slaveæ¬è¿åˆ°masterã€‚</p><p>æ¯æ¬¡ä¼ è¾“éƒ½åŒ…æ‹¬å¦‚ä¸‹ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>ä¸€ä¸ªåœ°å€å’Œæ§åˆ¶å‘¨æœŸ(an address and control cycle)</li><li>ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å‘¨æœŸ(one or more cycle for the data)</li></ul></blockquote><p>ç”±äºåœ°å€ä¸èƒ½è¢«æ‰©å±•(extended)ï¼Œæ‰€æœ‰æ‰€æœ‰çš„ä»è®¾å¤‡å¿…é¡»åœ¨æ­¤æœŸé—´å–æ ·åœ°å€ã€‚ä½†æ˜¯æ•°æ®å¯ä»¥ç”¨<code>HREADY</code>ä¿¡å·æ‰©å±•ã€‚å½“è¯¥ä¿¡å·ä¸ºä½æ—¶å¯¼è‡´<code>ç­‰å¾…çŠ¶æ€</code>(wait states)è¢«å¡è¿›è¿™æ¬¡ä¼ è¾“é‡Œé¢ï¼›å› æ­¤å…è®¸slaveæœ‰é¢å¤–çš„æ—¶é—´å–æä¾›æˆ–è€…é‡‡æ ·æ•°æ®ã€‚</p><p>åœ¨ä¼ è¾“ä¸­ï¼Œslaveé€šè¿‡<code>response signal</code>ä¼ è¾¾çŠ¶æ€ä¿¡æ¯ï¼Œ<code>HRESP[1:0]</code>ï¼š</p><ul><li><strong>OkAY</strong>ï¼šæŒ‡ç¤ºä¼ è¾“è¿›å±•æ­£å¸¸ï¼Œå½“HREADYå˜é«˜æ—¶ï¼Œè¯¥ä¿¡å·æŒ‡ç¤ºä¼ è¾“æˆåŠŸå®Œæˆ(complete successfully)</li><li><strong>ERROR</strong>ï¼šæŒ‡ç¤ºä¼ è¾“âŒå‘ç”Ÿï¼Œä¼ è¾“å¤±è´¥</li><li><strong>RETRY and SPLIT</strong>ï¼šä¸¤è€…éƒ½è¡¨ç¤ºä¼ è¾“ä¸èƒ½ç«‹åˆ»å®Œæˆï¼Œä½†æ˜¯masteråº”è¯¥ç»§ç»­å°è¯•ä¼ è¾“ã€‚</li></ul><p><font color="blue">notes:</font>åœ¨æ­£å¸¸æ“ä½œä¸­ï¼Œå…è®¸masteråœ¨ä»²è£å™¨æˆäºˆå…¶å®ƒmasterè®¿é—®æ€»çº¿å‰å®Œæˆä¸€æ¬¡burstçš„æ‰€æœ‰ä¼ è¾“ã€‚ä½†æ˜¯ï¼Œä¸ºäº†é¿å…è¿‡å¤šçš„(excessive)ä»²è£å»¶è¿Ÿï¼Œæœ‰å¯èƒ½ä»²è£å™¨ä¼šæ‰“æ–­ä¸€æ¬¡burstï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œmasterå¿…é¡»é‡æ–°å‘ä»²è£å™¨ç”³è¯·æ€»çº¿ä»¥å®Œæˆburstä¸­å‰©ä½™çš„ä¼ è¾“ã€‚</p><h1 id="3-Basic-transfer"><a href="#3-Basic-transfer" class="headerlink" title="3 Basic transfer"></a>3 Basic transfer</h1><h2 id="3-1-simple-without-wait"><a href="#3-1-simple-without-wait" class="headerlink" title="3.1 simple without wait"></a>3.1 simple without wait</h2><blockquote><p>ä¸€æ¬¡AHBä¼ è¾“åŒ…å«ä¸¤ä¸ªä¸åŒçš„éƒ¨åˆ†(two distinct sections)ï¼š</p><ul><li>The address phase, which lasts only a single cycle</li><li>The data phase, which may require several cycles. This is achieved using the HREADY signal.</li></ul><p><img src="https://image.beenli.cn/img/20201009/ilQdeYFuyKhz.jpg?imageslim" alt="mark"></p><center><strong>ğŸ‘†æ²¡æœ‰ç­‰å¾…çŠ¶æ€çš„ç®€å•ä¼ è¾“</strong></center><ul><li>masteråœ¨<code>HCLK</code>ä¸Šå‡æ²¿æŠŠåœ°å€å’Œæ§åˆ¶ä¿¡å·é©±åŠ¨åˆ°busä¸Š</li><li>slaveåœ¨ä¸‹ä¸€ä¸ªä¸Šå‡æ²¿é‡‡æ ·åœ°å€å’Œæ§åˆ¶ä¿¡å·</li><li>åœ¨slaveé‡‡æ ·å®Œæˆä¹‹åï¼Œå®ƒå¼€å§‹é©±åŠ¨åˆé€‚çš„å›åº”ä¿¡å·ï¼Œç„¶åresponseè¢«masteråœ¨ä¸‰ä¸ªä¸Šå‡æ²¿é‡‡æ ·ã€‚</li></ul></blockquote><hr><p><font color="blue">notes:</font> äº‹å®ä¸Šï¼Œä»»ä½•ä¼ è¾“çš„åœ°å€ç›¸ä¸å‰ä¸€ä¸ªä¼ è¾“çš„æ•°æ®ç›¸å‘ç”Ÿåœ¨åŒä¸€æ—¶æœŸã€‚æ­£æ˜¯å› ä¸ºè¿™ç§é‡å ï¼Œå®ƒä»¬æ„æˆäº†æ€»çº¿æµæ°´ç‰¹æ€§ï¼Œä¸ºé«˜æ€§èƒ½æ“ä½œæä¾›å¥‘æœºï¼ŒåŒæ—¶ä¸ºslaveå¯¹æ¥æ”¶çš„æ•°æ®åšå‡ºååº”æä¾›äº†è¶³å¤Ÿçš„æ—¶é—´ã€‚</p><h2 id="3-2-simple-with-wait"><a href="#3-2-simple-with-wait" class="headerlink" title="3.2 simple with wait"></a>3.2 <a name="extend">simple with wait</a></h2><p><img src="https://image.beenli.cn/img/20201009/LaEzji7jaCvB.jpg?imageslim" alt="mark"></p><p><font color="gree">notes:</font> â… ã€å¯¹äºå†™æ“ä½œï¼Œmasteréœ€è¦åœ¨æ‰©å±•å‘¨æœŸä¸€ç›´ä¿æŒç¨³å®šçš„æ•°æ®ï¼›â…¡ã€å¯¹äºè¯»æ“ä½œï¼Œslaveä¸éœ€è¦ä¸€ç›´æä¾›æœ‰æ•ˆæ•°æ®ï¼Œç›´åˆ°ä¼ è¾“å°†è¦å®Œæˆã€‚</p><h2 id="3-3-multiple-transfers"><a href="#3-3-multiple-transfers" class="headerlink" title="3.3 multiple transfers"></a>3.3 multiple transfers</h2><center><strong>æ‰©å±•å¯¹ä¸‹æ¬¡ä¼ è¾“çš„åœ°å€ç›¸çš„side-effect</strong></center><p><img src="https://image.beenli.cn/img/20201009/vaC3e2oTfz4L.jpg?imageslim" alt="mark"></p><ul><li>åœ°å€Aå’Œåœ°å€Cçš„ä¼ è¾“æ²¡æœ‰ç­‰å¾…çŠ¶æ€</li><li>åœ°å€Bçš„ä¼ è¾“æœ‰ä¸€ä¸ªç­‰å¾…çŠ¶æ€</li><li>åœ°å€Bä¼ è¾“ä¸­çš„æ•°æ®phaseæ‰©å±•å¯¹åœ°å€Cä¼ è¾“çš„åœ°å€phaseæ‰©å±•æœ‰å½±å“ã€‚</li></ul><h1 id="4-Transfer-type"><a href="#4-Transfer-type" class="headerlink" title="4 Transfer type"></a>4 Transfer type</h1><blockquote><p>æ¯ä¸€ç§ä¼ è¾“éƒ½å¯ä»¥è¢«å½’ç±»ä¸ºä»¥ä¸‹å››ç§ä¸­çš„ä¸€ç§ï¼Œç”¨<code>HTRANS[1:0]</code>ä¿¡å·æŒ‡ç¤º</p></blockquote><div class="table-container"><table><thead><tr><th>HTRANS[1:0]</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>00</td><td>IDLE</td><td>â‘ æ²¡æœ‰æ•°æ®ä¼ è¾“è¯·æ±‚ã€‚IDLEç”¨åœ¨masterè·å¾—æˆæƒï¼Œä½†ä¸æƒ³å¼€å§‹æ•°æ®ä¼ è¾“æ—¶ã€‚â‘¡slaveå¿…é¡»æ€»æ˜¯å¯¹è¿™ç§ä¼ è¾“æä¾›ä¸€ä¸ªæ²¡æœ‰ç­‰å¾…çŠ¶æ€çš„<code>OKAY</code>å“åº”ï¼Œå¹¶ä¸”è¯¥ä¼ è¾“åº”è¯¥è¢«slaveå¿½ç•¥æ‰</td></tr><tr><td>01</td><td>BUSY</td><td>â‘ è¯¥çŠ¶æ€å…è®¸masteråœ¨burstä¸­é—´æ’å…¥<code>IDLE</code>å‘¨æœŸï¼›è¯¥çŠ¶æ€è¡¨æ˜masteræ­£åœ¨ç»§ç»­ä¸€æ¬¡burstï¼›ä½†æ˜¯ä¸‹ä¸€ä¸ªä¼ è¾“ä¸èƒ½ç«‹å³å‘ç”Ÿã€‚â­å½“masterä½¿ç”¨è¯¥ç±»å‹æ—¶ï¼Œåœ°å€å’Œæ§åˆ¶ä¿¡å·ä¸€å®šååº”(reflect)burstçš„ä¸‹ä¸€æ¬¡ä¼ è¾“ã€‚â‘¡ä¼ è¾“åº”è¯¥è¢«slaveå¿½è§†ï¼Œslaveä¸€å®šæ€»æ˜¯æä¾›é›¶ç­‰å¾…çŠ¶æ€çš„<code>OKAY</code>å›åº”ï¼Œè·ŸIDLEåŒæ ·çš„æ–¹å¼</td></tr><tr><td>10</td><td>NONSEQ</td><td>â‘ æŒ‡ç¤ºburstçš„ç¬¬ä¸€æ¬¡ä¼ è¾“æˆ–è€…ä¸€ä¸ªå•æ¬¡ä¼ è¾“ï¼›åœ°å€å’Œæ§åˆ¶ä¿¡å·ä¸ä¸Šæ¬¡ä¼ è¾“æ²¡æœ‰å…³ç³»ã€‚â‘¡æ€»çº¿ä¸Šå•ä¸€ä¼ è¾“(single transfer)ä¸burstä¼ è¾“ä¸­çš„ç¬¬ä¸€ä¸ªä¼ è¾“åŒæ ·å¯¹å¾…ï¼Œå› æ­¤ä¼ è¾“ç±»å‹ä¸º<code>NONSEQUENTIAL</code></td></tr><tr><td>11</td><td>SEQ</td><td>â‘ busrtä¸­é™¤äº†ç¬¬ä¸€æ¬¡ä¼ è¾“å‰©ä½™çš„æ‰€æœ‰ä¼ è¾“éƒ½æ˜¯<code>SEQENTIAL</code>;å¹¶ä¸”åœ°å€ä¸ä¸Šæ¬¡ä¼ è¾“æœ‰å…³ã€‚æ§åˆ¶ä¿¡æ¯ä¸ä¸Šæ¬¡ä¼ è¾“ç›¸åŒï¼Œåœ°å€ä¿¡æ¯=ä¸Šæ¬¡åœ°å€ä¿¡æ¯+æ•°æ®å¤§å°(in byte)ã€‚â‘¡åœ¨wrappingä¸­ï¼Œ<a href="#boundry">åœ°å€åŒ…è£¹åœ¨åœ°å€è¾¹ç•Œ(warps at the address boundry)</a>ï¼Œåœ°å€è¾¹ç•Œ=beatsçš„æ•°é‡(4,8æˆ–è€…16)*<a href="#size">æ•°æ®å¤§å°(in byte)</a></td></tr></tbody></table></div><p><img src="https://image.beenli.cn/img/20201009/k5ITwMzdBWxc.jpg?imageslim" alt="mark"></p><h1 id="5-Burst-operation"><a href="#5-Burst-operation" class="headerlink" title="5 Burst operation"></a>5 Burst operation</h1><blockquote><p>4ï¼Œ8ï¼Œ16èŠ‚æ‹çš„burstsåœ¨AHBåè®®ä¸­æœ‰å®šä¹‰ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰æ²¡æœ‰å®šä¹‰é•¿åº¦çš„burstså’Œå•ä¸ªçš„ä¼ è¾“ï¼›é€’å¢å’ŒåŒ…è£¹çš„é˜µå‘ä¼ è¾“éƒ½è¢«æ”¯æŒï¼š</p><ul><li>é€’å¢çš„é˜µå‘è®¿é—®é¡ºåºçš„ä½ç½®ï¼Œçªå‘ä¸­çš„æ¯ä¸ªä¼ è¾“çš„åœ°å€åªæ˜¯å…ˆå‰åœ°å€çš„ä¸€ä¸ªå¢é‡ã€‚</li><li>å¯¹äºå°è£…é˜µå‘ï¼Œå¦‚æœä¼ è¾“çš„èµ·å§‹åœ°å€æ²¡æœ‰å¯¹é½é˜µå‘çš„æ€»å­—èŠ‚æ•°(size * beats)ï¼Œé‚£ä¹ˆä¼ è¾“åœ°å€å°†åŒ…è£¹å½“è¾¾åˆ°è¾¹ç•Œæ—¶(trap when the boundary is reached)ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª4-beatçš„åŒ…è£¹é˜µå‘ä»¥å­—(4-byte)è®¿é—®å°†å°è£…åœ¨16-byteçš„è¾¹ç•Œã€‚å› æ­¤å¦‚æœä¼ è¾“çš„èµ·å§‹åœ°å€ä¸ºOx34ï¼Œé‚£ä¹ˆå®ƒç”±å››æ¬¡ä¼ è¾“ç»„æˆï¼Œæ¯æ¬¡åœ°å€ä¸ºOx34, Ox38, Ox3C, Ox30</li></ul></blockquote><p align="right"><strong>Table 4-1 Burst signal encoding</strong></p><div class="table-container"><table><thead><tr><th>HBURS[2:0]</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>000</td><td>SINGLE</td><td>Single transfer</td></tr><tr><td>001</td><td>INCR</td><td>æ²¡æœ‰æŒ‡å®šé•¿åº¦çš„é€’å¢é˜µå‘</td></tr><tr><td>010</td><td>WRAP4</td><td>4-beat wrapping burst</td></tr><tr><td>011</td><td>INCR4</td><td>4-beat incrementing burst</td></tr><tr><td>100</td><td>WRAP8</td><td>8-beat wrapping burst</td></tr><tr><td>101</td><td>INCR8</td><td>8-beat incrementing burst</td></tr><tr><td>110</td><td>WRAP16</td><td>16-beat wrapping burst</td></tr><tr><td>111</td><td>INCR16</td><td>16-beat incrementing burst</td></tr></tbody></table></div><ul><li>é˜µå‘ä¸èƒ½è·¨è¶Š1KBçš„åœ°å€è¾¹ç•Œ(å³A[9:0]=0)ã€‚å› æ­¤å¯¹äºmasterä¸è¦å°è¯•å¼€å§‹ä¸€ä¸ªå›ºå®šé•¿åº¦é€’å¢é˜µå‘ï¼Œè®©è¿™ä¸ªç•Œé™è¢«è·¨è¶Šã€‚</li><li>ä½¿ç”¨æ²¡æœ‰æŒ‡å®šé•¿åº¦çš„é˜µå‘ï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ªé•¿åº¦ä¸º1çš„é˜µæ³•æ¥ä»£æ›¿single transfersã€‚</li><li>ä¸€ä¸ªé€’å¢é˜µå‘å¯ä»¥æ˜¯ä»»ä½•é•¿åº¦,ä½†æ˜¯ä¸Šé™è¢«1KBè®¾å®š</li></ul><p><font color="blue">notes:</font> â‘ é˜µå‘çš„å¤§å°æ˜¯æ¯ä¸ªé˜µå‘èŠ‚æ‹çš„æ•°é‡ï¼Œä¸æ˜¯ä¼ é€çš„å­—èŠ‚æ•°ã€‚ä¸€ä¸ªburstä¼ é€çš„æ€»çš„æ•°æ®é‡=èŠ‚æ‹æ•°*æ¯ä¸ªèŠ‚æ‹æ•°æ®é‡(HSIZE[2:0])â‘¡ï¼š<a name="boundary">åœ¨ä¸€æ¬¡burstä¸­çš„æ‰€æœ‰ä¼ è¾“å¿…é¡»å¯¹é½åœ°å€è¾¹ç•Œ</a>ï¼Œï¼ˆè¾¹ç•Œç­‰äºä¼ è¾“çš„å¤§å°)ï¼›ä¾‹å¦‚ï¼Œå­—ä¼ è¾“å¿…é¡»å¯¹é½å­—åœ°å€è¾¹ç•Œ(A[1:0]=00å­—åœ°å€çš„åœ°ä¸¤ä½ä¸º0ï¼›å³è¡¨ç¤ºåœ°å€æ˜¯4çš„å€æ•°)ï¼ŒåŠå­—ä¼ è¾“å¿…é¡»å¯¹é½åŠå­—åœ°å€è¾¹ç•Œ( A[0] = 0(åœ°å€çš„æœ€åä¸€ä½ä¸º0;å³è¡¨ç¤ºåœ°å€æ˜¯2çš„å€æ•°))ã€‚</p><h2 id="5-1-early-termination"><a href="#5-1-early-termination" class="headerlink" title="5.1 early termination"></a>5.1 early termination</h2><blockquote><p>æœ‰å¾ˆå¤šæƒ…å½¢ï¼Œé˜µå‘ä¸èƒ½å®Œæˆï¼›å› æ­¤å¯¹äºslaveçš„è®¾è®¡ä¸­ï¼Œå……åˆ†åˆ©ç”¨é˜µå‘ä¿¡æ¯åœ¨é˜µå‘æå‰ç»ˆæ­¢æ—¶é‡‡å–æ­£ç¡®çš„è¡ŒåŠ¨å¾ˆé‡è¦ã€‚slaveå¯ä»¥é€šè¿‡ç›‘è§†<code>HTRANS</code>ä¿¡å·ç¡®å®šé˜µå‘ä½•æ—¶æå‰ç»ˆæ­¢ï¼Œç¡®ä¿é˜µå‘å¼€å§‹åçš„æ¯ä¸€ä¸ªä¼ è¾“éƒ½è¢«è´´ä¸Š<code>SEQUENTIAL</code>æˆ–è€…<code>BUSY</code>æ ‡ç­¾ã€‚å¦‚æœå¸¦æœ‰<code>NONSEQUENTIAL</code>æˆ–è€…<code>IDLE</code>çš„ä¼ è¾“å‡ºç°ï¼Œé‚£è¡¨æ˜æ–°çš„é˜µå‘å¼€å§‹å¹¶ä¸”ä¹‹å‰çš„é˜µå‘ä¸€å®šè¢«ç»ˆæ­¢äº†ã€‚</p><p>å¦‚æœmasterä¸èƒ½å®Œæˆä¸€ä¸ªé˜µå‘ï¼Œå› ä¸ºå®ƒå¤±å»äº†æ€»çº¿æ‹¥æœ‰æƒï¼Œé‚£ä¹ˆå®ƒå¿…é¡»åœ¨å®ƒä¸‹æ¬¡è·å¾—æƒé™æ—¶åˆé€‚åœ°é‡æ–°å»ºç«‹é˜µå‘ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªmasterä»…ä»…å®Œæˆäº†4-beaté˜µå‘ä¸­çš„ä¸€ä¸ªbeatï¼Œé‚£ä¹ˆå®ƒä¸‹æ¬¡å¿…é¡»ä½¿ç”¨<code>undefined-length</code>é˜µå‘æ¥å®Œæˆå‰©ä½™çš„ä¸‰ä¸ªé˜µå‘ã€‚</p></blockquote><h2 id="5-2-4-beat"><a href="#5-2-4-beat" class="headerlink" title="5.2 4-beat"></a>5.2 4-beat</h2><p><img src="https://image.beenli.cn/img/20201009/qnnwUkLNDIRe.png?imageslim" alt="mark"></p><p><img src="https://image.beenli.cn/img/20201009/XCK6FrNsexKT.png?imageslim" alt="mark"></p><p><font color="red">notes:</font> å› ä¸ºæ˜¯ä¼ é€å¤§å°4-byteçš„4-beaté˜µå‘ï¼›â‘ for warpingï¼šåœ°å€è¦å°è£…åœ¨16-byteçš„è¾¹ç•Œå†…ï¼›å› æ­¤åœ°å€ä¸ºOx3Cçš„ä¼ è¾“åç´§è·Ÿçš„æ˜¯åœ°å€ä¸ºOx30çš„ä¼ è¾“ã€‚â‘¡ï¼šfor increment: å®ƒå¯ä»¥è·¨è¶Š16-byteè¾¹ç•Œã€‚</p><hr><h2 id="5-3-8-beat"><a href="#5-3-8-beat" class="headerlink" title="5.3 8-beat"></a>5.3 8-beat</h2><p><img src="https://image.beenli.cn/img/20201009/Gdcib8auNtiX.png?imageslim" alt="mark"></p><blockquote><p>å¯ä»¥çœ‹åˆ°åœ°å€è¾¹ç•Œä¸ºï¼š8*4=32ï¼›é‚£ä¹ˆæ•´ä¸ªåœ°å€ç©ºé—´è¢«åˆ†å‰²æˆå¾ˆå¤šåŒ…å«32ä¸ªå­—èŠ‚çš„å—ï¼›00-1F; 20-3F; 40-5Fâ€¦.ï¼›ç”±äºèµ·å§‹åœ°å€ä¸ºOX34â€”â€”&gt;è¢«å°è£…åœ¨<code>Ox20-3F</code>è¿™å—é‡Œé¢ï¼›</p></blockquote><p><img src="https://image.beenli.cn/img/20201009/IcKa2VOByjNm.png?imageslim" alt="mark"></p><hr><h2 id="5-4-xx-beat"><a href="#5-4-xx-beat" class="headerlink" title="5.4 xx-beat"></a>5.4 xx-beat</h2><center><strong>Undefined-length bursts</strong></center><p><img src="https://image.beenli.cn/img/20201009/pztUIO5T2M9B.png?imageslim" alt="mark"></p><ul><li>ä¸¤ä¸ªåŠå­—ä¼ è¾“ä»åœ°å€Ox20å¼€å§‹ï¼Œåœ°å€æ¯æ¬¡å¢åŠ 2</li><li>ä¸‰ä¸ªå­—ä¼ è¾“ä»åœ°å€Ox5Cå¼€å§‹ï¼Œåœ°å€ä¼ è¾“å¢åŠ 4</li></ul><h1 id="6-Control-signals"><a href="#6-Control-signals" class="headerlink" title="6 Control signals"></a>6 Control signals</h1><blockquote><p>å’Œä¼ è¾“ç±»å‹å’Œé˜µå‘ç±»å‹ä¸€æ ·ï¼Œæ¯æ¬¡ä¼ è¾“éƒ½æœ‰è®¸å¤šæ§åˆ¶ä¿¡å·ï¼Œè¿™äº›ä¿¡å·æä¾›äº†ä¼ è¾“çš„é¢å¤–ä¿¡æ¯ã€‚è¿™äº›æ§åˆ¶ä¿¡å·æœ‰ç€å’Œåœ°å€æ€»çº¿å®Œå…¨ç›¸åŒçš„æ—¶åºã€‚ä½†æ˜¯ï¼Œå®ƒä»¬å¿…é¡»åœ¨æ•´ä¸ªé˜µå‘æœŸé—´ä¿æŒæ’å®š.(remain constant)</p></blockquote><h2 id="6-1-Transfer-direction"><a href="#6-1-Transfer-direction" class="headerlink" title="6.1 Transfer direction"></a>6.1 Transfer direction</h2><blockquote><p>å½“<code>HWRITE</code>ä¸ºé«˜ï¼Œä¿¡å·æŒ‡ç¤ºä¸€ä¸ªå†™ä¼ é€ï¼Œå¹¶ä¸”masteråœ¨å†™æ•°æ®æ€»çº¿ä¸Šå¹¿æ’­æ•°æ®(<code>HWDATA[31:0]</code>)ã€‚å½“å…¶ä¸ºä½æ—¶ï¼Œä¸€ä¸ªè¯»ä¼ é€å°†æ‰§è¡Œï¼Œslaveå¿…é¡»åœ¨è¯»æ•°æ®æ€»çº¿ä¸Šç”Ÿæˆæ•°æ®(<code>HRDATA[31:0]</code>)ã€‚</p></blockquote><h2 id="6-2-Transfer-size"><a href="#6-2-Transfer-size" class="headerlink" title="6.2 Transfer size"></a>6.2 <a name="size">Transfer size</a></h2><p><code>Hsize[2:0]</code>æŒ‡ç¤ºä¼ é€çš„å¤§å°ã€‚</p><p><img src="https://image.beenli.cn/img/20201009/PIOE3teyQpGn.png?imageslim" alt="mark"></p><blockquote><p>è¿™ä¸ªå¤§å°(transfer size)ç”¨äºå’Œ<code>HBURST[2:0]</code>ä¿¡å·è”ç»“èµ·æ¥å†³å®šwrapping burstsçš„åœ°å€è¾¹ç•Œ</p></blockquote><h2 id="6-3-Protection-control"><a href="#6-3-Protection-control" class="headerlink" title="6.3 Protection control"></a>6.3 Protection control</h2><blockquote><p>æ§åˆ¶ä¿æŠ¤ä¿¡å·<code>HPROT[3:0]</code>ï¼Œæä¾›äº†å…³äºæ€»çº¿è®¿é—®çš„é¢å¤–ä¿¡æ¯ï¼Œä¸»è¦æ˜¯ä¸ºäº†æƒ³è¦å®ç°æŸç§ä¿æŠ¤çš„æ¨¡å—ä½¿ç”¨ã€‚</p><p>è¿™ä¸ªä¿¡å·æŒ‡ç¤ºè¿™æ¬¡ä¼ è¾“ä¸ºï¼š</p><ul><li>å–æ“ä½œç \ æ•°æ®è®¿é—®</li><li>ç‰¹æƒæ¨¡å¼è®¿é—®\ ç”¨æˆ·æ¨¡å¼è®¿é—®</li></ul><p>å¯¹äºå¸¦æœ‰å†…å­˜ç®¡ç†å•å…ƒçš„masterï¼Œè¿™äº›ä¿¡å·è¿˜å¯ä»¥æŒ‡ç¤ºå½“å‰çš„è®¿é—®æ˜¯å¦å¯ç¼“å­˜(cacheable or bufferable)</p></blockquote><p><img src="https://image.beenli.cn/img/20201009/lB70hNmFcAKN.png?imageslim" alt="mark"></p><p><font color="blue">notes:</font> å¹¶ä¸æ˜¯æ‰€æœ‰çš„masteréƒ½æœ‰èƒ½åŠ›ç”Ÿæˆæ­£ç¡®ä¿æŠ¤ä¿¡æ¯ï¼Œå› æ­¤æ¨èslaveä¸è¦ä½¿ç”¨<code>HPROT</code>ä¿¡å·çš„ä¿¡æ¯ï¼Œé™¤éä¸¥æ ¼éœ€è¦(strictly necessary)ã€‚</p><h1 id="7-Address-decodingâ“"><a href="#7-Address-decodingâ“" class="headerlink" title="7 Address decodingâ“"></a>7 Address decodingâ“</h1><blockquote><p>ä¸­å¿ƒåŒ–çš„åœ°å€è¯‘ç å™¨(central address decoder)ä¸ºæ€»çº¿ä¸Šæ¯ä¸€ä¸ªslaveæä¾›ä¸€ä¸ªé€‰æ‹©ä¿¡å·ï¼Œ<code>HSELx</code>ã€‚é€‰æ‹©ä¿¡å·æ˜¯é«˜é˜¶åœ°å€ä¿¡å·çš„ç»„åˆè¯‘ç ï¼Œç®€å•åœ°å€è¯‘ç æ–¹æ¡ˆé¼“åŠ±ä½¿ç”¨æ¥é¿å…å¤æ‚è¯‘ç é€»è¾‘ï¼Œå¹¶ä¸”å¯ä»¥ä¿è¯é«˜é€Ÿæ“ä½œã€‚</p><p>å½“<code>HREADY</code>ä¿¡å·ä¸ºé«˜æ—¶(æŒ‡ç¤ºå½“å‰ä¼ è¾“å®Œæˆ)ï¼Œslaveä¸€å®šä»…é‡‡æ ·åœ°å€ï¼Œæ§åˆ¶ä¿¡å·å’Œ<code>HSELx</code>ã€‚åœ¨ç‰¹ç‚¹æƒ…æ™¯ä¸‹ï¼Œ<code>HSELx</code>ä¿¡å·å¯èƒ½åœ¨<code>HREADY</code>ä¸ºä½çš„æ—¶è¢«å£°æ˜(å‘å‡º)ï¼Œä½†æ˜¯æ‰€é€‰slaveåœ¨å½“å‰ä¼ è¾“å®Œæˆæ—¶å°†ä¼šæ”¹å˜ã€‚</p><p>â“èƒ½å¤Ÿåˆ†é…ç»™å•ä¸ªslaveçš„æœ€å°åœ°å€ç©ºé—´ä¸º<code>1kB</code>ã€‚æ‰€æœ‰çš„masteréƒ½è¢«è®¾è®¡æˆä¸å…è®¸æ‰§è¡Œè·¨è¶Š1KBè¾¹ç•Œçš„é€’å¢ä¼ è¾“(incrementing transfers)ï¼Œå› æ­¤ç¡®ä¿burstæ°¸è¿œä¸ä¼šè¶Šè¿‡åœ°å€è¯‘ç è¾¹ç•Œã€‚</p><p>åœ¨ç³»ç»Ÿè®¾è®¡ä¸åŒ…å«ä¸€ä¸ªå®Œå…¨å¡«å……çš„å†…å­˜æ˜ å°„çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªé¢å¤–çš„é»˜è®¤slaveåº”è¢«å®ç°ï¼Œä»¥æä¾›ä¸€ä¸ªå“åº”æ—¶ï¼Œä»»ä½•ä¸å­˜åœ¨çš„åœ°å€ä½ç½®è¢«è®¿é—®ã€‚å¦‚æœ<code>NONSEQUENTIAL</code>æˆ–è€…<code>SEQUENTIAL</code>ä¼ è¾“å°è¯•ä¸€ä¸ªä¸å­˜åœ¨çš„åœ°å€ä½ç½®ï¼Œé‚£ä¹ˆé»˜è®¤çš„slaveåº”è¯¥æä¾›ä¸€ä¸ª<code>ERROR</code>å“åº”ã€‚<code>IDLE</code>æˆ–è€…<code>BUSY</code>ä¼ è¾“å°è¯•ä¸€ä¸ªä¸å­˜åœ¨çš„åœ°å€ä½ç½®æ—¶ï¼Œåº”è¯¥è¿”å›é›¶ç­‰å¾…çŠ¶æ€çš„<code>OKAY</code>å“åº”ã€‚é»˜è®¤slaveçš„åŠŸèƒ½é€šå¸¸ç”±decoderçš„ä¸€éƒ¨åˆ†å®Œæˆã€‚</p></blockquote><p><img src="https://image.beenli.cn/img/20201009/XInRU3i6fHtN.png?imageslim" alt="mark"></p><h1 id="8-Slave-response"><a href="#8-Slave-response" class="headerlink" title="8 Slave response"></a>8 Slave response</h1><blockquote><p>åœ¨masterå¼€å§‹ä¸€ä¸ªä¼ è¾“åï¼Œslaveéšå³åˆ¤æ–­ä¼ è¾“æ”¹æ€æ ·è¿›å±•ï¼Œåœ¨AHB specä¸­æ²¡æœ‰[å½“ä¼ è¾“å¼€å§‹åï¼Œmasterå¯ä»¥å–æ¶ˆä¼ è¾“]çš„è§„å®šã€‚</p><p>æ— è®ºslaveä½•æ—¶è¢«è®¿é—®ï¼Œå®ƒä¸€å®šæä¾›ä¸€ä¸ªresponse,æŒ‡ç¤ºä¼ è¾“çš„çŠ¶æ€ã€‚<code>HREADY</code>ä¿¡å·ç”¨äºæ‰©å±•ä¼ è¾“ï¼Œå®ƒè¿˜å’Œå“åº”ä¿¡å·<code>HRESP[1:0]</code>ç»„åˆæä¾›ä¼ è¾“çŠ¶æ€ã€‚</p><p>slaveå¯ä»¥ç”¨å¤šç§æ–¹æ³•å®Œæˆä¼ è¾“ï¼š</p><ol><li>ç«‹å³å®Œæˆ</li><li>æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªç­‰å¾…çŠ¶æ€åŒ€å‡ºæ—¶é—´æ¥å®Œæˆ</li><li>å‘é€ä¸€ä¸ª<code>error</code>ä¿¡å·å‘ŠçŸ¥ä¼ è¾“å¤±è´¥</li><li>å»¶è¿Ÿä¼ è¾“çš„å®Œæˆï¼Œä½†æ˜¯å…è®¸masterå’Œslaveè®©å‡ºæ€»çº¿ï¼Œè…¾ç»™å…¶å®ƒä¼ è¾“ä½¿ç”¨ã€‚</li></ol></blockquote><h2 id="8-1-transfer-done"><a href="#8-1-transfer-done" class="headerlink" title="8.1 transfer done"></a>8.1 transfer done</h2><blockquote><p><a href="#extend"><code>HREADY</code>ä¿¡å·ç”¨äºæ‰©å±•AHBä¼ è¾“çš„æ•°æ®éƒ¨åˆ†ã€‚</a>å½“æ‹‰ä½è¯¥ä¿¡å·æ—¶è¡¨æ˜ä¼ è¾“è¢«æ‰©å±•ï¼Œå½“æ‹‰é«˜è¯¥ä¿¡å·è¡¨ç¤ºä¼ è¾“å®Œæˆ</p><p><font color="red">note:</font> ä¸ºäº†è®¡ç®—è®¿é—®æ€»çº¿çš„å»¶è¿Ÿæ—¶é—´ï¼Œæ¯ä¸ªmasterå¿…é¡»æœ‰ä¸€ä¸ªé¢„å…ˆç¡®å®šçš„ç­‰å¾…çŠ¶æ€çš„æœ€å¤§æ•°ç›®ï¼Œå®ƒå°†åœ¨é€€å‡ºæ€»çº¿ä¹‹å‰æ’å…¥ã€‚æˆ‘ä»¬æ¨èä½†ä¸å¼ºåˆ¶ï¼šæ¯ä¸ªslaveä¸è¦æ’å…¥è¶…è¿‡16ä¸ªwait statesï¼Œä»¥é˜²ä»»ä½•å•ä¸ªè®¿é—®ğŸ”’ä½æ€»çº¿è¿‡å¤šçš„æ—¶é’Ÿå‘¨æœŸã€‚</p></blockquote><h2 id="8-2-transfer-response"><a href="#8-2-transfer-response" class="headerlink" title="8.2 transfer response"></a>8.2 transfer response</h2><blockquote><p>é€šå¸¸ï¼Œslaveä½¿ç”¨<code>HREADY</code>ä¿¡å·æ¥æ’å…¥åˆé€‚çš„æ•°é‡çš„<code>wait states</code>ï¼Œå¹¶åœ¨ä¼ è¾“å®Œæˆæ—¶ç½®é«˜<code>HREADY</code>ï¼Œè¿”å›<code>OKAY</code>responseï¼ŒæŒ‡ç¤ºä¼ è¾“æˆåŠŸå®Œæˆã€‚</p><p><code>ERROR</code> responseç”¨äºæŒ‡ç¤ºæŸç§å½¢å¼çš„ä¼ è¾“å¤±è´¥ã€‚å¾ˆå…¸å‹çš„æ˜¯ä¿æŠ¤é”™è¯¯ï¼Œä¾‹å¦‚å°è¯•å†™å…¥åªèƒ½è¯»çš„å­˜å‚¨åŒºåŸŸã€‚</p><p><code>SPLIT</code>å’Œ<code>RETRY</code>å“åº”ç»„åˆè®©slaveèƒ½å»¶è¿Ÿä¼ è¾“çš„å®Œæˆï¼Œä½†æ˜¯é‡Šæ”¾æ€»çº¿ç»™å…¶å®ƒmasterç”¨ã€‚è¿™äº›å“åº”ç»„åˆé€šå¸¸ä»…ä»…è¢«é‚£äº›è®¿é—®å»¶è¿Ÿé•¿çš„masterä½¿ç”¨ï¼Œå……åˆ†åˆ©ç”¨è¿™äº›å“åº”ç å¯ä»¥ç¡®ä¿å…¶å®ƒçš„masterç”³è¯·busä¸ä¼šç­‰å¾…å¤ªé•¿çš„æ—¶é—´ã€‚</p></blockquote><p><img src="https://image.beenli.cn/img/20201009/qakoEUczkIsS.png?imageslim" alt="mark"></p><p><font color="red">note:</font> å½“slaveå‘ç°è¿˜ä¸èƒ½ç«‹åˆ»ç»™å‡ºå“åº”ç»“æœï¼Œéœ€è¦æ’å…¥å‡ ä¸ªç­‰å¾…å‘¨æœŸæ—¶ï¼Œå®ƒåº”è¯¥å“åº”<code>OKAY</code></p><h2 id="8-3-Two-cycle-response"><a href="#8-3-Two-cycle-response" class="headerlink" title="8.3 Two-cycle response"></a>8.3 Two-cycle response</h2><blockquote><p>åªæœ‰<code>OKAY</code>å“åº”æ‰å¯èƒ½å‡ºç°åœ¨å•å‘¨æœŸä¸­ã€‚<code>ERROR</code>ï¼Œ<code>SPLIT</code>å’Œ<code>RETRY</code>å“åº”è‡³å°‘éœ€è¦ä¸¤ä¸ªå‘¨æœŸã€‚ä¸ºäº†ç”¨è¿™äº›å“åº”ä¸­çš„ä»»ä½•ä¸€ä¸ªæ¥å®Œæˆä¼ è¾“ï¼Œåœ¨å€’æ•°ç¬¬äºŒä¸ªå‘¨æœŸï¼Œslaveé©±åŠ¨<code>HRESP[1:0]</code>æŒ‡ç¤ºERROR, RETRY or SPLITï¼ŒåŒæ—¶é©±åŠ¨HREADYä½ç”µå¹³æ¥æ‰©å±•ä¸€ä¸ªé¢å¤–çš„å‘¨æœŸã€‚åœ¨æœ€åä¸€ä¸ªå‘¨æœŸ<code>HREADY</code>é©±åŠ¨åˆ°é«˜ç”µå¹³ç»“æŸè¿™æ¬¡ä¼ è¾“ï¼Œä½†æ˜¯<code>HRESP[1:0]</code>ä»ç„¶ä¿æŒä¸å˜æŒ‡ç¤ºERROR, RETRY or SPLITã€‚</p><p>å¦‚æœslaveéœ€è¦å¤šäºä¸¤ä¸ªå‘¨æœŸæ¥æä¾›ERROR, RETRY or SPLITå“åº”ï¼Œé‚£ä¹ˆé¢å¤–çš„ç­‰å¾…çŠ¶æ€åœ¨ä¼ è¾“çš„å¼€å§‹è¢«æ’å…¥ã€‚ç­‰å¾…æœŸé—´HREADY=0ï¼Œå“åº”è®¾ç½®ä¸º<code>OKAY</code></p><p>ç”±äºæ€»çº¿æµæ°´çº¿çš„ç‰¹æ€§ï¼Œéœ€è¦ä¸¤ä¸ªå‘¨æœŸçš„å“åº”ã€‚è¿™æ—¶slaveå¼€å§‹å‘å°„ ERROR, SPLIT or RETRYä¸­çš„ä»»ä½•ä¸€ä¸ªå“åº”ï¼Œç„¶åä¸‹ä¸€æ¬¡ä¼ è¾“çš„åœ°å€å·²ç»è¢«å¹¿æ’­åˆ°æ€»çº¿ä¸Šã€‚ä¸¤å‘¨æœŸçš„å“åº”ç»™masterè¶³å¤Ÿçš„æ—¶é—´å–æ¶ˆåœ°å€ï¼Œåœ¨ä¸‹ä¸€æ¬¡ä¼ è¾“å¼€å§‹å‰é©±åŠ¨<code>HTRANS[1:0]</code>åˆ°IDLEã€‚</p><p>å¯¹äºSPLITå’ŒRETRYå“åº”ï¼Œæ¥ä¸‹æ¥çš„ä¼ è¾“ä¸€å®šè¢«å–æ¶ˆï¼Œå› ä¸ºåœ¨å½“å‰ä¼ è¾“å®Œæˆå‰ä¸èƒ½è¿›è¡Œæ­¤ä¼ è¾“ã€‚ä½†æ˜¯ï¼Œå¯¹äºERRORå“åº”ï¼Œå…¶ä¸­å½“å‰ä¼ è¾“æ²¡æœ‰é‡å¤æ—¶ï¼Œå®Œæˆæ¥ä¸‹æ¥ä¼ è¾“çš„æ˜¯å¯é€‰çš„ã€‚</p></blockquote><h3 id="8-3-1-retry"><a href="#8-3-1-retry" class="headerlink" title="8.3.1 retry"></a>8.3.1 retry</h3><p><img src="https://image.beenli.cn/img/20201007/qIJ2WDNn39pv.png?imageslim" alt="mark"></p><ul><li>masterå¼€å§‹ä¸€ä¸ªåœ°å€Açš„ä¼ è¾“</li><li>åœ¨è¿™æ¬¡ä¼ è¾“çš„å“åº”æ”¶åˆ°å‰ï¼Œå®ƒå¼€å§‹æ–°çš„ä¼ è¾“A+4</li><li>åœ¨åœ°å€Açš„slaveä¸èƒ½ç«‹åˆ»å®Œæˆæ”¹æ¬¡ä¼ è¾“ï¼Œå› æ­¤å®ƒå›å¤<code>RETRY</code>å“åº”ï¼›è¿™ä¸ªå“åº”å‘Šè¯‰masteråœ°å€Açš„ä¼ è¾“ä¸èƒ½å®Œæˆï¼Œæ‰€ä»¥åœ°å€A+4çš„ä¼ è¾“è¢«å–æ¶ˆå¹¶ç”¨IDLEä¼ è¾“æ›¿ä»£ã€‚</li></ul><hr><h3 id="8-3-2-Error"><a href="#8-3-2-Error" class="headerlink" title="8.3.2 Error"></a>8.3.2 Error</h3><p><img src="https://image.beenli.cn/img/20201007/v0mXUKMwCtur.png?imageslim" alt="mark"></p><ul><li>slaveéœ€è¦ä¸€ä¸ªå‘¨æœŸå†³å®šå“åº”(æ­¤æœŸé—´HRESPæŒ‡ç¤ºOKAY)</li><li>ç„¶åslaveç”¨ä¸¤å‘¨æœŸçš„ERRORå“åº”ç»ˆæ­¢è¯¥ä¼ è¾“</li></ul><h2 id="8-4-Error-response"><a href="#8-4-Error-response" class="headerlink" title="8.4 Error response"></a>8.4 Error response</h2><blockquote><p>å¦‚æœä¸€ä¸ªslaveæä¾›ä¸€ä¸ªé”™è¯¯å“åº”ï¼Œç„¶åmasterå¯ä»¥é€‰æ‹©å–æ¶ˆåœ¨çªå‘çš„å‰©ä½™ä¼ è¾“ã€‚ä½†æ˜¯ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„è¦æ±‚ï¼Œå¹¶ä¸”masterç»§ç»­åœ¨çªå‘ä¸­ä¼ è¾“å‰©ä½™çš„æ•°æ®ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚</p></blockquote><h2 id="8-5-Split-and-retry"><a href="#8-5-Split-and-retry" class="headerlink" title="8.5 Split and retry"></a>8.5 Split and retry</h2><blockquote><p>åˆ†å‰²å’Œé‡è¯•å“åº”æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå½“slaveä¸èƒ½ç«‹å³ä¸ºä¼ è¾“æä¾›æ•°æ®æ—¶ï¼Œå¯ä»¥é‡Šæ”¾æ€»çº¿ã€‚è¿™ä¸¤ç§æœºåˆ¶éƒ½å…è®¸åœ¨æ€»çº¿ä¸Šçš„ä¼ è¾“å®Œæˆï¼Œå› æ­¤å…è®¸é«˜ä¼˜å…ˆçº§çš„masterè®¿é—®æ€»çº¿ã€‚</p><p>ä¸¤è€…çš„ä¸åŒåœ¨äºä»²è£å™¨åˆ†é…æ€»çº¿çš„æ–¹æ³•ï¼š</p><ul><li>å¯¹äºretryï¼šä»²è£ç»§ç»­ä½¿ç”¨æ­£å¸¸çš„ä¼˜å…ˆçº§ç­–ç•¥ï¼Œå› æ­¤åªæœ‰æ›´é«˜ä¼˜å…ˆçº§çš„masterèƒ½è·å¾—æ€»çº¿</li><li>å¯¹äºsplitï¼šä»²è£å™¨è°ƒæ•´ä¼˜å…ˆç­–ç•¥ï¼Œä»¥è‡³äºä»»ä½•ç”³è¯·çš„masteréƒ½æœ‰æœºä¼šè·å¾—ï¼Œå³ä½¿æ˜¯é‚£äº›ä½ä¼˜å…ˆçº§çš„ã€‚<a name="split">ä¸ºäº†å®ŒæˆSPLITçš„ä¼ è¾“ï¼Œä»²è£å™¨å¿…é¡»è¢«é€šçŸ¥slaveä½•æ—¶å‡†å¤‡å¥½äº†æ•°æ®ã€‚</a></li></ul><p>SPLITä¼ è¾“éœ€è¦åŒæ—¶åœ¨ä»²è£å™¨å’Œslaveä¸Šå¢åŠ å¤æ‚åº¦ï¼Œä½†æ˜¯å®ƒçš„ä¼˜åŠ¿åœ¨äºå®ƒå®Œå…¨é‡Šæ”¾æ€»çº¿ç»™å…¶å®ƒmasters, ä¸æ­¤ç›¸å¯¹çš„æ˜¯retryï¼Œå®ƒåªé‡Šæ”¾æ€»çº¿ç»™ä¼˜å…ˆçº§æ›´é«˜çš„masterã€‚</p><p>masteråº”è¯¥ç”¨åŒæ ·çš„æ–¹å¼å¯¹å¾…SPLITå’ŒRETRYã€‚å®ƒåº”è¯¥ç»§ç»­ç”³è¯·æ€»çº¿ï¼Œå°è¯•ä¼ è¾“ç›´åˆ°å®ƒè¦ä¹ˆæˆåŠŸå®Œæˆï¼Œè¦ä¹ˆå®ƒä»¥ERRORå“åº”æå‰ç»ˆæ­¢äº†ã€‚</p></blockquote><h1 id="9-Data-buses"><a href="#9-Data-buses" class="headerlink" title="9 Data buses"></a>9 Data buses</h1><blockquote><p>ä¸ºäº†AHBç³»ç»Ÿå®ç°ä¸éœ€è¦ä½¿ç”¨<code>ä¸‰æ€é©±åŠ¨å™¨</code>(tristate drivers)ï¼Œæˆ‘ä»¬éœ€è¦ç‹¬ç«‹çš„è¯»å’Œå†™æ•°æ®æ€»çº¿ã€‚æœ€å°çš„æ•°æ®æ€»çº¿å®½åº¦è¢«æŒ‡å®šä¸º32 bitsï¼Œä½†æ˜¯å¯ä»¥å¢åŠ ã€‚</p></blockquote><h2 id="9-1-HWDATA-31-0"><a href="#9-1-HWDATA-31-0" class="headerlink" title="9.1 HWDATA[31:0]"></a>9.1 HWDATA[31:0]</h2><blockquote><p>å†™æ•°æ®æ€»çº¿åœ¨å†™ä¼ è¾“æœŸé—´ç”±masteré©±åŠ¨ã€‚å¦‚æœä¼ è¾“è¢«æ‰©å±•ï¼Œmasterä¿æŒæ•°æ®æœ‰æ•ˆç›´åˆ°ä¼ è¾“å®Œæˆ(ç”±HREADY å˜é«˜æŒ‡ç¤º)</p><p>å¯¹äºæ¯”èµ·æ€»çº¿å®½åº¦è¿˜çª„çš„ä¼ è¾“ï¼Œæ¯”å¦‚åœ¨32ä½æ€»çº¿ä¸Šä¼ è¾“16ä½ï¼Œé‚£ä¹ˆmasteråªç”¨é©±åŠ¨é€‚å½“çš„<code>å­—èŠ‚é€šé“</code>ï¼ˆbyte lanes)ã€‚slaveè´Ÿè´£ä¸ºå†™è¿›çš„æ•°æ®é€‰é€šæ­£ç¡®çš„å­—èŠ‚é€šé“ã€‚ğŸ‘‡è¡¨æ ¼è¯´æ˜å“ªä¸ªå­—èŠ‚é€šé“åˆ†åˆ«åœ¨å¤§ç«¯å’Œå°ç«¯ç³»ç»Ÿä¸­è¢«æ¿€æ´»ã€‚å¦‚æœéœ€è¦ï¼Œæ­¤ä¿¡æ¯å¯ä»¥æ‰©å±•ä¸ºæ›´å®½çš„æ•°æ®æ€»çº¿å®ç°ã€‚å¯¹äºä¼ è¾“å¤§å°å°äºæ•°æ®æ€»çº¿å®½åº¦çš„é˜µå‘ä¼ è¾“ï¼Œæ¯ä¸€æ‹æœ‰ä¸åŒçš„æ¿€æ´»å­—èŠ‚é€šé“ã€‚</p><p>æ¿€æ´»å­—èŠ‚é€šé“å–å†³äºç³»ç»Ÿæ˜¯å¤§ç«¯è¿˜æ˜¯å°ç«¯ï¼Œä½†æ˜¯AHBæ²¡æœ‰æŒ‡å®šæ‰€éœ€çš„ç«¯ã€‚å› æ­¤ï¼Œå¯¹äºç³»ç»Ÿä¸­çš„masterå’Œslaveä¿æŒç›¸åŒçš„ç«¯å¾ˆé‡è¦ã€‚</p></blockquote><h2 id="9-2-HRDATA-31-0"><a href="#9-2-HRDATA-31-0" class="headerlink" title="9.2 HRDATA[31:0]"></a>9.2 HRDATA[31:0]</h2><blockquote><p>è¯»æ•°æ®æ€»çº¿åœ¨è¯»ä¼ è¾“ä¸­è¢«å¯¹åº”çš„slaveé©±åŠ¨ã€‚å¦‚æœslaveæ‰©å±•ä¼ é€ï¼Œé‚£ä¹ˆslaveä»…ä»…éœ€è¦æä¾›æœ‰æ•ˆçš„æ•°æ®åœ¨ä¼ è¾“çš„æœ€åä¸€ä¸ªå‘¨æœŸï¼Œç”¨HREADY=1æŒ‡ç¤º</p><p>å¯¹äºæ¯”æ€»çº¿å®½åº¦æ›´çª„çš„ä¼ è¾“ï¼Œslaveä»…ä»…éœ€è¦åœ¨æ¿€æ´»çš„å­—èŠ‚é€šé“ä¸Šæä¾›æœ‰æ•ˆçš„æ•°æ®ã€‚masterè´Ÿè´£ä»æ­£ç¡®çš„å­—èŠ‚é“ä¸­é€‰æ‹©æ•°æ®</p><p>slaveåªè¦å½“ä¼ è¾“å¸¦æœ‰OKAYå“åº”å®Œæˆæ—¶æä¾›æœ‰æ•ˆæ•°æ®ã€‚ SPLIT, RETRY and ERROR responsesä¸éœ€è¦æä¾›æœ‰æ•ˆè¯»æ•°æ®ã€‚</p><p><img src="https://image.beenli.cn/img/20201007/utIIQ2a1FJji.png?imageslim" alt="mark"></p></blockquote><h2 id="9-3-Endianness"><a href="#9-3-Endianness" class="headerlink" title="9.3 Endianness"></a>9.3 Endianness</h2><blockquote><p>ä¸ºäº†è®©ç³»ç»ŸåŠŸèƒ½æ­£ç¡®ï¼Œæ‰€æœ‰æ¨¡å—ä½¿ç”¨åŒæ ·çš„ç«¯å¾ˆé‡è¦ï¼Œå¹¶ä¸”æ‰€æœ‰çš„æ•°æ®è·¯ç”±æˆ–è€…æ¡¥ä¹Ÿç”¨ä¸€æ ·çš„ã€‚</p><p>åŠ¨æ€ç«¯ä¸æ”¯æŒï¼Œå› ä¸ºç»å¤§å¤šåµŒå…¥ä¹¦ç³»ç»Ÿï¼Œè¿™å°†å¯¼è‡´å¤§é‡å†—ä½™çš„ç¡…å¼€é”€(silicon overhead that is redundant)</p><p>å¯¹äºæŸå—è®¾è®¡è€…ï¼Œæˆ‘ä»¬æ¨èåªæœ‰é‚£äº›å¯è¢«ç”¨åœ¨è®¸å¤šåœ°æ–¹çš„æ¨¡å—æ‰åº”è¯¥è®¾è®¡æˆå¤§å°ç«¯ï¼Œè¦ä¹ˆå¸¦æœ‰å¯é…ç½®çš„å¼•è„š(pin)æˆ–è€…å†…éƒ¨æ§åˆ¶ä½å–é€‰æ‹©ç«¯çš„å¤§å°ã€‚å¯¹äºæ›´å¤šç‰¹å®šåº”ç”¨çš„æ¨¡å—ï¼Œå›ºå®šç«¯ä¸ºå°ç«¯æˆ–è€…å¤§ç«¯å¯ä»¥èŠ‚çœåŠŸè€—ï¼Œæé«˜æ¥å£æ€§èƒ½ã€‚</p></blockquote><h1 id="10-Arbitration"><a href="#10-Arbitration" class="headerlink" title="10 Arbitration"></a>10 Arbitration</h1><blockquote><p>ä»²è£æœºåˆ¶è¢«ç”¨æ¥ç¡®ä¿ä»»ä½•æ—¶å€™åªæœ‰ä¸€ä¸ªmasterè®¿é—®æ€»çº¿ã€‚ä»²è£å™¨é€šè¿‡è§‚å¯Ÿä¸€äº›ä¸åŒçš„è¯·æ±‚ï¼Œåˆ¤æ–­å½“å‰è¯·æ±‚ä¸­æœ€é«˜ä¼˜å…ˆçº§çš„masteræ¥å®Œæˆè¿™ä¸€åŠŸèƒ½ã€‚ä»²è£ä¹Ÿæ¥å—æ¥è‡ªslaveçš„è¯·æ±‚ï¼Œ<a href="#split">è¯·æ±‚å®ŒæˆSPLITä¼ è¾“ã€‚</a></p><p>ä»»ä½•ä¸èƒ½å®ŒæˆSPLITä¼ è¾“çš„slaveéƒ½ä¸éœ€è¦çŸ¥é“ä»²è£çš„è¿‡ç¨‹ï¼Œé™¤éå®ƒä»¬éœ€è¦è§‚æµ‹è¿™æ ·çš„äº‹å®â€”â€”ä¸€è¿ä¸²çš„ä¼ è¾“å¯èƒ½æ— æ³•å®Œæˆå¦‚æœæ€»çº¿æ‰€æœ‰æƒæ”¹å˜äº†ã€‚</p></blockquote><h2 id="10-1-Signal-description"><a href="#10-1-Signal-description" class="headerlink" title="10.1 Signal description"></a>10.1 Signal description</h2><ul><li><strong>HBUSREQx </strong>ï¼šæ€»çº¿è¯·æ±‚ä¿¡å·ï¼›æ¯ä¸ªmasteræœ‰å•ç‹¬çš„è¯·æ±‚ä¿¡å·è¿æ¥åˆ°ä»²è£å™¨ï¼Œæœ€å¤šæœ‰16ä¸ªç‹¬ç«‹çš„masterã€‚</li><li><strong>HLOCKx </strong>ï¼šé”ä¿¡å·ä¸è¯·æ±‚ä¿¡å·è¢«masteråŒæ—¶å‘å‡ºï¼›å®ƒæŒ‡ç¤ºæˆ‘å°†è¦æ‰§è¡Œå¤§é‡ä¸å¯åˆ†å‰²çš„ä¼ è¾“ï¼Œå¹¶ä¸”ä¸€æ—¦å¸¦ğŸ”’ä¼ è¾“çš„ç¬¬ä¸€ä¸ªä¼ è¾“å¼€å§‹ï¼Œä»²è£ä¸€å®šä¸è¦æˆæƒå…¶å®ƒçš„masterã€‚è¯¥ä¿¡å·ä¸€å®šåœ¨å®ƒè®¿é—®çš„åœ°å€ä¹‹å‰è‡³å°‘ä¸€ä¸ªå‘¨æœŸå‘å‡ºï¼Œä»¥å…ä»²è£æ”¹å˜äº†æˆæƒä¿¡å·ã€‚</li><li><strong>HGRANTx </strong>ï¼šæˆæƒä¿¡å·ç”±ä»²è£ç”Ÿæˆï¼ŒæŒ‡ç¤ºå½“å‰ç”³è¯·æ€»çº¿çš„masterä¸­ä¼˜å…ˆçº§æœ€é«˜çš„ï¼Œè€ƒè™‘é”ä¼ è¾“å’ŒSPLITä¼ è¾“åœ¨å†…ã€‚</li><li><strong>HMASTER[3:0]</strong>ï¼šæŒ‡ç¤ºå½“å‰è°æœ‰æƒåˆ©ä½¿ç”¨æ€»çº¿ã€‚è¯¥ä¿¡å·è¿˜è¢«ç”¨æ¥å½“ä½œåœ°å€æ§åˆ¶å¤šé€‰å™¨çš„æ§åˆ¶ä¿¡å·ã€‚masterçš„å·ç è¿˜è¢«èƒ½å¤Ÿæ‰§è¡ŒSPLITä¼ è¾“çš„slavesä½¿ç”¨ï¼Œæ¥å‘ä»²è£æŒ‡ç¤ºå“ªä¸€ä¸ªmasterèƒ½å¤Ÿå®ŒæˆSPLITäº¤æ˜“</li><li><strong>HMASTLOCK</strong>ï¼šä»²è£å™¨é€šè¿‡å‘å‡ºè¯¥ä¿¡å·æŒ‡ç¤ºå½“å‰ä¼ è¾“æ˜¯å¸¦ğŸ”’ä¼ è¾“åºåˆ—çš„ä¸€éƒ¨åˆ†ï¼Œå…¶ä¸åœ°å€å’Œæ§åˆ¶ä¿¡å·æœ‰ç›¸åŒçš„æ—¶åºã€‚</li><li><strong>HSPLIT[15:0] </strong>ï¼šèƒ½å¤Ÿå¤„ç†splitçš„slaveä½¿ç”¨16bitçš„<code>SPLIT Complete bus</code>æ¥æŒ‡ç¤ºå“ªä¸ªmasterèƒ½å¤Ÿå®Œæˆsplitäº¤æ˜“ã€‚ä»²è£å™¨éœ€è¦è¿™ä¸ªä¿¡æ¯æ¥æˆæƒmasterå»å®Œæˆè¯¥æ¬¡ä¼ è¾“ã€‚</li></ul><h2 id="10-2-Requesting-bus-access"><a href="#10-2-Requesting-bus-access" class="headerlink" title="10.2 Requesting bus access"></a>10.2 Requesting bus access</h2><blockquote><p>masterä½¿ç”¨<code>HBUSREQx</code>ä¿¡å·æ¥è¯·æ±‚è®¿é—®æ€»çº¿ï¼Œå¹¶å¯èƒ½åœ¨ä»»ä½•å‘¨æœŸå‘èµ·è¯·æ±‚ã€‚ä»²è£å™¨å°†åœ¨æ—¶é’Ÿä¸Šå‡æ²¿å–æ ·è¯·æ±‚ä¿¡å·ç„¶åä½¿ç”¨å†…éƒ¨ä¼˜å…ˆçº§ç®—æ³•å†³å®šå“ªä¸ªmasterå°†æˆä¸ºä¸‹ä¸€ä¸ªæœ‰æƒåˆ©è®¿é—®æ€»çº¿çš„ã€‚</p><p>æ­£å¸¸æ¥è¯´ä»²è£å™¨åªä¼šå½“é˜µå‘å®Œæˆåæ‰æˆæƒä¸€ä¸ªä¸åŒçš„masterã€‚ä½†æ˜¯ï¼Œå¦‚æœéœ€è¦ï¼Œä»²è£å™¨èƒ½æå‰ç»ˆæ­¢ä¸€æ¬¡é˜µå‘æ¥è®©æ›´é«˜ä¼˜å…ˆçº§çš„masterè®¿é—®ã€‚</p><p>å¦‚æœmasteréœ€è¦é”è®¿é—®ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»å‘é€HCLOKxä¿¡å·æ¥å‘ä»²è£å™¨æŒ‡ç¤ºï¼šä¸è¯¥æœ‰å…¶å®ƒçš„masterè¢«æˆæƒã€‚</p><p>å½“æœ‰ä¸€ä¸ªmasterè¢«æˆæƒæ€»çº¿å¹¶æ­£åœ¨æ‰§è¡Œä¸€ä¸ªå›ºå®šé•¿åº¦é•¿åº¦çš„é˜µå‘ï¼Œå®ƒæ²¡å¿…è¦æŒç»­è¯·æ±‚æ€»çº¿æ¥å®Œæˆé˜µå‘ã€‚ä»²è£å™¨è§‚å¯Ÿé˜µå‘çš„è¿›ç¨‹å¹¶ä½¿ç”¨<code>HBURST[2:0]</code>ä¿¡å·çŸ¥é“masterè¯·æ±‚äº†å¤šå°‘æ¬¡ä¼ è¾“ã€‚å¦‚æœmasterå¸Œæœ›åœ¨å½“å‰æ­£åœ¨è¿›è¡Œçš„burstä¹‹åå†æ‰§è¡Œç¬¬äºŒæ¬¡burstï¼Œé‚£ä¹ˆå®ƒåº”è¯¥åœ¨å½“å‰burstæœŸé—´é‡æ–°å‘å‡ºè¯·æ±‚ä¿¡å·</p><p>å¦‚æœä¸€ä¸ªmasteråœ¨é˜µå‘ä¸­é€”å¤±å»äº†æ€»çº¿è®¿é—®æƒï¼Œé‚£ä¹ˆå®ƒå¿…é¡»é‡æ–°å‘å‡º<code>HBUSREQx</code>è¯·æ±‚æ¥é‡æ–°è·å¾—æ€»çº¿è®¿é—®æƒã€‚</p><p>å¯¹äºæ²¡æœ‰å®šä¹‰é•¿åº¦çš„burstï¼Œmasterå¿…é¡»æŒç»­å‘å‡ºè¯·æ±‚çŸ¥é“å®ƒå¼€å§‹äº†æœ€åä¸€æ¬¡ä¼ è¾“(until it has started the last transfer)ã€‚åœ¨æ²¡æœ‰å®šä¹‰é•¿åº¦é˜µå‘çš„æœ«å°¾ï¼Œä»²è£å™¨ä¸èƒ½é¢„æµ‹ä½•æ—¶å»æ”¹å˜ä»²è£ã€‚</p><p>å½“masterä¸è¯·æ±‚æ€»çº¿æ—¶ï¼Œå®ƒå¯èƒ½è¢«æˆäºˆè¯¥æ€»çº¿ã€‚è¿™ç§æƒ…å†µå‘ç”Ÿåœ¨æ²¡æœ‰masterè¯·æ±‚æ€»çº¿å¹¶ä¸”ä»²è£å™¨æˆäºˆè®¿é—®æƒç»™ä¸€ä¸ªé»˜è®¤çš„masterã€‚å› æ­¤ï¼Œå¦‚æœmasterä¸éœ€è¦è®¿é—®æ€»çº¿ï¼Œå®ƒåº”è¯¥é©±åŠ¨ä¼ è¾“ç±»å‹<code>HTRANS</code>æŒ‡ç¤ºå½“å‰ä¼ è¾“ä¸º<code>IDLE</code>ã€‚</p></blockquote><h2 id="10-3-Granting-bus-access"><a href="#10-3-Granting-bus-access" class="headerlink" title="10.3 Granting bus access"></a>10.3 Granting bus access</h2><h3 id="10-3-1-granting-with-wait"><a href="#10-3-1-granting-with-wait" class="headerlink" title="10.3.1 granting with wait"></a>10.3.1 granting with wait</h3><blockquote><p>ä»²è£ç¨‹åºé€šè¿‡å£°æ˜é€‚å½“çš„<code>HGRANTx</code>ä¿¡å·æ¥æŒ‡ç¤ºå½“å‰è¯·æ±‚æ€»çº¿ä¸­å“ªä¸ªmasteræ˜¯æœ€é«˜ä¼˜å…ˆçº§çš„ã€‚å½“å½“å‰ä¼ è¾“å®Œæˆï¼Œæœ‰<code>HREADY</code>ä¸ºé«˜æ¥æŒ‡ç¤ºï¼Œä¹‹åmasterå°†è¢«æˆæƒå¹¶ä¸”ä»²è£å™¨ä¼šæ”¹å˜<code>HMASTER[3:0]</code>ä¿¡å·æ¥æŒ‡ç¤ºè¿™ä¸ªmasterçš„å·ç ã€‚</p><p><img src="https://image.beenli.cn/img/20201008/FPXL0rH173Vy.png?imageslim" alt="mark"></p><ul><li>å½“masterå‘å‡º<code>HBUSREQx</code>åå‡ ä¸ªå‘¨æœŸï¼Œä»²è£å™¨æ‰æˆæƒ(<code>HGRANTx</code>ç½®é«˜)</li><li>masteråªæœ‰ç­‰åˆ°<code>HGRANTx</code>å’Œ<code>HREADY</code>éƒ½ä¸ºé«˜æ‰å¼€å§‹ä¼ é€åœ°å€ã€‚åŒæ—¶<code>HMASTER[3:0]</code>æŒ‡ç¤ºè¯¥master</li><li>åœ°å€è¢«slaveé‡‡æ ·ï¼Œå½“<code>HREADY</code>ä¸ºé«˜æ—¶æ‰ä¼ é€ä¸‹ä¸€ä¸ªåœ°å€ã€‚</li></ul></blockquote><h3 id="10-3-2-Data-bus-owner"><a href="#10-3-2-Data-bus-owner" class="headerlink" title="10.3.2 Data bus owner"></a>10.3.2 Data bus owner</h3><blockquote><p><img src="https://image.beenli.cn/img/20201008/AWHDyOGLSx92.png?imageslim" alt="mark"></p><ul><li>æ•°æ®æ€»çº¿æ‹¥æœ‰æƒæ»åäºåœ°å€æ€»çº¿ã€‚(ğŸ‘†è½åT5å’ŒT6ä¸¤å‘¨æœŸ)</li><li>æ— è®ºä¼ è¾“ä½•æ—¶å®Œæˆ(ç”±HREADYä¸ºé«˜æŒ‡ç¤º)ï¼Œé‚£ä¹ˆæ‹¥æœ‰åœ°å€æ€»çº¿çš„master(ğŸ‘†#2åœ¨T7å¯ä»¥ä¼ é€å†™æ•°æ®)å°†èƒ½å¤Ÿä½¿ç”¨æ•°æ®æ€»çº¿ï¼Œå¹¶ä¸€ç›´å æœ‰æ•°æ®æ€»çº¿ç›´åˆ°ä¼ è¾“å®Œæˆã€‚</li></ul></blockquote><h3 id="10-3-3-handover-after-burst"><a href="#10-3-3-handover-after-burst" class="headerlink" title="10.3.3 handover after burst"></a>10.3.3 handover after burst</h3><blockquote><p><img src="https://image.beenli.cn/img/20201008/7W4Hcztx7uQz.png?imageslim" alt=""></p><ul><li>ä»²è£å™¨åœ¨å€’æ•°ç¬¬äºŒä¸ªåœ°å€è¢«é‡‡æ ·å®Œ(ğŸ‘†T5)æ”¹å˜<code>HGRANTx</code>ä¿¡å·ï¼Œæ–°çš„<code>HGRANTx</code>ä¿¡å·å°†å’Œé˜µå‘çš„æœ€åä¸€ä¸ªåœ°å€ä¿¡å·åœ¨ç›¸åŒæ—¶åˆ»è¢«é‡‡æ ·(ğŸ‘†åªæœ‰HREADYä¸ºé«˜æ—¶æ‰é‡‡æ ·æˆåŠŸå³T7ï¼›æ­¤æ—¶HMASTERä¹Ÿæ”¹ä¸º#2)ã€‚</li></ul></blockquote><h3 id="10-3-4-hgrant-and-hmaster"><a href="#10-3-4-hgrant-and-hmaster" class="headerlink" title="10.3.4 hgrant and hmaster"></a>10.3.4 hgrant and hmaster</h3><blockquote><p><img src="https://image.beenli.cn/img/20201008/i0vyocIqRNLC.png?imageslim" alt="mark"></p><ul><li>å› ä¸ºæœ‰ä¸­å¤®å¤ç”¨å™¨ï¼Œæ¯ä¸€ä¸ªmasteréƒ½èƒ½å¤Ÿé©±åŠ¨å®ƒä»¬æƒ³è¦ç«‹åˆ»æ‰§è¡Œçš„ä¼ è¾“çš„åœ°å€ï¼Œå¹¶ä¸”å®ƒä»¬ç›´åˆ°è¢«æˆäºˆæ€»çº¿æ‰éœ€è¦ç­‰å¾…ã€‚</li><li><code>HGRANTx</code>ä¿¡å·ä»…ä»…è¢«masterç”¨äºå†³å®šå®ƒä»¬ä½•æ—¶æ‹¥æœ‰æ€»çº¿ï¼Œå› æ­¤ä»€ä¹ˆæ—¶å€™å®ƒåº”è¯¥è€ƒè™‘åœ°å€å·²ç»è¢«é€‚å½“çš„slaveå–æ ·ã€‚</li></ul></blockquote><h2 id="10-4-Early-burst-termination"><a href="#10-4-Early-burst-termination" class="headerlink" title="10.4 Early burst termination"></a>10.4 Early burst termination</h2><blockquote><p>æ­£å¸¸æ¥è¯´ï¼Œä»²è£å™¨ä¸ç”¨ç§»äº¤æ€»çº¿ç»™ä¸€ä¸ªæ–°çš„masterï¼Œç›´åˆ°é˜µå‘ä¼ è¾“çš„ç»“æŸã€‚ä½†æ˜¯ï¼Œå¦‚æœä»²è£å™¨è®¤ä¸ºé˜µå‘åº”è¯¥æå‰ç»ˆæ­¢ä¸ºäº†é¿å…è®¿é—®æ€»çº¿æ—¶é—´è¿‡é•¿ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½åœ¨é˜µå‘å®Œæˆä¹‹å‰è½¬æ¢æˆæƒç»™å¦å¤–ä¸€ä¸ªmasterã€‚</p></blockquote><h2 id="10-5-default-bus-master"><a href="#10-5-default-bus-master" class="headerlink" title="10.5 default bus master"></a>10.5 default bus master</h2><blockquote><p>æ¯ä¸ªç³»ç»Ÿä¸€å®šåŒ…å«ä¸€ä¸ªé»˜è®¤çš„masterï¼Œå®ƒåœ¨å…¶å®ƒmasteréƒ½ä¸èƒ½è®¿é—®æ€»çº¿æ—¶è¢«æˆäºˆä½¿ç”¨ã€‚å½“è¢«æˆäºˆæ—¶ï¼Œé»˜è®¤masterä¸€å®šåªèƒ½è¿›è¡Œ<code>IDLE</code>çš„ä¼ è¾“ã€‚</p><p>å¦‚æœæ²¡æœ‰masterè¯·æ±‚æ€»çº¿ï¼Œé‚£ä¹ˆä»²è£å™¨è¦ä¹ˆæˆæƒé»˜è®¤çš„masterï¼Œè¦ä¹ˆæˆäºˆå¯èƒ½ä»è®¿é—®æ€»çº¿ä½å»¶è¿Ÿè·ç›Šæœ€å¤§çš„masterã€‚</p><p>æˆäºˆå¯¹æ€»çº¿é»˜è®¤çš„masterè®¿é—®æƒè¿˜æä¾›äº†ä¸€ç§æœ‰ç”¨çš„æœºåˆ¶ï¼Œä»¥ç¡®ä¿æ€»çº¿ä¸Šä¸ä¼šå¯åŠ¨æ–°çš„ä¼ è¾“ï¼Œæ˜¯åœ¨è¿›å…¥ä½åŠŸç‡å·¥ä½œæ¨¡å¼ä¹‹å‰æ‰§è¡Œçš„ä¸€ä¸ªæœ‰ç”¨çš„æ­¥éª¤</p><p>â­å¦‚æœæ‰€æœ‰å…¶å®ƒmasteréƒ½åœ¨ç­‰å¾…åˆ†å‰²ä¼ è¾“å®Œæˆï¼Œåˆ™å¿…é¡»æˆäºˆé»˜è®¤masterã€‚</p></blockquote><h1 id="11-Split-transfer"><a href="#11-Split-transfer" class="headerlink" title="11 Split transfer"></a>11 Split transfer</h1><blockquote><p>SPLITä¼ è¾“é€šè¿‡åˆ†ç¦»<code>masterå‘slaveæä¾›åœ°å€çš„æ“ä½œ</code>å’Œ<code>slaveå‘masteræä¾›æ­£ç¡®æ•°æ®çš„æ“ä½œ</code>ï¼Œæ¥æé«˜æ€»çš„æ€»çº¿åˆ©ç”¨ç‡ã€‚</p><p>å½“ä¸€æ¬¡ä¼ è¾“å‘ç”Ÿæ—¶ï¼Œslaveå¦‚æœç›¸ä¿¡è¯¥æ¬¡ä¼ è¾“éœ€è¦èŠ±è´¹å¾ˆå¤šå‘¨æœŸå»æ‰§è¡Œï¼Œé‚£ä¹ˆå®ƒå°†å‘é€SPLITå“åº”ã€‚è¿™ä¸ªä¿¡å·å‘Šè¯‰ä»²è£å™¨å½“å‰å°è¯•ä¼ è¾“çš„masterä¸åº”è¯¥è¢«æˆæƒç›´åˆ°slaveè¡¨ç¤ºå®ƒå·²ç»å‡†å¤‡å¥½å®Œæˆä¼ è¾“ã€‚å› æ­¤ä»²è£å™¨éœ€è¦è§‚æµ‹å“åº”ä¿¡å·å¹¶åœ¨å†…éƒ¨å±è”½æ¥è‡ªå·²è¢«åˆ†å‰²(have been SPLIT)çš„masterçš„ä»»ä½•è¯·æ±‚</p><p>åœ¨ä¸€æ¬¡ä¼ è¾“çš„åœ°å€ç›¸ä¸­ï¼Œä»²è£å™¨äº§ç”Ÿä¸€ä¸ªæ ‡ç­¾æˆ–è€…masterç¼–å·HMASTER[3:0]ï¼ŒæŒ‡ç¤ºæ­£åœ¨æ‰§è¡Œä¼ è¾“çš„masterã€‚ä»»ä½•å‘å‡ºSPLITå“åº”çš„slaveå¿…é¡»èƒ½å¤ŸæŒ‡ç¤ºå®ƒä»¬æœ‰èƒ½åŠ›å®Œæˆä¼ è¾“ï¼Œå¹¶ä¸”å®ƒé€šè¿‡è®°å½•HMASTER[3:0]ä¿¡å·ä¸Šçš„masterç¼–å·æ¥åšåˆ°è¿™ä¸€ç‚¹</p><p>éšåï¼Œå½“slaveå®Œæˆäº†ä¼ è¾“ï¼Œå®ƒæ ¹æ®masterç¼–å·åœ¨<code>HSPLITx[15:0]</code>ä¸Šå‘ä»²è£å™¨å‘å‡ºåˆé€‚çš„ä½ã€‚ä»²è£å™¨ç„¶åä½¿ç”¨è¯¥ä¿¡æ¯unmask(åœæ­¢å±è”½)å¯¹åº”masterçš„è¯·æ±‚ä¿¡å·å¹¶åœ¨é€‚å½“çš„é€‚åˆ(in due course)masterè¢«æˆæƒè®¿é—®æ¥é‡å¯ä¹‹å‰çš„ä¼ è¾“ã€‚ä»²è£å™¨æ¯å‘¨æœŸéƒ½å–æ ·HSPLITxä¿¡å·ï¼Œå› æ­¤slaveåªéœ€è¦å‘å‡ºåˆé€‚çš„ä½æŒç»­ä¸€ä¸ªå‘¨æœŸä»¥ä¾¿ä»²è£å™¨èƒ½å¤Ÿè¯†åˆ«å®ƒã€‚</p><p>åœ¨å¸¦æœ‰å¤šä¸ªæœ‰èƒ½åŠ›å‘é€SPLITçš„slaveç³»ç»Ÿä¸­ï¼Œæ¥è‡ªæ¯ä¸ªslaveçš„HSPLITxä¿¡å·è¢«æˆ–æ“ä½œåˆ°ä¸€èµ·ï¼Œäº§ç”Ÿä¸€ä¸ªæœ€ç»ˆç»“æœçš„HSPLITä¿¡å·ç»™ä»²è£å™¨ã€‚</p><p>åœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸­ï¼Œå¯èƒ½ç”¨ä¸åˆ°16ä¸ªmasterçš„æœ€å¤§å®¹é‡ã€‚å› æ­¤ä»²è£å™¨åªéœ€è¦ä¸€æ ¹HSPLITæ€»çº¿ï¼Œå…¶ä½æ•°ä¸masterä¸ªæ•°ç›¸åŒã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬æ¨èæ‰€æœ‰æœ‰èƒ½åŠ›å‘é€splitçš„slaveéƒ½è¢«è®¾è®¡æˆæ”¯æŒæœ€å¤šçš„16ä¸ªmasterã€‚</p></blockquote><h2 id="11-1-split-transfer-seq"><a href="#11-1-split-transfer-seq" class="headerlink" title="11.1 split transfer seq"></a>11.1 split transfer seq</h2><blockquote><p>SPLITäº¤æ˜“çš„åŸºæœ¬é˜¶æ®µå¦‚ä¸‹ï¼š</p><ol><li>masterä»¥å’Œå…¶ä»–ä»»ä½•ä¼ è¾“ç›¸åŒçš„æ–¹å¼å¼€å¯ä¼ è¾“ï¼Œå¹¶å‘å°„åœ°å€å’Œæ§åˆ¶ä¿¡æ¯ã€‚</li><li>å¦‚æœslaveèƒ½å¤Ÿç«‹åˆ»æä¾›æ•°æ®ï¼Œå®ƒå¯èƒ½è¿™æ ·åšã€‚å¦‚æœslaveå†³å®šå®ƒå¯èƒ½éœ€è¦å¤šä¸ªå‘¨æœŸè·å¾—æ•°æ®ï¼Œå®ƒå°†ç»™å‡ºä¸€ä¸ªSPLITå“åº”ã€‚åœ¨æ¯æ¬¡ä¼ è¾“ä¸­ï¼Œä»²è£å™¨å¹¿æ’­ä¸€ä¸ªå·ç æˆ–è€…æ ‡ç­¾â€”æŒ‡ç¤ºæ­£åœ¨ä½¿ç”¨æ€»çº¿çš„masterã€‚slaveå¿…é¡»è®°å½•è¿™ä¸ªå·ç ï¼Œåé¢ç”¨è¿™ä¸ªä¿¡æ¯é‡å¯è¿™ä¸ªä¼ è¾“ã€‚</li><li>ä»²è£å™¨æˆæƒå…¶å®ƒmasterï¼Œå¹¶ä¸”SPLITå“åº”çš„åŠ¨ä½œå…è®¸masteråˆ‡æ¢çš„å‘ç”Ÿã€‚å¦‚æœæ‰€æœ‰å…¶å®ƒçš„masterä¹Ÿæ”¶åˆ°äº†SPLITå“åº”ï¼Œé‚£ä¹ˆé»˜è®¤çš„masterè¢«æˆæƒã€‚</li><li>å½“slaveå‡†å¤‡å¥½å®Œæˆä¼ è¾“æ—¶ï¼Œå®ƒå‘å‡ºåˆé€‚çš„HSPLITxä¸­çš„ä½ç»™ä»²è£å™¨æŒ‡ç¤ºå“ªä¸ªmasterè¢«æˆæƒè®¿é—®æ€»çº¿ã€‚</li><li>ä»²è£å™¨æ¯ä¸ªå‘¨æœŸéƒ½ä¼šè§‚å¯ŸHSPLITxä¿¡å·ï¼Œå¹¶ä¸”å½“HSPLITxä¸­ä»»ä½•ä¸€ä½è¢«å£°æ˜æ—¶ï¼Œä»²è£å™¨æ¢å¤è¯¥masterçš„ä¼˜å…ˆçº§(å› ä¸ºä¹‹å‰è¢«å±è”½äº†)</li><li>æœ€ç»ˆä»²è£å™¨æˆæƒè¯¥masterï¼Œå¥½è®©å®ƒèƒ½å¤Ÿé‡æ–°å°è¯•è¿™æ¬¡ä¼ è¾“ã€‚å¦‚æœä¸€ä¸ªæ›´é«˜ä¼˜å…ˆçº§çš„masteræ­£åœ¨ä½¿ç”¨ï¼Œä¸Šè¿°åœºæ™¯å¯èƒ½ä¸ä¼šç«‹åˆ»å‘ç”Ÿã€‚</li><li>å½“ä¼ è¾“æœ€ç»ˆå‘ç”Ÿæ—¶ï¼Œslaveç”¨OKAYå“åº”ç»“æŸè¿™æ¬¡ä¼ è¾“ã€‚</li></ol></blockquote><h2 id="11-2-multiple-split-transâ“"><a href="#11-2-multiple-split-transâ“" class="headerlink" title="11.2 multiple split transâ“"></a>11.2 multiple split transâ“</h2><blockquote><p>è¯¥æ€»çº¿åè®®ä»…å…è®¸æ¯ä¸ªmasteræœ‰ä¸€ä¸ª<code>æ»å¤–äº¤æ˜“/æœªå®Œæˆäº‹ç‰©</code>(outstanding transaction)ã€‚å¦‚æœä»»ä½•masteræ¨¡å—èƒ½å¤Ÿå¤„ç†ä¸æ­¢ä¸€ä¸ªæ»å¤–äº¤æ˜“ï¼Œä»–éœ€è¦ä¸ºæ¯ä¸ªå®ƒèƒ½å¤„ç†çš„æ»å¤–äº¤æ˜“æä¾›ä¸€ç»„é¢å¤–çš„è¯·æ±‚å’Œæˆæƒä¿¡å·ã€‚åœ¨åè®®çº§åˆ«ä¸Šï¼Œå•ä¸ªæ¨¡å—å¯ä»¥ä½œä¸ºè®¸å¤šä¸åŒçš„masterå‡ºç°ï¼Œæ¯ä¸€ä¸ªmasteråªèƒ½æœ‰ä¸€ä¸ªæ»å¤–äº¤æ˜“ã€‚</p><p>â“ä½†æ˜¯ï¼Œä¸€ä¸ªæœ‰èƒ½åŠ›å¤„ç†SPLITçš„slaveå¯èƒ½æ¥æ”¶æ¯”å®ƒæ‰€èƒ½å¹¶å‘å¤„ç†æ›´å¤šçš„ä¼ è¾“è¯·æ±‚ã€‚å¦‚æœè¿™ç§æƒ…å†µå‘ç”Ÿï¼Œslaveå‘é€SPLITå“åº”ï¼Œä½†æ²¡æœ‰è®°å½•ä¸ä¼ è¾“å¯¹åº”çš„åœ°å€å’Œæ§åˆ¶ä¿¡æ¯æ˜¯å¯æ¥å—çš„ï¼Œslaveåªæ˜¯å¿…é¡»è®°å½•masterçš„ç¼–å·ã€‚é€šè¿‡ä¸ºæ‰€æœ‰ä¹‹å‰æœ‰splitä¼ è¾“å…³è”çš„masterå£°æ˜HSPLITxä¸­åˆé€‚çš„ä½ï¼Œç„¶åslaveæŒ‡ç¤ºå®ƒå¯ä»¥å¤„ç†å¦ä¸€ä¸ªä¼ è¾“ï¼Œä½†æ˜¯slaveæ²¡æœ‰è®°å½•åœ°å€å’Œæ§åˆ¶ä¿¡æ¯ã€‚</p><p>ç„¶åä»²è£å™¨èƒ½å¤Ÿé‡æ–°æˆæƒmasterè®¿é—®ï¼Œå®ƒä»¬ä¹Ÿå°±èƒ½å¤Ÿé‡æ–°å°è¯•ä¼ è¾“ï¼Œç»™äºˆslaveæ‰€è¦æ±‚çš„åœ°å€å’Œæ§åˆ¶ä¿¡æ¯ã€‚è¿™æ„å¤–ç€masteråœ¨å®ƒæœ€ç»ˆè¢«å…è®¸å®Œæˆå®ƒè¯·æ±‚çš„ä¼ è¾“å‰éœ€è¦è¢«æˆæƒè®¸å¤šæ—¶é—´(a number of time)ã€‚</p></blockquote><h2 id="11-3-preventing-deadlock"><a href="#11-3-preventing-deadlock" class="headerlink" title="11.3 preventing deadlock"></a>11.3 preventing deadlock</h2><blockquote><p>SPLITå’ŒRETRYå“åº”ä½¿ç”¨æ—¶ä¸€å®šè¦é¿å…æ­»é”ã€‚å•ä¸ªä¼ è¾“ä¸å¯èƒ½é”ä½AHB,å› ä¸ºæ¯ä¸ªslaveä¸€å®šè¢«æŒ‡æ´¾åœ¨é¢„å…ˆè§„å®šçš„å‘¨æœŸå†…å»å®Œæˆä¼ è¾“ã€‚ä½†æ˜¯ï¼Œå¦‚æœå¤§é‡ä¸åŒçš„masterå°è¯•è®¿é—®åŒä¸€ä¸ªslaveï¼Œè¿™ä¸ªslaveä»¥ä¸èƒ½å¤„ç†çš„æ–¹å¼å‘å°„SPLITå’ŒRETRYå“åº”æ—¶å¯èƒ½å‘ç”Ÿæ­»é”ã€‚</p></blockquote><h3 id="11-3-1-Split"><a href="#11-3-1-Split" class="headerlink" title="11.3.1 Split"></a>11.3.1 Split</h3><blockquote><p>å¯¹äºèƒ½å¤Ÿå‘å°„splitå“åº”çš„slaveï¼Œæ€»çº¿æ­»é”é€šè¿‡ç¡®ä¿slaveèƒ½å¤Ÿç»å—å¾—ä½ç³»ç»Ÿä¸­æ¯ä¸ªmasterçš„è¯·æ±‚æ¥é¿å…(æœ€å¤š16ä¸ª)ã€‚slaveæ²¡å¿…è¦ä¿å­˜æ¯æ¬¡ä¼ è¾“çš„åœ°å€å’Œæ§åˆ¶ä¿¡æ¯ï¼Œå®ƒä»…ä»…éœ€è¦è®°å½•è¿™æ ·çš„äº‹å®ï¼šä¸€æ¬¡ä¼ è¾“è¯·æ±‚å·²ç»å‘å‡ºï¼Œå¹¶ä¸”ä¸€ä¸ªSPLITå“åº”ä¹Ÿå‘å‡ºã€‚æœ€ç»ˆæ‰€æœ‰çš„masteréƒ½å°†åœ¨ä¸€ä¸ªè¾ƒä½ä¼˜å…ˆçº§ï¼Œç„¶åslaveå¯ä»¥æœ‰åºåœ°å¤„ç†è¿™äº›è¯·æ±‚ï¼Œå‘ä»²è£å™¨æŒ‡ç¤ºå®ƒæ­£åœ¨å¤„ç†å“ªä¸ªè¯·æ±‚ï¼Œå› æ­¤ä¿è¯æ‰€æœ‰çš„è¯·æ±‚æœ€ç»ˆéƒ½è¢«å®Œæˆã€‚</p><p>å½“ä¸€ä¸ªslaveæœ‰è®¸å¤šæœªå®Œæˆçš„è¯·æ±‚ï¼Œå®ƒå¯ä»¥é€‰æ‹©ä»¥ä»»ä½•æ¬¡åºå»å¤„ç†å®ƒä»¬ï¼Œå°½ç®¡slaveä¸€å®šè¦æ³¨æ„<code>é”å®šçš„ä¼ è¾“</code>(locked transfer)å¿…é¡»åœ¨ä»»ä½•å…¶å®ƒä¼ è¾“å¯ä»¥ç»§ç»­ä¹‹å‰å®Œæˆã€‚</p><p>ç†æƒ³æƒ…å†µä¸‹ï¼Œmasterçš„æœªå®Œæˆä¼ è¾“é‡ä¸åº”è¯¥è¶…è¿‡å®ƒæ‰€èƒ½æ”¯æŒçš„ä¼ è¾“é‡ï¼Œä½†æ˜¯éœ€è¦è¿™ç§æœºåˆ¶æ¥é˜²æ­¢æ€»çº¿æ­»é”ã€‚</p></blockquote><h3 id="11-3-2-Retry"><a href="#11-3-2-Retry" class="headerlink" title="11.3.2 Retry"></a>11.3.2 Retry</h3><blockquote><p>å¯¹äºå‘é€<code>RETRY</code>å“åº”çš„slaveæ¯æ¬¡åªèƒ½ç”±ä¸€ä¸ªmasterè®¿é—®ã€‚è¿™ä¸æ˜¯ç”±æ€»çº¿çš„åè®®å¼ºåˆ¶æ‰§è¡Œçš„ï¼Œåº”è¯¥ç”±ç³»ç»Ÿä½“ç³»ç»“æ„ç¡®ä¿ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå‘é€RETRYå“åº”çš„slaveå¯èƒ½æ˜¯é‚£äº›ä¸€æ¬¡åªæœ‰ä¸€ä¸ªmasterè®¿é—®çš„å¤–å›´è®¾å¤‡ï¼Œæ‰€ä»¥èƒ½å¤Ÿè¢«æ›´é«˜çº§åˆ«åè®®ç¡®ä¿ã€‚</p><p>å¯¹å¤šmasterè®¿é—®RETRY slavesçš„ç¡¬ä»¶ä¿æŠ¤ä¸æ˜¯æœ¬åè®®çš„è¦æ±‚ï¼Œä½†å¯æŒ‰ä¸‹ä¸€æ®µæ‰€è¿°å®ç°ã€‚åœ¨æ€»çº¿çº§åˆ«ä¸Šï¼Œåªè¦æ±‚slaveä¸€å®šè¦åœ¨é¢„å®šæ•°é‡çš„æ—¶é’Ÿå‘¨æœŸå†…é©±åŠ¨HREADYåˆ°é«˜ç”µå¹³ã€‚</p></blockquote><p>å¦‚æœéœ€è¦ç¡¬ä»¶ä¿æŠ¤ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨RETRY slaveæœ¬èº«ä¸Šå®ç°ã€‚å½“ä¸€ä¸ªslaveå‘å°„ä¸€ä¸ªRETRYï¼Œå®ƒèƒ½é‡‡æ ·masterå·ç ã€‚åœ¨è¯¥æ—¶åˆ»å’Œä¼ è¾“æœ€ç»ˆè¢«å®Œæˆä¹‹é—´ï¼Œslaveæ£€æŸ¥æ¯ä¸ªä¼ è¾“å°è¯•ï¼Œä»¥ç¡®ä¿æ˜¯ç›¸åŒçš„masterå·ç ã€‚å¦‚æœå®ƒæ£€æµ‹åˆ°ä¸»ç¼–å·ä¸åŒï¼Œé‚£ä¹ˆå®ƒå¯ä»¥é‡‡å–å¦ä¸€ç§æ“ä½œè¿‡ç¨‹ï¼Œä¾‹å¦‚ï¼š</p><ul><li>ERRORå“åº”</li><li>å‘é€ä»²è£å™¨ä¸€ä¸ªä¿¡å·</li><li>ç³»ç»Ÿçº§åˆ«ä¸­æ–­(a system level interrupt)</li><li>ç³»ç»Ÿé‡ç½®(a complete system reset)</li></ul><h2 id="11-4-Bus-handover"><a href="#11-4-Bus-handover" class="headerlink" title="11.4 Bus handover"></a>11.4 Bus handover</h2><blockquote><p>åè®®è¦æ±‚masteråœ¨æ¥æ”¶åˆ†å‰²(split)æˆ–é‡è¯•(retry)å“åº”å,ç«‹å³æ‰§è¡Œä¸€æ¬¡IDLEä¼ è¾“å¥½è®©æ€»çº¿è¢«è½¬äº¤ç»™å¦ä¸€ä¸ªmasterã€‚</p><p><img src="https://image.beenli.cn/img/20201008/Xp2VmFI5Vsgp.png?imageslim" alt="mark"></p><ul><li>T1ä¹‹åä¼ è¾“çš„åœ°å€å‡ºç°åœ¨æ€»çº¿ä¸Šï¼›åœ¨T2å’ŒT3æ—¶é’Ÿæ²¿åslaveè¿”å›ä¸¤ä¸ªå‘¨æœŸSPLITå“åº”</li><li>ç¬¬ä¸€ä¸ªå“åº”å‘¨æœŸç»“æŸï¼ŒT3ï¼Œmasteræ£€æµ‹åˆ°ä¼ è¾“è¢«åˆ†å‰²(be SPLIT)æ‰€ä»¥å®ƒæ”¹å˜ä¸‹ä¸€æ¬¡ä¼ è¾“çš„æ§åˆ¶ä¿¡å·ä¸ºIDLEã€‚</li><li>åŒæ—¶åœ¨T3ï¼Œä»²è£å™¨é‡‡æ ·å“åº”ä¿¡å·å¹¶å‘ç°ä¼ è¾“å°†æ˜¯SPLITã€‚ç„¶åä»²è£å™¨èƒ½å¤Ÿè°ƒæ•´ä»²è£ä¼˜å…ˆçº§ï¼Œå¹¶ä¸”grantä¿¡å·åœ¨æ¥ä¸‹æ¥çš„ä¸€ä¸ªå‘¨æœŸå‘ç”Ÿæ”¹å˜ï¼Œä»¥è‡³äºæ–°çš„masterèƒ½å¤Ÿè¢«æˆæƒåœ°å€æ€»çº¿åœ¨T4ä¹‹åã€‚</li><li>â­æ–°masterè¢«ä¿è¯ç«‹åˆ»è®¿é—®ï¼Œå› ä¸ºIDLEä¼ è¾“æ€»æ˜¯åœ¨ä¸€ä¸ªå‘¨æœŸå®Œæˆã€‚</li></ul></blockquote><h1 id="12-Reset"><a href="#12-Reset" class="headerlink" title="12 Reset"></a>12 Reset</h1><blockquote><p><code>HRESETn</code>æ˜¯AHBæ–‡æ¡£ä¸­å”¯ä¸€çš„ä½ç”µå¹³æœ‰æ•ˆçš„ä¿¡å·ï¼Œå¹¶ä¸”æ˜¯æ‰€æœ‰æ€»çº¿å…ƒä»¶çš„ä¸»è¦å¤ä½ã€‚å¤ä½å¯å¼‚æ­¥å£°æ˜ï¼Œä½†æ˜¯åœ¨HCLKä¸Šå‡æ²¿ä¹‹ååŒæ­¥å¤±æ•ˆ(deasserted)ã€‚</p><p>åœ¨å¤ä½æœŸé—´ï¼Œæ‰€æœ‰masterç¡®ä¿åœ°å€å’Œæ§åˆ¶ä¿¡å·éƒ½åœ¨æœ‰æ•ˆçŠ¶æ€å¹¶ä¸”<code>HTRANS[1:0]</code>æŒ‡ç¤ºIDLEã€‚</p></blockquote><h1 id="13-Data-bus-width"><a href="#13-Data-bus-width" class="headerlink" title="13 Data bus width"></a>13 Data bus width</h1><blockquote><p>åœ¨ä¸æé«˜æ“ä½œé¢‘ç‡ä¸‹ï¼Œæé«˜æ€»çº¿å¸¦å®½çš„ä¸€ç§æ–¹æ³•æ˜¯æé«˜æ€»çº¿æ•°æ®é€šé“å®½åº¦ã€‚é‡‘å±å±‚çš„å¢åŠ å’Œå¤§ç‰‡å†…å­˜å‚¨å—çš„ä½¿ç”¨(ä¾‹å¦‚åµŒå…¥çš„DRAM)éƒ½æ˜¯é¼“åŠ±æ›´å®½æ€»çº¿çš„ä½¿ç”¨çš„é©±åŠ¨å› ç´ ã€‚</p><p>æŒ‡å®šä¸€ä¸ªå›ºå®šå®½åº¦çš„æ€»çº¿æ„å‘³ç€ï¼Œåœ¨è®¸å¤šæƒ…å†µä¸‹æ€»çº¿çš„å®½åº¦å¯¹äºåº”ç”¨ä¸æ˜¯æœ€ä¼˜çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é‡‡ç”¨çµæ´»çš„æ€»çº¿å®½åº¦ï¼Œä½†æ˜¯ä»»ç„¶ä¿è¯æ¨¡å—åœ¨è®¾è®¡ä¹‹é—´å…·æœ‰é«˜åº¦çš„å¯ç§»æ¤æ€§(highly portable)</p><p><a href="#size">AHBåè®®å…è®¸æ•°æ®æ€»çº¿ä¸º8ï¼Œ16ï¼Œ32ï¼Œ64ï¼Œ128ï¼Œ256ï¼Œ512æˆ–è€…1024bits</a>ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬æ¨èæœ€å°æ€»çº¿å®½åº¦ä¸º32bits,é¢„è®¡æœ€å¤§256bitså°†å¯¹ç»å¤§å¤šæ•°åº”ç”¨éƒ½æ˜¯è¶³å¤Ÿçš„ã€‚</p><p>å¯¹äºè¯»å’Œå†™ä¼ è¾“ï¼Œæ¥æ”¶æ¨¡å—å¿…é¡»ä»æ€»çº¿ä¸Šæ­£ç¡®çš„å­—èŠ‚é€šé“é€‰æ‹©æ•°æ®ã€‚ä¸éœ€è¦è·¨æ‰€æœ‰å­—èŠ‚é€šé“å¤åˆ¶æ•°æ®ã€‚</p></blockquote><h1 id="14-narrow-slave-on-wide-bus"><a href="#14-narrow-slave-on-wide-bus" class="headerlink" title="14 narrow slave on wide bus"></a>14 narrow slave on wide bus</h1><blockquote><p>ğŸ‘‡å›¾å±•ç¤ºäº†ä¸€ä¸ªåŸæœ¬è¢«è®¾è®¡æˆå¤„ç†32ä½æ•°æ®æ€»çº¿çš„slaveæ¨¡å—ï¼Œæ˜¯å¦‚ä½•è¢«è½»æ¾è½¬æ¢ä¸ºå¤„ç†64ä½æ€»çº¿ã€‚è¿™ä»…ä»…éœ€è¦é¢å¤–çš„å¤–éƒ¨é€»è¾‘ï¼Œè€Œä¸éœ€è¦ä»»ä½•å†…éƒ¨è®¾è®¡çš„æ”¹å˜ï¼Œå› æ­¤è¿™é¡¹æŠ€æœ¯ä¹Ÿå¯ä»¥è¢«ç”¨åˆ°ç¡¬å®å•å…ƒã€‚</p></blockquote><p><img src="https://image.beenli.cn/img/20201008/Lrfh7n73r7V5.png?imageslim" alt="mark"></p><p>å¯¹äºè¾“å‡ºï¼Œå½“è½¬åŒ–çª„çš„æ€»çº¿åˆ°ä¸€ä¸ªå®½çš„æ€»çº¿ï¼Œåšä¸‹é¢ä¸­çš„ä¸€æ¡ï¼š</p><ul><li>å°†æ•°æ®å¤åˆ¶åˆ°å®½æ€»çº¿çš„ä¸¤ä¸ªéƒ¨åˆ†(åƒğŸ‘†)</li><li>ä½¿ç”¨é¢å¤–å±‚æ¬¡é€»è¾‘ç¡®ä¿æ€»çº¿åªæœ‰åˆé€‚çš„åŠéƒ¨åˆ†æ”¹å˜ã€‚è¿™å¯ä»¥èŠ‚çº¦èƒ½è€—ã€‚</li></ul><h1 id="15-wide-slave-on-narrow-slave"><a href="#15-wide-slave-on-narrow-slave" class="headerlink" title="15 wide slave on narrow slave"></a>15 wide slave on narrow slave</h1><blockquote><p>ğŸ‘‡å›¾å±•ç¤ºäº†ä¸€ä¸ªå®½æ¥å£çš„slaveè¢«å®ç°åœ¨ä¸€ä¸ªçª„çš„æ€»çº¿ä¸Šã€‚</p></blockquote><p><img src="https://image.beenli.cn/img/20201008/YzRiClD91a4p.png?imageslim" alt="mark"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;The blog is derived from the translation of &lt;code&gt;ARM IHI 0011A&lt;/code&gt; AHB specification   Copyright Â© 1999 ARM Limited&lt;/p&gt;
</summary>
      
    
    
    
    <category term="RISC-V" scheme="https://www.beenli.cn/categories/RISC-V/"/>
    
    <category term="spec" scheme="https://www.beenli.cn/categories/RISC-V/spec/"/>
    
    
    <category term="specification" scheme="https://www.beenli.cn/tags/specification/"/>
    
  </entry>
  
  <entry>
    <title>12-hour clock using six BCD digits</title>
    <link href="https://www.beenli.cn/posts/8cc45ed0/"/>
    <id>https://www.beenli.cn/posts/8cc45ed0/</id>
    <published>2020-10-06T01:02:04.000Z</published>
    <updated>2020-10-06T03:32:55.882Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>problem linkï¼š<a href="https://hdlbits.01xz.net/wiki/Count_clock">https://hdlbits.01xz.net/wiki/Count_clock</a></p></blockquote><h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><blockquote><p>æ—¶é’Ÿæ˜¯æ¯ä¸ªäººæ¯å¤©éƒ½ä¼šç”¨åˆ°çš„å·¥å…·ï¼Œé‚£æ€ä¹ˆç”¨ç”µå­ç”µè·¯æ­å»ºä¸€ä¸ª12-hour(å¸¦æœ‰am/pmæŒ‡ç¤º)çš„æ—¶é’Ÿå‘¢ï¼Ÿ</p></blockquote><h2 id="Problem-description"><a href="#Problem-description" class="headerlink" title="Problem description"></a>Problem description</h2><blockquote><p><a name="reset">é€‰æ‹©ä¸€ç³»åˆ—åˆé€‚çš„è®¡æ•°å™¨</a>ã€‚ä½ çš„è®¡æ•°å™¨ç»Ÿä¸€è¢«å¿«æ—¶é’Ÿ(fast-running clock)é©±åŠ¨, è¿˜å¸¦æœ‰ä¸€ä¸ªè„‰å†²ä½¿èƒ½è¾“å…¥ï¼Œè¯¥è„‰å†²ä¼šåœ¨ä»»ä½•éœ€è¦æ—¶é’ŸåŠ 1çš„æ—¶å€™åˆ°æ¥ï¼ˆi.e.ï¼Œæ¯ç§’æ¥ä¸€æ¬¡)</p><ul><li><code>reset</code>ï¼šé‡ç½®æ—¶é’Ÿåˆ°12ï¼š00ï¼š00 AM</li><li><code>pm</code> is 0 for AM and 1 for PM</li><li><code>hh:mm:ss</code>ï¼šéƒ½å„è‡ªä»£è¡¨ä¸¤ä½BCD(ç”¨å››ä½äºŒè¿›åˆ¶è¡¨è¾¾ä¸€ä½åè¿›åˆ¶)æ•°ï¼›</li><li><code>hh</code>(hours)ï¼š01-12ï¼›<code>mm</code>(minutes)ï¼š00-59ï¼›<code>ss</code>(seconds)ï¼š00-59</li><li><code>reset</code>æ¯”<code>enable</code>æœ‰æ›´é«˜çš„æƒé™ï¼Œå³ä½¿åœ¨ä½¿èƒ½ä¿¡å·æ— æ•ˆçš„æ—¶å€™ä¹Ÿå¯ä»¥å€¼ä½ã€‚</li><li>ğŸ‘‡ï¼šä»11:59:59 AM åˆ°12:00:00 PMç¿»è½¬å’ŒåŒæ­¥å¤ä½ï¼Œä½¿èƒ½çš„è¡Œä¸ºã€‚</li></ul><p><img src="https://image.beenli.cn/img/20201006/8D0uEm3C0lTU.jpg?imageslim" alt="mark"></p></blockquote><p><font color="blue">Hint</font>ï¼šNote that <code>11:59:59 PM</code>(æ™šä¸Šè½¬é’Ÿ) advances to <code>12:00:00 AM</code>, and <code>12:59:59 PM</code>ï¼ˆä¸­åˆå¿«1ç‚¹äº†) advances to <code>01:00:00 PM</code>. There is no 00:00:00.</p><h2 id="Template"><a href="#Template" class="headerlink" title="Template"></a>Template</h2><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">// Module Declaration</span><br><span class="hljs-keyword">module</span> top_module(<br>    <span class="hljs-keyword">input</span> clk,<br>    <span class="hljs-keyword">input</span> reset,<br>    <span class="hljs-keyword">input</span> ena,<br>    <span class="hljs-keyword">output</span> pm,<br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] hh,<br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] mm,<br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] ss); <br>   <br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></tbody></table></figure><h2 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h2><h3 id="â‘ -1ä½BCDè®¡æ•°å™¨"><a href="#â‘ -1ä½BCDè®¡æ•°å™¨" class="headerlink" title="â‘  1ä½BCDè®¡æ•°å™¨"></a>â‘  1ä½BCDè®¡æ•°å™¨</h3><blockquote><ol><li><p>å¤ä½åˆ°0ï¼šä¸ºåˆ†é’Ÿï¼Œç§’è®¡æ•°å™¨æœåŠ¡</p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">/************** 1ä½BCDè®¡æ•°å™¨,å¤ä½åˆ°0;å®ç°0-9çš„å¾ªç¯ ***************/</span><br><span class="hljs-keyword">module</span> bcdreset0 (<br>    <span class="hljs-keyword">input</span> clk,<br>    <span class="hljs-keyword">input</span> reset,        <span class="hljs-comment">// Synchronous active-high reset</span><br>    <span class="hljs-keyword">input</span> enable,<br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] q);<br>    <span class="hljs-keyword">always</span> @ (<span class="hljs-keyword">posedge</span> clk) <span class="hljs-keyword">begin</span><br>        <span class="hljs-keyword">if</span>(reset) q &lt;= <span class="hljs-number">4'h0</span>;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(!enable) q &lt;= q;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(q == <span class="hljs-number">4'h9</span>) q &lt;= <span class="hljs-number">4'h0</span>;<br>        <span class="hljs-keyword">else</span> q &lt;= q + <span class="hljs-number">4'h1</span>;<br>    <span class="hljs-keyword">end</span><br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></tbody></table></figure></li><li><p>å¤ä½åˆ°2ï¼š<a href="#reset">ä¸ºå°æ—¶ä½ä½æœåŠ¡(x-&gt;2)</a>[â­æ­¤å¤„æœ‰ç‰¹æ®Šæƒ…å†µ]</p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">/************************* 1ä½BCDè®¡æ•°å™¨ï¼Œå¤ä½åˆ°2ï¼›å®ç°0-9çš„å¾ªç¯ *************************/</span><br><span class="hljs-comment">/************** ä¸ªä½ä¸º2æ—¶ï¼šå½“é«˜ä½ä¸º1ï¼Œä¸‹ä¸€æ¬¡åº”è¯¥æ˜¯1ï¼›ä½†æ˜¯å½“é«˜ä½ä¸º0ï¼Œä¸‹ä¸€æ¬¡ä¸º3 **************/</span><br><span class="hljs-keyword">module</span> bcdreset2 (<br>    <span class="hljs-keyword">input</span> clk,<br>    <span class="hljs-keyword">input</span> reset,        <span class="hljs-comment">// Synchronous active-high reset</span><br>    <span class="hljs-keyword">input</span> flag,<span class="hljs-comment">// æŒ‡ç¤ºå½“å‰ä¸ºç‰¹æ®Šæƒ…å†µï¼Œå³ä¸º12çš„æ—¶å€™</span><br>    <span class="hljs-keyword">input</span> enable,<br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] q);<br>    <span class="hljs-keyword">always</span> @ (<span class="hljs-keyword">posedge</span> clk) <span class="hljs-keyword">begin</span><br>        <span class="hljs-keyword">if</span>(reset) q &lt;= <span class="hljs-number">4'h2</span>;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(!enable) q &lt;= q;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(flag) q &lt;= <span class="hljs-number">4'h1</span>;<span class="hljs-comment">// ç‰¹æ®Šæƒ…å†µ</span><br> <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(q == <span class="hljs-number">4'h9</span>) q &lt;= <span class="hljs-number">4'h0</span>;<br>       <span class="hljs-keyword">else</span> q &lt;= q + <span class="hljs-number">4'h1</span>;<br>    <span class="hljs-keyword">end</span><br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></tbody></table></figure></li><li><p>å¤ä½åˆ°1ï¼š<a href="#reset">ä¸ºå°æ—¶é«˜ä½æœåŠ¡(x-&gt;1)</a>[â­æ­¤å¤„æœ‰ç‰¹æ®Šæƒ…å†µ]</p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">/*********** 1ä½BCDè®¡æ•°å™¨ï¼Œå¤ä½åˆ°2ï¼›å®ç°0-1çš„å¾ªç¯ *************/</span><br><span class="hljs-comment">/*********** æ¯æ¬¡ä½¿èƒ½åˆ°æ¥ï¼Œå°æ—¶é«˜ä½è¦ä¹ˆä»0-&gt;1ï¼›è¦ä¹ˆä»1-&gt;0;é€»è¾‘å¯¹åº”ä»£ç ç¬¬11è¡Œ***********/</span><br><span class="hljs-keyword">module</span> bcd_zero_one(<br>    <span class="hljs-keyword">input</span> clk,<br>    <span class="hljs-keyword">input</span> reset,<br>    <span class="hljs-keyword">input</span> enable,<br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] q);<br>    <span class="hljs-keyword">always</span> @ (<span class="hljs-keyword">posedge</span> clk) <span class="hljs-keyword">begin</span><br>        <span class="hljs-keyword">if</span> (reset) q &lt;= <span class="hljs-number">4'h1</span>;   <span class="hljs-comment">// (å¤ä½ä¸º12ï¼› é«˜ä½ä¸º1ï¼‰</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!enable) q &lt;= q;<br>        <span class="hljs-keyword">else</span> q[<span class="hljs-number">0</span>] &lt;= ~q[<span class="hljs-number">0</span>]; <span class="hljs-comment">// 0å˜ä¸º1ï¼Œ1å˜ä¸º0(0000-&gt;0001)</span><br>    <span class="hljs-keyword">end</span><br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></tbody></table></figure><h3 id="â‘¡-ä¸¤ä½BCDè®¡æ•°å™¨"><a href="#â‘¡-ä¸¤ä½BCDè®¡æ•°å™¨" class="headerlink" title="â‘¡ ä¸¤ä½BCDè®¡æ•°å™¨"></a>â‘¡ ä¸¤ä½BCDè®¡æ•°å™¨</h3></li><li><p>ç§’ï¼Œåˆ†é’Ÿè®¡æ•°å™¨ï¼šå®ç°0-59å¾ªç¯ï¼›å¤ä½ä¸º0</p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">/**************** ä¸¤ä½BCD(8-bit)æ•°è¡¨ç¤º0-59 ;å¾ªç¯åˆ°59æ—¶èƒ½ä¸èƒ½ä¸‹ä¸€ä¸ªè®¡æ•°åˆ°0 **************/</span><br><span class="hljs-keyword">module</span> zero2fifty_nine(<br>    <span class="hljs-keyword">input</span> clk,<br>    <span class="hljs-keyword">input</span> reset,<br>    <span class="hljs-keyword">input</span> ena,<br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] ss);<br>    <span class="hljs-keyword">wire</span> ena_ten, reset_ten;<br>    <span class="hljs-keyword">assign</span> reset_ten = (((ss == <span class="hljs-number">8'h59</span>) &amp; ena) | reset)? <span class="hljs-number">1'd1</span>:<span class="hljs-number">1'd0</span>;â­<span class="hljs-comment">// å½“è®¡æ•°åˆ°59ä¸”ä¸‹ä¸€ä¸ªä½¿èƒ½åˆ°æ¥æ—¶ï¼ŒæŠŠé«˜ä½ç½®ä¸ºåˆ°0ï¼›å› ä¸ºä½ä½è‚¯å®šå›åˆ°0;å¦‚æœä¸resetï¼Œé‚£ä¹ˆè‚¯å®šä¸º60</span><br>    <span class="hljs-keyword">assign</span> ena_ten = ((ss[<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] == <span class="hljs-number">4'h9</span>) &amp; ena)?<span class="hljs-number">1'd1</span>:<span class="hljs-number">1'd0</span>;â­    <span class="hljs-comment">// ä¸ªä½åˆ°9(é‡ç‚¹:å¿…é¡»ä½¿èƒ½åˆ°æ¥)æ‰èƒ½ä½¿èƒ½åä½(å‡è®¾ç°åœ¨ä¸º29åˆ†:00ç§’,åˆ†é’Ÿçš„åä½ä½¿èƒ½å¿…é¡»åœ¨60såæ‰ä¼šåˆ°æ¥;ä½†æ˜¯ä¸å¹¶ä¸Šä½¿èƒ½,é‚£ä¹ˆä¸‹ä¸€ç§’å°†æ˜¯39åˆ†:01ç§’</span><br>    decade_counter one (clk, reset, ena, ss[<span class="hljs-number">3</span>:<span class="hljs-number">0</span>]);<span class="hljs-comment">// 4ä½äºŒè¿›åˆ¶è¡¨ç¤ºä¸ªä½çš„0-9</span><br>    decade_counter ten (clk, reset_ten, ena_ten, ss[<span class="hljs-number">7</span>:<span class="hljs-number">4</span>]);<span class="hljs-comment">// 4ä½äºŒè¿›åˆ¶è¡¨ç¤ºåä½çš„0-9</span><br><span class="hljs-keyword">endmodule</span>    <br><br></code></pre></td></tr></tbody></table></figure></li><li><p>å°æ—¶è®¡æ•°å™¨ï¼šå®ç°1-12å¾ªç¯ï¼Œå¤ä½ä¸º12</p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">/************* ä¸¤ä½BCD(8-bit)æ•°è¡¨ç¤º1-12;å¾ªç¯åˆ°12æ—¶èƒ½ä¸èƒ½ä¸‹ä¸€ä¸ªè®¡æ•°åˆ°1 ***************/</span><br><span class="hljs-comment">/* â­(flag12) å°æ—¶ä¸ªä½ä¸º2æ—¶ï¼šå½“é«˜ä½ä¸º1(12)ï¼Œä¸‹ä¸€æ¬¡åº”è¯¥æ˜¯1ï¼›ä½†æ˜¯å½“é«˜ä½ä¸º0(02)ï¼Œä¸‹ä¸€æ¬¡ä¸º3  */</span><br><span class="hljs-keyword">module</span> one2twelve(<br>    <span class="hljs-keyword">input</span> clk,<br>    <span class="hljs-keyword">input</span> reset,<br>    <span class="hljs-keyword">input</span> ena,<br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] hh);<br>    <span class="hljs-keyword">wire</span> ena_ten, flag12;<br>    <span class="hljs-keyword">assign</span> ena_ten = (ena &amp; ((hh == <span class="hljs-number">8'h9</span>)|(hh == <span class="hljs-number">8'h12</span>)))? <span class="hljs-number">1'd1</span>:<span class="hljs-number">1'd0</span>;<span class="hljs-comment">// å°æ—¶é«˜ä½çš„æ”¹å˜ä¿¡å·(09-&gt;10;12-&gt;01)</span><br>    <span class="hljs-keyword">assign</span> flag12 = (hh == <span class="hljs-number">8'h12</span>);<span class="hljs-comment">// æŒ‡ç¤ºå½“å‰ä¸º12</span><br>    BCDreset2 one (clk, reset, flag12, ena, hh[<span class="hljs-number">3</span>:<span class="hljs-number">0</span>]);<span class="hljs-comment">// 4ä½äºŒè¿›åˆ¶è¡¨ç¤ºä¸ªä½çš„0-9</span><br>    BCDzero_one ten (clk, reset, ena_ten, hh[<span class="hljs-number">7</span>:<span class="hljs-number">4</span>]); <span class="hljs-comment">// 4ä½äºŒè¿›åˆ¶è¡¨ç¤ºåä½çš„0-1</span><br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></tbody></table></figure><h3 id="â‘¢-å®ä¾‹åŒ–ä¸‰ä¸ªâ‘¡"><a href="#â‘¢-å®ä¾‹åŒ–ä¸‰ä¸ªâ‘¡" class="headerlink" title="â‘¢ å®ä¾‹åŒ–ä¸‰ä¸ªâ‘¡"></a>â‘¢ å®ä¾‹åŒ–ä¸‰ä¸ªâ‘¡</h3></li></ol></blockquote><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">module</span> top_module(<br>    <span class="hljs-keyword">input</span> clk,<br>    <span class="hljs-keyword">input</span> reset,<br>    <span class="hljs-keyword">input</span> ena,<br>    <span class="hljs-keyword">output</span> pm,<br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] hh,<br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] mm,<br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] ss); <br><span class="hljs-keyword">wire</span> ena_hr, ena_min, ena_pm;<br>    one2twelve hour (clk, reset, ena_hr, hh);<br>    zero2fifty_nine minite(clk, reset, ena_min, mm);<br>    zero2fifty_nine second(clk, reset, ena, ss);<br>    <span class="hljs-keyword">assign</span> ena_min = (ss==<span class="hljs-number">8'h59</span>)?<span class="hljs-number">1'd1</span>:<span class="hljs-number">1'd0</span>;<span class="hljs-comment">// å½“59sæ—¶æ‰ä½¿èƒ½åˆ†é’Ÿè®¡æ•°å™¨;</span><br>    <span class="hljs-keyword">assign</span> ena_hr = ((mm == <span class="hljs-number">8'h59</span>) &amp; (ss == <span class="hljs-number">8'h59</span>))? <span class="hljs-number">1'd1</span>: <span class="hljs-number">1'd0</span>;<span class="hljs-comment">// å½“59åˆ†59sæ‰ä½¿èƒ½å°æ—¶è®¡æ•°å™¨</span><br>    <span class="hljs-keyword">assign</span> ena_pm = ena_hr &amp; (hh == <span class="hljs-number">8'h11</span>);  <span class="hljs-comment">// å½“11æ—¶59åˆ†59sæ‰èƒ½æ”¹å˜pmâ­</span><br>    <span class="hljs-keyword">always</span> @ (<span class="hljs-keyword">posedge</span> clk) <span class="hljs-keyword">begin</span><br>        <span class="hljs-keyword">if</span> (reset) pm &lt;= <span class="hljs-number">1'd0</span>;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(ena_pm) pm &lt;= ~pm;   <span class="hljs-comment">// æ¯å½“æ—¶é’Ÿè½¬åˆ°11:59:59pméƒ½ä¼šå˜æ¢ä¸€æ¬¡</span><br>        <span class="hljs-keyword">else</span> pm &lt;= pm;<br>    <span class="hljs-keyword">end</span><br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></tbody></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;problem linkï¼š&lt;a href=&quot;https://hdlbits.01xz.net/wiki/Count_clock&quot;&gt;https://hdlbits.01xz.net/wiki/Count_clock&lt;/a&gt;&lt;/p&gt;
&lt;/blockqu</summary>
      
    
    
    
    <category term="Digital IC" scheme="https://www.beenli.cn/categories/Digital-IC/"/>
    
    <category term="HDL Bits" scheme="https://www.beenli.cn/categories/Digital-IC/HDL-Bits/"/>
    
    
    <category term="circuits" scheme="https://www.beenli.cn/tags/circuits/"/>
    
  </entry>
  
  <entry>
    <title>From 1000Hz clock to 1Hz--OneHertz</title>
    <link href="https://www.beenli.cn/posts/8cdff568/"/>
    <id>https://www.beenli.cn/posts/8cdff568/</id>
    <published>2020-10-03T06:47:49.000Z</published>
    <updated>2020-10-06T01:20:58.342Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>problem linkï¼š<a href="https://hdlbits.01xz.net/wiki/Exams/ece241_2014_q7b">https://hdlbits.01xz.net/wiki/Exams/ece241_2014_q7b</a></p></blockquote><h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><blockquote><p>ä»é¢‘ç‡ä¸º1000Hzçš„æ—¶é’Ÿä¸­å¾—åˆ°é¢‘ç‡ä¸º1Hzçš„ä¿¡å·(<code>OneHertz</code>)ï¼Œå®ƒç”¨æ¥é©±åŠ¨ä¸€ç³»åˆ—æ—¶/åˆ†/ç§’è®¡æ•°å™¨çš„ä½¿èƒ½ä¿¡å·(Enable signal)ä»¥æ­¤åˆ›å»ºä¸€ä¸ªæ•°å­—æ—¶é’Ÿå¢™(digital wall clock)ã€‚å› ä¸ºéœ€è¦æ—¶é’Ÿæ¯ç§’è®¡æ•°ä¸€æ¬¡ï¼ŒOneHertzä¿¡å·å¿…é¡»æ¯ç§’å‡†ç¡®åœ°æ–­è¨€ä¸€ä¸ªå‘¨æœŸ(å‘¨æœŸä¸º1ç§’ï¼Œä¸”æ¯å‘¨æœŸåªèƒ½ç¿»è½¬ä¸€æ¬¡)ã€‚</p></blockquote><h2 id="Problem-Description"><a href="#Problem-Description" class="headerlink" title="Problem Description"></a>Problem Description</h2><blockquote><p>ç”¨BCDè®¡æ•°å™¨å’Œå°‘è®¸å…¶å®ƒçš„é—¨æ„å»º<code>åˆ†é¢‘å™¨</code>(frequency divider)ã€‚å¹¶ä¸”è¾“å‡ºä½ æ‰€ä½¿ç”¨çš„BCDè®¡æ•°å™¨çš„ä½¿èƒ½ä¿¡å·ã€‚(c_enable[0] for the fastest counter, c_enable[2] for the slowest)</p><p>å¦‚ä¸‹çš„BCDè®¡æ•°å™¨å·²ç»æä¾›ç»™ä½ ï¼Œ<code>Enable</code>ä¸ºé«˜ç”µå¹³è®¡æ•°å™¨æ‰èƒ½æ­£å¸¸å·¥ä½œï¼Œ<code>Reset</code>ä¸ºåŒæ­¥é«˜ç”µå¹³ç½®ä½0ï¼›<br></p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">module</span> bcdcount (<br><span class="hljs-keyword">input</span> clk,<br><span class="hljs-keyword">input</span> reset,<br><span class="hljs-keyword">input</span> enable,<br><span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] Q<br>);<br></code></pre></td></tr></tbody></table></figure><br>ä½ è®¾è®¡çš„ç”µè·¯ä¸­æ‰€æœ‰çš„è®¡æ•°å™¨å¿…é¡»ç›´æ¥ä½¿ç”¨ç›¸åŒçš„1000Hzæ—¶é’Ÿä¿¡å·ã€‚<p></p></blockquote><h2 id="Template"><a href="#Template" class="headerlink" title="Template"></a>Template</h2><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">module</span> top_module (<br>    <span class="hljs-keyword">input</span> clk,<br>    <span class="hljs-keyword">input</span> reset,<br>    <span class="hljs-keyword">output</span> OneHertz,<br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">2</span>:<span class="hljs-number">0</span>] c_enable<br>); <br>    <br></code></pre></td></tr></tbody></table></figure><h2 id="First-Try"><a href="#First-Try" class="headerlink" title="First Try"></a>First Try</h2><h3 id="answer"><a href="#answer" class="headerlink" title="answer"></a>answer</h3><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">module</span> top_module (<br>    <span class="hljs-keyword">input</span> clk,<br>    <span class="hljs-keyword">input</span> reset,<br>    <span class="hljs-keyword">output</span> OneHertz,<br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">2</span>:<span class="hljs-number">0</span>] c_enable<br>); <br>    <span class="hljs-keyword">reg</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] Q0,Q1,Q2;<br>    <span class="hljs-comment">/************ BCDåè¿›åˆ¶,å½“Q=1001æ—¶ä½¿èƒ½--&gt;åå€é¢‘ ***************/</span><br>    <span class="hljs-keyword">assign</span> c_enable[<span class="hljs-number">0</span>] = <span class="hljs-number">1'b1</span>;<span class="hljs-comment">// è®©ç¬¬ä¸€ä¸ªè®¡æ•°å™¨å…¨é€Ÿè®¡æ•°</span><br>    <span class="hljs-keyword">assign</span> c_enable[<span class="hljs-number">1</span>] = Q0[<span class="hljs-number">3</span>] &amp; Q0[<span class="hljs-number">0</span>];<span class="hljs-comment">// ç¬¬äºŒè®¡æ•°å™¨è®¡æ•°å‘¨æœŸæ˜¯ç¬¬ä¸€ä¸ªçš„10å€</span><br>    <span class="hljs-keyword">assign</span> c_enable[<span class="hljs-number">2</span>] = Q1[<span class="hljs-number">3</span>] &amp; Q1[<span class="hljs-number">0</span>]; <span class="hljs-comment">// ç¬¬äºŒè®¡æ•°å™¨è®¡æ•°å‘¨æœŸæ˜¯ç¬¬äºŒä¸ªçš„10å€</span><br>    <span class="hljs-keyword">assign</span> OneHertz = Q2[<span class="hljs-number">3</span>] &amp; Q2[<span class="hljs-number">0</span>];<br>    bcdcount counter0 (clk, reset, c_enable[<span class="hljs-number">0</span>], Q0); <br>    bcdcount counter1 (clk, reset, c_enable[<span class="hljs-number">1</span>], Q1);<br>    bcdcount counter2 (clk, reset, c_enable[<span class="hljs-number">2</span>], Q2);<br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></tbody></table></figure><h3 id="resultâŒ"><a href="#resultâŒ" class="headerlink" title="resultâŒ"></a>resultâŒ</h3><p><img src="https://image.beenli.cn/img/20201003/WrnmNC6Ae30I.jpg?imageslim" alt="mark"></p><center>åœ¨è®¡æ•°0-10çš„æ—¶å€™æ˜¯æ­£ç¡®çš„</center><p><img src="https://image.beenli.cn/img/20201003/BBvSVnJpwakc.jpg?imageslim" alt="mark"></p><ul><li><p>åœ¨è®¡æ•°90-99çš„æ—¶å€™: c_enable[2]æœ¬è¯¥ä¸º0å´å˜ä¸ºäº†1ï¼Œå¯¼è‡´è¾“å‡ºc_enable=5=3â€™b101;</p></li><li><p>ç”±äºc_enable[2]=Q1[3] &amp; Q1[0]ï¼Œèµ·åˆæˆ‘è®¤ä¸ºæ˜¯Q1æœ‰é—®é¢˜ï¼›åç»­ç”»å‡ºå¦‚ä¸‹è‰å›¾å‘ç°è¿˜æ˜¯c_enableæœ‰é—®é¢˜</p><p><img src="https://image.beenli.cn/img/20201003/Fzbw4O8G94sC.jpg?imageslim" alt="mark"></p></li></ul><ul><li>ç”±äºQ1æ˜¯ç”±è®¡æ•°å™¨ç”Ÿæˆçš„ï¼Œåªè¦ä½¿èƒ½ä¿¡å·æ²¡é—®é¢˜ï¼Œé‚£ä¹ˆå®ƒå°±è¿˜ğŸ†—</li><li>åˆç”±äºä½¿èƒ½ä¿¡å·1å’Œ2æ˜¯æˆ‘ä»¬å®šä¹‰ï¼Œæ‰€ä»¥ä»è¿™é‡Œä¸‹æ‰‹è§£å†³é—®é¢˜æ¯”è¾ƒæ–¹ä¾¿ï¼›</li><li>ç”±ä¸Šå›¾çŸ¥ä½¿èƒ½ä¿¡å·2æœ‰é—®é¢˜ï¼Œå®ƒåœ¨è®¡æ•°90-99æœŸé—´ä¸€ç›´ä¸ºé«˜ç”µå¹³ï¼Œæˆ‘ä»¬åªå¸Œæœ›å…¶åœ¨99æ—¶ä¸ºé«˜ç”µå¹³ã€‚</li><li>æ‰€æœ‰ä¿®æ”¹ä½¿èƒ½2çš„èµ‹å€¼ï¼šc_enable[2] = Q1[3] &amp; Q1[0] <code>&amp; c_enable[1]</code></li><li>åŒç†æˆ‘ä»¬ä¹Ÿè¦ä¿®æ”¹OneHertz = Q2[3] &amp; Q2[0] &amp; <code>c_enable[2]</code>;ï¼Œè®©å…¶åªåœ¨999æ—¶æ‰æœ‰æ•ˆï¼›å¦åˆ™å…¶åœ¨900-999ä¸€ç›´æœ‰æ•ˆï¼›</li></ul><h2 id="Final-answer"><a href="#Final-answer" class="headerlink" title="Final answer"></a>Final answer</h2><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">module</span> top_module (<br>    <span class="hljs-keyword">input</span> clk,<br>    <span class="hljs-keyword">input</span> reset,<br>    <span class="hljs-keyword">output</span> OneHertz,<br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">2</span>:<span class="hljs-number">0</span>] c_enable<br>); <span class="hljs-comment">//</span><br>    <span class="hljs-keyword">reg</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] Q0,Q1,Q2;<br>    <span class="hljs-keyword">assign</span> c_enable[<span class="hljs-number">0</span>] = <span class="hljs-number">1'b1</span>;<br>    <span class="hljs-keyword">assign</span> c_enable[<span class="hljs-number">1</span>] = Q0[<span class="hljs-number">3</span>] &amp; Q0[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">assign</span> c_enable[<span class="hljs-number">2</span>] = Q1[<span class="hljs-number">3</span>] &amp; Q1[<span class="hljs-number">0</span>] &amp; c_enable[<span class="hljs-number">1</span>]; <br>    <span class="hljs-keyword">assign</span> OneHertz = Q2[<span class="hljs-number">3</span>] &amp; Q2[<span class="hljs-number">0</span>] &amp; c_enable[<span class="hljs-number">2</span>];<br>    bcdcount counter0 (clk, reset, c_enable[<span class="hljs-number">0</span>], Q0); <br>    bcdcount counter1 (clk, reset, c_enable[<span class="hljs-number">1</span>], Q1);<br>    bcdcount counter2 (clk, reset, c_enable[<span class="hljs-number">2</span>], Q2);<br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></tbody></table></figure><h2 id="Advanced-problem-â“"><a href="#Advanced-problem-â“" class="headerlink" title="Advanced problem(â“)"></a>Advanced problem(â“)</h2><p>â­å¦‚ä½•å®ç°<code>50%</code>(xx%)å ç©ºæ¯”çš„10(xx)å€é¢‘ç”µè·¯</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;problem linkï¼š&lt;a href=&quot;https://hdlbits.01xz.net/wiki/Exams/ece241_2014_q7b&quot;&gt;https://hdlbits.01xz.net/wiki/Exams/ece241_2014_q</summary>
      
    
    
    
    <category term="Digital IC" scheme="https://www.beenli.cn/categories/Digital-IC/"/>
    
    <category term="HDL Bits" scheme="https://www.beenli.cn/categories/Digital-IC/HDL-Bits/"/>
    
    
    <category term="circuits" scheme="https://www.beenli.cn/tags/circuits/"/>
    
  </entry>
  
  <entry>
    <title>Unprivileged Spec(1)--RV32I</title>
    <link href="https://www.beenli.cn/posts/6c2bdcd1/"/>
    <id>https://www.beenli.cn/posts/6c2bdcd1/</id>
    <published>2020-09-30T01:01:08.000Z</published>
    <updated>2020-09-30T12:18:10.086Z</updated>
    
    <content type="html"><![CDATA[<center>RV32I Base Integer Instruction Set</center><h1 id="1-Preface"><a href="#1-Preface" class="headerlink" title="1 Preface"></a>1 Preface</h1><blockquote><ul><li>RV32Iæ˜¯ä¸ºäº†è¶³å¤Ÿæˆä¸ºç¼–è¯‘å™¨ç›®æ ‡å¹¶èƒ½æ”¯æŒç°ä»£æ“ä½œç³»ç»Ÿç¯å¢ƒè€Œè®¾è®¡çš„ä¸€ä¸ªåŸºæœ¬æ•´æ•°æŒ‡ä»¤é›†ã€‚å®ƒä¹Ÿä¸ºäº†å‡å°‘ç¡¬ä»¶å®ç°çš„æœ€å°éœ€æ±‚è€Œè®¾è®¡ã€‚RV32IåŒ…å«40ä¸ªç‹¬ç«‹çš„æŒ‡ä»¤ï¼Œå°½ç®¡ä¸€äº›ç®€å•çš„å®ç°å¯èƒ½ç”¨å•ä¸€çš„ç³»ç»Ÿç¡¬ä»¶æŒ‡ä»¤ï¼ˆa single <a href="#system">SYSTEM hardware instruction</a>)ä»£æ›¿ECALL/EBREAKæŒ‡ä»¤ï¼Œå®ƒæ€»æ˜¯æ•è·å¼‚å¸¸(always traps)å¹¶ä¸”å¯èƒ½å°†FENCEæŒ‡ä»¤å®ç°ä¸ºNOPï¼Œä»¥å‡å°‘æŒ‡ä»¤æ•°åˆ°38ä¸ªã€‚RV32Ièƒ½å¤Ÿæ¨¡æ‹Ÿå‡ ä¹ä»»ä½•çš„ISAæ‰©å±•ï¼ˆé™¤äº†Aæ‰©å±•ï¼Œå®ƒéœ€è¦é¢å¤–ç¡¬ä»¶æ”¯æŒåŸå­æ“ä½œ(atomicityï¼‰</li></ul><ul><li>åœ¨å®è·µä¸­ï¼ŒåŒ…å«æœºå™¨æ¨¡å¼ç‰¹æƒæ¶æ„çš„ç¡¬ä»¶å®ç°å°†éœ€è¦9ä¸ªCSRæŒ‡ä»¤ã€‚</li></ul><ul><li>åŸºæœ¬æ•´æ•°æŒ‡ä»¤é›†çš„å­é›†ä¹Ÿè®¸å¯¹äºæ•™å­¦ç›®çš„å¾ˆæœ‰ç”¨(pedagogical purposes), ä½†æ˜¯åŸºç¡€å·²ç»è¢«å®šä¹‰ï¼Œå¯¹å®ç°å…¶å­é›†çš„çœŸæ­£çš„ç¡¬ä»¶é™¤äº†å¿½ç•¥éå¯¹é½å†…å­˜è®¿é—®å¹¶æŠŠæ‰€æœ‰çš„SYSTEM instructionè§†ä¸ºå•ä¸€çš„å¼‚å¸¸(single trap)ï¼Œæˆ‘ä»¬ä¸åº”è¯¥æœ‰ä»€ä¹ˆå…¶å®ƒçš„åŠ¨æœºã€‚</li></ul><hr><p>å…³äºRV32Içš„å¤§å¤šæ³¨é‡Šä¹Ÿé€‚ç”¨äºRV64I baseã€‚</p></blockquote><h1 id="2-Programmerâ€™s-Model"><a href="#2-Programmerâ€™s-Model" class="headerlink" title="2 Programmerâ€™s Model"></a>2 Programmerâ€™s Model</h1><blockquote><p>å¯¹äºRV32Iéç‰¹æƒçŠ¶æ€ä¸€å…±æœ‰32ä¸ªå¯„å­˜å™¨(éƒ½æ˜¯32ä½å®½ï¼Œi.e. ,XLEN=32)ï¼š<code>x0~x31</code>;x0è¢«ç¡¬ç¼–ç åˆ°0ã€‚å¦å¤–31ä¸ªå¯„å­˜å™¨ä¿å­˜çš„å€¼å¯ä»¥è¢«è§£é‡Šä¸ºï¼šâ… ã€å¸ƒå°”å€¼çš„é›†åˆï¼Œâ…¡ã€è¡¥ç çš„æœ‰ç¬¦å·äºŒè¿›åˆ¶æ•´æ•°ï¼Œâ…¢ã€æ— ç¬¦å·äºŒè¿›åˆ¶æ•´æ•°</p><p>æœ‰ä¸€ä¸ªé¢å¤–çš„éç‰¹æƒå¯„å­˜å™¨ï¼Œ<code>pc</code>(program counter)ï¼šä¿å­˜å½“å‰æŒ‡ä»¤çš„åœ°å€</p></blockquote><ul><li>åœ¨Base Integer ISAä¸­ï¼Œæ²¡æœ‰æŒ‡å®šçš„æ ˆæŒ‡é’ˆæˆ–è€…å­ä¾‹ç¨‹è¿”å›åœ°å€é“¾æ¥å¯„å­˜å™¨(link register)ï¼›æŒ‡ä»¤ç¼–ç å…è®¸ä»»ä½•å¯„å­˜å™¨è¢«ç”¨äºè¿™ä¸ªç›®çš„ï¼›ä½†æ˜¯ï¼Œæ ‡å‡†è½¯ä»¶è°ƒç”¨æƒ¯ä¾‹(calling convention)ä½¿ç”¨å¯„å­˜å™¨<code>x1</code>ä¿å­˜è°ƒç”¨çš„è¿”å›åœ°å€ï¼Œ<code>x5</code>ä½œä¸ºå¤‡ç”¨é“¾æ¥å¯„å­˜å™¨ã€‚æ ‡å‡†è°ƒç”¨ä¾‹ç¨‹ä½¿ç”¨<code>x2</code>ä½œä¸ºæ ˆæŒ‡é’ˆ(stack pointer)</li><li>ç¡¬ä»¶å¯ä»¥ä½¿ç”¨<code>x1</code>æˆ–<code>x2</code>æ¥åŠ é€Ÿå‡½æ•°è°ƒç”¨å’Œè¿”å›(å› ä¸ºå¯ä»¥å°½æ—©è§£ç )ï¼›<a href="#jal">è¯¦æƒ…è§<code>JAL</code>å’Œ<code>JALR</code>æŒ‡ä»¤</a></li><li>å¯é€‰çš„å‹ç¼©16-bitæŒ‡ä»¤æ ¼å¼åŸºäºè¿™æ ·çš„å‡è®¾è®¾è®¡çš„ï¼š<code>x1</code>ï¼šè¿”å›åœ°å€å¯„å­˜å™¨ï¼›<code>x2</code>:æ ˆæŒ‡é’ˆã€‚ä½¿ç”¨å…¶ä»–çº¦å®šçš„è½¯ä»¶å°†æ­£å¸¸è¿è¡Œï¼Œä½†å¯èƒ½æœ‰è¾ƒå¤§çš„ä»£ç å¤§å°ã€‚</li></ul><hr><p><strong><font color="red">notesï¼š</font></strong></p><ul><li>å¯ç”¨æ¶æ„å¯„å­˜å™¨(available architectural registers)çš„æ•°é‡èƒ½å¤Ÿå¯¹<code>ä»£ç å¤§å°</code>ï¼Œ<code>æ€§èƒ½</code>ï¼Œ<code>èƒ½è€—</code>äº§ç”Ÿé‡å¤§å½±å“ã€‚å°½ç®¡16ä¸ªå¯„å­˜å™¨å¯¹äºè¿è¡Œç¼–è¯‘ä»£ç çš„æ•´æ•°ISAæ¥è¯´æ˜¯è¶³å¤Ÿçš„ï¼Œä½†æ˜¯åœ¨é•¿åº¦ä¸º16ä½ä½¿ç”¨3-addressæ ¼å¼çš„æŒ‡ä»¤ä¸­ç¼–ç æ‹¥æœ‰16ä¸ªå¯„å­˜å™¨å®Œæ•´çš„ISAæ˜¯ä¸å¯èƒ½çš„ã€‚(â­PS:16ä¸ªå¯„å­˜å™¨ï¼Œaddressè‡³å°‘4ä½ï¼Œä¸‰åœ°å€å°±12ä½ï¼Œé‚£ä¹ˆåªå‰©ä¸‹4ä½åŒºåˆ†ä¸åŒçš„æŒ‡ä»¤äº†,å³æœ€å¤š16æ¡ä¸åŒçš„æŒ‡ä»¤)ã€‚</li><li>å°½ç®¡2-addressæ˜¯å¯èƒ½çš„ã€‚ä½†å®ƒå¢åŠ æŒ‡ä»¤æ¡æ•°å¹¶ä¸”é™ä½æ•ˆç‡ã€‚æˆ‘ä»¬æƒ³è¦é¿å…ç«‹å³æ•°æŒ‡ä»¤çš„å¤§å°æ¥ç®€åŒ–ç¡¬ä»¶å®ç°ï¼Œä¸€æ—¦32-bitçš„æŒ‡ä»¤å¤§å°è¢«é‡‡ç”¨ï¼Œæ”¯æŒ32ä¸ªæ•´æ•°å¯„å­˜å™¨å°±å¾ˆæ˜¾è€Œæ˜“è§äº†ã€‚ä¸€ä¸ªæ›´å¤§æ•°é‡çš„æ•´æ•°å¯„å­˜å™¨ä¹Ÿæœ‰åŠ©äºæé«˜é«˜æ€§èƒ½ä»£ç çš„æ€§èƒ½ï¼Œå¯å¹¿æ³›ä½¿ç”¨<code>å¾ªç¯å±•å¼€</code>ï¼ˆloop unrolling)ã€<code>è½¯ä»¶æµæ°´çº¿</code>(software pipelining)å’Œ<code>ç¼“å­˜å¹³é“º</code>(cache tiling)ã€‚â“</li><li>åŸºäºä¸Šé¢è¿™äº›åŸå› ï¼Œæˆ‘ä»¬ä¸ºåŸºç¡€ISAé€‰æ‹©äº†ä¸€ä¸ªå¸¸è§„å¤§å°ï¼ˆconventional size)â€”â€”32ä¸ªæ•´æ•°å¯„å­˜å™¨ã€‚åŠ¨æ€å¯„å­˜å™¨ä½¿ç”¨è¶‹å‘äºè¢«ä¸€äº›ç»å¸¸è®¿é—®çš„å¯„å­˜å™¨ä¸»å®°ï¼Œå¹¶ä¸”<code>regfile</code>(å¯„å­˜å™¨å †)çš„å®ç°å¯è¢«ä¼˜åŒ–ä»¥å‡å°‘é¢‘ç¹è®¿é—®å¯„å­˜å™¨çš„è®¿é—®èƒ½é‡(access energy)ã€‚</li><li>å¯é€‰çš„16ä½å‹ç¼©æŒ‡ä»¤æ ¼å¼ç»å¤§éƒ¨åˆ†åªä½¿ç”¨8ä¸ªå¯„å­˜å™¨ï¼Œå› æ­¤èƒ½æä¾›ç¨ å¯†çš„æŒ‡ä»¤ç¼–ç (dense instruction encoding),ä½†æ˜¯å¦‚æœæƒ³è¦çš„è¯ï¼Œé¢å¤–çš„æŒ‡ä»¤é›†æ‰©å±•èƒ½æ”¯æŒæ›´å¤§çš„å¯„å­˜å™¨ç©ºé—´(è¦ä¹ˆæ‰å¹³çš„è¦ä¹ˆåˆ†å±‚æ¬¡çš„)ã€‚</li></ul><h1 id="3-Base-Instruction-Formats"><a href="#3-Base-Instruction-Formats" class="headerlink" title="3 Base Instruction Formats"></a>3 Base Instruction Formats</h1><blockquote><p>æœ‰4ç§æ ¸å¿ƒçš„æŒ‡ä»¤æ ¼å¼ï¼šR/I/S/Uã€‚æŒ‡ä»¤é•¿åº¦éƒ½æ˜¯32ä½ï¼Œå¹¶ä¸”å¿…é¡»åœ¨å†…å­˜ä¸­ä»¥4å­—èŠ‚ä¸ºè¾¹ç•Œå¯¹é½ã€‚æŒ‡ä»¤åœ°å€éå¯¹é½çš„å¼‚å¸¸ï¼Œå¸¸å¸¸æ˜¯ç”±äºåˆ†æ”¯çš„å‘ç”Ÿ(taken branch)æˆ–è€…éæ¡ä»¶è·³è½¬çš„ç›®æ ‡åœ°å€ä¸æ˜¯4å­—èŠ‚å¯¹é½ã€‚</p></blockquote><ul><li><p>å¯¹äºè§£ç ä¸€ä¸ªä¿ç•™æŒ‡ä»¤çš„è¡Œä¸ºæ˜¯æ²¡æœ‰è§„å®šçš„(unspecified)</p></li><li><p>RISC-V ISAä¿æŒæºå¯„å­˜å™¨(<code>rs1</code>å’Œ<code>rs2</code>)å’Œç›®æ ‡å¯„å­˜å™¨(<code>rd</code>)çš„ä½ç½®åœ¨æ‰€æœ‰æŒ‡ä»¤æ ¼å¼ä¸­ç›¸åŒä»¥ç®€åŒ–è§£ç ã€‚é™¤äº†ä½¿ç”¨åœ¨CSRæŒ‡ä»¤ä¸­çš„5bitçš„ç«‹å³æ•°ï¼Œç«‹å³æ•°æ€»æ˜¯<code>sign-extended</code>ï¼Œé€šå¸¸æ˜¯æ‰“åŒ…åˆ°æŒ‡ä»¤ä¸­æœ€å·¦è¾¹çš„å¯ç”¨ä½ï¼Œè¿™æ ·åˆ†é…ä»¥å‡å°‘ç¡¬ä»¶çš„å¤æ‚ç¨‹åº¦ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¯¹äºæ‰€æœ‰ç«‹å³æ•°çš„ç¬¦å·ä½æ€»æ˜¯åœ¨æœ€é«˜ä½(ä¹Ÿå°±æ˜¯Ins[31])æ¥åŠ é€Ÿç¬¦å·æ‰©å±•ç”µè·¯ã€‚</p><p><img src="https://image.beenli.cn/img/20200930/F4vpswvD8a17.jpg?imageslim" alt="mark"><br><strong><i></i></strong></p><center><strong><i>imm[x]æŒ‡çš„æ˜¯å½“å‰ä½åœ¨æ‰©å±•æˆ32ä½ç«‹å³æ•°ä¸­çš„ä½ç½®</i></strong></center><p></p><ul><li>å®é™…åº”ç”¨ä¸­ï¼Œå¤§éƒ¨åˆ†ç«‹å³æ•°è¦ä¹ˆå¾ˆå°ï¼Œè¦ä¹ˆéœ€è¦æ‰€æœ‰çš„ä½æ•°(XLEN bits)ã€‚æˆ‘ä»¬é€‰æ‹©éå¯¹ç§°ç«‹å³æ•°åˆ†å‰²ï¼šå¸¸è§„æŒ‡ä»¤ä¸­ç«‹å³æ•°å 12bits;ç‰¹æ®Šçš„ load-upper-immediate æŒ‡ä»¤ä¸­ç«‹å³æ•°å 20bitsã€‚è¿™æ ·åšæ˜¯ä¸ºäº†ç»™å¸¸è§„æŒ‡ä»¤æ›´å¤šçš„opcodeç©ºé—´ã€‚</li></ul></li></ul><h1 id="4-Immediate-Encoding"><a href="#4-Immediate-Encoding" class="headerlink" title="4 Immediate Encoding"></a>4 Immediate Encoding</h1><blockquote><p>æŒ‡ä»¤æ ¼å¼è¿˜æœ‰ä¸¤ä¸ªå˜ç§(variants)ï¼šB/Jï¼Œå®ƒä»¬åŸºäºç«‹å³æ•°çš„å¤„ç†è¡ç”Ÿå‡ºæ¥ã€‚</p></blockquote><p><img src="https://image.beenli.cn/img/20200930/NR78wxr6Nbb8.jpg?imageslim" alt="mark"></p><ul><li>Så’ŒBä»…æœ‰çš„åŒºåˆ«ï¼šåœ¨Bæ ¼å¼ä¸­12bitç«‹å³æ•°åŸŸä¹˜ä»¥2ç”¨äºç¼–ç åˆ†æ”¯åç§»ã€‚è€Œä¸æ˜¯åƒä¼ ç»Ÿåšæ³•é‚£æ ·ï¼Œå°†æŒ‡ä»¤ç¼–ç ä¸­çš„æ‰€æœ‰ç«‹å³æ•°ä½ç”¨ç¡¬ä»¶å·¦ç§»ä¸€ä½,ä¸­é—´çš„ä½æ•°(imm[10:1])å’Œç¬¦å·ä½ä¿ç•™åœ¨å›ºå®šä½ç½®ï¼Œè€ŒSæ ¼å¼ä¸­çš„æœ€ä½ä½(inst[7])åœ¨Bæ ¼å¼ä¸­ç¼–ç ä¸€ä¸ªé«˜é˜¶ä½ã€‚</li><li>Uå’ŒJçš„ä»…æœ‰åŒºåˆ«ï¼šUè¦å‘å·¦ç§»12ä½ï¼›è€ŒJåªç”¨ç§»åŠ¨1ä½ã€‚åœ¨Uå’ŒJæŒ‡ä»¤ç«‹å³æ•°ä¸­æŒ‡ä»¤çš„ä½ç½®å°½é‡è·Ÿå…¶ä»–æ ¼å¼çš„æŒ‡ä»¤æˆ–è€…å®ƒä»¬äº’ç›¸é‡å ã€‚</li></ul><p><img src="https://image.beenli.cn/img/20200930/CoSeYfK4wdG4.jpg?imageslim" alt="mark"></p><h1 id="5-Computational"><a href="#5-Computational" class="headerlink" title="5 Computational "></a>5 <a name="compute">Computational </a></h1><blockquote><p>å¤§å¤šæ•°çš„<code>æ•´æ•°ç®—æœ¯æŒ‡ä»¤</code>(Integer computational instruction)å¯¹ä¿å­˜åœ¨æ•´æ•°å¯„å­˜å™¨ä¸­çš„<code>XLEN</code>ä½çš„å€¼è¿›è¡Œæ“ä½œã€‚æ•´æ•°è®¡ç®—æŒ‡ä»¤è¦ä¹ˆè¢«ç¼–ç ä¸ºä½¿ç”¨Iæ ¼å¼çš„å¯„å­˜å™¨-ç«‹å³æ•°æ“ä½œï¼›è¦ä¹ˆä½¿ç”¨Ræ ¼å¼çš„å¯„å­˜å™¨-å¯„å­˜å™¨æ“ä½œã€‚å¯¹äºè¿™ä¸¤ç§ç±»å‹æŒ‡ä»¤çš„ç›®çš„å¯„å­˜å™¨éƒ½æ˜¯<code>rd</code>ã€‚æ²¡æœ‰æ•´å‹è®¡ç®—æŒ‡ä»¤ä¼šå¯¼è‡´ç®—æœ¯å¼‚å¸¸</p></blockquote><ul><li><p>åŸºæœ¬æŒ‡ä»¤é›†ä¸åŒ…æ‹¬å¯¹æ•´æ•°ç®—æœ¯è¿ç®—ä¸Šåš<code>æº¢å‡ºæ£€æŸ¥</code>(overflow checks)æ”¯æŒçš„ç‰¹æ®ŠæŒ‡ä»¤é›†ã€‚å› ä¸ºè®¸å¤šæº¢å‡ºæ£€æŸ¥èƒ½å¤Ÿæ›´ä¾¿å®œåœ°(cheaply)ä½¿ç”¨RISC-Våˆ†æ”¯æ¥å®ç°</p></li><li><p>å¯¹<code>æ— ç¬¦å·åŠ æ³•</code>çš„æº¢å‡ºæ£€æŸ¥ä»…ä»…éœ€è¦åœ¨åŠ æ³•æŒ‡ä»¤ååŠ ä¸Šä¸€æ¡é¢å¤–çš„åˆ†æ”¯æŒ‡ä»¤</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">add t0,t1,t2<br>blut t0, t1, overflow<br></code></pre></td></tr></tbody></table></figure></li><li><p>å¯¹äºæœ‰ç¬¦å·åŠ æ³•ï¼šå¦‚æœä¸€ä¸ªæ“ä½œæ•°çš„ç¬¦å·å·²çŸ¥ï¼Œæº¢å‡ºæ£€æŸ¥ä»…éœ€è¦åŠ æ³•ä¹‹åçš„ä¸€ä¸ªåˆ†æ”¯ï¼ˆè¦†ç›–äº†å¸¦æœ‰ç«‹å³æ•°æ“ä½œæ•°çš„å¸¸è§åŠ æ³•æƒ…å½¢ï¼‰</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">addi t0, t1, +imm<br>blt t0, t1, overflow<br></code></pre></td></tr></tbody></table></figure></li><li><p>å¯¹äºå¸¸è§„çš„<code>æœ‰ç¬¦å·åŠ æ³•</code>ï¼ŒåŠ æ³•ä¹‹åéœ€è¦ä¸‰æ¡é¢å¤–çš„æŒ‡ä»¤ã€‚åˆ©ç”¨å½“ä¸”ä»…å½“å¦ä¸€ä¸ªæ“ä½œæ•°ä¸ºè´Ÿæ—¶ï¼Œè¯¥å’Œåº”å°äºå…¶ä¸­ä¸€ä¸ªæ“ä½œæ•°çš„è§‚å¯Ÿã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">add t0, t1, t2<br>slti t3, t2, 0<br>slt t4, t0, t1<br>bne t3, t4, overflow<br></code></pre></td></tr></tbody></table></figure></li><li>åœ¨RV64Iä¸­ï¼Œ32ä½æœ‰ç¬¦å·çš„åŠ æ³•æº¢å‡ºå¯ä»¥é€šè¿‡æ¯”è¾ƒADDå’ŒADDWæ“ä½œçš„ç»“æœæ¥è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚(ADDWè‚¯å®šä¸ä¼šæº¢å‡º)</li></ul><h2 id="Register-Immediate"><a href="#Register-Immediate" class="headerlink" title="Register-Immediate"></a><a name="arith">Register-Immediate</a></h2><p><img src="https://image.beenli.cn/img/20200930/9lWr2QpMilov.jpg?imageslim" alt="mark"></p><ol><li><p><code>ADDI</code>ï¼šå°†12ä½ç«‹å³æ•°ç¬¦å·æ‰©å±•åä¸<code>rs1</code>ä¸­çš„å€¼ç›¸åŠ ï¼Œç®—æœ¯æº¢å‡ºå¿½ç•¥ï¼Œç»“æœçš„ä½32ä½å­˜åˆ°<code>rd</code>å¯„å­˜å™¨ä¸­ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">/* ä¸¤æ¡æŒ‡ä»¤ç­‰æ•ˆ */<br>ADDI rd, rs1, 0<br>MV rd , rs1(æ±‡ç¼–ä¼ªæŒ‡ä»¤ï¼šå°†rs1ä¸­çš„å€¼å¤åˆ¶ç»™rd)<br></code></pre></td></tr></tbody></table></figure></li><li><p><code>SLTI</code>(set less than immediate): å½“å¯„å­˜å™¨<code>rs1</code>ä¸­çš„å€¼å°äºç«‹å³æ•°ï¼ˆä¿©è€…éƒ½è§†ä¸ºæœ‰ç¬¦å·æ•°)ï¼Œå°†å¯„å­˜å™¨<code>rd</code>ç½®ä¸º1ï¼›å¦åˆ™ç½®0ã€‚<code>SLTIU</code>: åŠŸèƒ½ä¸€æ ·ï¼Œä½†æ˜¯æŠŠæ¯”è¾ƒçš„å¯¹è±¡è§†ä¸ºæ— ç¬¦å·æ•°ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">/* ä¸¤æ¡æŒ‡ä»¤ç­‰æ•ˆ */<br>SLTIU rd, rs1, 1(å½“rs1ç­‰äº0,rdä¸º1,å¦åˆ™ä¸º0)<br>SEQZ rd, rs<br></code></pre></td></tr></tbody></table></figure></li><li><p><code>ANDI, ORI, XORI</code>: ä¸‰ä¸ªé€»è¾‘è¿ç®—ç¬¦ï¼Œåˆ†åˆ«å¯¹rs1å’Œç«‹å³æ•°æ‰§è¡Œ<code>æŒ‰ä½</code>(bitwise)çš„ä¸ï¼Œæˆ–ï¼Œå¼‚æˆ–è¿ç®—ã€‚</p><h2 id=""><a href="#" class="headerlink" title=""></a><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">/* ä¸¤æ¡æŒ‡ä»¤ç­‰æ•ˆ */<br>XORI rd, rs1, -1(-1çš„è¡¥ç ä¸ºå…¨1)<br>NOT rd, rs(å°†rså„ä½å–åèµ‹å€¼ç»™rd)<br></code></pre></td></tr></tbody></table></figure></h2><p><img src="https://image.beenli.cn/img/20200930/ohbIXFmmows6.jpg?imageslim" alt="mark"></p></li></ol><blockquote><p><code>ç§»ä½</code>è¢«ç¼–ç ä¸€ç§ç‰¹æ®Šçš„Iç±»å‹æŒ‡ä»¤æ ¼å¼ã€‚</p><ul><li>è¢«ç§»ä½çš„æ“ä½œæ•°ä¸º<code>rs1</code>ï¼›ç§»ä½çš„ä½æ•°è¢«ç¼–ç åœ¨ç«‹å³æ•°åŸŸçš„ä½äº”ä½ä¸Šã€‚</li><li>ğŸ‘‰ç§»ç±»å‹è¢«ç¼–ç åœ¨ç¬¬30ä½ä¸Šï¼›</li><li><code>SLLI</code>(shift left logical)ï¼š0è¢«ç§»åŠ¨åˆ°ä½ä½</li><li><code>SRLI</code>: 0è¢«ç§»åŠ¨åˆ°é«˜ä½</li><li><code>SRAI</code>: (shift right arithmetic): åŸç¬¦å·ä½å¤åˆ¶åˆ°ç©ºå‡ºçš„é«˜ä½</li></ul></blockquote><hr><p><img src="https://image.beenli.cn/img/20200930/HH9oFeg4OyQC.jpg?imageslim" alt="mark"></p><ol><li><code>LUI</code>(load upper immediate): ç”¨äºæ„å»º32ä½å¸¸æ•°å¹¶ä½¿ç”¨Uæ ¼å¼æŒ‡ä»¤ã€‚æŠŠU-immediateçš„å€¼æ”¾åœ¨ç›®çš„å¯„å­˜å™¨çš„é«˜20ä½ï¼Œå…¶å®ƒä½ä½ç”¨0å¡«å……ã€‚</li><li><code>AUIPC</code>(add upper immediate to pc)ï¼šç”¨äºæ„å»ºä¸pcç›¸å…³çš„åœ°å€ï¼Œå¹¶ä½¿ç”¨Uæ ¼å¼æŒ‡ä»¤ã€‚å½¢æˆ32ä½çš„åç§»(é«˜20ä½æ¥è‡ªç«‹å³æ•°ï¼Œä½12ä½ç”¨0å¡«å……)ï¼ŒæŠŠè¿™ä¸ªåç§»åŠ åˆ°AUIPCæŒ‡ä»¤çš„åœ°å€ä¸Šï¼Œç„¶åæŠŠç»“æœæ”¾åˆ°<code>rd</code>ä¸­ã€‚ï¼ˆrd = pc-4+im)<ul><li>AUIPCæŒ‡ä»¤æ”¯æŒ<code>åŒæŒ‡ä»¤åºåˆ—</code>(two-instruction sequences)è®¿é—®ç›¸å¯¹PCçš„ä»»æ„åç§»(for both control-flow transfers and data accesses)</li><li>ä¸€ä¸ªAUIPCå’ŒJALRä¸­12ä½åç§»çš„ç»„åˆèƒ½å¤Ÿè½¬æ¢æ§åˆ¶ç»™ä»»æ„32ä½çš„PCç›¸å¯¹åœ°å€(PC-relative address)ï¼Œè€Œä¸€ä¸ªALIPCåŠ ä¸Šä¸€ä¸ªå¸¸è§„loadå’ŒstoreæŒ‡ä»¤ä¸­çš„12ä½ç«‹å³æ•°åç§»èƒ½ä¾›è®¿é—®ä»»æ„32ä½PCç›¸å¯¹åœ°å€çš„æ•°æ®åœ°å€(PC-relative data address)</li><li>å½“å‰PCå€¼å¯ä»¥é€šè¿‡è®¾ç½®ç«‹å³æ•°ä¸º0è·å¾—ï¼Œå°½ç®¡JAL+4æŒ‡ä»¤ä¹Ÿèƒ½è·å¾—æœ¬åœ°PC(JALä¸‹ä¸€æŒ‡ä»¤)ï¼Œå®ƒå¯èƒ½åœ¨ç®€å•å¾®æ¶æ„ä¸­é€ æˆæµæ°´çº¿å´©æºƒï¼Œæˆ–è€…åœ¨æ›´å¤æ‚çš„å¾®æ¶æ„ä¸­æ±¡æŸ“BTB(â“)</li></ul></li></ol><h2 id="Register-Register"><a href="#Register-Register" class="headerlink" title="Register-Register"></a>Register-Register</h2><blockquote><p>RV32Iå®šä¹‰äº†å‡ ä¸ªRå‹ç®—æœ¯è¿ç®—ã€‚æ‰€æœ‰çš„è¿ç®—éƒ½è¯»å–<code>rs1</code>,<code>rs2</code>å¯„å­˜å™¨çš„å€¼ä½œä¸ºæºæ“ä½œæ•°ï¼ŒæŠŠç»“æœå†™å›<code>rd</code>å¯„å­˜å™¨ã€‚<code>funct7</code>å’Œ<code>funct3</code>åŸŸé€‰æ‹©åˆé€‚çš„è¿ç®—ã€‚</p></blockquote><p><img src="https://image.beenli.cn/img/20200930/cdJ8aBabLVTk.jpg?imageslim" alt="mark"></p><p><a href="#arith">æ„ä¹‰åŒğŸ‘†ã€‚</a></p><h2 id="NOP-Instruction"><a href="#NOP-Instruction" class="headerlink" title="NOP Instruction"></a>NOP Instruction</h2><p><img src="https://image.beenli.cn/img/20200930/QOhQFMEFTYs1.jpg?imageslim" alt="mark"></p><ul><li>NOPæŒ‡ä»¤ï¼šä¸ä¼šæ”¹å˜ä»»ä½•æ¶æ„ä¸Šå¯è§çš„çŠ¶æ€ã€‚å‡ºæ¥æ¨è¿›PCï¼Œå¢åŠ ä»»ä½•é€‚ç”¨çš„æ€§èƒ½è®¡æ•°å™¨ã€‚NOPè¢«ç¼–ç ä¸º`ADDI x0, x0, 0</li><li>NOPså¯ä»¥è¢«ç”¨æ¥å¯¹é½ä»£ç æ®µä¸é‡è¦çš„å¾®æ¶æ„åœ°å€è¾¹ç•Œã€‚æˆ–è€…ä¸ºå†…è”ä»£ç ä¿®æ”¹(inline code modification)æµå‡ºç©ºé—´ã€‚å°½ç®¡æœ‰è®¸å¤šå¯èƒ½çš„æ–¹æ³•å»ç¼–ç NOP,æˆ‘ä»¬ä½¿ç”¨äº†è§„èŒƒçš„NOPç¼–ç æ¥å…è®¸å¾®æ¶æ„ä¼˜åŒ–ä»¥åŠæ›´æ˜“è¯»çš„åæ±‡ç¼–è¾“å‡ºã€‚å…¶å®ƒçš„NOPç¼–ç å¯ä»¥ç”¨ä½œæŒ‡ç¤ºæŒ‡ä»¤(HINT instruction)</li><li>é€‰æ‹©ADDIä½œä¸ºNOPç¼–ç æ˜¯å› ä¸ºå®ƒåœ¨è·¨ä¸€ç³»åˆ—ç³»ç»Ÿæ‰§è¡Œæ—¶æœ€å¯èƒ½å ç”¨æœ€å°‘çš„èµ„æº;é™¤æ­¤ä¹‹å¤–ï¼Œè¯¥æŒ‡ä»¤ä»…è¯»å–ä¸€ä¸ªå¯„å­˜å™¨ã€‚å¹¶ä¸”ï¼Œä¸€ä¸ªADDIåŠŸèƒ½å•å…ƒåœ¨è¶…æ ‡é‡è®¾è®¡ä¸­æ›´å®¹æ˜“å¯ç”¨ï¼Œå› ä¸ºaddsæ˜¯æœ€å¸¸è§çš„è¿ç®—</li><li>åœ°å€ç”Ÿæˆå•å…ƒå¯ä»¥ä½¿ç”¨ç›¸åŒçš„ç¡¬ä»¶å¤Ÿæ‰§è¡ŒADDIï¼Œè¯¥ç¡¬ä»¶è¢«ç”¨äºbase+offsetåœ°å€è®¡ç®—ï¼Œè€Œregister-register ADDï¼Œé€»è¾‘è¿ç®—æˆ–ç§»ä½è¿ç®—æ“ä½œéœ€è¦é¢å¤–çš„ç¡¬ä»¶ã€‚</li></ul><h1 id="6-Control-Transfer"><a href="#6-Control-Transfer" class="headerlink" title="6 Control Transfer"></a>6 Control Transfer</h1><blockquote><p>RV32Iæä¾›ä¸¤ç§æ§åˆ¶è½¬ä¹‰æŒ‡ä»¤ï¼š<code>æ— æ¡ä»¶è·³è½¬</code>ï¼Œ<code>æ¡ä»¶åˆ†æ”¯</code></p><p>RV32Iæ§åˆ¶è½¬ä¹‰æŒ‡ä»¤æ²¡æœ‰æ¶æ„ä¸Šå¯è§çš„<code>å»¶è¿Ÿæ§½</code>(delay slot)</p></blockquote><h2 id="Unconditional-Jumps"><a href="#Unconditional-Jumps" class="headerlink" title="Unconditional Jumps"></a>Unconditional Jumps</h2><p><img src="https://image.beenli.cn/img/20200930/qCmY8sLbKGDK.jpg?imageslim" alt="mark"></p><p><code>JAL</code>(jump and link)æŒ‡ä»¤ä½¿ç”¨<code>J-type</code>æ ¼å¼ï¼ŒJ-immediateä»¥ä¸¤å­—èŠ‚çš„å€æ•°ç¼–ç ä¸€ä¸ªæœ‰ç¬¦å·åç§»ã€‚(in multiple of 2 bytesï¼›åˆ™è¯¥åç§»è¦ä¹˜ä»¥2)ã€‚åç§»ç¬¦å·æ‰©å±•ï¼Œç„¶ååŠ ä¸Šå½“å‰æŒ‡ä»¤çš„åœ°å€å½¢æˆ<code>è·³è½¬ç›®æ ‡åœ°å€</code>(jump target address)ã€‚Jumpså› æ­¤èƒ½å¤Ÿè®¿é—®Â±1 MiBèŒƒå›´ã€‚JALå­˜å‚¨ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€(pc+4)åˆ°<code>rd</code>ï¼›</p><p>æ ‡å‡†è½¯ä»¶è°ƒç”¨çº¦å®šä½¿ç”¨x1ä½œä¸ºè¿”å›åœ°å€å¯„å­˜å™¨ï¼Œx5ä½œä¸ºå¤‡ç”¨é“¾æ¥å¯„å­˜å™¨ã€‚</p><p><img src="https://image.beenli.cn/img/20200930/VUjOV9BMhinO.jpg?imageslim" alt="mark"></p><p><code>JALR</code>(jump and link register)ï¼šé—´æ¥è·³è½¬æŒ‡ä»¤ï¼šä½¿ç”¨<code>I-type</code>ï¼Œç›®æ ‡åœ°å€é€šè¿‡æŠŠç¬¦å·æ‰©å±•çš„12æ¯”ç‰¹ç«‹å³æ•°åŠ åˆ°rs1ä¸Šï¼Œç„¶åç½®ç»“æœçš„æœ€ä½ä½ä¸º0è·å¾—ï¼›ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€(pc+4)å†™åˆ°å¯„å­˜å™¨rdã€‚å¦‚æœç»“æœä¸éœ€è¦ï¼Œå¯ä»¥æŠŠ<code>x0</code>å½“ä½œç›®çš„å¯„å­˜å™¨ã€‚</p><p>å¦‚æœç›®æ ‡åœ°å€æ²¡æœ‰å¯¹é½å››å­—èŠ‚è¾¹ç•Œï¼Œjarå’ŒjarlæŒ‡ä»¤å°†äº§ç”Ÿ<code>æŒ‡ä»¤åœ°å€éå¯¹é½</code>å¼‚å¸¸ã€‚</p><p>è¿”å›åœ°å€<code>é¢„æµ‹æ ˆ</code>(prediction stack)æ˜¯é«˜æ€§èƒ½å–å€¼å•å…ƒçš„ä¸€ä¸ªå¸¸è§ç‰¹ç‚¹ï¼Œè¦æ±‚å‡†ç¡®æ£€æµ‹ç”¨äºè¿‡ç¨‹è°ƒç”¨å’Œè¿”å›çš„æŒ‡ä»¤æ˜¯æœ‰æ•ˆçš„ã€‚</p><ul><li>å¯¹äºRISC-V,å…³äºæŒ‡ä»¤ä½¿ç”¨çš„çº¿ç´¢é€šè¿‡å¯„å­˜å™¨å·çš„ä½¿ç”¨è¢«ç®€å•çš„ç¼–ç ã€‚</li><li>JALæŒ‡ä»¤åº”è¯¥æŠŠè¿”å›åœ°å€å‹è¿›è¿”å›åœ°å€æ ˆ(RAS)ä¸­ï¼Œå½“ä¸”ä»…å½“<code>rd = x1/x5</code>ï¼›</li><li>JALRæŒ‡ä»¤åº”è¯¥push/pop a RAS</li></ul><p><img src="https://image.beenli.cn/img/20200930/WC8l9YmmyroI.jpg?imageslim" alt="mark"></p><center>link is true when the register is either x1 or x5</center><h2 id="Conditional-Branches"><a href="#Conditional-Branches" class="headerlink" title="Conditional Branches"></a>Conditional Branches</h2><blockquote><p>æ‰€æœ‰åˆ†æ”¯æŒ‡ä»¤ä½¿ç”¨<code>B-type</code>æ ¼å¼ã€‚</p><p>12æ¯”ç‰¹çš„ç«‹å³æ•°ç”¨2å­—èŠ‚çš„å€æ•°ç¼–ç æœ‰ç¬¦å·åç§»</p><p>ç«‹å³æ•°ç¬¦å·æ‰©å±•åä¸å½“å‰æŒ‡ä»¤åœ°å€ç›¸åŠ ï¼Œå¯ä»¥è®¿é—®çš„åœ°å€èŒƒå›´ï¼š<code>Â±4 KiB</code></p></blockquote><p><img src="https://image.beenli.cn/img/20200930/PR0CJpoojIFU.jpg?imageslim" alt="mark"></p><p><code>BEQ</code>:branch equal;&nbsp;&nbsp;<code>BNE</code>: branch not equal;&nbsp;&nbsp;<code>BLT</code>: branch less than;&nbsp;&nbsp;<code>BGE</code>: branch greater than;</p><ul><li>åº”è¯¥å¯¹è½¯ä»¶è¿›è¡Œä¼˜åŒ–ï¼Œä½¿é¡ºåºä»£ç è·¯å¾„æˆä¸ºæœ€å¸¸è§çš„è·¯å¾„ï¼Œå¹¶å°†è¾ƒä¸ç»å¸¸ä½¿ç”¨çš„åˆ†æ”¯ä»£ç è·¯å¾„ç½®äºè¡Œå¤–ã€‚è½¯ä»¶è¿˜åº”è¯¥å‡è®¾ï¼Œè‡³å°‘åœ¨ç¬¬ä¸€æ¬¡é‡åˆ°åˆ†æ”¯æ—¶ï¼Œé¢„æµ‹å‘åè·³è½¬çš„åˆ†æ”¯å‘ç”Ÿï¼Œå‘å‰è·³è½¬çš„åˆ†æ”¯ä¸å‘ç”Ÿã€‚åŠ¨æ€é¢„æµ‹å™¨åº”è¯¥å¿«é€Ÿå­¦ä¹ ä»»ä½•å¯é¢„æµ‹çš„åˆ†æ”¯è¡Œä¸ºã€‚</li><li>ä¸åƒä¸€äº›å…¶å®ƒçš„æ¶æ„ï¼ŒRISC-Vä¸­å¯¹äº<code>éæ¡ä»¶åˆ†æ”¯</code>åº”è¯¥æ€»æ˜¯ä½¿ç”¨<code>jump</code>(JAL with rd=x0)æŒ‡ä»¤è€Œä¸æ˜¯æ¡ä»¶æ€»æ˜¯æ»¡è¶³çš„æœ‰æ¡ä»¶åˆ†æ”¯æŒ‡ä»¤</li><li>RISC-Vè·³è½¬ä¹Ÿæ˜¯ä¸pcç›¸å…³çš„ï¼Œå¹¶ä¸”æ¯”åˆ†æ”¯æ”¯æŒæ›´å¤§çš„åç½®èŒƒå›´ï¼Œè€Œä¸”ä¸ä¼šæ±¡æŸ“æ¡ä»¶åˆ†æ”¯é¢„æµ‹è¡¨ã€‚</li></ul><h1 id="7-Load-and-Store-ğŸ˜³"><a href="#7-Load-and-Store-ğŸ˜³" class="headerlink" title="7 Load and Store(ğŸ˜³)"></a>7 Load and Store(ğŸ˜³)</h1><blockquote><p>RV32Iæ˜¯ä¸€ä¸ªè£…è½½å’Œå­˜å‚¨æ¶æ„ï¼šåªæœ‰<code>load</code>å’Œ<code>store</code>æŒ‡ä»¤èƒ½å¤Ÿè®¿é—®å†…å­˜ï¼Œç®—æœ¯æŒ‡ä»¤åªèƒ½æ“ä½œCPUå¯„å­˜å™¨ã€‚</p></blockquote><ul><li>RV32Iæä¾›äº†32-bitçš„åœ°å€ç©ºé—´ï¼Œç”¨å­—èŠ‚ç¼–ç ã€‚</li><li><code>EEI</code>å®šä¹‰äº†åœ°å€ç©ºé—´çš„é‚£éƒ¨åˆ†å¯ä»¥è¢«å“ªäº›æŒ‡ä»¤åˆæ³•è®¿é—®ã€‚(e.g.ï¼Œä¸€äº›åœ°å€å¯èƒ½åªèƒ½è¢«è¯»ï¼Œæˆ–ä»…æ”¯æŒæŒ‰å­—è®¿é—®)</li><li>ç›®çš„å¯„å­˜å™¨ä¸º<code>x0</code>çš„è£…è½½æŒ‡ä»¤å°†æŠ›å‡ºå¼‚å¸¸ï¼Œå³ä½¿è£…è½½çš„å€¼è¢«ä¸¢å¼ƒä¹Ÿä¼šé€ æˆå…¶å®ƒçš„å‰¯ä½œç”¨ã€‚</li></ul><blockquote><p>In RISC-Vï¼Œendianness is byte-address invariant</p></blockquote><ul><li><p>å¦‚æœä¸€ä¸ªå­—èŠ‚ä»¥æŸç§é¡ºåº(at some endianness)å­˜å‚¨åˆ°å†…å­˜æŸä¸ªåœ°å€å¤„ï¼Œé‚£ä¹ˆä»¥å­—èŠ‚å¤§å°ä»é‚£ä¸ªåœ°å€ä»¥ä»»æ„çš„é¡ºåº(in any endianness)è£…è½½çš„ç»“æœæ˜¯å­˜å‚¨çš„å€¼ã€‚</p></li><li><p>å°ç«¯(little-endian): å¤šå­—èŠ‚å­˜å‚¨æ—¶æŠŠå¯„å­˜å™¨æœ€ä½ä¸ºå­—èŠ‚å†™åˆ°å†…å­˜å­—èŠ‚åœ°å€çš„æœ€ä½ä¸ºï¼Œéšåå¯„å­˜å™¨çš„å…¶å®ƒå­—èŠ‚ä»¥æƒé‡å‡åºå†™å…¥ã€‚ï¼ˆæƒé‡è¶Šå¤§çš„å­—èŠ‚å æ®çš„å†…å­˜åœ°å€è¶Šå¤§ï¼‰</p></li></ul><hr><p><img src="https://image.beenli.cn/img/20200930/gJvyXMYKv7Ov.jpg?imageslim" alt="mark"></p><blockquote><p>è£…è½½å’Œå­˜å‚¨æŒ‡ä»¤ç”¨äºåœ¨å¯„å­˜å™¨å’Œå†…å­˜ä¸­è½¬æ¢æ•°æ®ã€‚</p><p>Loads: <code>I-type</code></p><p>Stores: <code>S-type</code></p><p>æœ‰æ•ˆåœ°å€ï¼šç«‹å³æ•°ç¬¦å·æ‰©å±•åŠ ä¸ŠåŸºå€å¯„å­˜å™¨<code>rs1</code></p><p>ç›®çš„åœ°å€ï¼šâ… ã€for load:ä»å†…å­˜å–å€¼åˆ°<code>rd</code>;â…¡ã€for storeï¼šå¤åˆ¶<code>rs2</code>çš„å€¼åˆ°å†…å­˜</p></blockquote><h1 id="8-Memory-Ordering"><a href="#8-Memory-Ordering" class="headerlink" title="8 Memory Ordering"></a>8 Memory Ordering</h1><p><img src="https://image.beenli.cn/img/20200930/8gVkNfBMa1IW.jpg?imageslim" alt="mark"></p><ul><li><p><code>FENCE</code>ï¼šç”¨äºæ’åºè¢«å…¶å®ƒRISC-Vçº¿ç¨‹ï¼Œå¤–éƒ¨è®¾å¤‡æˆ–è€…åå¤„ç†å™¨å¯è§çš„è®¾å¤‡I/Oå’Œå­˜å‚¨å™¨è®¿é—®ã€‚</p></li><li><p>ä»»ä½•è®¾å¤‡è¾“å…¥(I)ï¼Œè®¾å¤‡è¾“å‡º(O)ï¼Œå­˜å‚¨å™¨è¯»å–(R),å­˜å‚¨å™¨å†™(W)çš„ç»„åˆèƒ½å¤Ÿè¢«æ’åºæˆä»»ä½•ç›¸åŒçš„ç»„åˆã€‚</p></li><li>é€šä¿—åœ°è¯´ï¼Œæ²¡æœ‰å…¶å®ƒçº¿ç¨‹æˆ–è€…å¤–éƒ¨è®¾å¤‡èƒ½å¤Ÿåœ¨<code>fence</code>ä¹‹å‰çš„æŒ‡ä»¤é›†è¿›è¡Œä»»ä½•æ“ä½œä¹‹å‰ï¼Œè§‚æµ‹åˆ°åœ¨<code>fence</code>åè€…çš„æŒ‡ä»¤é›†åˆæ‰€åšçš„ä»»ä½•æ“ä½œã€‚å°±åƒä¸€ä¸ªå±éšœä¸€æ ·ï¼Œå‰é¢çš„æ“ä½œåªæœ‰å…ˆå®Œæˆï¼Œåé¢çš„æŒ‡ä»¤ç»“æœæ‰èƒ½è¢«å…¶å®ƒå¤„ç†å™¨è§‚å¯Ÿåˆ°ã€‚</li><li>memory-mapped I/Oè®¾å¤‡å¾ˆå…¸å‹åœ°è¢«æ²¡æœ‰cacheçš„loadså’Œstoreè®¿é—®ï¼Œå®ƒä»¬ä½¿ç”¨Iå’ŒOè€Œä¸æ˜¯Rå’ŒWã€‚</li><li>æŒ‡ä»¤é›†æ‰©å±•ä¹Ÿå¯ä»¥æè¿°æ–°çš„I/OæŒ‡ä»¤ï¼Œä½¿ç”¨fenceæŒ‡ä»¤ä¸­Iå’ŒOä½è¿›è¡Œæ’åº</li></ul><p><img src="https://image.beenli.cn/img/20200930/6dnc1SCYbwDA.jpg?imageslim" alt="mark"></p><ul><li>fence modeåŸŸåœ¨ins[31:28]ï¼›å½“fm=0000æ—¶æ’åºæ‰€æœ‰çš„å†…å­˜æ“ä½œã€‚</li><li>å¯é€‰çš„<code>FENCE.TSO</code>æŒ‡ä»¤å…¶fm=1000ï¼›predecessor=RW,å¹¶ä¸”successor=RWã€‚TSOå‘½ä»¤å®ƒçš„å‰é¢é›†åˆä¸­çš„æ‰€æœ‰åŠ è½½æ“ä½œå…ˆäºå®ƒçš„åç»§é›†åˆä¸­çš„æ‰€æœ‰å†…å­˜æ“ä½œï¼›å®ƒçš„å‰é¢é›†åˆä¸­çš„æ‰€æœ‰å­˜å‚¨æ“ä½œ(store operation)éƒ½è¦å…ˆäºå®ƒçš„åç»§é›†åˆä¸­çš„æ‰€æœ‰å­˜å‚¨æ“ä½œ</li></ul><h1 id="9-Call-and-Breakpoints"><a href="#9-Call-and-Breakpoints" class="headerlink" title="9 Call and Breakpoints"></a>9 Call and Breakpoints</h1><blockquote><p><a name="system">SYSTEM instruction</a>ï¼šè¢«ç”¨äºè®¿é—®éœ€è¦ç‰¹æƒè®¿é—®çš„ç³»ç»ŸåŠŸèƒ½ï¼Œä½¿ç”¨<code>I-type</code>ã€‚</p><p>åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p><ul><li>è‡ªåŠ¨è¯»-ä¿®æ”¹-å†™(read-modify-write)<code>æ§åˆ¶çŠ¶æ€å¯„å­˜å™¨</code>(CSRs)ã€‚</li><li>æ½œåœ¨çš„ç‰¹æƒæŒ‡ä»¤(potentially privileged instructions)</li></ul><p>ç³»ç»ŸæŒ‡ä»¤è¢«å®šä¹‰æˆè¿è¡Œç¨ç®€å•çš„å®ç°æ€»æ˜¯æ•è·å¼‚å¸¸ç»™å•ä¸€çš„<code>è½¯ä»¶å¼‚å¸¸å¤„ç†å™¨</code>(software trap handle)ï¼›æ›´åŠ å¤æ‚çš„å®ç°å¯èƒ½éœ€è¦æ‰§è¡Œæ›´å¤šæ¡ç³»ç»ŸæŒ‡ä»¤</p></blockquote><p><img src="https://image.beenli.cn/img/20200930/Wf33chpE3JIQ.jpg?imageslim" alt="mark"></p><p>è¿™ä¸¤ä¸ªæŒ‡ä»¤ä¼šå‘<code>é…å¥—æ‰§è¡Œç¯å¢ƒ</code>(supporting execution environment)å¼•èµ·ä¸€ä¸ªç²¾ç¡®çš„<code>è¯·æ±‚å¼‚å¸¸</code>(requested trap)ã€‚</p><h2 id="ECALL"><a href="#ECALL" class="headerlink" title="ECALL"></a>ECALL</h2><blockquote><p><code>ECALL</code>ï¼šå‘è¿è¡Œç¯å¢ƒæå‡ºæœåŠ¡è¯·æ±‚(service request)</p><p>EElå°†å®šä¹‰æœåŠ¡è¯·æ±‚çš„å‚æ•°å¦‚ä½•ä¼ é€’ï¼Œä½†é€šå¸¸è¿™äº›éƒ½æ˜¯åœ¨æ•´æ•°å¯„å­˜å™¨ä¸­æŒ‡å®šçš„ä½ç½®</p></blockquote><h2 id="EBREAK"><a href="#EBREAK" class="headerlink" title="EBREAK"></a>EBREAK</h2><blockquote><p><code>EBREAK</code>ï¼šè¿”å›æ§åˆ¶æƒç»™è°ƒè¯•å™¨ç¯å¢ƒ(debugging environment)</p></blockquote><h1 id="10-Hint"><a href="#10-Hint" class="headerlink" title="10 Hint"></a>10 Hint</h1><blockquote><p>RV32Iä¸º<code>HINT</code>æŒ‡ä»¤ä¿ç•™äº†å¤§çš„ç¼–ç ç©ºé—´ï¼Œé€šå¸¸æ˜¯ç”¨æ¥å’Œå¾®æ¶æ„æ²Ÿé€šæ€§èƒ½æç¤ºã€‚HINTsè¢«ç¼–ç ä¸º<a href="#compute">æ•´æ•°è®¡ç®—æŒ‡ä»¤</a>,å…¶ä¸­<code>rd=x0</code>ã€‚å› æ­¤ï¼ŒåƒnopæŒ‡ä»¤ä¸€æ ·ï¼ŒHINTsä¸ä¼šæ”¹å˜æ¶æ„å¯è§çš„çŠ¶æ€ï¼Œé™¤äº†å¢åŠ pcå’Œä»»ä½•é€‚ç”¨çš„æ€§èƒ½è®¡æ•°å™¨ã€‚</p></blockquote><p><img src="https://image.beenli.cn/img/20200930/nVtEvPja9AXi.jpg?imageslim" alt="mark"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;center&gt;RV32I Base Integer Instruction Set&lt;/center&gt;

&lt;h1 id=&quot;1-Preface&quot;&gt;&lt;a href=&quot;#1-Preface&quot; class=&quot;headerlink&quot; title=&quot;1 Preface&quot;&gt;&lt;/a&gt;1 Pref</summary>
      
    
    
    
    <category term="RISC-V" scheme="https://www.beenli.cn/categories/RISC-V/"/>
    
    <category term="spec" scheme="https://www.beenli.cn/categories/RISC-V/spec/"/>
    
    
  </entry>
  
  <entry>
    <title>IEEE Standard(1)--Conventions</title>
    <link href="https://www.beenli.cn/posts/7b1b9603/"/>
    <id>https://www.beenli.cn/posts/7b1b9603/</id>
    <published>2020-09-28T09:44:18.000Z</published>
    <updated>2020-09-30T12:01:11.648Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1ã€Overview"><a href="#1ã€Overview" class="headerlink" title="1ã€Overview"></a>1ã€Overview</h1><h2 id="1-1-Convention"><a href="#1-1-Convention" class="headerlink" title="1.1 Convention"></a>1.1 Convention</h2><p><code>shall</code>: ç”¨äºæ³•å®šçš„è¦æ±‚ï¼ˆmandatory requirementï¼‰</p><p><code>may</code>: ç”¨äºå¯é€‰çš„ç‰¹æ€§ï¼ˆoptional featureï¼‰</p><h2 id="1-2-Syntactic-description"><a href="#1-2-Syntactic-description" class="headerlink" title="1.2 Syntactic description"></a>1.2 Syntactic description</h2><blockquote><p><a href="https://www.jianshu.com/p/15efcb0c06c8">BNFæè¿°æ–¹æ³•</a>(Backus-Naur Form)ï¼š</p><p>åŸºæœ¬ç»“æ„ä¸ºï¼š<non-terminal> ::= <replacement></replacement></non-terminal></p><ul><li><code>::=</code>ï¼šè¢«å®šä¹‰ä¸ºçš„æ„æ€</li><li><code>â€œ  â€</code>: åŒå¼•å·è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯ç»ˆç»“ç¬¦ï¼Œä¸èƒ½å†è¢«å®šä¹‰ã€‚</li><li>åœ¨åŒå¼•å·å¤–çš„å­—ä»£è¡¨ç€è¯­æ³•éƒ¨åˆ†ï¼›<code>åŸºæœ¬ç±»å‹ ::= å­—ç¬¦ä¸² | æ•°å­— | å¸ƒå°”</code>,å…¶ä¸­å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å…·ä½“æ˜¯ä»€ä¹ˆï¼Œç”±ä¸‹é¢çš„è§„åˆ™å®šä¹‰ï¼ˆé€’å½’ï¼‰</li><li><code>&lt;&gt;</code>ï¼šå°–æ‹¬å·é‡Œçš„å†…å®¹è¡¨ç¤ºå¿…é€‰å†…å®¹ï¼›</li><li><code>[...]</code>: è¡¨ç¤ºå¯é€‰ã€‚</li><li><code>{...}</code>:è¡¨ç¤ºé‡å¤ï¼›å®ä¾‹ï¼š<code>AB ::= "a" {"b"}</code>è¡¨ç¤ºï¼šABç”±ä¸€ä¸ªaåŠ ä¸Šä»»æ„æ•°é‡ï¼ˆåŒ…æ‹¬0ä¸ªï¼‰ä¸ªbç»„æˆ</li><li><code>(...)</code>: è¡¨ç¤ºåˆ†ç»„ï¼Œç”¨æ¥æ§åˆ¶ä¼˜å…ˆçº§ï¼›<code>AX ::= "a" ("m"|"n")</code>è¡¨ç¤ºï¼šAXç”±ä¸€ä¸ªaåŠ ä¸Šmæˆ–è€…nç»„æˆ</li><li><code>(*...*)</code> : æ³¨é‡Šï¼Œè¯´æ˜æ€§æ–‡æœ¬ï¼Œä¸è¡¨ç¤ºä»»ä½•è¯­æ³•ã€‚</li></ul></blockquote><ol><li><p>å°å†™å•è¯ï¼Œä¸€äº›åŒ…å«ä¸‹åˆ’çº¿çš„ï¼šè¯­æ³•ç›®å½•ï¼ˆsyntactic categoriesï¼‰</p><p>â€‹        <code>module_declaration</code></p></li><li><p>ç²—ä½“ï¼šä¿ç•™å­—ã€æ“ä½œç¬¦ã€æ ‡ç‚¹ç¬¦å·</p><p>â€‹    <code>module</code>            <code>=&gt;</code>                <code>;</code></p></li><li><p>ç«–æ¡|åˆ†å‰²å¯é€‰å•å…ƒã€‚å¦‚æœå®ƒä»¥ç²—ä½“å½¢å¼å‡ºç°ï¼Œå®ƒæ‰è¡¨ç¤ºè‡ªå·±ã€‚</p><p>â€‹    unary_operator ::= + |  -  |  ! |  ~ |  &amp; |   ~&amp; |   <strong>|</strong>(æˆ–)  |  ~|(æˆ–é)  |  ^  |  ~^ |  ^~ï¼ˆéƒ½è¡¨ç¤ºåŒæˆ–)</p></li><li><p>æ–¹æ‹¬å·[â€¦]åŒ…å«å¯é€‰é¡¹ã€‚</p><p><code>input_declaration ::= input [range] list_of_variables;</code></p></li><li><p>èŠ±æ‹¬å·<code>{}</code>é™¤éä»¥ç²—ä½“å‡ºç°ï¼Œå®ƒæ‰è¡¨ç¤ºè‡ªå·±ï¼Œå¦åˆ™è¡¨ç¤ºé‡å¤ã€‚é‡å¤ä»å·¦åˆ°å³è¿›è¡Œï¼Œå’Œå·¦é€’å½’ç­‰æ•ˆã€‚</p><ul><li><p>list_of_param_assignments ::= param_assignment  { , param_assignment }</p></li><li><p>list_of_param_assignments ::=<br>param_assignment| list_of_param_assignment , param_assignment</p></li></ul></li><li><p>ä»»ä½•ç›®å½•çš„åå­—ä»¥æ–œä½“å¼€å¤´ï¼Œç­‰æ•ˆäºæ²¡æœ‰æ–œä½“éƒ¨åˆ†çš„ç›®å½•åã€‚æ–œä½“éƒ¨åˆ†åªæ˜¯ä¸ºäº†ä¼ è¾¾<code>semantic information</code>ã€‚</p><p><img src="https://image.beenli.cn/img/20200928/OpmV1Dh0HDh6.jpg?imageslim" alt="mark"></p></li><li><p>æ­£æ–‡ä¸­å½“ä¸€ä¸ªtermè¢«å®šä¹‰æ—¶ä½¿ç”¨æ–œä½“ï¼›åœ¨ä¾‹å­ï¼Œæ–‡ä»¶åï¼Œå¸¸é‡ç‰¹åˆ«æ—¶0ï¼Œ1ï¼Œxå’Œzçš„å€¼æ—¶ä½¿ç”¨<code>constant-width</code>å­—ä½“ï¼ˆç­‰å®½å­—ä½“ï¼‰</p></li></ol><h1 id="2ã€Lexical-convention"><a href="#2ã€Lexical-convention" class="headerlink" title="2ã€Lexical convention"></a>2ã€Lexical convention</h1><h2 id="2-1ã€Lexical-tokens"><a href="#2-1ã€Lexical-tokens" class="headerlink" title="2.1ã€Lexical tokens"></a>2.1ã€Lexical tokens</h2><blockquote><p>Verilog HDL source file shall be a stream of lexical tokens. A <code>lexical tokens</code> shall consist of one or more characters.<br>verilogæºæ–‡ä»¶åº”è¯¥æ˜¯ä¸€è¿ä¸²è¯­æ³•æ ‡è®°ï¼Œä¸€ä¸ªè¯­æ³•æ ‡è®°ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ç»„æˆã€‚</p></blockquote><p>æºæ–‡ä»¶ä¸­tokensçš„ä½ç½®æ˜¯éšæ„çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šé™¤äº†tokenåˆ†éš”ç¬¦ï¼Œç©ºæ ¼å’Œæ¢è¡Œä¸åº”è¯¥æœ‰ç‰¹æ®Šæ„ä¹‰ï¼Œè½¬ä¹‰å­—ç¬¦é™¤å¤–ã€‚</p><p>æœ‰å¦‚ä¸‹å‡ ç§è¯­æ³•æ ‡è®°</p><ul><li>White space</li><li>Comment</li><li>Operator</li><li>Number</li><li>String</li><li>Identifier</li><li>Keyword</li></ul><h2 id="2-2ã€White-space"><a href="#2-2ã€White-space" class="headerlink" title="2.2ã€White space"></a>2.2ã€White space</h2><p>white spaceåº”è¯¥åŒ…å«ï¼šç”¨äºç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦å’Œæ ¼å¼æè¦çš„å­—ç¬¦ã€‚è¿™äº›å­—ç¬¦åº”è¯¥è¢«å¿½ç•¥é™¤äº†å½“å®ƒä»¬ç”¨äºåˆ†å‰²å…¶ä»–è¯­æ³•æ ‡è®°(tokens)ã€‚ä½†æ˜¯blankså’Œtabsè¢«è®¤ä¸ºæ˜¯æœ‰æ„ä¹‰çš„å­—ç¬¦åœ¨å­—ç¬¦ä¸²ä¸­ã€‚</p><h2 id="2-3ã€Comments"><a href="#2-3ã€Comments" class="headerlink" title="2.3ã€Comments"></a>2.3ã€Comments</h2><ul><li>å•è¡Œæ³¨é‡Š <code>//</code></li><li>å—æ³¨é‡Šï¼š<code>/*</code>   â€¦. <code>*/</code></li></ul><h2 id="2-4ã€Operators"><a href="#2-4ã€Operators" class="headerlink" title="2.4ã€Operators"></a>2.4ã€Operators</h2><blockquote><p>æ“ä½œç¬¦å¯ä»¥æ˜¯å•ä¸ªï¼ŒåŒä¸ªæˆ–ä¸‰ä¸ªå­—ç¬¦çš„åºåˆ—ï¼Œå¹¶è¢«ç”¨åœ¨è¡¨è¾¾å¼ä¸­ã€‚<a href="#">Clause5</a>å°†è®¨è®ºè¡¨è¾¾å¼ä¸­æ“ä½œç¬¦çš„ä½¿ç”¨ã€‚</p></blockquote><p>å•ç›®è¿ç®—ç¬¦(<em>Unary operators</em>)ï¼šåœ¨æ“ä½œæ•°(operand)çš„å·¦è¾¹</p><p>åŒç›®è¿ç®—ç¬¦(<em>Binary  operators</em>)ï¼šåœ¨ä¸¤ä¸ªæ“ä½œæ•°ä¸­é—´</p><p>ä¸‰æœ¨è¿ç®—ç¬¦(<em>Triple operator</em> or <em>conditional operator</em>): æœ‰ä¸¤ä¸ªæ“ä½œç¬¦å­—ç¬¦åˆ†å‰²ä¸‰ä¸ªæ“ä½œæ•°ï¼ˆa? x: y)</p><h2 id="2-5ã€Numbers"><a href="#2-5ã€Numbers" class="headerlink" title="2.5ã€Numbers"></a>2.5ã€Numbers</h2><p><em>Constant numbers</em>å¯ä»¥è¢«æŒ‡å®šä¸º<code>integer constant</code>æˆ–è€…<code>real constant</code></p><h3 id="2-5-1ã€Integer-constant"><a href="#2-5-1ã€Integer-constant" class="headerlink" title="2.5.1ã€Integer constant"></a>2.5.1ã€Integer constant</h3><p>æœ‰ä¸¤ç§è¡¨è¾¾æ–¹å¼ï¼š</p><ol><li><a href="#simple">ç®€å•çš„åè¿›åˆ¶æ•°</a>ï¼ša sequence of digits of 0 through 9ã€‚å¼€å¤´å¯ä»¥åŠ ä¸Š<code>+</code>æˆ–è€…<code>-</code>ï¼ˆè¢«è§†ä¸ºæœ‰ç¬¦å·çš„æ•´æ•°ï¼‰</li><li>æŒ‡å®šåŸºç ï¼ˆdï¼Œhï¼Œoï¼Œbï¼‰ï¼šå¯é€‰çš„<code>ä½å®½</code>+<code>'(ASCII 0x27)</code>+<code>åŸºç </code>+<code>digits</code><ul><li>ä½å®½ï¼šéé›¶æ— ç¬¦å·åè¿›åˆ¶æ•°</li><li>åŸºç ï¼šå¤§å°å†™ä¸æ•æ„Ÿï¼›å‰é¢å¯é€‰sæŒ‡ç¤ºæ˜¯å¦ä¸ºæœ‰ç¬¦å·æ•°ï¼ˆæ²¡æœ‰sæ—¶é»˜è®¤ä¸ºunsigned integers)</li><li><code>'</code>ä¸<code>åŸºç </code>ä¸­é—´ä¸èƒ½æœ‰ç©ºæ ¼ã€‚<span class="github-emoji" style="display:inline;vertical-align:middle"><span>â­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></li><li><code>digits</code>: åº”è¯¥ç´§è·Ÿç€<code>åŸºç </code>ï¼Œå‰é¢ä¹Ÿå¯ä»¥æœ‰ç©ºæ ¼ã€‚a-fä¸åŒºåˆ†å¤§å°å†™</li><li><a href="#s"><code>s</code>ä¸å½±å“æŒ‡å®šçš„ä½æ¨¡å¼ï¼Œåªæ”¹å˜è§£é‡Šæ–¹å¼ã€‚â“</a></li></ul></li></ol><ul><li>è´Ÿæ•°ç”¨è¡¥ç è¡¨ç¤º</li><li>xä»£è¡¨<code>unknown value</code>ï¼›zä»£è¡¨<code>high-impedance value</code>ï¼ˆxåº”è¯¥è®¾ä¸º4bitå¯¹äºhçš„åŸºç ï¼Œ3bitå¯¹äºoçš„åŸºç ï¼›zåŒç†ï¼‰</li><li><a href="#left pad">å¦‚æœæ— ç¬¦å·æ•°ä½å®½å°äºæŒ‡å®šä½å®½ï¼Œé‚£ä¹ˆç”¨0å¡«å……ï¼›</a>å¦‚æœæ— ç¬¦å·æ•°æœ€å·¦è¾¹çš„ä½æ˜¯xæˆ–z;é‚£ä¹ˆç”¨xæˆ–zå¡«å……ã€‚å¦‚æœæ— ç¬¦å·ä½å®½å¤§äºæŒ‡å®šï¼Œé‚£ä¹ˆåº”è¯¥ä»å·¦è¾¹æˆªæ–­åˆ°æŒ‡å®šä½å®½ã€‚</li><li>æ²¡æœ‰æŒ‡å®šä½å®½çš„æ•°å­—è‡³å°‘ä¸º<code>32ä½</code>ï¼›å¯¹äºé«˜ä½æ˜¯xæˆ–è€…zçš„æ²¡æœ‰ä½å®½æ— ç¬¦å·å¸¸æ•°åº”ä½æ‰©å±•åˆ°åŒ…å«è¯¥å¸¸æ•°çš„è¡¨è¾¾å¼çš„å¤§å°ã€‚â“</li><li><code>?</code>æ˜¯<code>z</code>çš„æ›¿ä»£å­—ç¬¦ã€‚åœ¨é«˜é˜»å€¼ä¸éœ€è¦æ³¨æ„æ—¶ï¼Œå¯ç”¨ï¼Ÿæ¥å¢åŠ å¯è¯»æ€§ã€‚</li><li>åœ¨åè¿›åˆ¶å¸¸æ•°ä¸­ï¼Œæ— ç¬¦å·æ•°ä¸èƒ½åŒ…å«ä»»ä½•x,z,?ï¼›é™¤éåªæœ‰ä¸€ä¸ªdigitï¼ŒæŒ‡ç¤ºå…¶ä¸­æ¯ä¸€ä½éƒ½æ˜¯xæˆ–è€…zã€‚</li><li><a href="#underscore"><code>_</code>ä¸‹åˆ’çº¿</a>åœ¨æ•°å­—çš„ä»»ä½•ä½ç½®éƒ½æ˜¯åˆæ³•çš„ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚ä¸‹åˆ’çº¿æ˜¯æ²¡æœ‰æ„ä¹‰çš„ ï¼Œåªæ˜¯ä¸ºäº†åˆ†å‰²é•¿çš„æ•°å­—æé«˜å¯è¯»æ€§ã€‚</li></ul><p><strong><a name="simple">æ— ç¬¦å·æ•°ï¼š</a></strong></p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">/************* Example 1--Unsized constant numbers *****************/</span><br><span class="hljs-number">659</span>    <span class="hljs-comment">// is a decimal number </span><br>'h <span class="hljs-number">837</span>FF  <span class="hljs-comment">// is a hexadecimal number </span><br><span class="hljs-number">'o7460</span>   <span class="hljs-comment">// is an octal number </span><br><span class="hljs-number">4</span>af   <span class="hljs-comment">// is illegal (hexadecimal format requires 'h)</span><br><br><span class="hljs-comment">/************* Example 2--Sized constant numbers *****************/</span><br><span class="hljs-number">4'b1001</span> <span class="hljs-comment">// is a 4-bit binary number </span><br><span class="hljs-number">5</span> 'D <span class="hljs-number">3</span> <span class="hljs-comment">// is a 5-bit decimal number </span><br><span class="hljs-number">3'b01x</span> <span class="hljs-comment">// is a 3-bit number with the least significant bit unknown </span><br><span class="hljs-number">12'hx</span> <span class="hljs-comment">// is a 12-bit unknown number </span><br><span class="hljs-number">16'hz</span> <span class="hljs-comment">// is a 16-bit high-impedance number</span><br></code></pre></td></tr></tbody></table></figure><p><strong><a name="s">æœ‰ç¬¦å·æ•°çš„è¡¨ç¤ºæ„ä¹‰ï¼š</a></strong></p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">/************* Example 3â€”Using sign with constant numbers *****************/</span><br><span class="hljs-number">8</span> 'd -<span class="hljs-number">6</span> <span class="hljs-comment">// this is illegal syntax </span><br>-<span class="hljs-number">8</span> 'd <span class="hljs-number">6</span> <span class="hljs-comment">// this defines the two's complement of 6, held in 8 bitsâ€”equivalent to -(8'd 6) </span><br><span class="hljs-number">4</span> 'shf <span class="hljs-comment">// this denotes the 4-bit number '1111', to be interpreted as a 2's complement number, </span><br><span class="hljs-comment">// or '-1'. This is equivalent to -4'h 1 </span><br>-<span class="hljs-number">4</span> 'sd15 <span class="hljs-comment">// this is equivalent to -(-4'd 1), or '0001'</span><br><span class="hljs-number">16</span>'sd?   <span class="hljs-comment">// the same as 16'sbz </span><br></code></pre></td></tr></tbody></table></figure><p><strong><a name="left pad">è‡ªåŠ¨å·¦å¡«å……ï¼š</a></strong></p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">/************* Example 4â€”Automatic left padding **************************/</span><br><span class="hljs-keyword">reg</span>  [<span class="hljs-number">11</span>:<span class="hljs-number">0</span>] a, b, c, d;<br><span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>a = 'h x; <span class="hljs-comment">// yields xxx</span><br>b = 'h <span class="hljs-number">3</span>x; <span class="hljs-comment">// yields 03x</span><br>c = 'h z3; <span class="hljs-comment">// yields zz3</span><br>d = 'h <span class="hljs-number">0</span>z3; <span class="hljs-comment">// yields 0z3</span><br><span class="hljs-keyword">end</span><br><span class="hljs-keyword">reg</span>  [<span class="hljs-number">84</span>:<span class="hljs-number">0</span>]      e, f, g; <br>e = <span class="hljs-number">'h5</span>;    <span class="hljs-comment">// yields {82{1'b0},3'b101}</span><br>f = <span class="hljs-number">'hx</span>;    <span class="hljs-comment">// yields {85{1'hx}}</span><br>g = <span class="hljs-number">'hz</span>;    <span class="hljs-comment">// yields {85{1'hz}}</span><br></code></pre></td></tr></tbody></table></figure><p><a name="underscore"><strong>ä½¿ç”¨ä¸‹åˆ’çº¿ï¼š</strong></a></p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">/************* Using underscore character in numbers *******************/</span><br><span class="hljs-number">27_195_000</span> <br><span class="hljs-number">16'b0011_0101_0001_1111</span> <br><span class="hljs-number">32</span> 'h <span class="hljs-number">12</span>ab_f001  <br></code></pre></td></tr></tbody></table></figure><h3 id="2-5-2ã€Real-constants"><a href="#2-5-2ã€Real-constants" class="headerlink" title="2.5.2ã€Real constants"></a>2.5.2ã€Real constants</h3><blockquote><p><em>real constants</em>ç”¨<a href="https://en.wikipedia.org/wiki/IEEE_754-1985">IEEE Std 754-1985</a>ï¼ŒåŒç²¾åº¦æµ®ç‚¹æ•°è¡¨ç¤º</p></blockquote><p>æœ‰ä¸¤ç§è¡¨ç¤ºæ–¹æ³•ï¼š</p><ol><li>åè¿›åˆ¶è¡¨ç¤ºï¼š14.72</li><li>ç§‘å­¦è®¡æ•°æ³•ï¼š39e8ï¼ˆè¡¨ç¤º39ä¹˜ä»¥10çš„8æ¬¡æ–¹ï¼‰</li></ol><p>æ³¨æ„ï¼šå¸¦æœ‰å°æ•°ç‚¹çš„å®æ•°è‡³å°‘åœ¨å°æ•°ç‚¹ä¸¤è¾¹å„æœ‰ä¸€ä½ã€‚</p><p><code>.12</code>  &nbsp;<code>9.</code> &nbsp; <code>4.E3</code> &nbsp; <code>.2e-7</code> éƒ½æ˜¯ä¸åˆæ³•çš„</p><h3 id="2-5-3ã€Convertion"><a href="#2-5-3ã€Convertion" class="headerlink" title="2.5.3ã€Convertion"></a>2.5.3ã€Convertion</h3><p>å®æ•°å‘æ•´æ•°è½¬åŒ–ï¼šå››èˆäº”å…¥åˆ°æœ€è¿‘çš„æ•´æ•°ï¼Œè€Œä¸æ˜¯æˆªæ–­ã€‚</p><p>å½“ä¸€ä¸ªå®æ•°è¢«èµ‹å€¼ç»™æ•´æ•°æ—¶ï¼šè¿›è¡Œéšå£«è½¬åŒ–(implicit conversion)</p><p>å››èˆäº”å…¥è§„åˆ™ï¼šaway from zero</p><ul><li>-1.5 è½¬åŒ–ä¸º-2ï¼›1.5è½¬åŒ–ä¸º2</li></ul><h2 id="2-6ã€Strings"><a href="#2-6ã€Strings" class="headerlink" title="2.6ã€Strings"></a>2.6ã€Strings</h2><blockquote><p><code>å­—ç¬¦ä¸²</code>æ˜¯ä¸€ä¸ªå­—ç¬¦åºåˆ—ï¼Œç”¨(â€œ â€œ)æ‹¬èµ·æ¥ï¼ŒåŒ…å«åœ¨ä¸€è¡Œä¸­ã€‚å­—ç¬¦ä¸²å¯ä»¥ç”¨ä½œè¡¨è¾¾å¼çš„æ“ä½œæ•°ï¼›èµ‹å€¼æ—¶è¢«å½“æˆæ— ç¬¦å·æ•´æ•°å¸¸æ•°ï¼Œä¸€ä¸ª8-bitçš„ASCIIå€¼å¯¹åº”ä¸€ä¸ªå­—ç¬¦ã€‚</p></blockquote><h3 id="2-6-1ã€String-variable-declaration"><a href="#2-6-1ã€String-variable-declaration" class="headerlink" title="2.6.1ã€String variable declaration"></a>2.6.1ã€String variable declaration</h3><blockquote><p>å­—ç¬¦ä¸²å˜é‡æ˜¯<code>reg</code>ç±»å‹ï¼Œå®½åº¦=å­—ç¬¦ä¸ªæ•°*8</p></blockquote><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">/********* "Hello world!"ä¸€å…±12ä¸ªå­—ç¬¦ ********/</span><br><span class="hljs-keyword">reg</span> [<span class="hljs-number">8</span>*<span class="hljs-number">12</span>:<span class="hljs-number">1</span>] stringvar;<br><span class="hljs-keyword">initial</span>   <span class="hljs-keyword">begin</span><br>  stringvar = <span class="hljs-string">"Hello world!"</span>;<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></tbody></table></figure><h3 id="2-6-2ã€String-manipulation"><a href="#2-6-2ã€String-manipulation" class="headerlink" title="2.6.2ã€String manipulation"></a>2.6.2ã€String manipulation</h3><blockquote><p>å­—ç¬¦ä¸²å¯ä»¥ç”¨Verilogçš„æ“ä½œç¬¦è¿›è¡Œæ“çºµã€‚è¢«æ“çºµçš„å€¼æ˜¯8bit ASCIIå€¼åºåˆ—</p></blockquote><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">module</span>  string_test;<br><span class="hljs-keyword">reg</span>  [<span class="hljs-number">8</span>*<span class="hljs-number">14</span>:<span class="hljs-number">1</span>] stringvar;<br><span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>    stringvar = <span class="hljs-string">"Hello world"</span>;<br>    <span class="hljs-built_in">$display</span> (<span class="hljs-string">"%s is stored as %h"</span>, stringvar,stringvar);<br>    stringvar = {stringvar,<span class="hljs-string">"!!!"</span>};<br>    <span class="hljs-built_in">$display</span> (<span class="hljs-string">"%s is stored as %h"</span>, stringvar,stringvar);<br><span class="hljs-keyword">end</span><br><span class="hljs-keyword">endmodule</span><br><br><br><span class="hljs-comment">/************** outputs ****************/</span><br>Hello world is stored as <span class="hljs-number">00000048656</span>c6c6f20776f726c64<br>Hello world!!! is stored as <span class="hljs-number">48656</span>c6c6f20776f726c64212121<br></code></pre></td></tr></tbody></table></figure><ul><li>å½“å˜é‡å ç”¨ç©ºé—´å¤§äºæ‰€åˆ†é…çš„ç©ºé—´æ—¶ï¼Œå€¼å‘å³è°ƒæ•´ï¼Œæœ€å·¦è¾¹ç”¨0å¡«å……ï¼Œä¸å¤„ç†éå­—ç¬¦ä¸²çš„å€¼ä¸€æ ·ã€‚</li><li>å½“å ç”¨ç©ºé—´å¤§äºåˆ†é…ç©ºé—´æ—¶ï¼Œå­—ç¬¦ä¸²è¿˜æ˜¯å‘å³è°ƒæ•´ï¼Œæœ€å·¦è¾¹çš„æˆªæ–­ã€‚</li></ul><h3 id="2-6-3-Special-characters-in-strings"><a href="#2-6-3-Special-characters-in-strings" class="headerlink" title="2.6.3 Special characters in strings"></a>2.6.3 Special characters in strings</h3><blockquote><p>æœ‰äº›å­—ç¬¦åªæœ‰å‰é¢åŠ ä¸Š<code>escape character</code>å®ƒä»¬æ‰èƒ½åœ¨å­—ç¬¦ä¸²é‡Œé¢ä½¿ç”¨</p></blockquote><p><img src="https://image.beenli.cn/img/20200928/SL0ReCcivKw9.jpg?imageslim" alt="mark"></p><h2 id="2-7ã€Identifiersï¼Œkeywords-and-system-names"><a href="#2-7ã€Identifiersï¼Œkeywords-and-system-names" class="headerlink" title="2.7ã€Identifiersï¼Œkeywords,and system names"></a>2.7ã€Identifiersï¼Œkeywords,and system names</h2><blockquote><p><code>æ ‡è¯†ç¬¦</code>ç”¨äºç»™ä¸€ä¸ªå¯¹è±¡ç‹¬ä¸€æ— äºŒçš„åå­—ï¼Œä½¿å¾—å®ƒä»¬èƒ½å‘—å¼•ç”¨ã€‚</p></blockquote><p>ç®€å•çš„æ ‡è¯†ç¬¦ï¼šå­—æ¯ï¼Œæ•°å­—ï¼Œ<code>$</code>,&nbsp;&nbsp;<code>_</code>ç»„æˆã€‚å¼€å¤´åªèƒ½æ˜¯å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿ã€‚ï¼ˆ<code>_bus</code>, <code>wan$li</code>)</p><p>å®ç°çš„æ—¶å€™æ ‡è¯†ç¬¦æœ‰æœ€å¤§é•¿åº¦ï¼Œå®ƒçš„é™åˆ¶åº”è¯¥è‡³å°‘ä¸º1024ä¸ªå­—ç¬¦ã€‚å¦‚æœä¸€ä¸ªæ ‡è¯†ç¬¦é•¿åº¦è¶…è¿‡è¿™ä¸ªï¼Œç³»ç»Ÿåº”è¯¥æŠ¥é”™ã€‚</p><h3 id="2-7-1-Escaped-identifiers"><a href="#2-7-1-Escaped-identifiers" class="headerlink" title="2.7.1 Escaped identifiers"></a>2.7.1 Escaped identifiers</h3><blockquote><p><code>è½¬ä¹‰æ ‡è¯†ç¬¦</code>ä»¥åæ–œæ <code>\</code>å¼€å§‹ï¼Œä»¥<code>white space</code>(space,  tab,newline)ç»“æŸã€‚å®ƒä»¬æä¾›äº†åœ¨æ ‡è¯†ç¬¦ä¸­åŒ…å«ä»»ä½•å¯æ‰“å°å­—ç¬¦çš„æ–¹æ³•ï¼ˆ33(!)-126(~)ï¼›$21_h$-$7E_h$)ã€‚</p></blockquote><p>å‰å¯¼åæ–œæ å’Œç»“å°¾çš„ç©ºç™½å­—ç¬¦éƒ½ä¸ç®—æ ‡è¯†ç¬¦çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤ï¼Œ<code>\cpu3</code>è¢«è®¤ä¸ºå’Œ<code>cpu3</code>ä¸€æ ·ã€‚</p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs verilog">\busa+index<br>\-clock<br>\***error-condition***<br>\net1/\net2<br>\{a,b}<br>\a*(b+c)<br></code></pre></td></tr></tbody></table></figure><h3 id="2-7-2-Keywords"><a href="#2-7-2-Keywords" class="headerlink" title="2.7.2 Keywords"></a>2.7.2 Keywords</h3><blockquote><p>å…³é”®å­—æ˜¯å…ˆå‰å®šä¹‰å¥½çš„éè½¬ä¹‰æ ‡è¯†ç¬¦ï¼Œå®ƒä»¬è¢«ç”¨æ¥å®šä¹‰è¯­è¨€ç»“æ„ã€‚å…³é”®å­—å‰é¢åŠ ä¸Šè½¬ä¹‰å­—ç¬¦ä¸è¢«è§£é‡Šä¸ºå…³é”®å­—</p></blockquote><p><img src="https://image.beenli.cn/img/20200928/uC5F8kwPRFzL.jpg?imageslim" alt="mark"></p><h3 id="2-7-3-System-tasks-and-functionsâ“"><a href="#2-7-3-System-tasks-and-functionsâ“" class="headerlink" title="2.7.3 System tasks and functionsâ“"></a>2.7.3 System tasks and functionsâ“</h3><blockquote><p>ç¾å…ƒç¬¦å·(<script type="math/tex">`)å¼•å¯¼ä¸€ç§è¯­è¨€ç»“æ„ï¼šå®ƒèƒ½å¼€å‘ç”¨æˆ·å®šä¹‰çš„ä»»åŠ¡å’Œå‡½æ•°ï¼›System constructsä¸æ˜¯è®¾è®¡åŸè¯­ï¼Œè€Œæ˜¯ä»¿çœŸåŠŸèƒ½ã€‚ç¾å…ƒ(`</script>)å¼€å¤´çš„åå­—è¢«è§£é‡Šä¸ºç³»ç»Ÿä»»åŠ¡æˆ–è€…ç³»ç»Ÿå‡½æ•°ã€‚</p></blockquote><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">/*********** for example **********/</span><br><span class="hljs-built_in">$display</span>  (<span class="hljs-string">"display a message"</span>);<br><span class="hljs-built_in">$finish</span> ;<br></code></pre></td></tr></tbody></table></figure><h3 id="2-7-4-Compiler-directives"><a href="#2-7-4-Compiler-directives" class="headerlink" title="2.7.4 Compiler directives"></a>2.7.4 Compiler directives</h3><blockquote><p>`ï¼ˆASICC value 0x60)å­—ç¬¦å¼•å¯¼ç”¨äºå®ç°ç¼–è¯‘å™¨æŒ‡ä»¤çš„è¯­è¨€ç»“æ„ï¼›ï¼Œä¸€ä¸ªæè¿°æ–‡ä»¶ä¸­çš„ç¼–è¯‘å™¨æŒ‡ä»¤å¯ä»¥æ§åˆ¶å¤šä¸ªæè¿°æ–‡ä»¶ä¸­çš„ç¼–è¯‘è¡Œä¸ºã€‚</p></blockquote><p>`identifier ç¼–è¯‘å™¨æŒ‡ä»¤ç»“æ„åœ¨ä»¥ä¸‹ä¸¤ç§åœ°æ–¹å®šä¹‰</p><ul><li>æ ‡å‡†æ ‡è¯†ç¬¦ç¼–è¯‘å™¨æŒ‡ä»¤</li><li>ç”±è½¯ä»¶å®ç°å®šä¹‰çš„é™„åŠ â€™æ ‡è¯†ç¬¦ç¼–è¯‘å™¨æŒ‡ä»¤ã€‚</li></ul><p>ä»»ä½•æœ‰æ•ˆçš„æ ‡è¯†ç¬¦ï¼ŒåŒ…æ‹¬å·²ç»åœ¨é™¤æ­¤æ„é€ ä¹‹å¤–çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨çš„å…³é”®å­—ï¼Œéƒ½å¯ä»¥ç”¨ä½œç¼–è¯‘å™¨æŒ‡ä»¤å</p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">/*********** for example **********/</span><br><span class="hljs-meta">`<span class="hljs-meta-keyword">define</span>  wordsize 8</span><br></code></pre></td></tr></tbody></table></figure><h2 id="2-8ã€Attributes"><a href="#2-8ã€Attributes" class="headerlink" title="2.8ã€Attributes"></a>2.8ã€Attributes</h2><blockquote><p>éšç€ä½¿ç”¨Verilog HDLä½œä¸ºæºä»£ç çš„ä»¿çœŸå™¨ä»¥å¤–çš„å·¥å…·çš„æ¿€å¢(proliferation); Verilogå¼•å…¥ä¸€ç§æœºåˆ¶ï¼šç”¨äºæŒ‡å®šå…³äºHDLæºä»£ç ä¸­å¯¹è±¡ã€è¯­å¥å’Œè¯­å¥ç»„çš„å±æ€§ï¼Œè¿™äº›å±æ€§å¯è¢«å„ç§å·¥å…·(åŒ…æ‹¬æ¨¡æ‹Ÿå™¨)ä½¿ç”¨ï¼Œä»¥æ§åˆ¶å·¥å…·çš„æ“ä½œæˆ–è¡Œä¸ºã€‚è¿™äº›å±æ€§è¢«ç§°ä½œ<code>attribute</code>. æœ¬å°èŠ‚å°†ä»‹ç»: å¯ä»¥ç”¨äºæŒ‡å®šå±æ€§çš„è¯­æ³•æœºåˆ¶ã€‚</p></blockquote><figure class="highlight delphi"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs delphi">attribute_instance ::= <span class="hljs-comment">(* attr_spec { , attr_spec } *)</span>  <br>attr_spec ::= <br>attr_name [ = constant_expression ]<br>attr_name ::= <br>identifier <br></code></pre></td></tr></tbody></table></figure><p><code>attribute_instance</code>ï¼š1ã€ä½œä¸ºå£°æ˜ï¼Œæ¨¡å—é¡¹ç›®ï¼Œè¯­å¥æˆ–è€…ç«¯å£è¿æ¥çš„å‰ç¼€ã€‚2ã€è¿ç®—ç¬¦æˆ–åœ¨ä¸€ä¸ªè¡¨è¾¾å¼ä¸­Verilogå‡½æ•°åçš„åç¼€</p><p>å¦‚æœæ²¡æœ‰ç»™å±æ€§æŒ‡æ´¾å€¼ï¼Œé‚£ä¹ˆå€¼é»˜è®¤ä¸º1ï¼›å¦‚æœå¯¹ç›¸åŒçš„language elementå®šä¹‰å¤šä¸ªç›¸åŒçš„å±æ€§åå­—ï¼Œé‚£ä¹ˆæœ€åä¸€ä¸ªå±æ€§å€¼å°†è¢«ä½¿ç”¨ï¼›å·¥å…·å¯ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ç»™ä¸ªwarningã€‚</p><p>nesting of attribute instances ä¸è¢«å…è®¸ï¼›ç”¨åŒ…å«å±æ€§å®ä¾‹çš„å¸¸é‡è¡¨è¾¾å¼(constant expression that contains an attribute instance)å»ç»™å±æ€§èµ‹å€¼æ˜¯ä¸åˆæ³•çš„ã€‚</p><h3 id="2-8-1-Examples"><a href="#2-8-1-Examples" class="headerlink" title="2.8.1 Examples"></a>2.8.1 Examples</h3><ul><li><p>èŒƒä¾‹1ï¼šç»™caseè¯­å¥è´´ä¸Šå±æ€§</p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs verilog">(* full_case, parallel_case *)<br><span class="hljs-keyword">case</span>  (foo)<br>&lt;rest_of_case_statement&gt;<br><br><span class="hljs-keyword">or</span><br><br>(* full_case=<span class="hljs-number">1</span> *)<br>(* parallel_case=<span class="hljs-number">1</span> *) <span class="hljs-comment">// Multiple attribute instances also OK</span><br><span class="hljs-keyword">case</span>  (foo)<br>&lt;rest_of_case_statement&gt;<br><br><span class="hljs-keyword">or</span><br><br>(* full_case, <span class="hljs-comment">// no value assignedï¼›é»˜è®¤ä¸º1</span><br>parallel_case=<span class="hljs-number">1</span> *)<br><span class="hljs-keyword">case</span>  (foo)<br>&lt;rest_of_case_statement&gt;<br></code></pre></td></tr></tbody></table></figure></li><li><p>èŒƒä¾‹2ï¼šç»™æ¨¡å—å®šä¹‰åŠ å±æ€§</p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs verilog">(* optimize_power *)<br><span class="hljs-keyword">module</span>  mod1 (&lt;port_list&gt;);<br></code></pre></td></tr></tbody></table></figure></li><li><p>èŒƒä¾‹3ï¼šç»™æ¨¡å—å®ä¾‹åŠ å±æ€§</p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs verilog">(* optimize_power=<span class="hljs-number">0</span> *)<br>mod1 synth1 (&lt;port_list&gt;);<br></code></pre></td></tr></tbody></table></figure></li><li><p>èŒƒä¾‹4ï¼šç»™regå£°æ˜åŠ å±æ€§</p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs verilog">(* fsm_state *)  <span class="hljs-keyword">reg</span>  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] state1;<br>(* fsm_state=<span class="hljs-number">1</span> *)  <span class="hljs-keyword">reg</span>  [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] state2, state3;<br><span class="hljs-keyword">reg</span>  [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] reg1;  <span class="hljs-comment">// this  reg  does NOT have fsm_state set</span><br>(* fsm_state=<span class="hljs-number">0</span> *)  <span class="hljs-keyword">reg</span>  [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] reg2;  <span class="hljs-comment">// nor does this one</span><br></code></pre></td></tr></tbody></table></figure></li><li><p>èŒƒä¾‹5ï¼šç»™æ“ä½œç¬¦åŠ å±æ€§</p><figure class="highlight verilog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs verilog">a = b ? (* no_glitch *) c : d;<br>a = b + (* mode = <span class="hljs-string">"cla"</span> *) c;<br></code></pre></td></tr></tbody></table></figure><h3 id="2-8-2-Syntax-çœç•¥"><a href="#2-8-2-Syntax-çœç•¥" class="headerlink" title="2.8.2 Syntax(çœç•¥)"></a>2.8.2 Syntax(çœç•¥)</h3></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1ã€Overview&quot;&gt;&lt;a href=&quot;#1ã€Overview&quot; class=&quot;headerlink&quot; title=&quot;1ã€Overview&quot;&gt;&lt;/a&gt;1ã€Overview&lt;/h1&gt;&lt;h2 id=&quot;1-1-Convention&quot;&gt;&lt;a href=&quot;#1-1-Con</summary>
      
    
    
    
    <category term="Digital IC" scheme="https://www.beenli.cn/categories/Digital-IC/"/>
    
    <category term="verilog" scheme="https://www.beenli.cn/categories/Digital-IC/verilog/"/>
    
    
    <category term="specification" scheme="https://www.beenli.cn/tags/specification/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®é€šè·¯(4)--Multiple Issue</title>
    <link href="https://www.beenli.cn/posts/a36b1d36/"/>
    <id>https://www.beenli.cn/posts/a36b1d36/</id>
    <published>2020-09-27T11:04:08.000Z</published>
    <updated>2020-09-28T03:50:35.348Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h1><blockquote><p><code>æŒ‡ä»¤é›†å¹¶è¡Œ</code>(instruction-level parallelism)æœ‰ä¸¤ç§æ–¹å¼</p><p>â… ã€<a href="https://www.beenli.cn/posts/d4768fc/">Pipeline</a>â€”â€”è¯¦è§æ•°æ®é€šè·¯(3)ï¼›æµæ°´çº¿è¶Šæ·±ï¼Œå¹¶è¡Œåº¦è¶Šé«˜ã€‚</p><p>â…¡ã€<code>å¤šå‘å°„</code>ï¼ˆmultiple issueï¼‰: æœ¬èŠ‚æ‰€è¦è®²è¿°çš„é‡ç‚¹ã€‚é€šè¿‡å¤åˆ¶è®¡ç®—æœºå†…éƒ¨éƒ¨ä»¶çš„æ•°é‡ï¼Œä½¿å¾—æ¯ä¸ªæµæ°´çº§å¯ä»¥å¯åŠ¨å¤šæ¡æŒ‡ä»¤</p></blockquote><ul><li>å¤šå‘å°„å¯ä»¥ä½¿æŒ‡ä»¤æ‰§è¡Œé€Ÿåº¦è¶…è¿‡æ—¶é’Ÿçš„é€Ÿåº¦ï¼Œå³CPIå°äº1ã€‚</li><li>å®ç°å¤šå‘å°„æœ‰ä¸¤ç§åŠæ³•ï¼š1ã€<code>static multiple issue</code>ï¼›2ã€<code>dynamic multiple issue</code>ã€‚</li></ul><p>å¤šå‘å°„æµæ°´çº¿å¿…é¡»å¤„ç†ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>æ‰“åŒ…æŒ‡ä»¤åˆ°<code>å‘å°„æ§½</code>(issue slots)ï¼šåœ¨å¤§å¤šæ•°é™æ€å¤šå‘å°„å®ç°ä¸Šï¼šåœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå‘å°„å¤šå°‘æ¡æŒ‡ä»¤ï¼Œå“ªäº›æŒ‡ä»¤è¢«å‘å°„è¿™ä¸ªè¿‡ç¨‹è‡³å°‘å¾ˆå¤§ä¸€éƒ¨åˆ†ç”±ç¼–è¯‘å™¨æ¥å®Œæˆã€‚è€Œåœ¨åŠ¨æ€å‘å°„å¤„ç†å™¨ä¸­ï¼Œè¿™ä¸ªé—®é¢˜ä¸€èˆ¬ç”±å¤„ç†å™¨åœ¨è¿è¡Œæ—¶æ¥å¤„ç†ã€‚ï¼ˆå°½ç®¡ç¼–è¯‘å™¨å·²ç»ä¼˜åŒ–äº†æŒ‡ä»¤é¡ºåºæ¥å°½å¯èƒ½å¤šå‘å°„ï¼‰</li><li>å¤„ç†æ•°æ®å’Œæ§åˆ¶å†’é™©ï¼šåœ¨é™æ€å‘å°„å¤„ç†å™¨ä¸­ï¼Œç¼–è¯‘å™¨è§£å†³å¤§éƒ¨åˆ†æˆ–è€…æ‰€æœ‰çš„å¯èƒ½å†’é™©ã€‚ä¸æ­¤ç›¸åçš„ï¼ŒåŠ¨æ€å‘å°„å¤„ç†å™¨ç”¨ç¡¬ä»¶æŠ€æœ¯åœ¨è¿è¡Œæ—¶è‡³å°‘æ¶ˆé™¤æŸäº›ç±»åˆ«çš„å†’é™©ã€‚</li></ol><blockquote><p>å°½ç®¡ï¼Œæˆ‘ä»¬æŠŠå®ƒä»¬æè¿°æˆä¸åŒçš„æ–¹æ³•ï¼Œä½†äº‹å®ä¸Šï¼Œä¸€ä¸ªæ–¹æ³•ç»å¸¸å€ŸåŠ©å¦å¤–ä¸€ä¸ªæ–¹æ³•çš„æŠ€æœ¯ã€‚</p></blockquote><h1 id="Speculation-æ¨æµ‹"><a href="#Speculation-æ¨æµ‹" class="headerlink" title="Speculation(æ¨æµ‹)"></a><a name="spec">Speculation(æ¨æµ‹)</a></h1><p class="note note-primary"><font color="blue">speculation</font>: An approach whereby the compiler or processor guesses the outcome of an instruction to remove it as a dependence in executing other instructions<br>æå‰ç»™å‡ºç»“æœ(çŒœæµ‹)æ¥é¿å…åé¢çš„æŒ‡ä»¤å¯¹æ­£åœ¨è¿è¡ŒæŒ‡ä»¤çš„ä¾èµ–</p><p>ä»¥ä¸‹æ˜¯å‡ ç§çŒœæµ‹çš„æƒ…å½¢ï¼š</p><ul><li>æˆ‘ä»¬çŒœæµ‹åˆ†æ”¯çš„ç»“æœï¼Œé‚£æ ·åˆ†æ”¯åé¢çš„æŒ‡ä»¤å¯ä»¥ææ—©æ‰§è¡Œã€‚</li><li>æˆ‘ä»¬çŒœæµ‹å­˜å­—å’Œå–å­—æŒ‡ä»¤è®¿é—®çš„ä¸æ˜¯åŒä¸€ä¸ªåœ°å€ï¼Œé‚£æ ·æˆ‘ä»¬åœ¨æ‰§è¡Œå­˜å­—æŒ‡ä»¤å‰å»æ‰§è¡Œå–å­—æŒ‡ä»¤ã€‚</li></ul><p>ä½†æ˜¯ï¼ŒçŒœæµ‹å¯èƒ½å‡ºç°é”™è¯¯âŒã€‚æ‰€ä»¥ï¼šä»»ä½•æ¨æµ‹æŠ€æœ¯éƒ½å¿…é¡»åŒ…å«ä¸€ç§æœºåˆ¶ï¼š1ã€æ£€æŸ¥æ¨æµ‹æ˜¯å¦æ­£ç¡®ï¼›2ã€å›æ»šç”±äºæ¨æµ‹æå‰æ‰§è¡Œçš„æŒ‡ä»¤çš„å½±å“ã€‚</p><ol><li><p>æ¨æµ‹é”™è¯¯æ—¶æ¢å¤æœºåˆ¶ï¼š</p><ul><li>for compile: æ’å…¥é¢å¤–çš„æŒ‡ä»¤æ£€æŸ¥æ¨æµ‹çš„æ­£ç¡®æ€§âœ”å¹¶æä¾›ä¸€ä¸ªfix-upä¾‹ç¨‹ä¾›æ¨æµ‹é”™è¯¯æ—¶ä½¿ç”¨ã€‚</li><li>for processor: ç”¨bufferç¼“å­˜æ¨æµ‹ç»“æœç›´åˆ°æ¨æµ‹çš„ç»“æœå¾—åˆ°ç¡®è®¤ã€‚å¦‚æœæ¨æµ‹æ­£ç¡®ï¼ŒæŠŠç¼“å­˜çš„èƒ½å®¹å†™åˆ°ç›¸åº”çš„å¯„å­˜å™¨ä¸­ï¼ŒæŒ‡ä»¤å®Œæˆã€‚å¦‚æœæ¨æµ‹ä¸æ­£ç¡®ï¼Œç¡¬ä»¶å†²åˆ·æ‰bufferï¼Œé‡æ–°æ‰§è¡Œæ­£ç¡®çš„æŒ‡ä»¤åºåˆ—ã€‚</li></ul></li><li><p>æ¨æµ‹å¯èƒ½å¼•å…¥å¦å¤–çš„é—®é¢˜ï¼šå¯¹æŸäº›æŒ‡ä»¤çš„æ¨æµ‹ä¼šå¯¼è‡´åŸæœ¬ä¸å­˜åœ¨çš„å¼‚å¸¸å‘ç”Ÿã€‚æ¯”å¦‚ï¼Œæ¨æµ‹æ‰§è¡Œä¸€æ¡è£…è½½æŒ‡ä»¤ï¼Œåœ¨æ¨æµ‹é”™è¯¯çš„æƒ…å†µä¸‹ï¼Œè¯¥æŒ‡ä»¤æ‰€ä½¿ç”¨çš„åœ°å€æ˜¯éæ³•çš„ã€‚</p></li></ol><h1 id="Static-multiple-issue"><a href="#Static-multiple-issue" class="headerlink" title="Static multiple-issue"></a>Static multiple-issue</h1><p class="note note-primary">Static multiple-issue processers all use the compiler to assist with packaging instructions and handling hazards.</p><p><code>issue packet</code>(å‘å°„åŒ…)ï¼šåœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…å¯ä»¥å‘å°„çš„æŒ‡ä»¤é›†åˆï¼Œå¯ä»¥ç”¨ä¸€æ¡å®Œæˆå¤šç§æ“ä½œçš„é•¿æŒ‡ä»¤æ¥ç±»æ¯”</p><p><code>Very Long Instruction Word</code>(è¶…é•¿æŒ‡ä»¤å­—)ï¼šä¸€ç§æŒ‡ä»¤é›†æ¶æ„ï¼Œèƒ½å¤Ÿå‘å°„å¤šæ¡æ“ä½œï¼Œè¿™äº›æ“ä½œåœ¨å•ä¸ªæŒ‡ä»¤ä¸­è¢«å®šä¹‰ä¸ºç‹¬ç«‹çš„ï¼Œå¹¶ä¸”ä¸€èˆ¬éƒ½æœ‰ç‹¬ç«‹çš„æ“ä½œç åŸŸã€‚</p><ul><li><p>é™æ€å¤šå‘å°„å¤„ç†å™¨æœ‰ä¸¤ç§ï¼š</p><ol><li>ç¼–è¯‘å™¨é¿å…æ‰€æœ‰å†’é™©ï¼›</li><li>ç¡¬ä»¶æ£€æµ‹æ•°æ®å†’é™©ï¼Œå¹¶åœ¨ä¸¤ä¸ªå‘å°„åŒ…é—´äº§ç”Ÿé˜»å¡ï¼Œè€Œç¼–è¯‘å™¨åªè´Ÿè´£é¿å…ä¸€ä¸ªæŒ‡ä»¤åŒ…é—´çš„ä¾èµ–ã€‚</li></ol></li><li><p>ä¸ºäº†å¹¶è¡Œå‘å°„ALUå’Œæ•°æ®ä¼ è¾“æ“ä½œï¼Œéœ€è¦æœ‰é¢å¤–çš„ç¡¬ä»¶ï¼š</p><ol><li>å¯„å­˜å™¨å †è¦æœ‰é¢å¤–çš„ç«¯å£ä¾›è¿ä¸ªæ“ä½œè¯»å–æ“ä½œæ•°ï¼›</li><li>è¦æœ‰é¢å¤–çš„ALUæ¥åŒæ—¶æ‰§è¡ŒEXé˜¶æ®µã€‚</li></ol></li><li><p>å¤šå‘å°„å¸¦æ¥çš„é—®é¢˜ï¼šç”±äºé¢å¤–çš„æŒ‡ä»¤é‡å ï¼Œå†’é™©çš„å¯èƒ½æ€§åŠ å€ã€‚</p><ol><li>è£…è½½æŒ‡ä»¤æœ‰ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸçš„<code>ä½¿ç”¨å»¶è¿Ÿ</code>ï¼ˆuse latency)ï¼›è¿™æ„å‘³ç€ä¸‹ä¸€ä¸ªå‘å°„åŒ…ä¸­æ‰€æœ‰æŒ‡ä»¤éƒ½ä¸èƒ½ä½¿ç”¨è£…è½½çš„ç»“æœã€‚</li><li>åŸæœ¬æ²¡æœ‰ä½¿ç”¨å»¶è¿Ÿçš„ALUæŒ‡ä»¤ï¼Œå…¶ç»“æœä¸èƒ½è¢«åœ¨åŒä¸€ä¸ªå‘å°„åŒ…çš„å…¶ä»–æŒ‡ä»¤ä½¿ç”¨ã€‚</li></ol></li></ul><p><img src="https://image.beenli.cn/img/20200927/pFpgnJVAbslU.jpg?imageslim" alt="mark"></p><ul><li><code>å¾ªç¯å±•å¼€</code>(loop unrolling)ï¼šä¸€ç§ä»è®¿é—®æ•°ç»„çš„å¾ªç¯ç¨‹åºä¸­è·å¾—æ›´å¤šæ€§èƒ½çš„æŠ€æœ¯ã€‚å…¶ä¸­å¾ªç¯ä½“ä¼šè¢«å¤åˆ¶å¤šä»½å¹¶ä¸”åœ¨ä¸åŒå¾ªç¯ä½“ä¸­çš„æŒ‡ä»¤ä¼šè°ƒåº¦åœ¨ä¸€èµ·ã€‚</li></ul><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/***************** ä¾‹ç¨‹ï¼šæŠŠä¸€æ®µæ•°ç»„ä¸­çš„æ•°å…¨éƒ¨åŠ ä¸Šä¸€ä¸ªæ•°(x21)  ********************/</span><br>Loop:  ld  x31, <span class="hljs-number">0</span>(x20)  <span class="hljs-comment">// x31=array element</span><br>       add  x31, x31, x21   <span class="hljs-comment">// add scalar in x21</span><br>       sd  x31, <span class="hljs-number">0</span>(x20) <span class="hljs-comment">// store result</span><br>       addi  x20, x20, <span class="hljs-number">-8</span>   <span class="hljs-comment">// decrement pointer</span><br>       blt  x22, x20, Loop  <span class="hljs-comment">// compare to loop limit,branch if x20 &gt; x22</span><br></code></pre></td></tr></tbody></table></figure><blockquote><p>ä¸è¿›è¡Œå¾ªç¯å±•å¼€çš„é™æ€å¤šå‘å°„è°ƒåº¦ï¼š</p></blockquote><p><img src="https://image.beenli.cn/img/20200928/dGh2jYTva3bm.jpg?imageslim" alt="mark"></p><blockquote><p>å¾ªç¯å±•å¼€ç»“æœï¼š</p></blockquote><p><img src="https://image.beenli.cn/img/20200928/5Sd7gcLfIrQ5.jpg?imageslim" alt="mark"></p><ul><li>åœ¨å¾ªç¯å±•å¼€è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨å¼•å…¥äº†å‡ ä¸ªä¸´æ—¶ç¼–è¯‘å™¨ï¼ˆx28ã€x29ã€x30ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹å«åš<code>å¯„å­˜å™¨é‡å‘½å</code>:  ç›®çš„æ˜¯æ¶ˆé™¤ä¸€äº›è™šå‡ä¾èµ–ã€‚</li><li>å¦‚æœæˆ‘ä»¬åªä½¿ç”¨x31å¯„å­˜å™¨ï¼šæˆ‘ä»¬å°†åœ¨sd x31,8(x20)åé¢é‡å¤ld x31,0(x20), add x31, x31, x21ã€‚ä½†æ˜¯è¿™äº›åºåˆ—å°½ç®¡éƒ½ä½¿ç”¨x31ï¼Œå®ƒä»¬å®é™…ä¸Šæ˜¯ä¸ç›¸å…³çš„ã€‚</li><li><code>antidependence</code> or <code>name dependence</code>(åç›¸å…³æˆ–åå­—ç›¸å…³)ï¼šä¸€ç»„æŒ‡ä»¤é›†å’Œä¸‹ä¸€ç»„æŒ‡ä»¤é›†ä¹‹é—´no data value flowï¼Œä»…ä»…æ˜¯å› ä¸ºé‡ç”¨å¯„å­˜å™¨åå¼•èµ·çš„ç›¸å…³ã€‚</li></ul><h1 id="Dynamic-multiple-issue"><a href="#Dynamic-multiple-issue" class="headerlink" title="Dynamic multiple-issue"></a>Dynamic multiple-issue</h1><p class="note note-primary">Dynamic multiple-issue processors are also known as <font color="blur"> superscalar</font> processors, or simply superscalars</p><h2 id="Basic-concept"><a href="#Basic-concept" class="headerlink" title="Basic concept"></a>Basic concept</h2><p>æœ€ç®€å•çš„è¶…æ ‡é‡å¤„ç†å™¨ï¼šæŒ‡ä»¤æŒ‰é¡ºåºå‘å°„ï¼Œå¤„ç†å™¨å†³å®šæ¯ä¸ªå‘¨æœŸå‘å°„0æ¡ï¼Œ1æ¡æˆ–å¤šæ¡æŒ‡ä»¤ã€‚</p><p>æ˜¾ç„¶ä¸ºäº†è·å¾—å¥½çš„æ€§èƒ½ï¼Œå¤„ç†å™¨ä»ç„¶éœ€è¦ç¼–è¯‘å™¨å¸®å¿™ç¼–æ’æŒ‡ä»¤é¡ºåºæ¥å‡å°‘ä¾èµ–ã€‚</p><p>ç®€å•è¶…æ ‡é‡å¤„ç†å™¨ä¸VLIWå¤„ç†å™¨(é™æ€å‘å°„)çš„åŒºåˆ«ï¼š</p><ul><li>for superscalar:ï¼š1ã€ä¸ç®¡æ˜¯å¦ç»è¿‡ç¼–è¯‘å™¨ç¼–æ’æŒ‡ä»¤é¡ºåºï¼Œéƒ½ç”±ç¡¬ä»¶æ¥ä¿è¯æ‰§è¡Œçš„æ­£ç¡®æ€§âœ”ã€‚2ã€ç¼–è¯‘è¿‡çš„ä»£ç å°†å§‹ç»ˆæ­£ç¡®çš„è¿è¡Œï¼Œæ— è®ºå‘å°„é€Ÿç‡è¿˜æ˜¯æµæ°´çº¿æ¶æ„ã€‚</li><li>for VLIWï¼šä¸åƒğŸ‘†é‚£æ ·ï¼Œå½“ç§»æ¤åˆ°ä¸åŒçš„å¤„ç†å™¨æ¨¡å‹å¾€å¾€éœ€è¦é‡æ–°ç¼–è¯‘ã€‚åœ¨å…¶ä»–çš„é™æ€å‘å°„å¤„ç†å™¨ä¸­ï¼Œä»£ç èƒ½å¤Ÿåœ¨ä¸åŒçš„å¤„ç†å™¨å®ç°ä¸Šæ­£ç¡®è¿è¡Œï¼Œä½†æ˜¯æ•ˆç‡å¾ˆå·®ä¹Ÿéœ€è¦é‡æ–°ç¼–è¯‘ã€‚</li></ul><p>è®¸å¤šè¶…æ ‡é‡å¤„ç†å™¨æ‰©å±•äº†åŸºæœ¬çš„åŠ¨æ€å‘å°„ç­–ç•¥ï¼Œå°†<font color="blue">dynamic pipeline scheduling(åŠ¨æ€æµæ°´çº¿è°ƒåº¦)</font>åŒ…å«è¿›æ¥ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*************** ä¸€ä¸ªç®€å•çš„ä¾‹å­ **************/</span><br>ld  x31, <span class="hljs-number">0</span>(x21)<br>add  x1,  x31, x2<br>sub  x23, x23, x3<br>andi  x5,  x23, <span class="hljs-number">20</span><br></code></pre></td></tr></tbody></table></figure><blockquote><p><font color="red">è¯´æ˜</font>ï¼šå³ä½¿subæŒ‡ä»¤å‡†å¤‡å¥½æ‰§è¡Œï¼Œå®ƒä¹Ÿå¿…é¡»ç­‰å¾…ldå’ŒaddæŒ‡ä»¤å…ˆç»“æŸæ‰è¡Œã€‚å¦‚æœå†…å­˜å¾ˆæ…¢ï¼ŒsubæŒ‡ä»¤å¯èƒ½ä¼šç­‰å¾…å¤šä¸ªå‘¨æœŸï¼ˆæ¯”å¦‚cacheæ²¡æœ‰å‘½ä¸­ï¼‰</p></blockquote><h2 id="dynamic-pipeline-scheduling"><a href="#dynamic-pipeline-scheduling" class="headerlink" title="dynamic pipeline scheduling"></a>dynamic pipeline scheduling</h2><blockquote><p>Dynamic pipeline scheduling chooses which instructions to execute next, possibly reordering them to avoid stalls.<br><strong>åŠ¨æ€è°ƒåº¦å¯ä»¥è¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´æŒ‡ä»¤é¡ºåº</strong></p></blockquote><p>æµæ°´çº¿è¢«åˆ†ä¸ºä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼š</p><ul><li>an instruction fetch and issue unitï¼ˆå–æŒ‡å‘å°„å•å…ƒ)</li><li>multiple functional unitsï¼ˆå¤šç§åŠŸèƒ½å•å…ƒï¼‰</li><li>commit unit(æäº¤å•å…ƒ)</li></ul><p><img src="https://image.beenli.cn/img/20200928/CiiibeQE7Kom.jpg?imageslim" alt="mark"></p><ol><li>æ¯ä¸ªåŠŸèƒ½å•å…ƒæœ‰ä¸ªbuffer, ç§°ä¸º<code>ä¿ç•™ç«™</code>ï¼ˆreservation station)ï¼Œå…¶ä¸­ä¿å­˜ç€æ“ä½œæ•°å’Œæ“ä½œ(opcode â“)ã€‚</li><li>åŠŸèƒ½å•å…ƒè¿ç®—å®Œæˆçš„ç»“æœä¼ é€ç»™1ã€commit unitï¼›2ã€æ—è·¯ç»™æ‰€éœ€çš„ä¿ç•™ç«™ã€‚</li><li>æäº¤å•å…ƒä¹Ÿæœ‰bufferï¼Œç§°ä¸º<code>reorder buffer</code>(é‡æ’åºç¼“å†²åŒº)ï¼šç¼“å­˜ç»“æœç›´åˆ°ç¡®å®šæ˜¯å®‰å…¨æ—¶æ‰å†™å…¥register fileæˆ–è€…memoryã€‚</li></ol><blockquote><p><strong>ä¿ç•™ç«™ç¼“å­˜æ“ä½œæ•°â•æäº¤å•å…ƒç¼“å­˜ç»“æœï¼ï¼ã€‹å¯„å­˜å™¨é‡å‘½å</strong></p><ul><li>å‘å°„æŒ‡ä»¤æ—¶ï¼Œå®ƒè¢«å¤åˆ¶åˆ°å¯¹åº”åŠŸèƒ½å•å…ƒçš„ä¿ç•™ç«™ä¸Šï¼Œå¦‚æœå®ƒçš„æ“ä½œæ•°åœ¨å¯„å­˜å™¨å †æˆ–è€…æäº¤å•å…ƒç¼“å†²åŒºä¸­æœ‰ï¼Œé‚£ä¹ˆæ“ä½œæ•°ç«‹é©¬å¤åˆ¶åˆ°ä¿ç•™ç«™ã€‚å¦‚æœæŒ‡ä»¤å·²ç»å‘å°„ï¼Œé‚£ä¹ˆå¯¹åº”æ“ä½œæ•°çš„å‰¯æœ¬ä¸å†éœ€è¦ï¼Œå¯ä»¥é‡å†™è¦†ç›–ã€‚</li><li>å¦‚æœä¸€ä¸ªæ“ä½œæ•°ä¸åœ¨register file or reorder bufferï¼Œä»–å¿…é¡»ç­‰å¾…æŸä¸ªåŠŸèƒ½å•å…ƒçš„ç»“æœã€‚ç¡¬ä»¶å¸®åŠ©è¿½è¸ªæ‰€éœ€çš„åŠŸèƒ½å•å…ƒï¼Œå½“å•å…ƒè®¡ç®—å‡ºç»“æœç›´æ¥å¤åˆ¶åˆ°ä¿ç•™ç«™è€Œæ—è·¯æ‰å¯„å­˜å™¨å †ã€‚</li></ul></blockquote><p><code>out-of-order execution</code>(ä¹±åºæ‰§è¡Œ)ï¼šå¤„ç†å™¨åœ¨ä¸è¿èƒŒåŸæœ‰æ•°æ®æµé¡ºåºçš„å‰æä¸‹ä»¥æŸç§é¡ºåºæ‰§è¡Œå„æ¡æŒ‡ä»¤ï¼Œä½†æ˜¯æ‰§è¡ŒæŒ‡ä»¤çš„é¡ºåºå¯ä»¥ä¸å–æŒ‡ä¸åŒã€‚</p><p><code>in-order commit</code>(é¡ºåºæäº¤)ï¼šæµæ°´çº¿æ‰§è¡Œçš„ç»“æœä»¥å–æŒ‡é¡ºåºå†™å›ç¨‹åºå‘˜å¯è§çš„å¯„å­˜å™¨çš„ä¸€ç§æäº¤æ–¹å¼ã€‚ï¼ˆå½“å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œå¤„ç†å™¨å¯ä»¥æ‰¾åˆ°æœ€åæ‰§è¡Œçš„é‚£æ¡æŒ‡ä»¤ï¼Œè€Œåªæœ‰è¿™æ¡å¯¼è‡´å¼‚å¸¸çš„æŒ‡ä»¤ä¹‹å‰çš„æŒ‡ä»¤æ‰èƒ½å¯¹å¯„å­˜å™¨çŠ¶æ€è¿›è¡Œæ”¹å˜ã€‚</p><p><a href="#spec">æ¨æµ‹</a>å’ŒåŠ¨æ€è°ƒåº¦ç»å¸¸ç»“åˆåœ¨ä¸€èµ·ï¼š</p><ul><li>é€šè¿‡å¯¹åˆ†æ”¯çš„é¢„æµ‹ï¼ŒåŠ¨æ€è°ƒåº¦å¯ä»¥åœ¨æ¨æµ‹æ–¹å‘ä¸Šè¿›è¡Œå–æŒ‡å’Œæ‰§è¡Œã€‚ç”±äºæŒ‡ä»¤æ˜¯é¡ºåºæäº¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ†æ”¯æŒ‡ä»¤åŠæ‰€æœ‰æ¨æµ‹æ‰§è¡Œçš„æŒ‡ä»¤æäº¤å‰çŸ¥é“æ¨æµ‹æ˜¯å¦å‡†ç¡®ã€‚</li><li>é€šè¿‡å¯¹è£…è½½æŒ‡ä»¤ç›®çš„åœ°å€çš„é¢„æµ‹ï¼Œå¯¹å­˜å–æŒ‡ä»¤è¿›è¡Œé‡æ’åºå’Œåˆ©ç”¨æäº¤å•å…ƒé¿å…é”™è¯¯çš„æ¨æµ‹ã€‚</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Preface&quot;&gt;&lt;a href=&quot;#Preface&quot; class=&quot;headerlink&quot; title=&quot;Preface&quot;&gt;&lt;/a&gt;Preface&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;æŒ‡ä»¤é›†å¹¶è¡Œ&lt;/code&gt;(instruction-level </summary>
      
    
    
    
    <category term="CS" scheme="https://www.beenli.cn/categories/CS/"/>
    
    <category term="Computer Organization &amp; Design" scheme="https://www.beenli.cn/categories/CS/Computer-Organization-Design/"/>
    
    
    <category term="processor" scheme="https://www.beenli.cn/tags/processor/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®é€šè·¯(3)--Pipeline &amp; hazards</title>
    <link href="https://www.beenli.cn/posts/d4768fc/"/>
    <id>https://www.beenli.cn/posts/d4768fc/</id>
    <published>2020-09-25T10:32:54.000Z</published>
    <updated>2020-09-27T11:48:50.997Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1ã€An-Overview-of-Pipeline"><a href="#1ã€An-Overview-of-Pipeline" class="headerlink" title="1ã€An Overview of Pipeline"></a>1ã€An Overview of Pipeline</h1><blockquote><p><code>æµæ°´çº¿</code>å°±åƒå·¥å‚çš„å·¥äººä¸€æ ·ï¼Œæ¯ä¸ªå·¥äººåªåšä¸€é“å·¥åºï¼ˆæ¯ä¸ªç¡¬ä»¶åªåšä¸€ä¸ªåŠŸèƒ½)ï¼ŒåŒä¸€æ—¶é—´å‡ é“å·¥åºåŒæ—¶åœ¨åš(åŒä¸€æ—¶é—´å¤šæ¡æŒ‡ä»¤åŒæ—¶æ‰§è¡Œï¼Œæ¯æ¡æŒ‡ä»¤åœ¨ä¸åŒçš„é˜¶æ®µ)ï¼Œæœ€åä¸€é“å·¥åºåšå®Œå³å®Œæˆäº†ä¸€ä»¶äº§å“(æ‰€ä»¥ååé‡éå¸¸å¤§)ã€‚</p></blockquote><p><img src="https://image.beenli.cn/img/20200925/CH2JrES42Wqd.jpg?imageslim" alt="mark"></p><h2 id="RISC-Vç»å…¸æµæ°´çº¿å¯ä»¥åˆ†ä¸ºäº”æ­¥"><a href="#RISC-Vç»å…¸æµæ°´çº¿å¯ä»¥åˆ†ä¸ºäº”æ­¥" class="headerlink" title="RISC-Vç»å…¸æµæ°´çº¿å¯ä»¥åˆ†ä¸ºäº”æ­¥"></a>RISC-Vç»å…¸æµæ°´çº¿å¯ä»¥åˆ†ä¸ºäº”æ­¥</h2><ul><li>Fetch instruction from memoryï¼ˆIF)</li><li>Read register and decode the instruction(ID)</li><li>Execute the operation or calculate an address(EX)</li><li>Access an operand in data memory (MEM) [if necessary]</li><li>Write the result into a register(WB) [if necessary]</li></ul><h2 id="é¢å‘æµæ°´çº¿çš„æŒ‡ä»¤é›†è®¾è®¡"><a href="#é¢å‘æµæ°´çº¿çš„æŒ‡ä»¤é›†è®¾è®¡" class="headerlink" title="é¢å‘æµæ°´çº¿çš„æŒ‡ä»¤é›†è®¾è®¡"></a>é¢å‘æµæ°´çº¿çš„æŒ‡ä»¤é›†è®¾è®¡</h2><ul><li><p>RISC-V æŒ‡ä»¤ç­‰é•¿ï¼Œè¿™ä¸€é™åˆ¶ç®€åŒ–äº†ç¬¬ä¸€çº§å–æŒ‡ä¸ç¬¬äºŒçº§è¯‘ç ã€‚</p><p>ã€x86æŒ‡ä»¤é•¿åº¦ä¸ç­‰ï¼Œä»1å­—èŠ‚åˆ°15å­—èŠ‚ä¸ç­‰ã€‚æœ€è¿‘x86ä½“ç³»ç»“æ„ï¼šå…ˆè½¬åŒ–ä¸ºç®€å•çš„æ“ä½œã€‘</p></li><li><p>RISC-Våªæœ‰å‡ ç§æŒ‡ä»¤æ ¼å¼ï¼Œæ¯ä¸€ç§æŒ‡ä»¤æºå’Œç›®çš„å¯„å­˜å™¨å­—æ®µä½ç½®ä¸å˜ã€‚</p><p>ã€ä½¿å¾—ç¬¬äºŒçº§åœ¨ç¡®å®šæŒ‡ä»¤ç±»å‹çš„åŒæ—¶å¼€å§‹è¯»å¯„å­˜å™¨å †ã€‘</p></li><li><p>RISC-Vçš„memory operandsä»…ä»…å‡ºç°åœ¨å­˜å–æŒ‡ä»¤ä¸­(å¸¸è§„ALUæŒ‡ä»¤çš„æ“ä½œæ•°ç›´æ¥åœ¨ç¬¬äºŒçº§å¯„å­˜å™¨å †è¯»å‡º)ã€‚æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨æ‰§è¡Œé˜¶æ®µè®¡ç®—å†…å­˜åœ°å€ï¼Œç„¶ååœ¨ä¸‹ä¸€ä¸ªé˜¶æ®µè®¿å­˜ã€‚</p><p>ã€å¦‚æœåƒx86é‚£æ ·å¯ä»¥æ“ä½œåœ¨å†…å­˜ä¸­çš„æ“ä½œæ•°ï¼Œé‚£ä¹ˆç¬¬ä¸‰ã€å››çº§å°†æ‰©å±•ä¸ºaddress stageï¼Œmemory stageï¼Œexecute stageã€‘</p></li></ul><h2 id="æµæ°´çº¿æ§åˆ¶"><a href="#æµæ°´çº¿æ§åˆ¶" class="headerlink" title="æµæ°´çº¿æ§åˆ¶"></a>æµæ°´çº¿æ§åˆ¶</h2><p><img src="https://image.beenli.cn/img/20200925/IekslQjza2wy.jpg?imageslim" alt="mark"></p><h1 id="2ã€Pipeline-Hazards"><a href="#2ã€Pipeline-Hazards" class="headerlink" title="2ã€Pipeline Hazards"></a>2ã€Pipeline Hazards</h1><blockquote><p>There are situation in pipelining when the next instruction cannot execute in the following clock cycle. These events are called <code>hazards</code>.</p></blockquote><h2 id="1ã€Structural-Hazard"><a href="#1ã€Structural-Hazard" class="headerlink" title="1ã€Structural Hazard"></a>1ã€Structural Hazard</h2><p class="note note-info">When a planned instruction cannot execute in the proper clock cycle because the hardware does not support the combination of instructions that are set to execute</p><p><strong></strong></p><center><strong>[ç”±äºç¡¬ä»¶èµ„æºä¸å¤Ÿå¯¼è‡´çš„å†’é™©]</strong></center><p></p><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æˆ‘ä»¬çš„IFå’ŒMEMåˆ†å¼€ï¼ˆæŒ‡ä»¤å¯„å­˜å™¨å’Œæ•°æ®å¯„å­˜å™¨ï¼‰</p><h2 id="2ã€Data-Hazard"><a href="#2ã€Data-Hazard" class="headerlink" title="2ã€Data Hazard"></a>2ã€Data Hazard</h2><p class="note note-info">When a planned instruction cannot execute in the proper clock cycle because data that are needed to execute the instruction are not yet available</p><p><strong></strong></p><center><strong>[ç”±äºæ“ä½œæ•°æ²¡æœ‰å‡†å¤‡å¥½å¯¼è‡´çš„å†’é™©]</strong></center><p></p><p>ä¸‰ç§ç»å…¸è§£å†³åŠæ³•</p><ul><li>Reorder code(é‡æ–°å®‰æ’ä»£ç )</li><li>stall the pipeline(é˜»å¡ä¸€ä¸ªæˆ–å‡ ä¸ªå‘¨æœŸ)</li><li>bypass or forwarding(æ—è·¯æˆ–è€…å‰æ¨ä¸Šä¸€æ¡æŒ‡ä»¤è¿ç®—çš„ç»“æœ)</li></ul><h3 id="â‘ Reorder-code"><a href="#â‘ Reorder-code" class="headerlink" title="â‘ Reorder code"></a>â‘ Reorder code</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-comment">//code segment in C</span><br>a = b + e;<br>c = b + f;<br><br><span class="hljs-comment">//generated RISC-V code for above segment</span><br>ld x1, <span class="hljs-number">0</span>(x31)<span class="hljs-comment">// Load b   1</span><br>ld x2, <span class="hljs-number">8</span>(x31)<span class="hljs-comment">// Load e2</span><br>add x3, x1, x2<span class="hljs-comment">// b + e3</span><br>sd x3, <span class="hljs-number">24</span>(x31)<span class="hljs-comment">// Store a4</span><br>ld x4, <span class="hljs-number">16</span>(x31)<span class="hljs-comment">// Load f5</span><br>add x5, x1, x4<span class="hljs-comment">// b + f6</span><br>sd x5, <span class="hljs-number">32</span>(x31)<span class="hljs-comment">// Store c7</span><br><br><span class="hljs-comment">/************** è¯´æ˜ *****************</span><br><span class="hljs-comment">1ã€é€šè¿‡æ—è·¯å¯ä»¥å»é™¤3å¯¹1çš„ä¾èµ–(load æŒ‡ä»¤æœ€å°‘éœ€è¦ä¸¤ä¸ªå‘¨æœŸï¼ŒALUæŒ‡ä»¤åœ¨æ—è·¯æŠ€æœ¯ä¸‹å¯¹ä¸‹ä¸€æ¡æŒ‡ä»¤ä¸ä¼šæ„æˆæ•°æ®å†’é™©ï¼‰</span><br><span class="hljs-comment">2ã€é€šè¿‡æ—è·¯ä¹Ÿå¯è§£å†³sdæŒ‡ä»¤å¯¹ä¸Šä¸€æ¡addæŒ‡ä»¤çš„ä¾èµ–</span><br><span class="hljs-comment">3ã€éœ€è¦è§£å†³çš„: 3V2å’Œ6V5         */</span><br><br><span class="hljs-comment">//************* è§£å†³åŠæ³• ***************</span><br>æŠŠç¬¬<span class="hljs-number">5</span>æ¡æŒ‡ä»¤æåˆ°ç¬¬äºŒæ¡æŒ‡ä»¤å’Œç¬¬ä¸‰æ¡ä¸­é—´ã€‚<br></code></pre></td></tr></tbody></table></figure><h3 id="â‘¡Bypassing"><a href="#â‘¡Bypassing" class="headerlink" title="â‘¡Bypassing"></a>â‘¡Bypassing</h3><p><img src="https://image.beenli.cn/img/20200925/9t5mAjk5HVXm.jpg?imageslim" alt="mark"></p><ul><li>andæŒ‡ä»¤éœ€è¦x2ï¼Œè€Œx2åªæœ‰ç­‰åˆ°ç¬¬ä¸€æ¡æŒ‡ä»¤å†™å›æ‰æœ‰æ•ˆ(å³ç¬¬äº”ä¸ªå‘¨æœŸå‰åŠæ®µ)</li><li>åŒç†oræŒ‡ä»¤</li><li>â“å‡è®¾: å†™å¯„å­˜å™¨æ“ä½œå‘ç”Ÿæ—¶é’Ÿå‘¨æœŸçš„å‰åŠæ®µè€Œè¯»å¯„å­˜å™¨æ“ä½œå‘ç”Ÿåœ¨æ—¶é’Ÿå‘¨æœŸååŠæ®µ</li></ul><p class="note note-info">æ—è·¯çš„æ ¸å¿ƒï¼šå‰ä¸€æ¡æŒ‡ä»¤è®¡ç®—çš„ç»“æœä¸ç”¨ç­‰åˆ°ç¬¬äº”å‘¨æœŸå†™å›å¯„å­˜å™¨å †è€Œæå‰æ—è·¯åˆ°å…¶åæŒ‡ä»¤çš„ALUæ“ä½œæ•°è¾“å…¥ä¸Šã€‚</p><p><img src="https://image.beenli.cn/img/20200925/DyyhciQAJVxi.jpg?imageslim" alt="mark"></p><ul><li><p>EXå†’é™©ï¼ˆEX/MEMæµæ°´çº¿å¯„å­˜å™¨æœ‰éœ€è¦çš„å€¼ï¼‰</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span>  (EX/MEM.RegWrite<br><span class="hljs-keyword">and</span>  (EX/MEM.RegisterRd â‰  <span class="hljs-number">0</span>)<br><span class="hljs-keyword">and</span>  (EX/MEM.RegisterRd = ID/EX.RegisterRs1)) ForwardA = <span class="hljs-number">10</span><br><br><span class="hljs-keyword">if</span>  (EX/MEM.RegWrite<br><span class="hljs-keyword">and</span>  (EX/MEM.RegisterRd â‰  <span class="hljs-number">0</span>)<br><span class="hljs-keyword">and</span>  (EX/MEM.RegisterRd = ID/EX.RegisterRs2)) ForwardB = <span class="hljs-number">10</span><br></code></pre></td></tr></tbody></table></figure></li><li><p>MEM hazard</p><h2 id=""><a href="#" class="headerlink" title=""></a><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span>  (MEM/WB.RegWrite<br><span class="hljs-keyword">and</span>  (MEM/WB.RegisterRd â‰  <span class="hljs-number">0</span>)<br><span class="hljs-keyword">and</span>  <span class="hljs-keyword">not</span>(EX/MEM.RegWrite <span class="hljs-keyword">and</span> (EX/MEM.RegisterRd â‰  <span class="hljs-number">0</span>)<br><span class="hljs-keyword">and</span> (EX/MEM.RegisterRd = ID/EX.RegisterRs1)) <br>     <span class="hljs-comment">// å…ˆåˆ¤æ–­ä¸æ˜¯EXå†’é™©ï¼Œä¸ç„¶åº”è¯¥æ˜¯æ—è·¯ä¸Šä¸€æ¡æŒ‡ä»¤EX/MEMç»“æœæ—è·¯ä¸Šä¸Šæ¡MEM/WB</span><br><span class="hljs-keyword">and</span>  (MEM/WB.RegisterRd = ID/EX.RegisterRs1)) ForwardA = <span class="hljs-number">01</span><br><br><span class="hljs-keyword">if</span>  (MEM/WB.RegWrite<br><span class="hljs-keyword">and</span>  (MEM/WB.RegisterRd â‰  <span class="hljs-number">0</span>)<br><span class="hljs-keyword">and</span>  <span class="hljs-keyword">not</span>(EX/MEM.RegWrite <span class="hljs-keyword">and</span> (EX/MEM.RegisterRd â‰  <span class="hljs-number">0</span>)<br><span class="hljs-keyword">and</span> (EX/MEM.RegisterRd = ID/EX.RegisterRs2))<br><span class="hljs-keyword">and</span>  (MEM/WB.RegisterRd = ID/EX.RegisterRs2)) ForwardB = <span class="hljs-number">01</span><br></code></pre></td></tr></tbody></table></figure></h2></li></ul><p><img src="https://image.beenli.cn/img/20200925/0sMUpSTpeddo.jpg?imageslim" alt="mark"></p><ul><li>æ—è·¯å•å…ƒäº§ç”Ÿæ§åˆ¶ä¿¡å·é€‰ç€ALUçš„è¾“å…¥operandã€‚</li></ul><h3 id="â‘¢Stalls"><a href="#â‘¢Stalls" class="headerlink" title="â‘¢Stalls"></a>â‘¢Stalls</h3><p class="note note-info">éœ€è¦é˜»å¡çš„æƒ…å½¢ï¼šå½“ä¸€æ¡æŒ‡ä»¤è¯•å›¾è¯»å–ä¸€ä¸ªç”±å‰ä¸€æ¡è£…è½½æŒ‡ä»¤è¯»å…¥çš„å¯„å­˜å™¨æ—¶ï¼Œå°±æ— æ³•ä½¿ç”¨æ—è·¯è§£å†³å†’é™©(å› ä¸ºlwæŒ‡ä»¤éœ€è¦åœ¨ç¬¬å››é˜¶æ®µæ‰èƒ½äº§ç”Ÿç»“æœ)</p><ol><li><p>å†’é™©æ£€æµ‹å•å…ƒ</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span>  (ID/EX.MemRead <span class="hljs-keyword">and</span><br>((ID/EX.RegisterRd = IF/ID.RegisterRs1) <span class="hljs-keyword">or</span><br>(ID/EX.RegisterRd = IF/ID.RegisterRs2)))<br>stall the pipeline<br></code></pre></td></tr></tbody></table></figure></li><li><p>æ£€æµ‹å•å…ƒå·¥ä½œåœ¨IDé˜¶æ®µã€‚</p></li><li><p>é˜»å¡åé¢æŒ‡ä»¤çš„æ–¹æ³•ï¼šä¿æŒPCå¯„å­˜å™¨å’ŒIF/IDæµæ°´çº¿å¯„å­˜å™¨ä¸å˜ã€‚</p></li><li><p>æ’å…¥ä¸€æ¡ç©ºæŒ‡ä»¤ï¼ˆnop)ï¼šä¸€ç§ä¸è¿›è¡Œä»»ä½•æ“ä½œæˆ–ä¸æ”¹å˜ä»»ä½•çŠ¶æ€çš„æŒ‡ä»¤ã€‚</p><p>å®ç°æ–¹æ³•ï¼šæ§åˆ¶ä¿¡å·å…¨éƒ¨ç½®ä¸º0ï¼Œè¿™äº›æ§åˆ¶ä¿¡å·åœ¨æ¯ä¸ªæ—¶é’Ÿå‘¨æœŸéƒ½å‘å‰ä¼ é€’ï¼Œä½†ä¸ä¼šäº§ç”Ÿä¸è‰¯å½±å“ï¼Œå› ä¸ºæ§åˆ¶ä¸º0ï¼Œé‚£ä¹ˆæ‰€æœ‰å¯„å­˜å™¨å’Œå­˜å‚¨å™¨éƒ½ä¸è¿›è¡Œå†™æ“ä½œã€‚</p></li></ol><p><img src="https://image.beenli.cn/img/20200925/2CuKo0v4bF7b.jpg?imageslim" alt="mark"></p><h2 id="3ã€Control-Hazard"><a href="#3ã€Control-Hazard" class="headerlink" title="3ã€Control Hazard"></a>3ã€Control Hazard</h2><p class="note note-info">An instruction must be fetched at every clock cycle to sustain the pipeline, yet in our design the decision about whether to branch doesn't occur until the MEM pipeline stage.<br>(åé¢çš„ä¼˜åŒ–ğŸ™†â€çœ‹åˆ°åœ¨IDçº§å°±å¯ä»¥ç¡®å®šåˆ†æ”¯)</p><p><strong></strong></p><center><strong>[ç”±äºé€‰æ‹©âœ”çš„æŒ‡ä»¤éœ€è¦å»¶è¿Ÿ]</strong></center><p></p><h3 id="â‘ Branch"><a href="#â‘ Branch" class="headerlink" title="â‘ Branch"></a>â‘ Branch</h3><ol><li><p>å‡å®šåˆ†æ”¯ä¸å‘ç”Ÿï¼ˆå¦‚æœå‘ç”Ÿé¢„å–å’Œè¯‘ç çš„æŒ‡ä»¤è¦ä¸¢å¼ƒï¼‰</p></li><li><p>ç¼©çŸ­åˆ†æ”¯å»¶è¿Ÿï¼ˆææ—©ç¡®å®šåˆ†æ”¯ï¼Œå‡å°‘flushçš„æŒ‡ä»¤æ•°ï¼‰</p><ul><li><p>è®¡ç®—åˆ†æ”¯ç›®æ ‡åœ°å€ï¼ˆIF/IDæµæ°´çº¿å¯„å­˜å™¨å·²ç»æœ‰äº†PCå’Œç«‹å³æ•°å­—æ®µçš„å€¼ï¼‰</p></li><li><p>åˆ¤æ–­åˆ†æ”¯æ¡ä»¶ï¼šéœ€è¦é¢å¤–çš„æ—è·¯å’Œå†’é™©æ£€æµ‹ç¡¬ä»¶ã€‚ã€å› ä¸ºåˆ†æ”¯æ¡ä»¶çš„åˆ¤æ–­å¯èƒ½ä¾èµ–äºè¿˜åœ¨æµæ°´çº¿ä¸­çš„ç»“æœã€‘</p><blockquote><p>ä¸¤ä¸ªéš¾ç‚¹ï¼š</p><p>â… ã€å‰é¢çš„ALUæ—è·¯å•å…ƒåœ¨EXçº§ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ä¸€ä¸ªæ–°çš„æ—è·¯å•å…ƒå·¥ä½œåœ¨IDçº§ã€‚è¿˜éœ€è¦ä¸€ä¸ª<code>equality test logic</code>ï¼ˆå¯¹ä¸¤ä¸ªå¯„å­˜å™¨çš„å€¼æŒ‰ä½å¼‚æˆ–æ¥ç€æˆ–æ“ä½œï¼‰</p><p>â…¡ã€å¯èƒ½æ•°æ®åœ¨IDçº§æ—è·¯ä¸è¿‡æ¥ã€‚ä¸Šä¸€æ¡æ˜¯ALUæŒ‡ä»¤ï¼Œé‚£ä¹ˆåªèƒ½<code>stall a cycle</code>ï¼›å¦‚æœæ˜¯lwæŒ‡ä»¤ï¼Œé‚£ä¹ˆå¿…é¡»<code>stall two cycles</code>ã€‚</p><p>â…¢ã€æ§åˆ¶ä¿¡å·æ–°å¢ä¸€ä¸ª<code>IF.flush</code>ä¿¡å·ï¼ŒæŠŠé¢„å–çš„é‚£æ¡æŒ‡ä»¤å˜æˆnopæŒ‡ä»¤ã€‚</p></blockquote></li></ul></li><li><p>åŠ¨æ€åˆ†æ”¯é¢„æµ‹(ç¼“å­˜ä¹‹å‰è¿è¡Œåˆ†æ”¯çš„ä¿¡æ¯è¿›è¡Œåˆ¤æ–­)<br>fetching new instructions from the same places as the last time.)</p><ul><li><code>åˆ†æ”¯é¢„æµ‹ç¼“å­˜</code>(branch prediction buffer)ä¹Ÿç§°ä¸º<code>åˆ†æ”¯å†å²è®°å½•è¡¨</code>(branch history table):ä½¿ç”¨åˆ†æ”¯æŒ‡ä»¤åœ°å€åœ°ä½ç´¢å¼•çš„ä¸€å°å—å­˜å‚¨åŒºã€‚</li><li>è¿™ç±»ç¼“å­˜æˆ‘ä»¬å®é™…ä¸Šä¸çŸ¥é“é¢„æµ‹æ˜¯å¦æ­£ç¡®ï¼Œè€Œä¸”å®ƒè¿˜å¯èƒ½ç”±å…¶ä»–å…·æœ‰ç›¸åŒåœ°å€åœ°ä½çš„åˆ†æ”¯è®¾ç½®ã€‚</li><li>é¢„æµ‹é”™è¯¯âŒæ—¶ï¼Œé”™è¯¯çš„é¢„å–æŒ‡ä»¤åˆ é™¤ï¼Œé¢„æµ‹ä½å–åï¼Œå›åˆ°åŸæ¥çš„ä½ç½®ï¼ˆâ“å¾—æœ‰ç¼“å­˜ï¼‰ï¼Œç»§ç»­æŒ‰ç…§æ­£ç¡®çš„æ–¹å‘å–æŒ‡å¹¶æ‰§è¡Œã€‚</li><li>åˆ†æ”¯é¢„æµ‹ç¼“å­˜å¯ä»¥ç”¨å¾ˆå°ï¼Œç”¨æŒ‡ä»¤åœ°å€è®¿é—®çš„special buffer in IF pipe stageã€‚å¦‚æœé¢„æµ‹åˆ†æ”¯ï¼Œé‚£ä¹ˆä»åˆ†æ”¯targetå–æŒ‡ä»¤ã€‚</li><li>ä¸ºäº†æ”¹å–„éå¸¸æœ‰è§„å¾‹çš„åˆ†æ”¯çš„é¢„æµ‹æ­£ç¡®ç‡ï¼ˆæ¯”å¦‚å¾ªç¯ï¼Œ9æ¬¡åˆ†æ”¯åªæœ‰æœ€åä¸€æ¬¡å¾ªç¯é€€å‡ºä¸åˆ†æ”¯ï¼‰ï¼›å¯ä»¥ä½¿ç”¨<code>ä¸¤ä½çš„é¢„æµ‹æœºåˆ¶</code>ã€‚</li></ul><p><img src="https://image.beenli.cn/img/20200927/XfbMg3jzjpEc.jpg?imageslim" alt="mark"></p><ul><li><code>ç›¸å…³é¢„æµ‹å™¨</code>ï¼ˆcorrelation predictors)ï¼šä¸ä»…ä½¿ç”¨local branchçš„ä¿¡æ¯ï¼Œè¿˜ç»¼åˆglobal behavior of recently executed branches ã€‚å…¸å‹çš„ç›¸å…³é¢„æµ‹å™¨ä¸ºæ¯ä¸ªåˆ†æ”¯æä¾›ä¸¤ä¸ªä¸¤ä½çš„é¢„æµ‹å™¨ï¼Œæ ¹æ®ä¸Šä¸€æ¬¡åˆ†æ”¯æ˜¯å¦æ‰§è¡Œé€‰æ‹©å…¶ä¸­ä¸€ä¸ªé¢„æµ‹å™¨ï¼Œå› æ­¤å…¨å±€åˆ†æ”¯è¡Œä¸ºå¯ä»¥çœ‹æˆadding additional index bits for the prediction lookup.</li><li><code>ç«äº‰é¢„æµ‹å™¨</code>(tournament branch predictor)ï¼šä¸ºæ¯ä¸ªåˆ†æ”¯ä½¿ç”¨å¤šä¸ªé¢„æµ‹å™¨ï¼Œå¹¶è®°å½•å“ªä¸ªé¢„æµ‹å™¨é¢„æµ‹ç»“æœæœ€å¥½ã€‚å…¸å‹çš„ç«äº‰é¢„æµ‹å™¨ï¼šå¯¹æ¯ä¸ªåˆ†æ”¯ç´¢å¼•åŒ…å«ä¸¤ä¸ªé¢„æµ‹ç»“æœï¼Œä¸€ä¸ªåŸºäºæœ¬åœ°ä¿¡æ¯ï¼Œä¸€ä¸ªåŸºäºå…¨å±€åˆ†æ”¯è¡Œä¸ºã€‚ä¸€ä¸ªé€‰æ‹©å™¨é€‰æ‹©å“ªä¸ªä½œä¸ºé¢„æµ‹ç»“æœã€‚</li><li><code>æ¡ä»¶ç§»åŠ¨æŒ‡ä»¤</code>(conditional move instruction)ï¼šä¸åŒäºåˆ†æ”¯æŒ‡ä»¤æ”¹å˜PCå€¼ï¼Œæ¡ä»¶ç§»åŠ¨æŒ‡ä»¤å°†æ ¹æ®æ¡ä»¶æ”¹å˜moveæŒ‡ä»¤çš„ç›®çš„å¯„å­˜å™¨ã€‚åœ¨ARMv8æŒ‡ä»¤é›†æ¶æ„ä¸­ï¼šCSEL X8, X11,X4,NE å¦‚æœæ¡ä»¶ç ä¸ä¸ºé›¶ï¼Œå¤åˆ¶x11åˆ°x8ï¼›å¦åˆ™å¤åˆ¶X4åˆ°X8;</li></ul></li></ol><h3 id="â‘¡Exception"><a href="#â‘¡Exception" class="headerlink" title="â‘¡Exception"></a>â‘¡Exception</h3><p class="note note-danger">Control is the most challenging aspect of processor design: it is both the hardest part to get right and toughest part to make fast<br>ç„¶è€Œæ§åˆ¶ä¸­æœ€éš¾çš„å°±æ˜¯å®ç°å¼‚å¸¸æˆ–ä¸­æ–­â€”â€”é™¤åˆ†æ”¯å¤–æ”¹å˜æ­£å¸¸æŒ‡ä»¤æ‰§è¡Œæµ</p><p>å½“å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œå¤„ç†å™¨å¿…é¡»åšçš„åŸºæœ¬äº‹æƒ…æ˜¯ï¼š</p><ul><li>åœ¨<code>SEPC</code>(supervisor exception cause register)ä¿å­˜å‡ºé”™æŒ‡ä»¤çš„åœ°å€</li><li>æŠŠæ§åˆ¶æƒäº¤ç»™æ“ä½œç³»ç»Ÿçš„ç‰¹å®šåœ°å€å¤„</li></ul><p>å¯¹äºå¤„ç†å¼‚å¸¸çš„OS,å®ƒå¿…é¡»çŸ¥é“å¼‚å¸¸çš„åŸå› ï¼š</p><ul><li><p>è®¾ç½®ä¸€ä¸ª<code>åŸå› å¯„å­˜å™¨</code>ï¼ˆSupervisor Exception Cause Register or SCAUSE):å…¶ä¸­æœ‰ä¸ªåŸŸæŒ‡ç¤ºå¼‚å¸¸çš„åŸå› </p></li><li><p>ä½¿ç”¨<code>å‘é‡ä¸­æ–­</code>(vectored interrupts), æ§åˆ¶æƒè¢«è½¬ç§»åˆ°çš„åœ°å€æ˜¯ç”±å¼‚å¸¸åŸå› å†³å®šï¼Œè¯¥åœ°å€å¯èƒ½è¢«æ·»åŠ åˆ°æŒ‡å‘å‘é‡ä¸­æ–­å†…å­˜èŒƒå›´çš„base registerä¸­ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å¼‚å¸¸ä¸­æ–­å‘é‡åœ°å€æ¥è¡¨ç¤ºå¼‚å¸¸ç§ç±»ã€‚</p><p><img src="https://image.beenli.cn/img/20200927/MKHGADukdjKe.jpg?imageslim" alt="mark"></p></li></ul><p>å¼‚å¸¸åœ¨æµæ°´çº¿ä¸­çš„å®ç°(ä½¿ç”¨è‡ªå‰ç›¸åŒçš„æœºåˆ¶ï¼Œä¸è¿‡è¿™æ¬¡ç”±å¼‚å¸¸é‡ç½®æ§åˆ¶ä¿¡å·)</p><ul><li>IFçº§æŒ‡ä»¤çš„æ¸…é™¤ç”¨ä¹‹å‰çš„<code>IF.flush</code>ä¿¡å·</li><li>æ–°å¢<code>ID.Flush</code>ä¿¡å·å’Œä¹‹å‰çš„å†’é™©æ£€æµ‹å•å…ƒäº§ç”Ÿçš„stallä¿¡å·è¿›è¡Œæˆ–è¿ç®—ï¼Œç„¶ååŠ åœ¨è‡ªå‰çš„å¤šé€‰å™¨ä¸Šï¼Œå®ç°IDçº§æŒ‡ä»¤æ¸…é™¤</li><li>æ–°å¢ä¸€ä¸ª<code>EX.Flush</code>ä¿¡å·æ¸…é™¤EXçº§çš„æŒ‡ä»¤</li><li>ä¸ºäº†ä»å¼‚å¸¸å¤„ç†ç¨‹åºçš„åœ°å€å–æŒ‡ï¼Œåªè¦ç®€å•å®¶ä¸€ä¸ªé¢å¤–çš„è¾“å…¥åˆ°PCçš„å¤šé€‰å™¨ã€‚</li></ul><p><img src="https://image.beenli.cn/img/20200927/W5ek8iOsIVie.jpg?imageslim" alt="mark"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1ã€An-Overview-of-Pipeline&quot;&gt;&lt;a href=&quot;#1ã€An-Overview-of-Pipeline&quot; class=&quot;headerlink&quot; title=&quot;1ã€An Overview of Pipeline&quot;&gt;&lt;/a&gt;1ã€An Overvi</summary>
      
    
    
    
    <category term="CS" scheme="https://www.beenli.cn/categories/CS/"/>
    
    <category term="Computer Organization &amp; Design" scheme="https://www.beenli.cn/categories/CS/Computer-Organization-Design/"/>
    
    
    <category term="processor" scheme="https://www.beenli.cn/tags/processor/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®é€šè·¯(2)--Control</title>
    <link href="https://www.beenli.cn/posts/f0189490/"/>
    <id>https://www.beenli.cn/posts/f0189490/</id>
    <published>2020-08-20T12:54:40.000Z</published>
    <updated>2020-09-27T11:07:21.876Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1ã€ALUæ§åˆ¶"><a href="#1ã€ALUæ§åˆ¶" class="headerlink" title="1ã€ALUæ§åˆ¶"></a>1ã€ALUæ§åˆ¶</h1><blockquote><p>MIPS ALUåœ¨4ä½æ§åˆ¶ä¿¡å·ä¸Šå®šä¹‰äº†6ç§æœ‰æ•ˆçš„è¾“å…¥ç»„åˆ</p></blockquote><p><img src="https://image.beenli.cn/img/20200820/VGrg5UNVVt4J.jpg?imageslim" alt="mark"></p><ul><li>å­˜å‚¨å™¨è®¿é—®æŒ‡ä»¤ï¼šadd</li><li>Rå‹æŒ‡ä»¤ï¼šæ ¹æ®æŒ‡ä»¤ä½6ä½çš„functå­—æ®µ<a href="#link"><sup>1</sup></a> ï¼ŒALUæ‰§è¡Œ5ç§æ“ä½œä¸­çš„ä¸€ç§(noræš‚æ—¶æ²¡ç”¨)</li><li>branchæŒ‡ä»¤ï¼šsub(ä¸¤ä¸ªæ“ä½œæ•°ç›¸å‡åˆ¤æ–­æ˜¯å¦ä¸ºé›¶)</li></ul><ul><li><code>å¤šçº§è¯‘ç </code>ï¼šè¾“å…¥ï¼š6ä½functå­—æ®µå’Œ2ä½ALUOPå­—æ®µâ€”â€”â€”â€”&gt;è¾“å‡ºï¼š4ä½ALU control lines</li></ul><p><img src="https://image.beenli.cn/img/20200820/xlEg0oIEPQA5.jpg?imageslim" alt="mark"></p><center>ä¸»æ§åˆ¶å•å…ƒç”ŸæˆALUOP</center><ul><li>çœŸå€¼è¡¨â€”â€”ä¼˜åŒ–åè½¬æ¢ä¸ºé—¨ç”µè·¯ï¼ˆå‘å¾…å®šï¼‰</li></ul><p><img src="https://image.beenli.cn/img/20200820/fBArSknPUEb4.jpg?imageslim" alt="mark"></p><h1 id="2ã€ä¸»æ§åˆ¶å•å…ƒ"><a href="#2ã€ä¸»æ§åˆ¶å•å…ƒ" class="headerlink" title="2ã€ä¸»æ§åˆ¶å•å…ƒ"></a>2ã€ä¸»æ§åˆ¶å•å…ƒ</h1><div id="link"></div><ul><li>æŒ‡ä»¤æ ¼å¼</li></ul><p><img src="https://image.beenli.cn/img/20200820/MLWQrvKbTmz4.jpg?imageslim" alt="mark"></p><ul><li>Rå‹æŒ‡ä»¤opcodeä¸º0ï¼›lwä¸º35ï¼›swä¸º43 ; branchä¸º<span class="github-emoji" style="display:inline;vertical-align:middle"><span>4âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0034-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></li></ul><p><img src="https://image.beenli.cn/img/20200820/w7nhaHnvyrH3.jpg?imageslim" alt="mark"></p><center>7ä¸ªå¤šé€‰å™¨æ§åˆ¶ä¿¡å·çš„ä½œç”¨</center><p><img src="https://image.beenli.cn/img/20200820/kdnnx95gnWHt.jpg?imageslim" alt="mark"></p><center>ä¸»æ§å•å…ƒäº§ç”Ÿ7ä¸ªä¸€ä½æ§åˆ¶ä¿¡å·+2ä½ALUOP</center><ul><li><p>æ§åˆ¶ä¿¡å·çœŸå€¼è¡¨</p><p><img src="https://image.beenli.cn/img/20200820/xa7NDi0PBA7x.jpg?imageslim" alt="mark"></p></li><li><p>op[5:0]å–è‡³Instruction[31:26]</p></li><li>RegDst: Rä¸º1è¡¨ç¤ºç›®çš„å¯„å­˜å™¨ä¸ºrd; lwä¸ºrs; swå’Œbranchä¸ç”¨å†™å›å¯„å­˜å™¨å †æ‰€ä»¥æ²¡æœ‰ç›®çš„å¯„å­˜å™¨ã€‚</li><li>ALUSrc: Rå’Œbranchä¸º0è¡¨ç¤ºALUç¬¬äºŒä¸ªæ“ä½œæ•°æ¥è‡ªrt; lwå’Œswè¡¨ç¤ºç¬¬äºŒä¸ªæ“ä½œæ•°æ¥è‡ªä½16ä½çš„æ‰©å±•ã€‚</li><li>MemtoReg: swå’Œbranchä¸ºxè¡¨ç¤ºä¸ç”¨å†™å›ã€‚Rä¸º0è¡¨ç¤ºALUè®¡ç®—ç»“æœå†™å›ï¼›lwè¡¨ç¤ºæ•°æ®å¯„å­˜å™¨å–å‡ºæ¥çš„æ•°å†™å›</li><li>Regwirte: Rå’Œlwè¦å†™å›æ‰€ä»¥ä¸º1ã€‚</li><li>MenRead: åªè¦lwè¦è¯»æ‰€ä»¥åªæœ‰lwä¸º1</li><li>MemWrite: åªæœ‰swè¦å†™</li><li>Branch: åªæœ‰branchæ‰è§¦å‘</li><li>ALUOP: Rä¸º10ï¼›å­˜å‚¨ä¸º00ï¼›branchä¸º01</li></ul><ul><li><p>è·³è½¬å®ç°ï¼ˆå³æ”¹å˜PCçš„å€¼ï¼‰</p><p>å…¶OPcodeä¸º2.ä½26ä½éƒ½æ˜¯offset_addressã€‚</p><p><img src="https://image.beenli.cn/img/20200820/PCxbE327wJVr.jpg?imageslim" alt="mark"></p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1ã€ALUæ§åˆ¶&quot;&gt;&lt;a href=&quot;#1ã€ALUæ§åˆ¶&quot; class=&quot;headerlink&quot; title=&quot;1ã€ALUæ§åˆ¶&quot;&gt;&lt;/a&gt;1ã€ALUæ§åˆ¶&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;MIPS ALUåœ¨4ä½æ§åˆ¶ä¿¡å·ä¸Šå®šä¹‰äº†6ç§æœ‰æ•ˆçš„è¾“å…¥ç»„åˆ&lt;/p&gt;
&lt;/bl</summary>
      
    
    
    
    <category term="CS" scheme="https://www.beenli.cn/categories/CS/"/>
    
    <category term="Computer Organization &amp; Design" scheme="https://www.beenli.cn/categories/CS/Computer-Organization-Design/"/>
    
    
    <category term="processor" scheme="https://www.beenli.cn/tags/processor/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®é€šè·¯(1)--Basic Datapath</title>
    <link href="https://www.beenli.cn/posts/74018a17/"/>
    <id>https://www.beenli.cn/posts/74018a17/</id>
    <published>2020-08-20T07:10:16.000Z</published>
    <updated>2020-09-27T11:08:18.082Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1ã€Preface"><a href="#1ã€Preface" class="headerlink" title="1ã€Preface"></a>1ã€Preface</h1><blockquote><p>è®¡ç®—æœºæ€§èƒ½ï¼šâ‘ æŒ‡ä»¤æ•°ç›®(ç¼–è¯‘å™¨å’ŒæŒ‡ä»¤é›†ï¼‰ï¼Œâ‘¡æ—¶é’Ÿå‘¨æœŸé•¿åº¦(ç»„åˆç”µè·¯æœ€å¤§å»¶æ—¶)ï¼Œâ‘¢æ¯æ¡æŒ‡ä»¤æ‰€éœ€è¦çš„æ—¶é’Ÿå‘¨æœŸæ•°(å¤„ç†å™¨æ¶æ„ï¼ŒæŒ‡ä»¤ç±»åˆ«ï¼Œå¤šå‘å°„è¶…æ ‡é‡æµæ°´)</p></blockquote><p>æœ¬ç¯‡åªæ˜¯ä¸€ä¸ªåŸºæœ¬çš„<code>MIPS</code>å®ç°ã€‚</p><ul><li>å­˜å‚¨å™¨è®¿é—®æŒ‡ä»¤ï¼šå–å­—(<code>lw</code>) å’Œå­˜å­—(<code>sw</code>)</li><li>ç®—æ•°é€»è¾‘æŒ‡ä»¤ï¼šåŠ æ³•(<code>add</code>)ã€å‡æ³•(<code>sub</code>)ã€ä¸è¿ç®—(<code>and</code>)ã€æˆ–è¿ç®—(<code>or</code>)å’Œå°äºåˆ™è®¾ç½®(<code>slt</code>)</li><li>åˆ†æ”¯æŒ‡ä»¤ï¼šç›¸ç­‰åˆ™åˆ†æ”¯(<code>beq</code>)å’Œè·³è½¬(<code>j</code>)</li></ul><p><img src="https://image.beenli.cn/img/20200820/yKiuzyrIln7F.jpg?imageslim" alt="mark"></p><ol><li><p><code>RæŒ‡ä»¤</code>å¯¹åº”ç®—æ•°é€»è¾‘æŒ‡ä»¤ã€‚(rs, rtå¯¹åº”ä¸¤ä¸ªæºæ“ä½œæ•°ï¼Œrdå¯¹åº”ç›®çš„å¯„å­˜å™¨)</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">add $t1, $t2, $t3 # $t1=$t2+$t3<br>slt $to, $s0, $a1 # reg $t0 = 0 if $s0 &gt;= $a1<br></code></pre></td></tr></tbody></table></figure></li><li><p><code>IæŒ‡ä»¤</code>å¯¹åº”è®¿å­˜å’Œåˆ†æ”¯æŒ‡ä»¤ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">sw $t1, offset_value($t2) # æŠŠ$t1çš„å€¼å­˜åˆ°ä»¥$t2ä¸ºåŸºå€åŠ ä¸Š16ä½åœ°å€åç§»ä¸Šå»ã€‚<br>  # rs=$t2, rt=$t1(ç›®æ ‡å¯„å­˜å™¨),[15:0]=offset<br>lw $t1, offset_value($t2) # æŠŠ$t2ä¸ºåŸºå€åŠ ä¸Š16ä½åœ°å€åç§»æ‰€åœ¨åœ°å€çš„å€¼å­˜åˆ°t1ã€‚<br>beq $t3, $zero, loop1  # if($t3==$zero) go to loop1<br>  # loop1æ˜¯å16ä½ã€‚rs=$t3,rt=$zero;<br></code></pre></td></tr></tbody></table></figure></li><li><p><code>JæŒ‡ä»¤</code>å¯¹åº”æ— æ¡ä»¶è·³è½¬</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">j for2tst  # jump tp for2tst<br></code></pre></td></tr></tbody></table></figure><h1 id="2ã€An-Overview-of-the-Implementation"><a href="#2ã€An-Overview-of-the-Implementation" class="headerlink" title="2ã€An Overview of the Implementation"></a>2ã€An Overview of the Implementation</h1></li></ol><ul><li>å®ç°æ¯æ¡æŒ‡ä»¤çš„å‰ä¸¤æ­¥æ˜¯ä¸€æ ·çš„<ol><li>ç¨‹åºè®¡æ•°å™¨(PC)æŒ‡å‘æŒ‡ä»¤æ‰€åœ¨çš„å­˜å‚¨å•å…ƒï¼Œå¹¶ä»ä¸­å–å‡ºæŒ‡ä»¤ã€‚(PCæ˜¯åœ°å€)</li><li>é€šè¿‡æŒ‡ä»¤å­—æ®µå†…å®¹ï¼Œé€‰æ‹©è¯»å–ä¸€ä¸ªæˆ–ä¸¤ä¸ªå¯„å­˜å™¨ã€‚å¯¹äºå–å­—æŒ‡ä»¤ï¼Œåªéœ€è¯»ä¸€ä¸ªå¯„å­˜å™¨å³<code>rs</code>,è€Œå…¶å®ƒå¤§å¤šæ•°æŒ‡ä»¤è¦æ±‚è¯»å–ä¸¤ä¸ªå¯„å­˜å™¨ï¼ˆ<code>rs</code>ï¼Œ <code>rt</code>)ã€‚</li></ol></li></ul><blockquote><p>å‰é¢ä¸¤æ­¥å®Œæˆåï¼Œä¸ºå®ŒæˆæŒ‡ä»¤è€Œè¿›è¡Œçš„åç»­æ­¥éª¤åˆ™å–å†³äºå…·ä½“çš„æŒ‡ä»¤ç±»å‹</p></blockquote><p><img src="https://image.beenli.cn/img/20200820/U2dhJ3SxBt84.jpg?imageslim" alt="mark"></p><ol><li>æ‰€æœ‰æŒ‡ä»¤ä¸­é™¤äº†<code>jump</code>ï¼Œåœ¨è¯»å–å¯„å­˜å™¨åéƒ½è¦ä½¿ç”¨ALUã€‚<ul><li>è®¿å­˜æŒ‡ä»¤ï¼šaddress calculation</li><li>ç®—æœ¯é€»è¾‘æŒ‡ä»¤ï¼šoperation execution</li><li>åˆ†æ”¯æŒ‡ä»¤ï¼šcomparison</li></ul></li><li>ALUä¹‹ååˆå„ä¸ç›¸åŒ<ul><li>è®¿é—®Data Memory: <code>storeæŒ‡ä»¤</code>è¦å†™å…¥æ•°æ®åˆ°data memoryï¼›<code>loadæŒ‡ä»¤</code>è¦ä»memoryè¯»æ•°æ®</li><li>å†™å›registers: <code>RæŒ‡ä»¤</code>éœ€è¦æŠŠALUè®¡ç®—çš„ç»“æœ; <code>loadæŒ‡ä»¤</code>è¦data memoryè¯»å‡ºçš„æ•°æ®</li><li>æ”¹å˜PC: å¦‚æœåˆ†æ”¯æˆç«‹é‚£ä¹ˆæ”¹å˜PCå€¼ï¼Œå¦åˆ™è‡ªå¢4ã€‚</li></ul></li></ol><h1 id="3ã€Building-a-Datapath"><a href="#3ã€Building-a-Datapath" class="headerlink" title="3ã€Building a Datapath"></a>3ã€Building a Datapath</h1><blockquote><p>æ•°æ®é€šè·¯éƒ¨ä»¶ï¼šä¸€ä¸ªç”¨æ¥æ“ä½œæˆ–ä¿å­˜å¤„ç†å™¨ä¸­æ•°æ®çš„å•å…ƒã€‚åœ¨MPISå®ç°ä¸­ï¼Œæ•°æ®é€šè·¯éƒ¨ä»¶åŒ…æ‹¬<code>æŒ‡ä»¤å­˜å‚¨å™¨</code>ã€<code>æ•°æ®å­˜å‚¨å™¨</code>ã€<code>å¯„å­˜å™¨å †</code>ã€<code>ALU</code>ã€<code>åŠ æ³•å™¨</code>.</p></blockquote><h2 id="3-1ã€basic-components"><a href="#3-1ã€basic-components" class="headerlink" title="3.1ã€basic components"></a>3.1ã€basic components</h2><p><img src="https://image.beenli.cn/img/20200820/N8jUdro8qK22.jpg?imageslim" alt="mark"></p><center>å–æŒ‡ä»¤ï¼Œæ›´æ–°æŒ‡ä»¤</center><p><img src="https://image.beenli.cn/img/20200820/mNdvEm8uGB4b.jpg?imageslim" alt="mark"></p><center>æ ¹æ®å¯„å­˜å™¨å·å–æ“ä½œæ•°è¿›è¡ŒALUè¿ç®—</center><p><img src="https://image.beenli.cn/img/20200820/wXPwKwvLR8RN.jpg?imageslim" alt="mark"></p><center>å‘å†…å­˜è¯»æˆ–è€…å†™æ•°æ®</center><h2 id="3-2ã€combination-components"><a href="#3-2ã€combination-components" class="headerlink" title="3.2ã€combination components"></a>3.2ã€combination components</h2><p><img src="https://image.beenli.cn/img/20200820/96jAaA7ct7r0.jpg?imageslim" alt="mark"></p><p><img src="https://image.beenli.cn/img/20200820/0PQCr6vCD7Dm.jpg?imageslim" alt="mark"></p><center>branchæŒ‡ä»¤éœ€è¦[15:0]å·¦ç§»ä¸¤ä½å¹¶ç¬¦å·æ‰©å±•åˆ°32ä½ä¸PCç›¸åŠ ç»„æˆæ–°çš„PC</center><h2 id="3-3ã€single-data-path"><a href="#3-3ã€single-data-path" class="headerlink" title="3.3ã€single data path"></a>3.3ã€single data path</h2><blockquote><p>å‡è®¾æˆ‘ä»¬åœ¨<code>ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸ</code>å†…æ‰§è¡Œä»»æ„ä¸€æ¡æŒ‡ä»¤ã€‚é‚£æ„å‘³ç€æ¯æ¡æŒ‡ä»¤ä¸èƒ½ç”¨æŸä¸ªéƒ¨ä»¶ä¸¤æ¬¡æˆ–ä»¥ä¸Šã€‚æ‰€ä»¥ä»»ä½•éœ€è¦é‡å¤çš„éƒ¨ä»¶éƒ½å¿…é¡»è¢«å¤åˆ¶ã€‚</p><p>1ã€éœ€è¦ä¸€ä¸ªæŒ‡ä»¤å­˜å‚¨å™¨å¤–ï¼Œè¿˜éœ€è¦ä¸€ä¸ªæ•°æ®å­˜å‚¨å™¨</p><p>2ã€å°½ç®¡æœ‰çš„åŠŸèƒ½å•å…ƒéœ€è¦å¤åˆ¶ï¼Œä½†åœ¨æ‰§è¡Œä¸åŒæŒ‡ä»¤æ—¶ï¼Œå¾ˆå¤šåŠŸèƒ½å•å…ƒå¯ä»¥è¢«å…±äº«(å¤ç”¨)</p></blockquote><p><img src="https://image.beenli.cn/img/20200820/v7L4zwoVuOAJ.jpg?imageslim" alt="mark"></p><center>å¤ç”¨ALUå’Œå¯„å­˜å™¨å †</center>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1ã€Preface&quot;&gt;&lt;a href=&quot;#1ã€Preface&quot; class=&quot;headerlink&quot; title=&quot;1ã€Preface&quot;&gt;&lt;/a&gt;1ã€Preface&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;è®¡ç®—æœºæ€§èƒ½ï¼šâ‘ æŒ‡ä»¤æ•°ç›®(ç¼–è¯‘å™¨å’ŒæŒ‡ä»¤é›†ï¼‰ï¼Œâ‘¡æ—¶é’Ÿå‘¨æœŸé•¿åº¦(</summary>
      
    
    
    
    <category term="CS" scheme="https://www.beenli.cn/categories/CS/"/>
    
    <category term="Computer Organization &amp; Design" scheme="https://www.beenli.cn/categories/CS/Computer-Organization-Design/"/>
    
    
    <category term="processor" scheme="https://www.beenli.cn/tags/processor/"/>
    
  </entry>
  
</feed>
